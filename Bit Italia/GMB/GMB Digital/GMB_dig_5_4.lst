MP2COD 3.80, COFF to COD File Converter
Copyright (c) 2004 Microchip Technology Inc.
Listing File Generated: Sat Sep 25 10:30:27 2004


Address  Value    Disassembly              Source                                                                           File
-------  -------  -----------------------  -------------------------------------------------------------------------------  -----
                                           ;************************************************************                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;	TITLE:	ECHO BUS multinodal control ----- Version for 9 ports IN, 8 out         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;	Programmer: GINO ISLA for BIT Srl.                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;	REVISION HISTORY:	08-11-03                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;	FREQUENCY: 4MHz                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;   **** ALL CHANGES MUST MADE IN GMB_dig_9_8.asm AND THEN PUT IN ***            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;   ****                   GMB_dig_5_4.asm       ***                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;************************************************************                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			list	p=16f628                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;#define		IN_9_OUT_8                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		IN_5_OUT_4                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #include	<p16f628.inc>                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                   LIST                                                                     C:\Embedded\GMB\GMB Digital\p16f628.inc
                                           ; P16F628.INC  Standard Header File, Version 1.01    Microchip Technology, Inc.  C:\Embedded\GMB\GMB Digital\p16f628.inc
                                                   LIST                                                                     C:\Embedded\GMB\GMB Digital\p16f628.inc
                                           #include 	<gmb_digital.h>                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           	ifdef	IN_9_OUT_8                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_NBR_OF_KEYS			8                                                        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_NBR_OF_PORTS			8                                                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_MAXBIT				3	;2**3 bit for port counting                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           	else                                                                            C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_NBR_OF_KEYS			4                                                        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_NBR_OF_PORTS			4                                                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_MAXBIT				2	;2**2 bit for port counting                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           	endif                                                                           C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;Pin usage definitions for the GMB ECHO BUS and other ports                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	OFF						0                                                               C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	ON						1                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	FALSE					0                                                              C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TRUE					1                                                               C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                                                                                                            C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_TIMER1_H				0x100-0x04	;1200 TICKS for 1ms                             C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_TIMER1_L				0x100-0xB0	;1200 TICKS                                     C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                                                                                                            C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_RX_TIMER				 5		;RX queus emptied every 5ms                            C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_TX_TIMER				15		;TX queus emptied every 15ms                           C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_TWENTYFIVEMS			25		;not used                                           C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_FIFTY_MS				50		;ALL SCHEDULED JOBS DELAY                              C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_SEVENTY_MS			70		;KEY SCAN TIMER                                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_HUNDRED_MS			100		;                                                    C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_ONESECOND				20		;LONG TIMER (TEMPORIZZATA, TAPPARELLA) based on 50ms tmr C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_ONEMINUTE				60		;scan time based on 1 seconds timer                   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_RXTIME				0xF0	;(=15 in high nibble) message retranmission counter     C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_BIT_0					91		;Duration (in clock ticks) of a '0' byte                 C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_BIT_1					63		;Duration (in clock ticks) of a '1' byte                 C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_BIT_SUP				120		;Max limit of of a bit during reception/transmission   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                                                                                                            C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define BUS_IN					PORTB,0                                                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define BUS_OUT					PORTB,1                                                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	KEY_IN					PORTB,2                                                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	MULTIKEY				PORTA,5                                                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;EEPROM ADDRESSES                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_MULTK_KEY_TIPO		EQU		33	;(33...40)tipo messaggio for MULTIKEY commands        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_STATO_USCITE			EQU		41	;save area for port states                             C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_TIPO_SCHEDA			EQU		42	;new, read only                                         C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_SW_VERSION			EQU		43	;new, read only                                          C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_RIT_USCITA			EQU		44	;new, delay activation of ports in the same zone         C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_RIT_SCHEDA			EQU		45	;new, delay activation of a scheda during zone command   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_RIT_MULTIC			EQU		46	;new, delay in sending multiple commands                 C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_POLARITA				EQU		47	;new, polarity of the port                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_SERIAL_NBR			EQU		48	;serial number                                           C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_PROGRAM_TYPE			EQU		49	;program type                                          C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_SCHEDA				EQU		50	;ingressi (ingresso 1..8)                                   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_USCITA_ZONA			EQU		58	;locazioni (ingresso 1..8)                              C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_USCITA_PORTA			EQU		66	;numerazione assegnata alla uscita (uscita 1..8)       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_FUNZIONE				EQU		74	;funzione (uscita 1..8)                                   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_TEMPO				EQU		82	;temporizzazione (uscita 1..8)                               C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_MULT_SCHEDA			EQU		90	;schede da comandare in multicomando                    C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_MULT_USCITA			EQU		98	;uscite da comandare in multicomando                    C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_ZONA_APPARTZA		EQU		106	;zone                                                 C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           EE_SGL_KEY_TIPO			EQU		114	;tipo messaggio for SINGLE KEY commands               C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;Protocol elements                                                               C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_NBR_PROTOCOL_BYTES 	6	;TYPE, SUB-TYPE, SERIAL, DISCRIMINATOR, ARGUMENT, SUMCHECK C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;---------------------------------------------------------                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_SIZE_RX_Q_ENTRY		5		;only message data, no CS                          C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_NBR_ENTRIES_RX		6		;Total size of RX_QUE = 30                          C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;---------------------------------------------------------                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;	Structure of the RX_QUEU:                                                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;	byte0 ... byte4 identical to the protocol messages                             C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;	minus the check sum since we don`t store it                                    C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;---------------------------------------------------------                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_SIZE_TX_Q_ENTRY		8		;includes the expiration, CS and key_to_port       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_NBR_ENTRIES_TX		6		;multicomms have to be process one by one           C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;---------------------------------------------------------                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;	Structure of the TX_QUEU:                                                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;	byte0 = expiraion counter (0=repeats expired)                                  C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;	byte1...byte5 = protocol bytes                                                 C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;	byte6 = checksum                                                               C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;	byte7 = key/port (ingresso/uscita) assignment                                  C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TX_EXPIRATION			0                                                        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TX_MSGTYPE				1                                                          C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TX_MSGSUBTYPE			2                                                        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TX_SERIAL				3                                                           C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TX_DISCRMINATOR			4                                                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TX_ARGUMENT				5                                                         C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TX_SUMCHECK				6                                                         C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TX_IN_OUT_KEY			7		;used for visualizzazione                             C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;---------------------------------------------------------                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;										;size of TX_QUE = 49                                                  C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	MAX_SINGLE_RETRIES		5		;Number of retries on single commands before giving up C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	MAX_MULTI_RETRIES		3		;Number of retries on multiple commands before giving up C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	MAX_ZONE_RETRIES		1		;No retries for zone commands                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TYPE_PROGRAMMAZIONE		170                                                 C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TYPE_RISPOSTA			 51                                                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TYPE_INTERROGAZIONE		119                                                 C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TYPE_FUNZIONAMENTO		 85                                                  C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_INVIO_MODULO		 16                                                   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_INVIO_ZONA			 17		;nuovo commando verso ZONA                        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_RISPO_MODULO		  0                                                   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_RISP_S_R			  7                                                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_INVIO_CPU			 34                                                     C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_RISPO_CPU			  2                                                     C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_ALLARME_C			128                                                     C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_RISPO_C			 70                                                       C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_RICH_CPU			 33                                                      C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	SUBT_RISTAT_CPU			  1                                                    C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                                                                                                            C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;Tipo Programma                                                                  C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	INGRESSO_USCITA		 	 15                                                   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	INGRESSO_VISUAL			240                                                    C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	ING_USC_RC				 51                                                        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;Fuzione                                                                         C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	NON_USATA				 0                                                          C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	MONOSTABILE				 3                                                        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	INVERTITORE				12                                                        C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	PASSOPASSO				48                                                         C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TAPPARELLA				51                                                         C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;#define SETRESET		   		192  - NOT USED                                          C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	TEMPORIZZATA	   		204                                                    C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	VISUALIZZAZIONE			240                                                    C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           ;Tipo messagio                                                                   C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_NORMALE				0                                                           C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_SET					1                                                              C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_RESET					2                                                            C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                           #define	C_ALLARME				3                                                           C:\Embedded\GMB\GMB Digital\gmb_digital.h
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002007   3f54     ADDLW     0x54           	__CONFIG _BODEN_ON&_CP_OFF&_PWRTE_ON&_WDT_ON&_INTRC_OSC_NOCLKOUT&_MCLRE_OFF&_LVP_OFF&_DATA_CP_OFF C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           	ERRORLEVEL -302                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           	UDATA                                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TIME_SCAN_TX		RES		1	;reduced timer to treat the msg TX QUE                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TIME_SCAN_RX		RES		1	;reduced timer to treat the msg RX QUE                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TIME_ALL_SCAN		RES		1	;reduced timer for periodic jobs                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TIME_KEY_SCAN		RES		1	;reduced timer for KEY scanning                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TEMP_BYT0			RES		1	;general purpose byte hold                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TEMP_BYT1			RES		1	;general purpose byte hold                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TEMP_BYT2			RES		1	;general purpose byte hold                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           BIT_0				RES		1	;length of a '0' bit                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           FLAGS0				RES 	1	;miscellaneous flags (see below)                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           FLAGS1				RES 	1	;miscellaneous flags (see below)                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           OWN_SERIAL			RES		1	;These are the mirror registers of their equivalent in EEPROM C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           OWN_PROGRAM			RES		1	;program type                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           POLARITA			RES		1	;Port polarity (neg/pos)                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           FUNZIONE			RES		8	;Port functions                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SCHEDA				RES		1	;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           USCITA				RES		1	;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MULTICOM			RES		1	;Counter for next multicommands (no multi command pending=8)   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MULT_ITNVAL			RES		1	;base for delay between multiple commands                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MULTIMER			RES		1	;Time counter between commands (multiples of 50ms)             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ACTIVE_ZONE			RES		1	;Zone number for which port actions are pending in this scheda C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ZONE_COUNTR			RES		1	;Counter for next zone command (no zone action pending=8)   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ZONE_INTVAL			RES		1	;base for delay between multiple                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ZONETIMER			RES		1	;Time counter between zone commands (multiples of 50ms)       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SCHEDA_DELAY2		RES		1	;To extend the delay of RIT_SCHEDA using 50ms delay iso of 100ms C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ZONE_COMMAND		RES		1	;New state for the porta in a zone (could be forced)        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ZONE_PORTS			RES		1	;Ports that were changed when executing zone command - for reply message C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ONE_SECOND			RES		1	;1 second reduced counter                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           PORT_MINUTES		RES		8	;Number of minutes until shutoff (temporizzate, tapparella) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           PORT_SECONDS		RES		8	;Number of seconds until shutoff (temporizzate, tapparella) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TIMER_INFO			RES		1	;temporary use of temporizzatto                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           OWN_PORT_TAP		RES		1	;own port for TAPPARELLA function                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           OTHRPORT_TAP		RES		1	;other port for TAPPARELLA function                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           OWNSTATE			RES		1	;own state for TAPPARELLA                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           OTHRSTATE			RES		1	;other side state for TAPPARELLA                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           PORTSTATE			RES		1	;Bit array for state of the ports                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           PRTSTATES			RES		1	;Bit array for state of the ports                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           FRONTE				RES		1	;1/0 for salita/discesa                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           NBR_PORT			RES		1	;port counter                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           GET_PORT			RES		1	;  "    "   used in READ_ALL_PORT_STATES                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           RD_WR_PORT			RES		1	;  "    "     "   " to access port state                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           NBR_ENTRIES			RES		1	;nbr of entries in the qeueus                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           WAIT_BUS_CLEAR		RES		1	;wait period to get hold of the bus                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           KEY_COUNTER			RES		1	;Identifies the KEY (tasto) being scanned                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           KEY_MASK			RES		1	;Local storage for PORTB                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           PREV_KEYS			RES		1	;previous state of the keys                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           KEY_CHANGES			RES		1	;Array of changed keys since last scan                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           KEYSTATES			RES		1	;Current state of all keys                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           KEY_STATE			RES		1	;Current state of a single key                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Variables starting with I_ are used ONLY during interrupts handling             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_STATUS_TEMP		RES		1	;save environment                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_FSR_TEMP			RES		1	;  "	"                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_TEMP_BIT			RES 	1	;general purpose bit hold during interrupt handling          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_TEMP_BYT0			RES		1	;general purpose byte hold during interrupt handling        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_NBR_BITS			RES		1	;general purpose bit counter during interrupt handling       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_NBR_BYTES			RES		1	;general purpose byte counter during interrupt handling     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_SUPERVISION		RES		1	;supervision of wait for IN_BUS status change              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_FREE_RX_Q			RES		1	;start of the free RX_QUEU entry                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           E2ADDRESS			RES		1	;address for EEPROM                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           E2VALUE				RES		1	;data to write in EEPROM                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           Bank1Data 			UDATA	                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TX_QUEU				RES		(C_SIZE_TX_Q_ENTRY*C_NBR_ENTRIES_TX)	;reserved space for sending data C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           RX_QUEU				RES		(C_SIZE_RX_Q_ENTRY*C_NBR_ENTRIES_RX)	;reserve space incoming msgs (no SUM_CHK) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           Bank2Data			UDATA                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           GARBAGE_CAN			RES		10	;in case no RX messages available, put unwanted message here C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           	UDATA_SHR					;Common bank                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           I_W_TEMP			RES		1	;save environment                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TEMP_BIT			RES 	1	;general purpose bit hold                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           NBR_BITS			RES		1	;general purpose bit counter                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           NBR_BYTES			RES		1	;general purpose byte counter                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TX_MSG_START		RES		1	;Begining of a msg in the RX_QUEU                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           RX_MSG_START		RES		1	;Begining of a msg in the RX_QUEU                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MSG_EXPIRE			RES		1	;number of mesage sends until expiration                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MSG_TYPE			RES		1	;COMMAND TYPE                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MSG_SUBT			RES		1	;COMMAND SUBTYPE                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MSG_SERL			RES		1	;SERIAL NUMBER                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MSG_DISC			RES		1	;DISCRIMINATOR                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MSG_ARGT			RES		1	;ARGUMENT                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TEMP_SC				RES		1	;byte to hold SC                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           KEY_TO_PORT			RES		1	;For VISUALIZZAZIONE, to drive the opposing port to this key C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Miscellaneous flags                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_MULTIKEY_NOW	FLAGS0,0	;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_MULTIKEY_PRE	FLAGS0,1	;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_REP_KEY_READ	FLAGS0,2	;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_DELAY_SCHEDA	FLAGS0,3	;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_ABORT_RX_FLAG	FLAGS0,4	;                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_BUS_IS_MINE	FLAGS0,5	;                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_SERIAL_MATCH	FLAGS0,6	;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_MSG_FOUND		FLAGS0,7	;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_STATEZONE_KEY	FLAGS1,0	;                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_ZONE_MSG_SNT	FLAGS1,1	;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_INITIALIZING	FLAGS1,2	;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_DEFER_MSG		FLAGS1,3	;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           #define		F_HAVE_VISUAL	FLAGS1,4	;                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           	CODE                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Reset Vector							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			org 	0x00				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000000   018a     CLRF      0xa            			CLRF	PCLATH				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000001   0183     CLRF      0x3            			CLRF	STATUS				;BANK 0 REGISTERS                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000002   28a7     GOTO      0xa7           			GOTO	Start				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ; Interrupt Vector						;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			org 	0x04				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000004   2bbe     GOTO      0x3be          			GOTO	Service_Interrupt	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Begining of executable code			;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			org		0x05				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Table lookup for key interface with CD4051.  Returns the correct bit sequence for C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;the port number (RB5,RB4,RB3 and  RB0,RB1,RB0)                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000005   0782     ADDWF     0x2,0x1        SELECT_KEY	ADDWF	PCL,F				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000006   3404     RETLW     0x4            			RETLW	b'00000100'			;RB7,RB6 || Key 1 0x00 || RB2,RB1,RB0                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000007   3424     RETLW     0x24           			RETLW	b'00100100'			;	"		Key 2 0x20			"                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000008   3414     RETLW     0x14           			RETLW	b'00010100'			;	"		Key 3 0x10			"                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000009   3434     RETLW     0x34           			RETLW	b'00110100'			;	"		Key 4 0x30			"                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00000a   340c     RETLW     0xc            			RETLW	b'00001100'			;	"		Key 5 0x08			"                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00000b   342c     RETLW     0x2c           			RETLW	b'00101100'			;	"		Key 6 0x28			"                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00000c   341c     RETLW     0x1c           			RETLW	b'00011100'			;	"		Key 7 0x18			"                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00000d   343c     RETLW     0x3c           			RETLW	b'00111100'			;	"		Key 8 0x38			"                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Truth tables for different function types of the ports                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUTS:	W<0,1> = operands (INPUT,CURRENT STATE)                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUTS:	W<0>=ON/OFF                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TABLE_MONOSTABILE						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00000e   0782     ADDWF     0x2,0x1        			ADDWF	PCL,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00000f   3400     RETLW     0x0            			RETLW	OFF					;W=b'00000000'                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000010   3400     RETLW     0x0            			RETLW	OFF					;W=b'00000001'                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000011   3401     RETLW     0x1            			RETLW	ON					;W=b'00000010'                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000012   3401     RETLW     0x1            			RETLW	ON					;W=b'00000011'                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TABLE_INVERTITORE						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000013   0782     ADDWF     0x2,0x1        			ADDWF	PCL,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000014   3401     RETLW     0x1            			RETLW	ON					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000015   3400     RETLW     0x0            			RETLW	OFF					;	"                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000016   3401     RETLW     0x1            			RETLW	ON					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000017   3400     RETLW     0x0            			RETLW	OFF					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           TABLE_PASSOPASSO						;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000018   0782     ADDWF     0x2,0x1        			ADDWF	PCL,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000019   3400     RETLW     0x0            			RETLW	OFF					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00001a   3401     RETLW     0x1            			RETLW	ON					;	"                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00001b   3401     RETLW     0x1            			RETLW	ON					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00001c   3400     RETLW     0x0            			RETLW	OFF					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Read port state.                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		W = PORT NUMBER                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	PORT_STATE<0> has the current state of the port                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           READ_PORT_STATE							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00001d   00dc     MOVWF     0x5c           			MOVWF	RD_WR_PORT			;save port number                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00001e   0782     ADDWF     0x2,0x1        			ADDWF	PCL,F				;go read the correct port bit                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00001f   2827     GOTO      0x27           			GOTO	_RPORT0				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000020   282a     GOTO      0x2a           			GOTO	_RPORT1				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000021   282d     GOTO      0x2d           			GOTO	_RPORT2				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000022   2830     GOTO      0x30           			GOTO	_RPORT3				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000023   2833     GOTO      0x33           			GOTO	_RPORT4				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000024   2836     GOTO      0x36           			GOTO	_RPORT5				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000025   2839     GOTO      0x39           			GOTO	_RPORT6				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000026   283c     GOTO      0x3c           			GOTO	_RPORT7				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000027   1805     BTFSC     0x5,0x0        _RPORT0		BTFSC	PORTA,0				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000028   1457     BSF       0x57,0x0       			BSF		PORTSTATE,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000029   283e     GOTO      0x3e           			GOTO	_RPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00002a   1885     BTFSC     0x5,0x1        _RPORT1		BTFSC	PORTA,1				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00002b   1457     BSF       0x57,0x0       			BSF		PORTSTATE,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00002c   283e     GOTO      0x3e           			GOTO	_RPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00002d   1905     BTFSC     0x5,0x2        _RPORT2		BTFSC	PORTA,2				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00002e   1457     BSF       0x57,0x0       			BSF		PORTSTATE,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00002f   283e     GOTO      0x3e           			GOTO	_RPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000030   1985     BTFSC     0x5,0x3        _RPORT3		BTFSC	PORTA,3				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000031   1457     BSF       0x57,0x0       			BSF		PORTSTATE,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000032   283e     GOTO      0x3e           			GOTO	_RPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000033   1b86     BTFSC     0x6,0x7        _RPORT4		BTFSC	PORTB,7				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000034   1457     BSF       0x57,0x0       			BSF		PORTSTATE,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000035   283e     GOTO      0x3e           			GOTO	_RPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000036   1b05     BTFSC     0x5,0x6        _RPORT5		BTFSC	PORTA,6				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000037   1457     BSF       0x57,0x0       			BSF		PORTSTATE,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000038   283e     GOTO      0x3e           			GOTO	_RPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000039   1b85     BTFSC     0x5,0x7        _RPORT6		BTFSC	PORTA,7				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00003a   1457     BSF       0x57,0x0       			BSF		PORTSTATE,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00003b   283e     GOTO      0x3e           			GOTO	_RPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00003c   1b06     BTFSC     0x6,0x6        _RPORT7		BTFSC	PORTB,6				;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00003d   1457     BSF       0x57,0x0       			BSF		PORTSTATE,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00003e   0adc     INCF      0x5c,0x1       _RPORT_FIN	INCF	RD_WR_PORT,F		;                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00003f   082c     MOVF      0x2c,0x0       			MOVF	POLARITA,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000040   00a5     MOVWF     0x25           			MOVWF	TEMP_BYT1			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000041   0bdc     DECFSZ    0x5c,0x1       _RD_POL		DECFSZ	RD_WR_PORT,F		;adjust the state according to polarization bit    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000042   2844     GOTO      0x44           			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000043   2846     GOTO      0x46           			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000044   0ca5     RRF       0x25,0x1       			RRF		TEMP_BYT1,F			;rotate TEMP_BYT1 till bit <0> has the correct polarity of this port C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000045   2841     GOTO      0x41           			GOTO	_RD_POL				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000046   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000047   06a5     XORWF     0x25,0x1       			XORWF	TEMP_BYT1,F			;TEMP_BYT1<0> now has the state of the port               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000048   0cd7     RRF       0x57,0x1       			RRF		PORTSTATE,F			;shift to prepare PORTSTATE<0>                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000049   0ca5     RRF       0x25,0x1       			RRF		TEMP_BYT1,F			;STATUS<C> has the polarized value of the port             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00004a   0dd7     RLF       0x57,0x1       			RLF		PORTSTATE,F			;  move it into PORTSTATE<0>                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00004b   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Write to a port taken into consideration the polarity defined in EEPROM.        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		W = port number, PORTSTATE=new state                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	modified port state                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           WRITE_PORT_STATE						;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00004c   00dc     MOVWF     0x5c           			MOVWF	RD_WR_PORT			;save port number                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00004d   1929     BTFSC     0x29,0x2       			BTFSC	F_INITIALIZING		;ignore polarity (during START ports are read as is)    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00004e   285d     GOTO      0x5d           			GOTO	_WRITE_TAB			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00004f   0a5c     INCF      0x5c,0x0       			INCF	RD_WR_PORT,W		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000050   00f3     MOVWF     0x73           			MOVWF	NBR_BITS			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000051   082c     MOVF      0x2c,0x0       			MOVF	POLARITA,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000052   00a5     MOVWF     0x25           			MOVWF	TEMP_BYT1			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000053   0bf3     DECFSZ    0x73,0x1       _WR_POL		DECFSZ	NBR_BITS,F			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000054   2856     GOTO      0x56           			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000055   2858     GOTO      0x58           			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000056   0ca5     RRF       0x25,0x1       			RRF		TEMP_BYT1,F			;rotate TEMP_BYT1 till bit <0> has the polarity of this port C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000057   2853     GOTO      0x53           			GOTO	_WR_POL				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000058   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000059   06a5     XORWF     0x25,0x1       			XORWF	TEMP_BYT1,F			;TEMP_BYT1<0> now has the OUTPUT value of the port        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00005a   0cd7     RRF       0x57,0x1       			RRF		PORTSTATE,F			;shift to prepare PORTSTATE<0>                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00005b   0ca5     RRF       0x25,0x1       			RRF		TEMP_BYT1,F			;STATUS<C> has the OUTPUT value of the port                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00005c   0dd7     RLF       0x57,0x1       			RLF		PORTSTATE,F			;  move it into PORTSTATE<0>                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00005d   085c     MOVF      0x5c,0x0       _WRITE_TAB	MOVF	RD_WR_PORT,W		;                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00005e   0782     ADDWF     0x2,0x1        			ADDWF	PCL,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00005f   2867     GOTO      0x67           			GOTO	_WPORT0				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000060   286c     GOTO      0x6c           			GOTO	_WPORT1				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000061   2871     GOTO      0x71           			GOTO	_WPORT2				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000062   2876     GOTO      0x76           			GOTO	_WPORT3				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000063   287b     GOTO      0x7b           			GOTO	_WPORT4				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000064   2880     GOTO      0x80           			GOTO	_WPORT5				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000065   2885     GOTO      0x85           			GOTO	_WPORT6				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000066   288a     GOTO      0x8a           			GOTO	_WPORT7				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000067   1c57     BTFSS     0x57,0x0       _WPORT0		BTFSS	PORTSTATE,0			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000068   1005     BCF       0x5,0x0        			BCF		PORTA,0				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000069   1857     BTFSC     0x57,0x0       			BTFSC	PORTSTATE,0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00006a   1405     BSF       0x5,0x0        			BSF		PORTA,0				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00006b   288e     GOTO      0x8e           			GOTO	_WPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00006c   1c57     BTFSS     0x57,0x0       _WPORT1		BTFSS	PORTSTATE,0			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00006d   1085     BCF       0x5,0x1        			BCF		PORTA,1				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00006e   1857     BTFSC     0x57,0x0       			BTFSC	PORTSTATE,0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00006f   1485     BSF       0x5,0x1        			BSF		PORTA,1				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000070   288e     GOTO      0x8e           			GOTO	_WPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000071   1c57     BTFSS     0x57,0x0       _WPORT2		BTFSS	PORTSTATE,0			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000072   1105     BCF       0x5,0x2        			BCF		PORTA,2				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000073   1857     BTFSC     0x57,0x0       			BTFSC	PORTSTATE,0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000074   1505     BSF       0x5,0x2        			BSF		PORTA,2				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000075   288e     GOTO      0x8e           			GOTO	_WPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000076   1c57     BTFSS     0x57,0x0       _WPORT3		BTFSS	PORTSTATE,0			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000077   1185     BCF       0x5,0x3        			BCF		PORTA,3				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000078   1857     BTFSC     0x57,0x0       			BTFSC	PORTSTATE,0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000079   1585     BSF       0x5,0x3        			BSF		PORTA,3				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00007a   288e     GOTO      0x8e           			GOTO	_WPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00007b   1c57     BTFSS     0x57,0x0       _WPORT4		BTFSS	PORTSTATE,0			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00007c   1386     BCF       0x6,0x7        			BCF		PORTB,7				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00007d   1857     BTFSC     0x57,0x0       			BTFSC	PORTSTATE,0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00007e   1786     BSF       0x6,0x7        			BSF		PORTB,7				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00007f   288e     GOTO      0x8e           			GOTO	_WPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000080   1c57     BTFSS     0x57,0x0       _WPORT5		BTFSS	PORTSTATE,0			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000081   1305     BCF       0x5,0x6        			BCF		PORTA,6				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000082   1857     BTFSC     0x57,0x0       			BTFSC	PORTSTATE,0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000083   1705     BSF       0x5,0x6        			BSF		PORTA,6				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000084   288e     GOTO      0x8e           			GOTO	_WPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000085   1c57     BTFSS     0x57,0x0       _WPORT6		BTFSS	PORTSTATE,0			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000086   1385     BCF       0x5,0x7        			BCF		PORTA,7				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000087   1857     BTFSC     0x57,0x0       			BTFSC	PORTSTATE,0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000088   1785     BSF       0x5,0x7        			BSF		PORTA,7				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000089   288e     GOTO      0x8e           			GOTO	_WPORT_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00008a   1c57     BTFSS     0x57,0x0       _WPORT7		BTFSS	PORTSTATE,0			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00008b   1306     BCF       0x6,0x6        			BCF		PORTB,6				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00008c   1857     BTFSC     0x57,0x0       			BTFSC	PORTSTATE,0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00008d   1706     BSF       0x6,0x6        			BSF		PORTB,6				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _WPORT_FIN								;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00008e   1929     BTFSC     0x29,0x2       			BTFSC	F_INITIALIZING		;don't rewrite port states during START                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00008f   28a6     GOTO      0xa6           			GOTO	_END_WRITE_PORT		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	READ_ALL_PORT_STATES; *** CALL ELIMINATED, STACK REDUCTION              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000090   01d7     CLRF      0x57           			CLRF	PORTSTATE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000091   01d8     CLRF      0x58           			CLRF	PRTSTATES			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000092   01db     CLRF      0x5b           			CLRF	GET_PORT			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000093   085b     MOVF      0x5b,0x0       _READ_PORT2	MOVF	GET_PORT,W			;                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000094   201d     CALL      0x1d           			CALL	READ_PORT_STATE		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000095   0cd7     RRF       0x57,0x1       			RRF		PORTSTATE,F			;portstate in STATUS<C>                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000096   0cd8     RRF       0x58,0x1       			RRF		PRTSTATES,F			;port state in PRTSTATES<8>                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000097   0adb     INCF      0x5b,0x1       			INCF	GET_PORT,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000098   085b     MOVF      0x5b,0x0       			MOVF	GET_PORT,W			;8 OR 4                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000099   3a04     XORLW     0x4            			XORLW	C_NBR_OF_PORTS		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00009a   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00009b   2893     GOTO      0x93           			GOTO	_READ_PORT2			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00009c   0858     MOVF      0x58,0x0       			MOVF	PRTSTATES,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00009d   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                             ifdef IN_5_OUT_4                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00009e   0ed7     SWAPF     0x57,0x1        			SWAPF	PORTSTATE,F			;only 4 ports read, make sure portstate bit occupy lower nibble C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00009f   300f     MOVLW     0xf            			MOVLW	0x0F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a0   05d7     ANDWF     0x57,0x1       			ANDWF	PORTSTATE,F			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                             endif                                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a1   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a2   00ee     MOVWF     0x6e           			MOVWF	E2VALUE				;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a3   3029     MOVLW     0x29           			MOVLW	EE_STATO_USCITE		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a4   00ed     MOVWF     0x6d           			MOVWF	E2ADDRESS			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a5   2650     CALL      0x650          			CALL	COPY_TO_EEPROM		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _END_WRITE_PORT							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a6   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;WARNING, ALL PROCEDURES ABOVE THIS REFERENCE JUMP TABLES, DON'T MOVE THEM!      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;++++++++++++++++++++++++ START OF THE PROGRAM +++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           Start									;                                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			BSF		STATUS,RP0			;leave out comments when no debug                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			BTFSC	PCON,1				;POWER ON?                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			GOTO	_NO_RESET			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a7   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a8   138b     BCF       0xb,0x7        			BCF		INTCON,GIE			;Disable interrupts                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000a9   3007     MOVLW     0x7            			MOVLW	0x07				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000aa   009f     MOVWF     0x1f           			MOVWF	CMCON				;comparator p.57                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ab   0185     CLRF      0x5            			CLRF	PORTA				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ac   0186     CLRF      0x6            			CLRF	PORTB				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ad   01e1     CLRF      0x61           			CLRF	PREV_KEYS			;Initialize local varialbles                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ae   01e2     CLRF      0x62           			CLRF	KEY_CHANGES			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000af   1683     BSF       0x3,0x5        			BSF		STATUS,RP0			;BANK 1 REGISTERS                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b0   018c     CLRF      0xc            			CLRF	PIE1				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b1   308b     MOVLW     0x8b           			MOVLW	b'10001011'			;OPTION<6>=0=int on falling edge RB0, ...SELECT TMR0 AND WDT OPTION C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b2   0081     MOVWF     0x1            			MOVWF	OPTION_REG			;PortB pullups disabled                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b3   3020     MOVLW     0x20           			MOVLW	b'00100000'			;RA5 = multitasto IN                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b4   0085     MOVWF     0x5            			MOVWF	TRISA				;RA7,RA6,RA3,RA2,RA1,RA0 + RB5, RB7 = USCITE                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           	ifdef	IN_9_OUT_8                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			MOVLW	b'00100000'			;RA5 = multitasto IN                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			MOVWF	TRISA				;RA7,RA6,RA3,RA2,RA1,RA0 + RB5, RB7 = USCITE                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			MOVLW	b'00000111'			;9_8: RB0=ECHOBUS OUT, RB1=ECHOBUS IN, RB2=IN KEYS        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			MOVWF	TRISB				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           	else                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b5   30e0     MOVLW     0xe0           			MOVLW	b'11100000'			;RA5 = multitasto IN                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b6   0085     MOVWF     0x5            			MOVWF	TRISA				;RA7,RA6,RA3,RA2,RA1,RA0 + RB5, RB7 = USCITE                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b7   30ff     MOVLW     0xff           			MOVLW	b'11111111'			;5_IN_4_OUT: RB0=ECHOBUS OUT, RB1=ECHOBUS IN, RB2,RB3,RB4,RB5=IN KEYS C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b8   0086     MOVWF     0x6            			MOVWF	TRISB				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           	endif	                                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000b9   30a0     MOVLW     0xa0           			MOVLW	TX_QUEU				;Clear the tx queu with zeroes                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ba   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000bb   3030     MOVLW     0x30           			MOVLW	C_SIZE_TX_Q_ENTRY*C_NBR_ENTRIES_TX	;                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000bc   00f4     MOVWF     0x74           			MOVWF	NBR_BYTES			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000bd   0103     CLRW                     			CLRW						;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000be   0080     MOVWF     0x0            _CLR_TX		MOVWF	INDF				;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000bf   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c0   0bf4     DECFSZ    0x74,0x1       			DECFSZ	NBR_BYTES,F			;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c1   28be     GOTO      0xbe           			GOTO	_CLR_TX				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c2   30d0     MOVLW     0xd0           			MOVLW	RX_QUEU				;Clear the RX_QUEU queu with -1s                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c3   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c4   301e     MOVLW     0x1e           			MOVLW	C_SIZE_RX_Q_ENTRY*C_NBR_ENTRIES_RX	;                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c5   00f4     MOVWF     0x74           			MOVWF	NBR_BYTES			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c6   30ff     MOVLW     0xff           			MOVLW	0xFF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c7   0080     MOVWF     0x0            _CLR_RX		MOVWF	INDF				;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c8   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000c9   0bf4     DECFSZ    0x74,0x1       			DECFSZ	NBR_BYTES,F			;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ca   28c7     GOTO      0xc7           			GOTO	_CLR_RX				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000cb   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000cc   01f4     CLRF      0x74           			CLRF	NBR_BYTES			;clear all LONG TIMERS (MINUTES and SECONDS                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000cd   3042     MOVLW     0x42           			MOVLW	PORT_MINUTES		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ce   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000cf   0180     CLRF      0x0            _TEMPO_TMRS	CLRF	INDF				;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d0   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d1   0af4     INCF      0x74,0x1       			INCF	NBR_BYTES,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d2   1e74     BTFSS     0x74,0x4       			BTFSS	NBR_BYTES,4			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d3   28cf     GOTO      0xcf           			GOTO	_TEMPO_TMRS			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d4   01bc     CLRF      0x3c           			CLRF	ZONE_INTVAL			;not active                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d5   01bd     CLRF      0x3d           			CLRF	ZONETIMER			;not active                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d6   01a8     CLRF      0x28           			CLRF	FLAGS0				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d7   01a9     CLRF      0x29           			CLRF	FLAGS1				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d8   01c0     CLRF      0x40           			CLRF	ZONE_PORTS			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000d9   3008     MOVLW     0x8            			MOVLW	8					;MULTICOM =8  means last multikey command has been processed      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000da   00b7     MOVWF     0x37           			MOVWF	MULTICOM			;(i.e. no more multicommands left to process)                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000db   00bb     MOVWF     0x3b           			MOVWF	ZONE_COUNTR			;(i.e no zone actions pending)                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000dc   3001     MOVLW     0x1            			MOVLW	1					;to force re-read of EEPROM                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000dd   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000de   2626     CALL      0x626          			CALL	READ_STABLE_DATA	;Read operating parameters from EEPROM                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;Reset ALL reduced timers and counters                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000df   1683     BSF       0x3,0x5        _NO_RESET	BSF		STATUS,RP0			;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e0   148e     BSF       0xe,0x1        			BSF		PCON,1				;set POR bit (1=no POR)                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e1   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e2   3005     MOVLW     0x5            			MOVLW	C_RX_TIMER			;Reset basic timers                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e3   00a1     MOVWF     0x21           			MOVWF	TIME_SCAN_RX		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e4   300f     MOVLW     0xf            			MOVLW	C_TX_TIMER			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e5   00a0     MOVWF     0x20           			MOVWF	TIME_SCAN_TX		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e6   3046     MOVLW     0x46           			MOVLW	C_SEVENTY_MS		;key_scan and job_scan start at different times           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e7   00a2     MOVWF     0x22           			MOVWF	TIME_ALL_SCAN		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e8   3032     MOVLW     0x32           			MOVLW	C_FIFTY_MS			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000e9   00a3     MOVWF     0x23           			MOVWF	TIME_KEY_SCAN		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ea   3014     MOVLW     0x14           			MOVLW	C_ONESECOND			;start seconds timer                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000eb   00c1     MOVWF     0x41           			MOVWF	ONE_SECOND			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ec   1529     BSF       0x29,0x2       			BSF		F_INITIALIZING		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ed   3029     MOVLW     0x29           			MOVLW	EE_STATO_USCITE		;reset ports to original values                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ee   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ef   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f0   01f4     CLRF      0x74           			CLRF	NBR_BYTES			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NXT_PORT_INI							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f1   0874     MOVF      0x74,0x0       			MOVF	NBR_BYTES,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f2   204c     CALL      0x4c           			CALL	WRITE_PORT_STATE	;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f3   0cd7     RRF       0x57,0x1       			RRF		PORTSTATE,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f4   0af4     INCF      0x74,0x1       			INCF	NBR_BYTES,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f5   1d74     BTFSS     0x74,0x2       			BTFSS	NBR_BYTES,C_MAXBIT	;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f6   28f1     GOTO      0xf1           			GOTO	_NXT_PORT_INI		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f7   1129     BCF       0x29,0x2       			BCF		F_INITIALIZING		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f8   30fc     MOVLW     0xfc           			MOVLW	C_TIMER1_H			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000f9   008f     MOVWF     0xf            			MOVWF	TMR1H				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000fa   3050     MOVLW     0x50           			MOVLW	C_TIMER1_L			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000fb   008e     MOVWF     0xe            			MOVWF	TMR1L				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000fc   100c     BCF       0xc,0x0        			BCF		PIR1,TMR1IF			;clear TMR1 interrupt flag                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000fd   3001     MOVLW     0x1            			MOVLW	b'00000001'			;prescale 1:1, internal clk,TMR1ON                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000fe   0090     MOVWF     0x10           			MOVWF	T1CON				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0000ff   3090     MOVLW     0x90           			MOVLW	b'10010000'			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000100   008b     MOVWF     0xb            			MOVWF	INTCON				;INTCON<4>=enbable RB0 ints                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000101   0064     CLRWDT                   _MAIN_LOOP	CLRWDT						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000102   1c0c     BTFSS     0xc,0x0        			BTFSS	PIR1,TMR1IF			;TIMR1 expired?                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000103   291f     GOTO      0x11f          			GOTO	_IDLE				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000104   100c     BCF       0xc,0x0        			BCF		PIR1,TMR1IF			;clear TMR1 interrupt flag                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000105   30fc     MOVLW     0xfc           			MOVLW	C_TIMER1_H			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000106   008f     MOVWF     0xf            			MOVWF	TMR1H				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000107   3050     MOVLW     0x50           			MOVLW	C_TIMER1_L			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000108   008e     MOVWF     0xe            			MOVWF	TMR1L				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000109   0ba1     DECFSZ    0x21,0x1       			DECFSZ	TIME_SCAN_RX,F		;SCAN RX QUEU every 5ms                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00010a   290e     GOTO      0x10e          			GOTO	_SCAN_TX			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00010b   2965     GOTO      0x165          			GOTO	SCAN_RX_QUEU		;GOTO ISO CALLs for STACK REDUCTION                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00010c   3005     MOVLW     0x5            _RET1		MOVLW	C_RX_TIMER			;reset RX timer                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00010d   00a1     MOVWF     0x21           			MOVWF	TIME_SCAN_RX		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00010e   0ba0     DECFSZ    0x20,0x1       _SCAN_TX	DECFSZ	TIME_SCAN_TX,F		;SCAN TX QUEU every 15ms                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00010f   2913     GOTO      0x113          			GOTO	_SCAN_JOBS			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000110   2a47     GOTO      0x247          			GOTO	SCAN_TX_QUEU		;GOTO ISO CALLs for STACK REDUCTION                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000111   300f     MOVLW     0xf            _RET2		MOVLW	C_TX_TIMER			;reset TX timer                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000112   00a0     MOVWF     0x20           			MOVWF	TIME_SCAN_TX		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000113   0ba2     DECFSZ    0x22,0x1       _SCAN_JOBS	DECFSZ	TIME_ALL_SCAN,F		;every 50ms                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000114   291a     GOTO      0x11a          			GOTO	_KEYS_SCAN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000115   2aa4     GOTO      0x2a4          			GOTO	ZONE_NEXT_COMM		;ZONE and MULTIKEY procs use additional reduced counters  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000116   2af7     GOTO      0x2f7          _RET3		GOTO	MULTIKEY_NEXT_COMM	; (based on the 50ms TIME_ALL_SCAN)               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000117   2b46     GOTO      0x346          _RET4		GOTO	CHECK_LONG_TIMERS	;This uses reduced counters based on 1 second counter C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000118   3032     MOVLW     0x32           _RET5		MOVLW	C_FIFTY_MS			;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000119   00a2     MOVWF     0x22           			MOVWF	TIME_ALL_SCAN		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00011a   0ba3     DECFSZ    0x23,0x1       _KEYS_SCAN	DECFSZ	TIME_KEY_SCAN,F		;                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00011b   291f     GOTO      0x11f          			GOTO	_IDLE				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00011c   2920     GOTO      0x120          			GOTO	SCAN_KEYS			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00011d   3032     MOVLW     0x32           _RET6		MOVLW	C_FIFTY_MS			;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00011e   00a3     MOVWF     0x23           			MOVWF	TIME_KEY_SCAN		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00011f   2901     GOTO      0x101          _IDLE		GOTO	_MAIN_LOOP			;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;This procedure scans all the keys starting with the KEY for multiple commands and C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;then the keys connected to the CD4051.  When variation in any of the key states are  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;detected, the appropiate procedures will be called to store messages in the TX_QUEU. C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Multiple commands as a result of a variation of the MULTIKEY will be created one at C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;a time under the control of its own reduced timer.                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;(Interface with CD4051: RB3, RB4, RB5  ->>  inputs C,B,A)                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000120   1db7     BTFSS     0x37,0x3       SCAN_KEYS	BTFSS	MULTICOM,3			;multiple command is active if the counter is =/ 8, C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000121   2942     GOTO      0x142          			GOTO	_SINGLE_KEY			;do not read the multikey until the multiple command is    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;finished                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000122   1a85     BTFSC     0x5,0x5        			BTFSC	MULTIKEY			;no multicommand running, read the port                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000123   1428     BSF       0x28,0x0       			BSF		F_MULTIKEY_NOW		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000124   1e85     BTFSS     0x5,0x5        			BTFSS	MULTIKEY			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000125   1028     BCF       0x28,0x0       			BCF		F_MULTIKEY_NOW		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000126   3001     MOVLW     0x1            			MOVLW	1					;F_MULTIKEY_NOW=0/1                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000127   0528     ANDWF     0x28,0x0       			ANDWF	FLAGS0,W			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000128   1029     BCF       0x29,0x0       			BCF		F_STATEZONE_KEY		;SAVE THE STATE OF THE MULTIKEY (in case its for a zone) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000129   04a9     IORWF     0x29,0x1       			IORWF	FLAGS1,F			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00012a   00e3     MOVWF     0x63           			MOVWF	KEYSTATES			;KEYSTATES<0> = new state of multikey                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00012b   0c28     RRF       0x28,0x0       			RRF		FLAGS0,W			;W<0>=F_MULTIKEY_PRE (e.g. previous state of multikey)        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00012c   0663     XORWF     0x63,0x0       			XORWF	KEYSTATES,W			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00012d   00e2     MOVWF     0x62           			MOVWF	KEY_CHANGES			;KEY_CHANGES<0> =1= key changed                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00012e   1c62     BTFSS     0x62,0x0       			BTFSS	KEY_CHANGES,0		;check for variations                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00012f   2942     GOTO      0x142          			GOTO	_SINGLE_KEY			;no variation in multikey                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000130   1928     BTFSC     0x28,0x2       			BTFSC	F_REP_KEY_READ		;crude debounce method, on first key change detection, just  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000131   2934     GOTO      0x134          			GOTO	_MULKY_CON			; set the F_REPEAT_READ flag, action occurs only            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000132   1528     BSF       0x28,0x2       			BSF		F_REP_KEY_READ		; on second detection                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000133   2942     GOTO      0x142          			GOTO	_SINGLE_KEY			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000134   1128     BCF       0x28,0x2       _MULKY_CON	BCF		F_REP_KEY_READ		;MULTIKEY has changed for the 2nd time, save new state as previous state: C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000135   30fd     MOVLW     0xfd           			MOVLW	b'11111101'			;reset F_MULTIKEY_PRE                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000136   05a8     ANDWF     0x28,0x1       			ANDWF	FLAGS0,F			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000137   0d63     RLF       0x63,0x0       			RLF		KEYSTATES,W			;now copy F_MULTIKEY_NOW into it                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000138   3902     ANDLW     0x2            			ANDLW	b'00000010'			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000139   04a8     IORWF     0x28,0x1       			IORWF	FLAGS0,F			;FLAGS0<1>=F_MULTIKEY_PRE                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00013a   302e     MOVLW     0x2e           			MOVLW	EE_RIT_MULTIC		;read the delay between multiple commands                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00013b   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00013c   00b8     MOVWF     0x38           			MOVWF	MULT_ITNVAL			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00013d   00b9     MOVWF     0x39           			MOVWF	MULTIMER			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00013e   01b7     CLRF      0x37           			CLRF	MULTICOM			;start the multikey command counter                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00013f   3001     MOVLW     0x1            			MOVLW	1					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000140   0563     ANDWF     0x63,0x0       			ANDWF	KEYSTATES,W			;KEYSTATES<0> has the state of KEYS(KEY_COUNTER)          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000141   00e4     MOVWF     0x64           			MOVWF	KEY_STATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;---------------------------------------;                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000142   239b     CALL      0x39b          _SINGLE_KEY	CALL	READ_IN_KEYS		;check individual keys                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000143   0863     MOVF      0x63,0x0       			MOVF	KEYSTATES,W			;KEYSTATES has the current state of the keys               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000144   0661     XORWF     0x61,0x0       			XORWF	PREV_KEYS,W			;Detect if any KEY variations                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000145   00e2     MOVWF     0x62           			MOVWF	KEY_CHANGES			;'1' in the position(s) of the key(s) that have changed   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000146   08e2     MOVF      0x62,0x1       			MOVF	KEY_CHANGES,F		;check for any changes                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000147   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000148   2964     GOTO      0x164          			GOTO	_KEY_SCAN_DONE		;No more changes (or no changes at all)                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000149   1928     BTFSC     0x28,0x2       			BTFSC	F_REP_KEY_READ		;crude debounce method, on first key change detection, just  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00014a   294d     GOTO      0x14d          			GOTO	_SGLKY_CON			; set the F_REPEAT_READ flag, action occurs only            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00014b   1528     BSF       0x28,0x2       			BSF		F_REP_KEY_READ		; on second detection                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00014c   2964     GOTO      0x164          			GOTO	_KEY_SCAN_DONE		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00014d   1128     BCF       0x28,0x2       _SGLKY_CON	BCF		F_REP_KEY_READ		;                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00014e   0863     MOVF      0x63,0x0       			MOVF	KEYSTATES,W			;Save the current state as previous state                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00014f   00e1     MOVWF     0x61           			MOVWF	PREV_KEYS			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000150   3004     MOVLW     0x4            			MOVLW	C_NBR_OF_KEYS		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000151   00f3     MOVWF     0x73           			MOVWF	NBR_BITS			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000152   01df     CLRF      0x5f           			CLRF	KEY_COUNTER			;KEYS(0..7)                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NEXT_KEY_CHG							;Loop to find which key(s) have changed                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000153   08e2     MOVF      0x62,0x1       			MOVF	KEY_CHANGES,F		;(executes until KEY_CHANGES becomes 0 if not already)    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000154   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000155   2964     GOTO      0x164          			GOTO	_KEY_SCAN_DONE		;No more changes (or no changes at all)                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000156   1003     BCF       0x3,0x0        			CLRC						;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000157   0ce2     RRF       0x62,0x1       			RRF		KEY_CHANGES,F		;this loop executes until KEY_CHANGES                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000158   1c03     BTFSS     0x3,0x0        			BTFSS	STATUS,C			;This key changed?                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000159   295e     GOTO      0x15e          			GOTO	_NOT_THIS_KEY		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00015a   3001     MOVLW     0x1            			MOVLW	1					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00015b   0563     ANDWF     0x63,0x0       			ANDWF	KEYSTATES,W			;KEYSTATES<0> has the state of KEYS(KEY_COUNTER)          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00015c   00e4     MOVWF     0x64           			MOVWF	KEY_STATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00015d   24a8     CALL      0x4a8          			CALL	KEY_ACTION			;KEY_STATE & KEY_COUNTER are inputs to KEY__ACTION          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NOT_THIS_KEY							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00015e   0ce3     RRF       0x63,0x1       			RRF		KEYSTATES,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00015f   0bf3     DECFSZ    0x73,0x1       			DECFSZ	NBR_BITS,F			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000160   2962     GOTO      0x162          			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000161   2964     GOTO      0x164          			GOTO	_KEY_SCAN_DONE		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000162   0adf     INCF      0x5f,0x1       			INCF	KEY_COUNTER,F		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000163   2953     GOTO      0x153          			GOTO	_NEXT_KEY_CHG		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _KEY_SCAN_DONE							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			RETURN						;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000164   291d     GOTO      0x11d          			GOTO	_RET6				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Scan the RX queu to see if we have any pending commands to perform.  Note that ALL C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;messages in the BUS have been received by the interrupt procedure, here we throw C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;away everything that is not ours.                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SCAN_RX_QUEU							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000165   1228     BCF       0x28,0x4       			BCF		F_ABORT_RX_FLAG		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000166   3006     MOVLW     0x6            			MOVLW	C_NBR_ENTRIES_RX	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000167   00a4     MOVWF     0x24           			MOVWF	TEMP_BYT0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000168   30d0     MOVLW     0xd0           			MOVLW	RX_QUEU				;Find a msg in the RX_QUEU                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000169   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00016a   30ff     MOVLW     0xff           _FIND_RX_Q	MOVLW	0xFF				;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00016b   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00016c   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00016d   2973     GOTO      0x173          			GOTO	_RX_MSG_FOUND		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00016e   3005     MOVLW     0x5            			MOVLW	C_SIZE_RX_Q_ENTRY	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00016f   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000170   0ba4     DECFSZ    0x24,0x1       			DECFSZ	TEMP_BYT0,F			;		                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000171   296a     GOTO      0x16a          			GOTO	_FIND_RX_Q			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000172   2a46     GOTO      0x246          			GOTO	_RXQ_FIN			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RX_MSG_FOUND							;msg found, analyze -> BREAKPOINT MESSAGE RECEIVED           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000173   0804     MOVF      0x4,0x0        			MOVF	FSR,W				;Save RX msg start                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000174   00f6     MOVWF     0x76           			MOVWF	RX_MSG_START		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	COPY_FROM_RX		;move the message to the SHARED data area                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Moves a RECEIVED message from the RX_QUEU to the SHARED bank (MSG_TYPE...MSG_BYTE4) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		RX_MSG_START                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	BYT0...BYTE4 filled with a copy of the msg                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           COPY_FROM_RX							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000175   0876     MOVF      0x76,0x0       			MOVF	RX_MSG_START,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000176   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000177   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;COMMAND_TYPE                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000178   00f8     MOVWF     0x78           			MOVWF	MSG_TYPE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000179   0a84     INCF      0x4,0x1        			INCF	FSR,F				;COMMAND_SUB_TYPE                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00017a   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00017b   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00017c   0a84     INCF      0x4,0x1        			INCF	FSR,F				;SERIAL                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00017d   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00017e   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00017f   0a84     INCF      0x4,0x1        			INCF	FSR,F				;DISCRMINATOR                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000180   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000181   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000182   0a84     INCF      0x4,0x1        			INCF	FSR,F				;ARGUMENT                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000183   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000184   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			RETURN						;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000185   0878     MOVF      0x78,0x0       			MOVF	MSG_TYPE,W			;command type 85                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000186   3a55     XORLW     0x55           			XORLW	TYPE_FUNZIONAMENTO	;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000187   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000188   29ab     GOTO      0x1ab          			GOTO	_FUNZIONAMENTO		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000189   0878     MOVF      0x78,0x0       			MOVF	MSG_TYPE,W			;command type 170                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00018a   3aaa     XORLW     0xaa           			XORLW	TYPE_PROGRAMMAZIONE	;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00018b   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00018c   2992     GOTO      0x192          			GOTO	_PROGRAMMAZIONE		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00018d   0878     MOVF      0x78,0x0       			MOVF	MSG_TYPE,W			;command type 119                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00018e   3a77     XORLW     0x77           			XORLW	TYPE_INTERROGAZIONE	;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00018f   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000190   29a7     GOTO      0x1a7          			GOTO	_INTERROGAZIONE		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000191   2a3f     GOTO      0x23f          			GOTO	_DISCARD			;Unknown or untreated (e.g. 51) message type - throw away     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _PROGRAMMAZIONE							;FSR -> RX msg                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000192   25c8     CALL      0x5c8          			CALL	CHECK_SERIAL		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000193   1f28     BTFSS     0x28,0x6       			BTFSS	F_SERIAL_MATCH		;(170,X,NS,DISCRIMINATOR,ARGUMENT)                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000194   2a3f     GOTO      0x23f          			GOTO	_DISCARD			;NOT a msg for us                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000195   087b     MOVF      0x7b,0x0       			MOVF	MSG_DISC,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000196   00ed     MOVWF     0x6d           			MOVWF	E2ADDRESS			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000197   087c     MOVF      0x7c,0x0       			MOVF	MSG_ARGT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000198   00ee     MOVWF     0x6e           			MOVWF	E2VALUE				;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000199   2650     CALL      0x650          			CALL	COPY_TO_EEPROM		;Put msg data into EEPROM                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00019a   2626     CALL      0x626          			CALL	READ_STABLE_DATA	;reread new parameters                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00019b   25bc     CALL      0x5bc          			CALL	SEND_PROG_REPLY		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00019c   3001     MOVLW     0x1            			MOVLW	1					;Check if programmazione is for a ZONE                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00019d   0679     XORWF     0x79,0x0       			XORWF	MSG_SUBT,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00019e   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00019f   2a3f     GOTO      0x23f          			GOTO	_DISCARD			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a0   303a     MOVLW     0x3a           			MOVLW	EE_USCITA_ZONA		;Do not delete this message, instead                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a1   027b     SUBWF     0x7b,0x0       			SUBWF	MSG_DISC,W			; convert it to a message for EE_SCHEDA and write 0 to it  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a2   3e32     ADDLW     0x32           			ADDLW	EE_SCHEDA			; to indicate zone command                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a3   00ed     MOVWF     0x6d           			MOVWF	E2ADDRESS			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a4   01ee     CLRF      0x6e           			CLRF	E2VALUE				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a5   2650     CALL      0x650          			CALL	COPY_TO_EEPROM		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a6   2a3f     GOTO      0x23f          			GOTO	_DISCARD			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _INTERROGAZIONE							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a7   25c8     CALL      0x5c8          			CALL	CHECK_SERIAL		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a8   1b28     BTFSC     0x28,0x6       			BTFSC	F_SERIAL_MATCH		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001a9   25bc     CALL      0x5bc          			CALL	SEND_PROG_REPLY		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001aa   2a3f     GOTO      0x23f          			GOTO	_DISCARD			;Finished                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _FUNZIONAMENTO							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	FUNZIONAMENTO		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Analyze command sub-type (for type 85) and react accordingly                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		msg in SHARED bank                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           FUNZIONAMENTO							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ab   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ac   3a10     XORLW     0x10           			XORLW	SUBT_INVIO_MODULO	;16                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ad   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ae   29c8     GOTO      0x1c8          			GOTO	_INVIO_MODULO		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001af   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b0   3a11     XORLW     0x11           			XORLW	SUBT_INVIO_ZONA		;17                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b1   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b2   29d8     GOTO      0x1d8          			GOTO	_INVIO_ZONA			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b3   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b4   3a00     XORLW     0x0            			XORLW	SUBT_RISPO_MODULO	;0                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b5   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b6   29fe     GOTO      0x1fe          			GOTO	_RISPO_MODULO_O_CPU	;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b7   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b8   3a46     XORLW     0x46           			XORLW	SUBT_RISPO_C		;70 (REPLY TO ALLARM MESSAGE)                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001b9   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ba   29fe     GOTO      0x1fe          			GOTO	_RISPO_MODULO_O_CPU	;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001bb   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001bc   3a22     XORLW     0x22           			XORLW	SUBT_INVIO_CPU		;34                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001bd   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001be   29d0     GOTO      0x1d0          			GOTO	_INVIO_CPU			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001bf   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c0   3a02     XORLW     0x2            			XORLW	SUBT_RISPO_CPU		;2                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c1   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c2   29fe     GOTO      0x1fe          			GOTO	_RISPO_MODULO_O_CPU	;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c3   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c4   3a21     XORLW     0x21           			XORLW	SUBT_RICH_CPU		;33                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c5   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c6   2a2c     GOTO      0x22c          			GOTO	_RICH_CPU			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c7   2a3f     GOTO      0x23f          			GOTO	_FUNZ_FIN			;SUBTYPE NOT TREATED (128,70,1,7) OR UNKNOWN                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _INVIO_MODULO							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c8   25c8     CALL      0x5c8          			CALL	CHECK_SERIAL		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001c9   1f28     BTFSS     0x28,0x6       			BTFSS	F_SERIAL_MATCH		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ca   2a3f     GOTO      0x23f          			GOTO	_FUNZ_FIN			;NOT a msg for us                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001cb   251c     CALL      0x51c          			CALL	PORT_ACTION			;action message for us                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001cc   3000     MOVLW     0x0            			MOVLW	SUBT_RISPO_MODULO	;start filling reply parameters (0)                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001cd   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ce   258a     CALL      0x58a          			CALL	SEND_ACTION_REPLY	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001cf   2a3f     GOTO      0x23f          			GOTO	_FUNZ_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _INVIO_CPU								;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d0   25c8     CALL      0x5c8          			CALL	CHECK_SERIAL		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d1   1f28     BTFSS     0x28,0x6       			BTFSS	F_SERIAL_MATCH		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d2   2a3f     GOTO      0x23f          			GOTO	_FUNZ_FIN			;NOT a msg for us                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d3   251c     CALL      0x51c          			CALL	PORT_ACTION			;action message for us                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d4   3002     MOVLW     0x2            			MOVLW	SUBT_RISPO_CPU		;start filling reply parameters (2)                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d5   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d6   258a     CALL      0x58a          			CALL	SEND_ACTION_REPLY	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d7   2a3f     GOTO      0x23f          			GOTO	_FUNZ_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _INVIO_ZONA								;we only handle ONE zone number at a time                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	MANAGE_ZONE_CNTRS	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;(85,17,ZN,0,[ON|OFF])                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;A message for a zone has arrived, analyse to see if we have a port assigned to it  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;and starts the necessary counters.                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		msg in SHARED datat                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MANAGE_ZONE_CNTRS						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d8   19bb     BTFSC     0x3b,0x3       			BTFSC	ZONE_COUNTR,3		;zone command is already active (counter is =/ 8)        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001d9   29dc     GOTO      0x1dc          			GOTO	_MANAGE_CNT			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001da   15a9     BSF       0x29,0x3       			BSF		F_DEFER_MSG			;don't treat the message but keep it                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001db   29fd     GOTO      0x1fd          			GOTO	_NO_ZONE			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001dc   01bb     CLRF      0x3b           _MANAGE_CNT	CLRF	ZONE_COUNTR			;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001dd   01c0     CLRF      0x40           			CLRF	ZONE_PORTS			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001de   08fa     MOVF      0x7a,0x1       			MOVF	MSG_SERL,F			;MSG_SERL is now MSG_zone                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001df   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e0   29eb     GOTO      0x1eb          			GOTO	_START_COUNTERS		;all schede belong to ZONE 0                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e1   083b     MOVF      0x3b,0x0       _NXT_ZONE	MOVF	ZONE_COUNTR,W		;                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e2   3e6a     ADDLW     0x6a           			ADDLW	EE_ZONA_APPARTZA	;read zone assignments from EEPROM                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e3   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e4   067a     XORWF     0x7a,0x0       			XORWF	MSG_SERL,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e5   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;do we have a port assigned to this zone?                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e6   29eb     GOTO      0x1eb          			GOTO	_START_COUNTERS		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e7   0abb     INCF      0x3b,0x1       			INCF	ZONE_COUNTR,F		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e8   19bb     BTFSC     0x3b,0x3       			BTFSC	ZONE_COUNTR,3		;all zones                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001e9   29fd     GOTO      0x1fd          			GOTO	_NO_ZONE			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ea   29e1     GOTO      0x1e1          			GOTO	_NXT_ZONE			;check if next port asssigned to this ZONE                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _START_COUNTERS							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001eb   302d     MOVLW     0x2d           			MOVLW	EE_RIT_SCHEDA		;read the delay for SCHEDA activation                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ec   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ed   00bd     MOVWF     0x3d           			MOVWF	ZONETIMER			;this 2 reduced timers serve to duplicate the delay in EE_RIT_SCHEDA C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ee   00be     MOVWF     0x3e           			MOVWF	SCHEDA_DELAY2		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ef   15a8     BSF       0x28,0x3       			BSF		F_DELAY_SCHEDA		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f0   302c     MOVLW     0x2c           			MOVLW	EE_RIT_USCITA		;read the delay for inter USCITA activation              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f1   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f2   00bc     MOVWF     0x3c           			MOVWF	ZONE_INTVAL			;this timer for all subsequent activations                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f3   087a     MOVF      0x7a,0x0       _TIMR_CONT	MOVF	MSG_SERL,W			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f4   00ba     MOVWF     0x3a           			MOVWF	ACTIVE_ZONE			;zone being commanded                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f5   01bb     CLRF      0x3b           			CLRF	ZONE_COUNTR			;start counter                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f6   087c     MOVF      0x7c,0x0       			MOVF	MSG_ARGT,W			;assume normal                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;determine type of action                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f7   00bf     MOVWF     0x3f           			MOVWF	ZONE_COMMAND		;ZONE_COMMAND: 	0=normal off                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f8   08fb     MOVF      0x7b,0x1       			MOVF	MSG_DISC,F			;				1=normal on                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001f9   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;				2=forced off                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001fa   29fd     GOTO      0x1fd          			GOTO	_NO_ZONE			;				3=forced on                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001fb   3002     MOVLW     0x2            			MOVLW	2					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001fc   07bf     ADDWF     0x3f,0x1       			ADDWF	ZONE_COMMAND,F		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NO_ZONE	;RETURN						;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001fd   2a3f     GOTO      0x23f          			GOTO	_FUNZ_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RISPO_MODULO_O_CPU						;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	REPLY_TO_MY_MSG		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;85,[0|2|70],SN,USCITA|E,STATE                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;A scheda has replied to a command (MSG 85):                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;a) Check the TX_QUEU and match serial and USCITA COMANDATA, if a match is found,  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;   delete it from the QUE.                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;b) Check to see if we are VISUALIZZAZIONE port, if we do, match serial and port to it C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;   to see if this is a delayed reply (e.g. TEMPORIZZATA or ZONE command) and match the C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;   reported state to the corresponding port.                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		msg in SHARED data                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	TX_QUEU entry = null                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           REPLY_TO_MY_MSG							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001fe   13a8     BCF       0x28,0x7       			BCF		F_MSG_FOUND			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0001ff   30a0     MOVLW     0xa0           			MOVLW	TX_QUEU				;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000200   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000201   3006     MOVLW     0x6            			MOVLW	C_NBR_ENTRIES_TX	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000202   00f4     MOVWF     0x74           			MOVWF	NBR_BYTES			;shared bank                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _TRY_NEXT_TXQ							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000203   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;Skip empty entry (0 = entry not used)                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000204   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000205   2a1f     GOTO      0x21f          			GOTO	_NOT_THIS_MSG		;Empty message                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000206   0804     MOVF      0x4,0x0        			MOVF	FSR,W				;FSR -> start of free TX msg                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000207   00f5     MOVWF     0x75           			MOVWF	TX_MSG_START		;non empty TX entry                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000208   3003     MOVLW     0x3            			MOVLW	TX_SERIAL			;point to serial number                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000209   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;FSR -> serial number of TX entry                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00020a   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00020b   067a     XORWF     0x7a,0x0       			XORWF	MSG_SERL,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00020c   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00020d   2a1f     GOTO      0x21f          			GOTO	_NOT_THIS_MSG		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00020e   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;if this is a reply to an alarm, a match on SN is enough    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00020f   3a46     XORLW     0x46           			XORLW	SUBT_RISPO_C		;70                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000210   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000211   2a1b     GOTO      0x21b          			GOTO	_DELETE_MSG			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000212   0a84     INCF      0x4,0x1        			INCF	FSR,F				;not an alarm...FSR -> TX_DISCRMINATOR (uscita da comandare)    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000213   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000214   057b     ANDWF     0x7b,0x0       			ANDWF	MSG_DISC,W			;at least one match in the reply must be made with the ports sent C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000215   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000216   2a1f     GOTO      0x21f          			GOTO	_NOT_THIS_MSG		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;TX msg found, see if we need to mirror the state                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000217   3003     MOVLW     0x3            			MOVLW	3					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000218   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;FSR -> TX_IN_OUT_KEY                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000219   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;key that was pressed to produce the command                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00021a   2596     CALL      0x596          			CALL	PROC_VISUALIZZAZIONE;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00021b   0875     MOVF      0x75,0x0       _DELETE_MSG	MOVF	TX_MSG_START,W		;IT CAN NOW BE DELETED                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00021c   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00021d   0180     CLRF      0x0            			CLRF	INDF				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00021e   2a25     GOTO      0x225          			GOTO	_TXD_Q_SEAR			;we're done with this msg in the queu                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NOT_THIS_MSG							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00021f   0bf4     DECFSZ    0x74,0x1       			DECFSZ	NBR_BYTES,F			;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000220   2a22     GOTO      0x222          			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000221   2a25     GOTO      0x225          			GOTO	_TXD_Q_SEAR			;no more messages                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000222   3008     MOVLW     0x8            			MOVLW	C_SIZE_TX_Q_ENTRY	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000223   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000224   2a03     GOTO      0x203          			GOTO	_TRY_NEXT_TXQ		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;FI                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000225   01da     CLRF      0x5a           _TXD_Q_SEAR	CLRF	NBR_PORT			;Now check if this state has to be mirrored          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000226   085a     MOVF      0x5a,0x0       _NXT_VISUAL	MOVF	NBR_PORT,W			;see if this is a delayed  message from a TEMPORIZZATA or TAPPARELLA C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000227   2596     CALL      0x596          			CALL	PROC_VISUALIZZAZIONE;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000228   0ada     INCF      0x5a,0x1       			INCF	NBR_PORT,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000229   1d5a     BTFSS     0x5a,0x2       			BTFSS	NBR_PORT,C_MAXBIT	;check all ports                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00022a   2a26     GOTO      0x226          			GOTO	_NXT_VISUAL			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _END_REPLY	;RETURN						;return REPLY_TO_MY_MSG                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00022b   2a3f     GOTO      0x23f          			GOTO	_FUNZ_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RICH_CPU								;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00022c   25c8     CALL      0x5c8          			CALL	CHECK_SERIAL		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00022d   1f28     BTFSS     0x28,0x6       			BTFSS	F_SERIAL_MATCH		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00022e   2a3f     GOTO      0x23f          			GOTO	_FUNZ_FIN			;NOT a msg for us                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00022f   3001     MOVLW     0x1            			MOVLW	SUBT_RISTAT_CPU		;(1) Reply to query from CPU                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000230   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	SND_PORT_PARS		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Get states of inputs and outputs and report back to the CPU                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		msg in SHARED data                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	                                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SND_PORT_PARS							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000231   239b     CALL      0x39b          			CALL	READ_IN_KEYS		; returns KEYSTATES                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000232   0863     MOVF      0x63,0x0       			MOVF	KEYSTATES,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000233   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000234   23ac     CALL      0x3ac          			CALL	READ_ALL_PORT_STATES; returns PORTSTATE                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000235   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000236   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000237   25ce     CALL      0x5ce          			CALL	FIND_EMPTY_TX_Q		;try to send the message                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000238   1ba8     BTFSC     0x28,0x7       			BTFSC	F_MSG_FOUND			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000239   2a3c     GOTO      0x23c          			GOTO	_SND_PORT_PARMS		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00023a   2644     CALL      0x644          			CALL	ERROR_HANDLER		;ERROR: NO TX ENTRY AVAILABLE FOR REPLY                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00023b   2a3f     GOTO      0x23f          			GOTO	_PORT_PARS_FIN		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _SND_PORT_PARMS							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00023c   3001     MOVLW     0x1            			MOVLW	1					;send only once                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00023d   00f7     MOVWF     0x77           			MOVWF	MSG_EXPIRE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00023e   2606     CALL      0x606          			CALL	COPY_TO_TX			;RX msg will be discarded on return                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _PORT_PARS_FIN							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			RETURN						;return SND_PORT_PARS                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _FUNZ_FIN	;RETURN						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00023f   19a9     BTFSC     0x29,0x3       _DISCARD	BTFSC	F_DEFER_MSG			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000240   2a45     GOTO      0x245          			GOTO	_CLEAR_DISC			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000241   0876     MOVF      0x76,0x0       			MOVF	RX_MSG_START,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000242   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000243   30ff     MOVLW     0xff           			MOVLW	0xFF				;Release RX message                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000244   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000245   11a9     BCF       0x29,0x3       _CLEAR_DISC	BCF		F_DEFER_MSG			;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RXQ_FIN	;RETURN						;STACK REDUCTION                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000246   290c     GOTO      0x10c          			GOTO	_RET1				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Scan the TX QUEUE to see if there is a messaqge to be transmitted               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SCAN_TX_QUEU							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000247   30a0     MOVLW     0xa0           			MOVLW	TX_QUEU				;TX_QUEU in bank1: address only with FSR (IRP=0)             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000248   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000249   3006     MOVLW     0x6            			MOVLW	C_NBR_ENTRIES_TX	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00024a   00dd     MOVWF     0x5d           			MOVWF	NBR_ENTRIES			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00024b   0800     MOVF      0x0,0x0        _FIND_TX	MOVF	INDF,W				;Skip empty entry (0 = entry not used)                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00024c   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00024d   2a5a     GOTO      0x25a          			GOTO	_NXT_FIND_TX		;not a rdy message                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _CANDIDATE_FOUND						;a non-empty TX msg has been found                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00024e   0804     MOVF      0x4,0x0        			MOVF	FSR,W				;Save pointer to entry in case we need to send                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00024f   00f5     MOVWF     0x75           			MOVWF	TX_MSG_START		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000250   0e00     SWAPF     0x0,0x0        			SWAPF	INDF,W				;Look at                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000251   390f     ANDLW     0xf            			ANDLW	0x0F				;IF REXMIT counter = 0                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000252   00a4     MOVWF     0x24           			MOVWF	TEMP_BYT0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000253   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000254   2a60     GOTO      0x260          			GOTO	_MSG_FOUND			;   send the message                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000255   03a4     DECF      0x24,0x1       			DECF	TEMP_BYT0,F			;ELSE                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000256   300f     MOVLW     0xf            			MOVLW	0x0F				;   decrement REXMIT counter                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000257   0580     ANDWF     0x0,0x1        			ANDWF	INDF,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000258   0e24     SWAPF     0x24,0x0       			SWAPF	TEMP_BYT0,W			;				                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000259   0480     IORWF     0x0,0x1        			IORWF	INDF,F				;END                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NXT_FIND_TX							;find another candidate                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00025a   0bdd     DECFSZ    0x5d,0x1       			DECFSZ	NBR_ENTRIES,F		;Continue searching for                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00025b   2a5d     GOTO      0x25d          			GOTO	$+2					; something to send                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00025c   2aa1     GOTO      0x2a1          			GOTO	_NO_MORE_MSG		;Give up, no msgs to send                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00025d   3008     MOVLW     0x8            			MOVLW	C_SIZE_TX_Q_ENTRY	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00025e   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00025f   2a4b     GOTO      0x24b          			GOTO	_FIND_TX			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _MSG_FOUND	;CALL	TAKE_BUS			;BEAKPOINT FOR TX MSG TO BE SENT                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Take ownership of the bus.  Since arriving messages are handled via interrupts, the wait C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;for collision can be allowed to be very short.  If a message arrives during this wait C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;(e.g. we were interrupted) we will abandon the attempt to send until the next cycle  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;(interrupt service resets F_BUS_IS_MINE).  We do this done to allow greater spacing between  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;messages being sent from different schede.                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000260   16a8     BSF       0x28,0x5       TAKE_BUS	BSF		F_BUS_IS_MINE		;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000261   0801     MOVF      0x1,0x0        			MOVF	TMR0,W				;Random value of TMR0                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000262   00de     MOVWF     0x5e           			MOVWF	WAIT_BUS_CLEAR		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000263   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;avoid waits of 0 cycles, add serial number                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000264   2a67     GOTO      0x267          			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000265   082a     MOVF      0x2a,0x0       			MOVF	OWN_SERIAL,W		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000266   07de     ADDWF     0x5e,0x1       			ADDWF	WAIT_BUS_CLEAR,F	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000267   1806     BTFSC     0x6,0x0        _CHK_BUS	BTFSC	BUS_IN				;test for free bus                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000268   2a6b     GOTO      0x26b          			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000269   12a8     BCF       0x28,0x5       			BCF		F_BUS_IS_MINE		;Impossible situtation: if someone had taken it, we would  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00026a   2aa1     GOTO      0x2a1          			GOTO	_NO_MORE_MSG		;  have been interrupted, but...                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00026b   1ea8     BTFSS     0x28,0x5       			BTFSS	F_BUS_IS_MINE		;If we were interrupted while waiting to take the bus (means a msg C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00026c   2aa1     GOTO      0x2a1          			GOTO	_NO_MORE_MSG		; has just arrived), abandon until next cycle - see Service_Interr C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00026d   0bde     DECFSZ    0x5e,0x1       			DECFSZ	WAIT_BUS_CLEAR,F	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00026e   2a67     GOTO      0x267          			GOTO	_CHK_BUS			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00026f   1ea8     BTFSS     0x28,0x5       			BTFSS	F_BUS_IS_MINE		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000270   2aa1     GOTO      0x2a1          			GOTO	_NO_MORE_MSG		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000271   1683     BSF       0x3,0x5        			BSF		STATUS,RP0			;WE OWN THE BUS!                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000272   1086     BCF       0x6,0x1        			BCF		TRISB,1				;put RB1 in output                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000273   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000274   138b     BCF       0xb,0x7        			BCF		INTCON,GIE			;From here on we operate without interrupts                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000275   1086     BCF       0x6,0x1        			BCF		BUS_OUT				;Take ownership                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			BSF		F_BUS_IS_MINE		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			;RETURN						;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			BTFSS	F_BUS_IS_MINE		;WARNING: TAKE_BUS DISABLES INTERRUPTS AND PUTS BUS_OUT LOW C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			GOTO	_NO_MORE_MSG		;If we don't own the bus or were interrupted,             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	MSG_SEND			;  abandon, will send later                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;PROCEDURE: Send a message in BUS_OUT                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Send a message.  Glare has been avoided.  Runs with interrupts disabled while   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;ALL OTHER PROCESSORS ARE INTERRUPTED                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT: 	FSR -> Message to be sent                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;SUM CHECK has been calculated already                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000276   3006     MOVLW     0x6            MSG_SEND	MOVLW	C_NBR_PROTOCOL_BYTES;                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000277   00f4     MOVWF     0x74           			MOVWF	NBR_BYTES			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000278   0875     MOVF      0x75,0x0       			MOVF	TX_MSG_START,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000279   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00027a   0a84     INCF      0x4,0x1        _NXT_T_BYTE	INCF	FSR,F				;Skip MSG_EXPIRE                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00027b   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;W = byte to be sent                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	SEND_BYTE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Send 8 bits of data + start and stop bits.  LSB is sent first.                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		W=byte to send                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SEND_BYTE								;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00027c   00a4     MOVWF     0x24           			MOVWF	TEMP_BYT0			;Hold the BUS LOW for the rest of the duration of           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00027d   3008     MOVLW     0x8            			MOVLW	8					;  C_BIT_1 before sending the HIGH for the START bit              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00027e   00f3     MOVWF     0x73           			MOVWF	NBR_BITS			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00027f   3035     MOVLW     0x35           			MOVLW	(C_BIT_1 - 10)		;(17 clocks used in the code up to here + 2 from here to GO_LOW  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000280   245e     CALL      0x45e          			CALL	GO_LOW				; + 2 tp begining of the loop) / 2 instructions per loop       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000281   305b     MOVLW     0x5b           			MOVLW	C_BIT_0				;send START bit (0)                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000282   2459     CALL      0x459          			CALL	GO_HIGH				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000283   303f     MOVLW     0x3f           			MOVLW	C_BIT_1				;go low for '1' bit                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000284   245e     CALL      0x45e          			CALL	GO_LOW				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000285   305b     MOVLW     0x5b           _NEXT_T_BIT	MOVLW	C_BIT_0				;Send 8 bits data                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000286   0ca4     RRF       0x24,0x1       			RRF		TEMP_BYT0,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000287   1803     BTFSC     0x3,0x0        			BTFSC	STATUS,C			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000288   303f     MOVLW     0x3f           			MOVLW	C_BIT_1				;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000289   2459     CALL      0x459          			CALL	GO_HIGH				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00028a   303f     MOVLW     0x3f           			MOVLW	C_BIT_1				;go low for '1' bit                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00028b   245e     CALL      0x45e          			CALL	GO_LOW				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00028c   0bf3     DECFSZ    0x73,0x1       			DECFSZ	NBR_BITS,F			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00028d   2a85     GOTO      0x285          			GOTO	_NEXT_T_BIT			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00028e   303f     MOVLW     0x3f           			MOVLW	C_BIT_1				;STOP bit                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00028f   2459     CALL      0x459          			CALL	GO_HIGH				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			RETURN						;return in SEND_BYTE                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000290   0bf4     DECFSZ    0x74,0x1       			DECFSZ	NBR_BYTES,F			;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000291   2a7a     GOTO      0x27a          			GOTO	_NXT_T_BYTE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			RETURN						;return in MSG_SEND                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000292   0875     MOVF      0x75,0x0       			MOVF	TX_MSG_START,W		;decrement retry counter when finished                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000293   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000294   300f     MOVLW     0xf            			MOVLW	0x0F				;RXMIT counter should be 0 anyways...                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000295   0580     ANDWF     0x0,0x1        			ANDWF	INDF,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000296   0b80     DECFSZ    0x0,0x1        			DECFSZ	INDF,F				;When it reaches 0 the message expires                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000297   2a99     GOTO      0x299          			GOTO	_RESET_RXMIT		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000298   2a9b     GOTO      0x29b          			GOTO	_MSG_DONE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RESET_RXMIT							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000299   30f0     MOVLW     0xf0           			MOVLW	C_RXTIME			;C_RXTIME has the timer value in HIGH nibble                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00029a   0480     IORWF     0x0,0x1        			IORWF	INDF,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00029b   1486     BSF       0x6,0x1        _MSG_DONE	BSF		BUS_OUT				;release bus                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00029c   108b     BCF       0xb,0x1        			BCF		INTCON,INTF			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00029d   178b     BSF       0xb,0x7        			BSF		INTCON,GIE			;DONE! interrupts re-enabled                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00029e   1683     BSF       0x3,0x5        			BSF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00029f   1486     BSF       0x6,0x1        			BSF		TRISB,1				;RB1 in high impedance (input)                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a0   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			GOTO	_NXT_FIND_TX		;find other ready messages                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NO_MORE_MSG							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a1   108b     BCF       0xb,0x1        			BCF		INTCON,INTF			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a2   178b     BSF       0xb,0x7        			BSF		INTCON,GIE			;DONE! interrupts re-enabled                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			RETURN						;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a3   2911     GOTO      0x111          			GOTO	_RET2				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;See if a zone action is active for this scheda.  I this is the first time we execute the zone C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;command (RIT_SCHEDA), we duplicate the wait to obtain the 100ms granularity.    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		ACTIVE_ZONE	= Zone number for which port actions are pending in this scheda C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			ZONE_COUNTR = Counter for next zone command (no zone action pending=8)       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			ZONE_INTVAL	= delay between activation of each uscita                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			ZONETIMER = Time counter between commands (multiples of 50ms)                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			ZONE_COMMAND = state OFF/ON                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	MSG_TYPE,MSG_SUBT, ETC, (see also procedure ZONE__ACTION)               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ZONE_NEXT_COMM							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a4   19bb     BTFSC     0x3b,0x3       			BTFSC	ZONE_COUNTR,3		;zone command running if ZONE_COUNTR <> 8                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a5   2af5     GOTO      0x2f5          			GOTO	_CLR_ZONE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;zone command is running                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a6   0bbd     DECFSZ    0x3d,0x1       			DECFSZ	ZONETIMER,F			;time for next action?                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a7   2af6     GOTO      0x2f6          			GOTO	_ZONE_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a8   1da8     BTFSS     0x28,0x3       	 		BTFSS	F_DELAY_SCHEDA		;if this is the scheda delay, wait a second time       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002a9   2aae     GOTO      0x2ae          			GOTO	_INTERVALS			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002aa   083e     MOVF      0x3e,0x0       			MOVF	SCHEDA_DELAY2,W		;duplicate wait                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ab   00bd     MOVWF     0x3d           			MOVWF	ZONETIMER			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ac   11a8     BCF       0x28,0x3       			BCF		F_DELAY_SCHEDA		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ad   2af6     GOTO      0x2f6          			GOTO	_ZONE_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ae   083c     MOVF      0x3c,0x0       _INTERVALS	MOVF	ZONE_INTVAL,W		;fill timer for next USCITA activation            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002af   00bd     MOVWF     0x3d           			MOVWF	ZONETIMER			;set delay for next zone activation                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b0   08ba     MOVF      0x3a,0x1       _NEXT_ZONE	MOVF	ACTIVE_ZONE,F		;DO (while ZONE_COUNTR < 8)                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b1   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;  IF zone=0                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b2   2aba     GOTO      0x2ba          			GOTO	_ZONE_NOT_ZERO		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b3   083b     MOVF      0x3b,0x0       			MOVF	ZONE_COUNTR,W		;    AND port =/ NOT ASSIGNED                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b4   3e2d     ADDLW     0x2d           			ADDLW	FUNZIONE			;        W -> FUNZIONE for this port                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b5   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b6   0880     MOVF      0x0,0x1        			MOVF	INDF,F				;????                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b7   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b8   2ac6     GOTO      0x2c6          			GOTO	_ZONE_FOUND			;  THEN activate next port (all ports belong to zone 0)    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002b9   2ac0     GOTO      0x2c0          			GOTO	_NO_ZONE_F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _ZONE_NOT_ZERO							;  ELSE                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ba   083b     MOVF      0x3b,0x0       			MOVF	ZONE_COUNTR,W		;    IF the port belongs to this (non-zero) ZONE          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002bb   3e6a     ADDLW     0x6a           			ADDLW	EE_ZONA_APPARTZA	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002bc   2647     CALL      0x647          			CALL	READ_EEPROM			;      THEN activate the port                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002bd   063a     XORWF     0x3a,0x0       			XORWF	ACTIVE_ZONE,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002be   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;    END                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002bf   2ac6     GOTO      0x2c6          			GOTO	_ZONE_FOUND			;  END                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;ENDO;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c0   1003     BCF       0x3,0x0        _NO_ZONE_F	CLRC						;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c1   0cc0     RRF       0x40,0x1       			RRF		ZONE_PORTS,F		;collect port number that have and have not changed        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c2   0abb     INCF      0x3b,0x1       			INCF	ZONE_COUNTR,F		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c3   1dbb     BTFSS     0x3b,0x3       			BTFSS	ZONE_COUNTR,3		;last zone/port has been handled (ZONE_COUNTR = 8)       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c4   2ab0     GOTO      0x2b0          			GOTO	_NEXT_ZONE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c5   2aec     GOTO      0x2ec          			GOTO	_SND_REPL_ZONE		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c6   14a9     BSF       0x29,0x1       _ZONE_FOUND	BSF		F_ZONE_MSG_SNT		;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c7   1403     BSF       0x3,0x0        			BSF		STATUS,C			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c8   0cc0     RRF       0x40,0x1       			RRF		ZONE_PORTS,F		;collect port number that have and have not changed        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	ZONE_ACTION			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATE FOR STACK REDUCTION                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;This is actually a subprocedure of ZONE_NEXT_COMM.  It allows to handle the action on this  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;port properly, by simulating a message to our own scheda with appropiate parameters C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NBR_PORT                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	A simulated message is created in the MSG_... parameters of shared data C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ZONE_ACTION								;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002c9   3055     MOVLW     0x55           			MOVLW	TYPE_FUNZIONAMENTO	;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ca   00f8     MOVWF     0x78           			MOVWF	MSG_TYPE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002cb   3010     MOVLW     0x10           			MOVLW	SUBT_INVIO_MODULO	;pretend to be a scheda                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002cc   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002cd   3002     MOVLW     0x2            			MOVLW	2					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ce   023f     SUBWF     0x3f,0x0       			SUBWF	ZONE_COMMAND,W		;if the message is for a force action                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002cf   1c03     BTFSS     0x3,0x0        			BTFSS	STATUS,C			; pretend to be a CPU                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d0   2ad3     GOTO      0x2d3          			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d1   3022     MOVLW     0x22           			MOVLW	SUBT_INVIO_CPU		;34                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d2   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d3   082a     MOVF      0x2a,0x0       			MOVF	OWN_SERIAL,W		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d4   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d5   01fb     CLRF      0x7b           			CLRF	MSG_DISC			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d6   0a3b     INCF      0x3b,0x0       			INCF	ZONE_COUNTR,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d7   00a5     MOVWF     0x25           			MOVWF	TEMP_BYT1			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d8   1403     BSF       0x3,0x0        			BSF		STATUS,C			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002d9   0dfb     RLF       0x7b,0x1       _ROT_PORT	RLF		MSG_DISC,F			;convert port number to bin                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002da   0ba5     DECFSZ    0x25,0x1       			DECFSZ	TEMP_BYT1,F			; and put in MSG_DISC                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002db   2ad9     GOTO      0x2d9          			GOTO	_ROT_PORT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002dc   01fc     CLRF      0x7c           			CLRF	MSG_ARGT			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002dd   3001     MOVLW     0x1            			MOVLW	1					;if ZONE_COMMAND is odd, MSG_ARGT=0, OFF			                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002de   053f     ANDWF     0x3f,0x0       			ANDWF	ZONE_COMMAND,W		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002df   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e0   2ae3     GOTO      0x2e3          			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e1   087b     MOVF      0x7b,0x0       			MOVF	MSG_DISC,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e2   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e3   251c     CALL      0x51c          			CALL	PORT_ACTION			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			RETURN						;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e4   0abb     INCF      0x3b,0x1       			INCF	ZONE_COUNTR,F		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e5   19bb     BTFSC     0x3b,0x3       			BTFSC	ZONE_COUNTR,3		;last zone/port has been handled (ZONE_COUNTR = 8)       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e6   2aec     GOTO      0x2ec          			GOTO	_SND_REPL_ZONE		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e7   083c     MOVF      0x3c,0x0       			MOVF	ZONE_INTVAL,W		;fill timer for next USCITA activation                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e8   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002e9   2ab0     GOTO      0x2b0          			GOTO	_NEXT_ZONE			;if INTERVAL timer is 0, no delay, activate next zone       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ea   00bd     MOVWF     0x3d           			MOVWF	ZONETIMER			;set delay for next zone activation                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002eb   2af6     GOTO      0x2f6          			GOTO	_ZONE_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _SND_REPL_ZONE							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ec   1ca9     BTFSS     0x29,0x1       			BTFSS	F_ZONE_MSG_SNT		;send state message only if a port(s) has changed state C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ed   2af6     GOTO      0x2f6          			GOTO	_ZONE_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ee   3000     MOVLW     0x0            			MOVLW	SUBT_RISPO_MODULO	;0                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ef   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f0   082a     MOVF      0x2a,0x0       			MOVF	OWN_SERIAL,W		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f1   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;serial                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f2   0840     MOVF      0x40,0x0       			MOVF	ZONE_PORTS,W		;collected port numbers                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f3   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f4   258a     CALL      0x58a          			CALL	SEND_ACTION_REPLY	;only one reply per scheda is sent                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f5   10a9     BCF       0x29,0x1       _CLR_ZONE	BCF		F_ZONE_MSG_SNT		;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _ZONE_FIN	;RETURN						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f6   2916     GOTO      0x116          			GOTO	_RET3				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Check to see if there is a multicommand running and if its time for the next send (50ms).  To C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;send a new command read EEPROM for next scheda and uscita.                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		MULTICOM, counter for the next command to be sent.                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	Entry in TX_QUE (or RX_QUE if key is assigned to action in this processor) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           MULTIKEY_NEXT_COMM						;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f7   19b7     BTFSC     0x37,0x3       			BTFSC	MULTICOM,3			;Multicommand acvtive if MULTICOM =< 8	                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f8   2b45     GOTO      0x345          			GOTO	_MULT_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002f9   0bb9     DECFSZ    0x39,0x1       			DECFSZ	MULTIMER,F			;time to scan for next command (if any)?                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002fa   2b45     GOTO      0x345          			GOTO	_MULT_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002fb   3008     MOVLW     0x8            _TRY_ANOTHR	MOVLW	8					;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002fc   00fe     MOVWF     0x7e           			MOVWF	KEY_TO_PORT			;8th key (key number 9)indicates a multikey command       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002fd   0837     MOVF      0x37,0x0       			MOVF	MULTICOM,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002fe   3e5a     ADDLW     0x5a           			ADDLW	EE_MULT_SCHEDA		;MULTI PORT command: EE_MULT_SCHEDA<>0, MULT_USCITA<>0xFF<>0 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0002ff   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000300   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000301   08fa     MOVF      0x7a,0x1       			MOVF	MSG_SERL,F			;see if the multicommand has been assigned, otherwise       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000302   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000303   2b10     GOTO      0x310          			GOTO	_MULTI_CONT			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000304   0837     MOVF      0x37,0x0       			MOVF	MULTICOM,W			;this could be a zone command                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000305   3e62     ADDLW     0x62           			ADDLW	EE_MULT_USCITA		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000306   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000307   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;save in case for HANDLE_ZONE_TX()                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000308   30ff     MOVLW     0xff           			MOVLW	0xFF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000309   067a     XORWF     0x7a,0x0       			XORWF	MSG_SERL,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00030a   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00030b   2b36     GOTO      0x336          			GOTO	_MULTI_ZONE			;ZONE command: EE_MULT_SCHEDA=0, MULT_USCITA<>0xFF         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00030c   0ab7     INCF      0x37,0x1       			INCF	MULTICOM,F			;NOT ASSIGNED when EE_MULT_SCHEDA=0, MULT_USCITA=0xFF       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00030d   19b7     BTFSC     0x37,0x3       			BTFSC	MULTICOM,3			;Try again if needed allowing for holes in the sequence    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00030e   2b45     GOTO      0x345          			GOTO	_MULT_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00030f   2afb     GOTO      0x2fb          			GOTO	_TRY_ANOTHR			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000310   0837     MOVF      0x37,0x0       _MULTI_CONT	MOVF	MULTICOM,W			;                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000311   3e62     ADDLW     0x62           			ADDLW	EE_MULT_USCITA		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000312   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000313   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000314   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;preload with 'ON'                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000315   0837     MOVF      0x37,0x0       			MOVF	MULTICOM,W			;Fill variable params according to type of message.         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000316   3e21     ADDLW     0x21           			ADDLW	EE_MULTK_KEY_TIPO	;Get the message type to be sent                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000317   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000318   00a5     MOVWF     0x25           			MOVWF	TEMP_BYT1			;save message type                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000319   3a00     XORLW     0x0            			XORLW	C_NORMALE			;normal                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00031a   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00031b   2b25     GOTO      0x325          			GOTO	_MULT_NRML			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00031c   3022     MOVLW     0x22           			MOVLW	SUBT_INVIO_CPU		;(34)not C_NORMALE, must be forzatura                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00031d   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00031e   0825     MOVF      0x25,0x0       			MOVF	TEMP_BYT1,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00031f   3a01     XORLW     0x1            			XORLW	C_SET				;forced ON?                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000320   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000321   2b23     GOTO      0x323          			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000322   2b29     GOTO      0x329          			GOTO	_MULT_OTHR			;if SET, ARGT already filled, fill other messge parameters  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000323   01fc     CLRF      0x7c           			CLRF	MSG_ARGT			;RESET                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000324   2b29     GOTO      0x329          			GOTO	_MULT_OTHR			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000325   1ca8     BTFSS     0x28,0x1       _MULT_NRML	BTFSS	F_MULTIKEY_PRE		;ON/OFF follows the multikey state              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000326   01fc     CLRF      0x7c           			CLRF	MSG_ARGT			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000327   3010     MOVLW     0x10           			MOVLW	SUBT_INVIO_MODULO	;16                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000328   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000329   3055     MOVLW     0x55           _MULT_OTHR	MOVLW	TYPE_FUNZIONAMENTO	;85                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00032a   00f8     MOVWF     0x78           			MOVWF	MSG_TYPE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00032b   3003     MOVLW     0x3            			MOVLW	MAX_MULTI_RETRIES	;3                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00032c   00f7     MOVWF     0x77           			MOVWF	MSG_EXPIRE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00032d   082a     MOVF      0x2a,0x0       			MOVF	OWN_SERIAL,W		;is this a command for my own scheda?                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00032e   067a     XORWF     0x7a,0x0       			XORWF	MSG_SERL,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00032f   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000330   2b3e     GOTO      0x33e          			GOTO	_SND_TX_MSG			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000331   25e0     CALL      0x5e0          _MULTOWN	CALL	FIND_EMPTY_RX_Q		;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000332   1fa8     BTFSS     0x28,0x7       			BTFSS	F_MSG_FOUND			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000333   2b43     GOTO      0x343          			GOTO	_RESET_INTVAL		;skip the increment of the command counter                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000334   25f5     CALL      0x5f5          			CALL	COPY_TO_RX			; so this multicom can be tried again later                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000335   2b42     GOTO      0x342          			GOTO	_NEX_MULTCOM		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000336   24f2     CALL      0x4f2          _MULTI_ZONE	CALL	HANDLE_ZONE_TX		;                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000337   3a01     XORLW     0x1            			XORLW	TRUE				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000338   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000339   2b3e     GOTO      0x33e          			GOTO	_SND_TX_MSG			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00033a   0ab7     INCF      0x37,0x1       			INCF	MULTICOM,F			;HANDLE_ZONE_TX returns FALSE if zone command is FORCED but  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00033b   19b7     BTFSC     0x37,0x3       			BTFSC	MULTICOM,3			; key is OFF so try next multicommand rightaway            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00033c   2b45     GOTO      0x345          			GOTO	_MULT_FIN			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00033d   2afb     GOTO      0x2fb          			GOTO	_TRY_ANOTHR			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00033e   25ce     CALL      0x5ce          _SND_TX_MSG	CALL	FIND_EMPTY_TX_Q		;if no TX_QUE entry available try again later  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00033f   1fa8     BTFSS     0x28,0x7       			BTFSS	F_MSG_FOUND			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000340   2b43     GOTO      0x343          			GOTO	_RESET_INTVAL		;skip the increment of the command counter                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000341   2606     CALL      0x606          			CALL	COPY_TO_TX			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NEX_MULTCOM							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000342   0ab7     INCF      0x37,0x1       			INCF	MULTICOM,F			;Next command on next cycle - this one succesfully processed C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RESET_INTVAL							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000343   0838     MOVF      0x38,0x0       			MOVF	MULT_ITNVAL,W		;start multikey interval timer before leaving             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000344   00b9     MOVWF     0x39           			MOVWF	MULTIMER			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _MULT_FIN	;RETURN						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000345   2917     GOTO      0x117          			GOTO	_RET4				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Check if its time to shut-off a TEMPORIZZATTA or TAPPARELLA port.               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           CHECK_LONG_TIMERS						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000346   0bc1     DECFSZ    0x41,0x1       			DECFSZ	ONE_SECOND,F		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000347   2b69     GOTO      0x369          			GOTO	_TEMPO_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000348   01da     CLRF      0x5a           			CLRF	NBR_PORT			;TEST THE SECONDS TIMERS                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000349   085a     MOVF      0x5a,0x0       _SECS_TEST	MOVF	NBR_PORT,W			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00034a   3e4a     ADDLW     0x4a           			ADDLW	PORT_SECONDS		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00034b   0084     MOVWF     0x4            			MOVWF	FSR					;FSR -> seconds counter                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00034c   0880     MOVF      0x0,0x1        			MOVF	INDF,F				;test for 0 (not active)                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00034d   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00034e   2b64     GOTO      0x364          			GOTO	_NXT_SEC_TIMER		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00034f   0b80     DECFSZ    0x0,0x1        			DECFSZ	INDF,F				;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000350   2b64     GOTO      0x364          			GOTO	_NXT_SEC_TIMER		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000351   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;if minute counter is also 0: shutoff                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000352   3e42     ADDLW     0x42           			ADDLW	PORT_MINUTES		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000353   0084     MOVWF     0x4            			MOVWF	FSR					;FSR -> minute counter                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000354   0880     MOVF      0x0,0x1        			MOVF	INDF,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000355   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000356   2b5e     GOTO      0x35e          			GOTO	_SHUT_IT_OFF		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000357   0380     DECF      0x0,0x1        			DECF	INDF,F				;decrement minutes                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000358   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000359   3e4a     ADDLW     0x4a           			ADDLW	PORT_SECONDS		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00035a   0084     MOVWF     0x4            			MOVWF	FSR					;FSR -> seconds counter again                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00035b   303c     MOVLW     0x3c           			MOVLW	60					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00035c   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00035d   2b64     GOTO      0x364          			GOTO	_NXT_SEC_TIMER		;not time yet                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _SHUT_IT_OFF							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00035e   3000     MOVLW     0x0            			MOVLW	OFF					;A TEMPO timer expired, shut-off the corresponding port         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00035f   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000360   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000361   204c     CALL      0x4c           			CALL	WRITE_PORT_STATE	;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000362   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000363   236a     CALL      0x36a          			CALL	BROADCAST_STAT		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NXT_SEC_TIMER							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000364   0ada     INCF      0x5a,0x1       			INCF	NBR_PORT,F			;prepare test for next port                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000365   1d5a     BTFSS     0x5a,0x2       			BTFSS	NBR_PORT,C_MAXBIT	;all ports checked?                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000366   2b49     GOTO      0x349          			GOTO	_SECS_TEST			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RESET_SECONDS							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000367   3014     MOVLW     0x14           			MOVLW	C_ONESECOND			;reset                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000368   00c1     MOVWF     0x41           			MOVWF	ONE_SECOND			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			RETURN						;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000369   2918     GOTO      0x118          _TEMPO_FIN	GOTO	_RET5				;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;A port has been turned off, broadcast new state                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		W = port number                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	msg in TX_QUE                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           BROADCAST_STAT							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00036a   00a5     MOVWF     0x25           			MOVWF	TEMP_BYT1			;save                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00036b   3055     MOVLW     0x55           			MOVLW	TYPE_FUNZIONAMENTO	;broadcast the new state of the ports                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00036c   00f8     MOVWF     0x78           			MOVWF	MSG_TYPE			;85                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00036d   3000     MOVLW     0x0            			MOVLW	SUBT_RISPO_MODULO	;0                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00036e   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00036f   082a     MOVF      0x2a,0x0       			MOVF	OWN_SERIAL,W		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000370   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;serial                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000371   0aa5     INCF      0x25,0x1       			INCF	TEMP_BYT1,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000372   01fb     CLRF      0x7b           			CLRF	MSG_DISC			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000373   1403     BSF       0x3,0x0        			BSF		STATUS,C			;convert port number INT to BIN PACKED                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000374   0dfb     RLF       0x7b,0x1       _BCAS_ROL	RLF		MSG_DISC,F			;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000375   0ba5     DECFSZ    0x25,0x1       			DECFSZ	TEMP_BYT1,F			;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000376   2b74     GOTO      0x374          			GOTO	_BCAS_ROL			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000377   23ac     CALL      0x3ac          			CALL	READ_ALL_PORT_STATES;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000378   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000379   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00037a   3001     MOVLW     0x1            			MOVLW	1					;send only once                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00037b   00f7     MOVWF     0x77           			MOVWF	MSG_EXPIRE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00037c   25ce     CALL      0x5ce          			CALL	FIND_EMPTY_TX_Q		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00037d   1ba8     BTFSC     0x28,0x7       			BTFSC	F_MSG_FOUND			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00037e   2b81     GOTO      0x381          			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00037f   2644     CALL      0x644          			CALL	ERROR_HANDLER		;ERROR: NO TX ENTRY AVAILABLE FOR REPLY                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000380   2b82     GOTO      0x382          			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000381   2606     CALL      0x606          			CALL	COPY_TO_TX			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000382   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Translate timing information into number of minutes and seconds for a timed port C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;WARNING:	Time is read from EEPROM and is given in GRANULARITY of 4 SECONDS      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		W = port number                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	PORT_MINUTES, PORT_SECONDS contain the real time delay                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SELECT_TEMPO_TIME						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000383   00a4     MOVWF     0x24           			MOVWF	TEMP_BYT0			;save the port number passed in W                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000384   0824     MOVF      0x24,0x0       			MOVF	TEMP_BYT0,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000385   3e42     ADDLW     0x42           			ADDLW	PORT_MINUTES		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000386   0084     MOVWF     0x4            			MOVWF	FSR					;FSR -> minute counter                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000387   0180     CLRF      0x0            			CLRF	INDF				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000388   0824     MOVF      0x24,0x0       			MOVF	TEMP_BYT0,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000389   3e52     ADDLW     0x52           			ADDLW	EE_TEMPO			;w has the port number                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00038a   2647     CALL      0x647          			CALL	READ_EEPROM			;read timing info                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00038b   00d2     MOVWF     0x52           			MOVWF	TIMER_INFO			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00038c   300f     MOVLW     0xf            _DEVIDE_15	MOVLW	15					;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00038d   0252     SUBWF     0x52,0x0       			SUBWF	TIMER_INFO,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00038e   1c03     BTFSS     0x3,0x0        			BTFSS	STATUS,C			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00038f   2b93     GOTO      0x393          			GOTO	_DIV_DONE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000390   0a80     INCF      0x0,0x1        			INCF	INDF,F				;			                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000391   00d2     MOVWF     0x52           			MOVWF	TIMER_INFO			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000392   2b8c     GOTO      0x38c          			GOTO	_DEVIDE_15			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _DIV_DONE								;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000393   3008     MOVLW     0x8            			MOVLW	8					;FSR-> PORT_SECONDS(port number)                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000394   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;convert to seconds                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000395   1003     BCF       0x3,0x0        			CLRC						;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000396   0dd2     RLF       0x52,0x1       			RLF		TIMER_INFO,F		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000397   0dd2     RLF       0x52,0x1       			RLF		TIMER_INFO,F		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000398   0852     MOVF      0x52,0x0       			MOVF	TIMER_INFO,W		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000399   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00039a   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Read the input keys from the CD4051 in 9 in 8 out or directly in 5 in 4 out.    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	KEYSTATES contains the state of the input keys                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           READ_IN_KEYS							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00039b   01e3     CLRF      0x63           			CLRF	KEYSTATES			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00039c   01df     CLRF      0x5f           			CLRF	KEY_COUNTER			; KEY_COUNTER=0 means KEY 1                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00039d   3004     MOVLW     0x4            			MOVLW	C_NBR_OF_KEYS		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00039e   00f3     MOVWF     0x73           			MOVWF	NBR_BITS			;general purpose bit counter                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                            ifdef IN_9_OUT_8                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NEXT_KEY	MOVF	KEY_COUNTER,W		;Read all the keys                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			CALL	SELECT_KEY			;Returns in W the correct bit sequence for addressing the CD4051 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			MOVWF	KEY_MASK			;save mask                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			MOVF	PORTB,W				;Read the ports                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ANDLW	b'11000011'			;mask out addressing bits                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			IORWF	KEY_MASK,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			MOVWF	PORTB				;write it back                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BSF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BCF		TRISB,2				;switch RB2 to output                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BCF		KEY_IN				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			NOP							;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			NOP							;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BSF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BSF		TRISB,2				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			CLRC						;Prepare the CARRY bit                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			NOP							;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			NOP							;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BTFSC	KEY_IN				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			BSF		STATUS,C			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			RRF		KEYSTATES,F			;Carry has the state of the key                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			DECFSZ	NBR_BITS,F			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			GOTO	_READ_KEY_FIN		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			INCF	KEY_COUNTER,F		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			GOTO	_NEXT_KEY			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                            else                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00039f   1683     BSF       0x3,0x5        			BSF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a0   30ff     MOVLW     0xff           			MOVLW	b'11111111'			;5_IN_4_OUT: RB0=ECHOBUS OUT, RB1=ECHOBUS IN, RB2,RB3,RB4,RB5=IN KEYS C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a1   0086     MOVWF     0x6            			MOVWF	TRISB				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a2   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a3   1906     BTFSC     0x6,0x2         			BTFSC	PORTB,2				;read in single keys for 5 in 4 out                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a4   1463     BSF       0x63,0x0       			BSF		KEYSTATES,0			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a5   1986     BTFSC     0x6,0x3         			BTFSC	PORTB,3				;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a6   14e3     BSF       0x63,0x1       			BSF		KEYSTATES,1			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a7   1a06     BTFSC     0x6,0x4         			BTFSC	PORTB,4				;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a8   1563     BSF       0x63,0x2       			BSF		KEYSTATES,2			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003a9   1a86     BTFSC     0x6,0x5         			BTFSC	PORTB,5				;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003aa   15e3     BSF       0x63,0x3       			BSF		KEYSTATES,3			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                            endif			                                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _READ_KEY_FIN							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ab   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Read all the ports and build a map in PORTSTAT with the complete array of port states C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	PORTSTATE                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           READ_ALL_PORT_STATES					;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ac   01d7     CLRF      0x57           			CLRF	PORTSTATE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ad   01d8     CLRF      0x58           			CLRF	PRTSTATES			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ae   01db     CLRF      0x5b           			CLRF	GET_PORT			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003af   085b     MOVF      0x5b,0x0       _READ_PORT	MOVF	GET_PORT,W			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b0   201d     CALL      0x1d           			CALL	READ_PORT_STATE		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b1   0cd7     RRF       0x57,0x1       			RRF		PORTSTATE,F			;portstate in STATUS<C>                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b2   0cd8     RRF       0x58,0x1       			RRF		PRTSTATES,F			;port state in PRTSTATES<8>                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b3   0adb     INCF      0x5b,0x1       			INCF	GET_PORT,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b4   085b     MOVF      0x5b,0x0       			MOVF	GET_PORT,W			;8 OR 4                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b5   3a04     XORLW     0x4            			XORLW	C_NBR_OF_PORTS		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b6   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b7   2baf     GOTO      0x3af          			GOTO	_READ_PORT			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b8   0858     MOVF      0x58,0x0       			MOVF	PRTSTATES,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003b9   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                             ifdef IN_5_OUT_4                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ba   0ed7     SWAPF     0x57,0x1        			SWAPF	PORTSTATE,F			;only 4 ports read, make sure portstate bit occupy lower nibble C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003bb   300f     MOVLW     0xf            			MOVLW	0x0F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003bc   05d7     ANDWF     0x57,0x1       			ANDWF	PORTSTATE,F			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                             endif                                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003bd   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INTERRUPT PROCEDURE: Receives a complete message in the ECHO BUS.               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;*** WARNING: on reception of a new message:                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;1) The TX timer is incremented to give more time to all schede to digest this   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;   new message before more transmissions are attempted.                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;2) TMR1 is stopped to avoid that all processor exit the interrupt procedured with this C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;   timer expired                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Contains procedures RECEIVE_BYTE,RECEIVE_BIT                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;(Make changes here to extend the protocol)                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	Empty entry on RX_QUEU filled with 6 bytes of recvd data                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           Service_Interrupt						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003be   00f1     MOVWF     0x71           			MOVWF	I_W_TEMP			;I_W_TEMP MUST be in shared memory                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003bf   0e03     SWAPF     0x3,0x0        			SWAPF	STATUS,W			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c0   00e5     MOVWF     0x65           			MOVWF	I_STATUS_TEMP		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c1   0183     CLRF      0x3            			CLRF	STATUS				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c2   00e5     MOVWF     0x65           			MOVWF	I_STATUS_TEMP		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c3   0804     MOVF      0x4,0x0        			MOVF	FSR,W				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c4   00e6     MOVWF     0x66           			MOVWF	I_FSR_TEMP			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c5   0064     CLRWDT                   			CLRWDT						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c6   0aa0     INCF      0x20,0x1       			INCF	TIME_SCAN_TX,F		;add 1 ms to next tranmission to avoid racing            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c7   1010     BCF       0x10,0x0       			BCF		T1CON,TMR1ON		;stop TMR1 to avoid synchoronize sending from many schede  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c8   1228     BCF       0x28,0x4       			BCF		F_ABORT_RX_FLAG		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003c9   12a8     BCF       0x28,0x5       			BCF		F_BUS_IS_MINE		;this is an indication to TAKE_BUS to avoid sending a message C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ca   3006     MOVLW     0x6            			MOVLW	C_NBR_ENTRIES_RX	; because a new one has just been received             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003cb   00e8     MOVWF     0x68           			MOVWF	I_TEMP_BYT0			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003cc   30d0     MOVLW     0xd0           			MOVLW	RX_QUEU				;Find an empty slot in the RX_QUEU                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003cd   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ce   30ff     MOVLW     0xff           _FIND_RX	MOVLW	0xFF				;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003cf   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d0   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d1   2bdb     GOTO      0x3db          			GOTO	_RX_CONT1			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d2   3005     MOVLW     0x5            			MOVLW	C_SIZE_RX_Q_ENTRY	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d3   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d4   0be8     DECFSZ    0x68,0x1       			DECFSZ	I_TEMP_BYT0,F		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d5   2bce     GOTO      0x3ce          			GOTO	_FIND_RX			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d6   1783     BSF       0x3,0x7        			BSF		STATUS,IRP			;NO SPACE FOR NEW MESSAGE!                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d7   3020     MOVLW     0x20           			MOVLW	GARBAGE_CAN			;This message will be received but ignored                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d8   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003d9   30ff     MOVLW     0xff           			MOVLW	0xFF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003da   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003db   0804     MOVF      0x4,0x0        _RX_CONT1	MOVF	FSR,W				;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003dc   00ec     MOVWF     0x6c           			MOVWF	I_FREE_RX_Q			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003dd   3078     MOVLW     0x78           			MOVLW	C_BIT_SUP			;bit supervision: avoid false interrupts                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003de   00eb     MOVWF     0x6b           			MOVWF	I_SUPERVISION		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003df   1c06     BTFSS     0x6,0x0        _SFTY_HIGH	BTFSS	BUS_IN				;BUS must be LOW before call                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e0   2be5     GOTO      0x3e5          			GOTO	_SFTY_CONT			;  to byte receiver                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e1   0beb     DECFSZ    0x6b,0x1       			DECFSZ	I_SUPERVISION,F		;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e2   2bdf     GOTO      0x3df          			GOTO	_SFTY_HIGH			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e3   1628     BSF       0x28,0x4       			BSF		F_ABORT_RX_FLAG		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e4   2c1b     GOTO      0x41b          			GOTO	_RX_ABORT			;BUS timed out, was probably a glitch                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e5   3005     MOVLW     0x5            _SFTY_CONT	MOVLW	C_SIZE_RX_Q_ENTRY	;FSR is pointing at the correct queu entry    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e6   00ea     MOVWF     0x6a           			MOVWF	I_NBR_BYTES			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NXT_R_BYTE	;CALL	RECEIVE_START_BIT	;STACK REDUCTION                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Receive the START bit.  We use the duty cycle of this bit to calibrate the minimum C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;length of the '0' bit.                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		START bit in IN_BUS                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	Duration of '0' bit in BIT_0 (6.25%*actual duration)                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           RECEIVE_START_BIT                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e7   2447     CALL      0x447          			CALL	RECEIVE_BIT			;receive the start bit                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e8   1a28     BTFSC     0x28,0x4       			BTFSC	F_ABORT_RX_FLAG		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003e9   2c1b     GOTO      0x41b          			GOTO	_RX_ABORT			;BUS timed out                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ea   0867     MOVF      0x67,0x0       			MOVF	I_TEMP_BIT,W		;I_TEMP_BIT has 100% duty cycle of START bit               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003eb   00a7     MOVWF     0x27           			MOVWF	BIT_0				;-6% to allow for errors in variations of clock speed          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ec   0ca7     RRF       0x27,0x1       			RRF		BIT_0,F				;devide by 16                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ed   0ca7     RRF       0x27,0x1       			RRF		BIT_0,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ee   0ca7     RRF       0x27,0x1       			RRF		BIT_0,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ef   0ca7     RRF       0x27,0x1       			RRF		BIT_0,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f0   0827     MOVF      0x27,0x0       			MOVF	BIT_0,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f1   390f     ANDLW     0xf            			ANDLW	0xF					;W=6.25% of BIT_0                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f2   0267     SUBWF     0x67,0x0       			SUBWF	I_TEMP_BIT,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f3   00a7     MOVWF     0x27           			MOVWF	BIT_0				;BIT_0=Length of START bit                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			;RETURN						;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f4   2428     CALL      0x428          			CALL	RECEIVE_BYTE		;Receive 5 bytes of data in the received buffer            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f5   2447     CALL      0x447          			CALL	RECEIVE_BIT			;receive and ignore the stop bit                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f6   1a28     BTFSC     0x28,0x4       			BTFSC	F_ABORT_RX_FLAG		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f7   2c1b     GOTO      0x41b          			GOTO	_RX_ABORT			;BUS timed out                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f8   0868     MOVF      0x68,0x0       			MOVF	I_TEMP_BYT0,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003f9   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003fa   0bea     DECFSZ    0x6a,0x1       			DECFSZ	I_NBR_BYTES,F		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003fb   2bfd     GOTO      0x3fd          			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003fc   2bff     GOTO      0x3ff          			GOTO	_RX_CS				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003fd   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003fe   2be7     GOTO      0x3e7          			GOTO	_NXT_R_BYTE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RX_CS									;stack reduction: = CALL	RECEIVE_START_BIT                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0003ff   2447     CALL      0x447          			CALL	RECEIVE_BIT			;receive the start bit                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000400   1a28     BTFSC     0x28,0x4       			BTFSC	F_ABORT_RX_FLAG		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000401   2c1b     GOTO      0x41b          			GOTO	_RX_ABORT			;BUS timed out                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000402   0867     MOVF      0x67,0x0       			MOVF	I_TEMP_BIT,W		;I_TEMP_BIT has 100% duty cycle of START bit               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000403   00a7     MOVWF     0x27           			MOVWF	BIT_0				;-6% to allow for errors in variations of clock speed          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000404   0ca7     RRF       0x27,0x1       			RRF		BIT_0,F				;devide by 16                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000405   0ca7     RRF       0x27,0x1       			RRF		BIT_0,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000406   0ca7     RRF       0x27,0x1       			RRF		BIT_0,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000407   0ca7     RRF       0x27,0x1       			RRF		BIT_0,F				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000408   0827     MOVF      0x27,0x0       			MOVF	BIT_0,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000409   390f     ANDLW     0xf            			ANDLW	0xF					;W=6.25% of BIT_0                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00040a   0267     SUBWF     0x67,0x0       			SUBWF	I_TEMP_BIT,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00040b   00a7     MOVWF     0x27           			MOVWF	BIT_0				;BIT_0=Length of START bit                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00040c   2428     CALL      0x428          			CALL	RECEIVE_BYTE		;Receive CS but don't put it in the queu -                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00040d   1a28     BTFSC     0x28,0x4       			BTFSC	F_ABORT_RX_FLAG		;   NOTE: last byte: no STOP bit                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00040e   2c1b     GOTO      0x41b          			GOTO	_RX_ABORT			;BUS timed out                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00040f   3005     MOVLW     0x5            			MOVLW	C_SIZE_RX_Q_ENTRY	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	CALC_CS				;FSR points to the last received byte                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED FOR STACK REDUCTION:                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Calculate a CHECK SUM	for a number for C_NBR_PROTOCOL_BYTES-1 in reverse order  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		W = number of bytes, FSR -> last byte in the string.                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	W = calculated CS, FSR -> first byte                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;WARNING: Runs with disabled interrupts                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000410   00ea     MOVWF     0x6a           CALC_CS		MOVWF	I_NBR_BYTES			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000411   0103     CLRW                     			CLRW						;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000412   0700     ADDWF     0x0,0x0        _LOOP_CS	ADDWF	INDF,W				;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000413   0bea     DECFSZ    0x6a,0x1       			DECFSZ	I_NBR_BYTES,F		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000414   2c16     GOTO      0x416          			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000415   2c18     GOTO      0x418          			GOTO	_CS_DONE			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000416   0384     DECF      0x4,0x1        			DECF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000417   2c12     GOTO      0x412          			GOTO	_LOOP_CS			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _CS_DONE	;RETURN						;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000418   0668     XORWF     0x68,0x0       			XORWF	I_TEMP_BYT0,W		;FSR now points to the first received byte               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000419   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00041a   2c1f     GOTO      0x41f          			GOTO	_ISR_END			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00041b   086c     MOVF      0x6c,0x0       _RX_ABORT	MOVF	I_FREE_RX_Q,W		;Clear entry and abort                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00041c   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00041d   30ff     MOVLW     0xff           			MOVLW	0xFF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00041e   0080     MOVWF     0x0            			MOVWF	INDF				;Clear this entry, timeout or SC error                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00041f   1410     BSF       0x10,0x0       _ISR_END	BSF		T1CON,TMR1ON		;restart timer1                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000420   0866     MOVF      0x66,0x0       			MOVF	I_FSR_TEMP,W		;restore pre-interrupt registers                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000421   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000422   0e65     SWAPF     0x65,0x0       			SWAPF	I_STATUS_TEMP,W		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000423   0083     MOVWF     0x3            			MOVWF	STATUS				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000424   0ef1     SWAPF     0x71,0x1       			SWAPF	I_W_TEMP,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000425   0e71     SWAPF     0x71,0x0       			SWAPF	I_W_TEMP,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000426   108b     BCF       0xb,0x1        			BCF		INTCON,INTF			;clear interrupt flag                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000427   0009     RETFIE                   			RETFIE						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Receives the next 8 bits of a transmitted byte. NOTE: LSB is received first     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	I_TEMP_BYT0 contains the full byte                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           RECEIVE_BYTE							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000428   01e8     CLRF      0x68           			CLRF	I_TEMP_BYT0			;prepare to receive 8 bits                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000429   3008     MOVLW     0x8            			MOVLW	8					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00042a   00e9     MOVWF     0x69           			MOVWF	I_NBR_BITS			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NEXT_R_BIT								;stack reduction: = CALL	RECEIVE_BIT	                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00042b   3078     MOVLW     0x78           			MOVLW	C_BIT_SUP			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00042c   00eb     MOVWF     0x6b           			MOVWF	I_SUPERVISION		;setup supervision                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00042d   01e7     CLRF      0x67           			CLRF	I_TEMP_BIT			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00042e   1806     BTFSC     0x6,0x0        _WAI_LOW2	BTFSC	BUS_IN				;wait here while bus is LOW                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00042f   2c34     GOTO      0x434          			GOTO	_WAI_HIGH2			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000430   0beb     DECFSZ    0x6b,0x1       			DECFSZ	I_SUPERVISION,F		;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000431   2c2e     GOTO      0x42e          			GOTO	_WAI_LOW2			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000432   1628     BSF       0x28,0x4       			BSF		F_ABORT_RX_FLAG		;timed out on the 'low'                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000433   2c3c     GOTO      0x43c          			GOTO	_END_RX_BIT2		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000434   3078     MOVLW     0x78           _WAI_HIGH2	MOVLW	C_BIT_SUP			;bus is HIGH                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000435   00eb     MOVWF     0x6b           			MOVWF	I_SUPERVISION		;setup supervision                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000436   1c06     BTFSS     0x6,0x0        _NXT_HIGH2	BTFSS	BUS_IN				;next bit started                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000437   2c3c     GOTO      0x43c          			GOTO	_END_RX_BIT2			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000438   0ae7     INCF      0x67,0x1       			INCF	I_TEMP_BIT,F		;length of the bit received                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000439   0beb     DECFSZ    0x6b,0x1       			DECFSZ	I_SUPERVISION,F		;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00043a   2c36     GOTO      0x436          			GOTO	_NXT_HIGH2			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00043b   1628     BSF       0x28,0x4       			BSF		F_ABORT_RX_FLAG		;timed out on the 'high'                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _END_RX_BIT2							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00043c   1a28     BTFSC     0x28,0x4       			BTFSC	F_ABORT_RX_FLAG		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00043d   2c46     GOTO      0x446          			GOTO	_RX_B_ABORT			;BUS timed out                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00043e   1003     BCF       0x3,0x0        			CLRC						;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00043f   0ce8     RRF       0x68,0x1       			RRF		I_TEMP_BYT0,F		;TEMP_BYT0(7) is now 0                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000440   0827     MOVF      0x27,0x0       			MOVF	BIT_0,W				;Compare with calibrated '0'                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000441   0267     SUBWF     0x67,0x0       			SUBWF	I_TEMP_BIT,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000442   1c03     BTFSS     0x3,0x0        			BTFSS	STATUS,C			;C is 1 when 0 or positive (e.g. I_TEMP_BIT>='0')            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000443   17e8     BSF       0x68,0x7       			BSF		I_TEMP_BYT0,7		;TEMP_BYT0(7)=1                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000444   0be9     DECFSZ    0x69,0x1       			DECFSZ	I_NBR_BITS,F		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000445   2c2b     GOTO      0x42b          			GOTO	_NEXT_R_BIT			;Loop to next bit                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000446   0008     RETURN                   _RX_B_ABORT	RETURN						;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Receive a bit coming in the ECHOBUS                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE - (BUS_IN is low)                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	I_TEMP_BIT = counter with the duration of the bit received              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           RECEIVE_BIT								;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000447   3078     MOVLW     0x78           			MOVLW	C_BIT_SUP			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000448   00eb     MOVWF     0x6b           			MOVWF	I_SUPERVISION		;setup supervision                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000449   01e7     CLRF      0x67           			CLRF	I_TEMP_BIT			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00044a   1806     BTFSC     0x6,0x0        _WAI_LOW	BTFSC	BUS_IN				;wait here while bus is LOW                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00044b   2c50     GOTO      0x450          			GOTO	_WAI_HIGH			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00044c   0beb     DECFSZ    0x6b,0x1       			DECFSZ	I_SUPERVISION,F		;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00044d   2c4a     GOTO      0x44a          			GOTO	_WAI_LOW			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00044e   1628     BSF       0x28,0x4       			BSF		F_ABORT_RX_FLAG		;timed out on the 'low'                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00044f   2c58     GOTO      0x458          			GOTO	_END_RX_BIT			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000450   3078     MOVLW     0x78           _WAI_HIGH	MOVLW	C_BIT_SUP			;bus is HIGH                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000451   00eb     MOVWF     0x6b           			MOVWF	I_SUPERVISION		;setup supervision                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000452   1c06     BTFSS     0x6,0x0        _NXT_HIGH	BTFSS	BUS_IN				;next bit started                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000453   2c58     GOTO      0x458          			GOTO	_END_RX_BIT			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000454   0ae7     INCF      0x67,0x1       			INCF	I_TEMP_BIT,F		;length of the bit received                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000455   0beb     DECFSZ    0x6b,0x1       			DECFSZ	I_SUPERVISION,F		;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000456   2c52     GOTO      0x452          			GOTO	_NXT_HIGH			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000457   1628     BSF       0x28,0x4       			BSF		F_ABORT_RX_FLAG		;timed out on the 'high'                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000458   0008     RETURN                   _END_RX_BIT	RETURN						;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Keep the BUS_OUT line HIGH for the duration of a the bit passed in W and then put  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;it low.  Note that this procedure expects the BUS_OUT to be (already) high at start.   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT	:	W=duration (1=93, 0=61 with 4Mz Fosc) (BUS_OUT = high)                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE (BUS_OUT = high)                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           GO_HIGH									;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000459   00f2     MOVWF     0x72           			MOVWF	TEMP_BIT			;5 instruction clocks since bus is high for START bit        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00045a   1486     BSF       0x6,0x1        			BSF		BUS_OUT				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00045b   0bf2     DECFSZ    0x72,0x1       _HOLD_HIGH	DECFSZ	TEMP_BIT,F			;8		"		"		"	"	"	"	"	DATA bit                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00045c   2c5b     GOTO      0x45b          			GOTO	_HOLD_HIGH			;8		"		"		"	"	"	"	"	STOP bit                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00045d   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Put the BUS_OUT line to LOW for the duration of a '1' bit. Sets the bus high when done. C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		W = duration of low (always bit '1')                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           GO_LOW									;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00045e   00f2     MOVWF     0x72           			MOVWF	TEMP_BIT			;17 intruction clocks since bus is low for START msg         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00045f   1086     BCF       0x6,0x1        			BCF		BUS_OUT				;13 intruction clocks since bus is low for START of next byte C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000460   0bf2     DECFSZ    0x72,0x1       _HOLD_LOW	DECFSZ	TEMP_BIT,F			; 4		"		"		"	"	"	"	"	any DATA bit                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000461   2c60     GOTO      0x460          			GOTO	_HOLD_LOW			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000462   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;TEMPORIZZATA goes on on a high and stays on till the timer runs out, a new high C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;resets the timer.  Timer is given in units of 1/2 seconds.                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NBR_PORT, PORTSTATE<0,1> = current and requested states                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	W=ON/OFF action                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           PROC_TEMPORIZZATA						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000463   3002     MOVLW     0x2            			MOVLW	b'000000010'		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000464   0557     ANDWF     0x57,0x0       			ANDWF	PORTSTATE,W			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000465   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000466   2c6d     GOTO      0x46d          			GOTO	_TEMPO_END			;no changes made on a LOW                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000467   3001     MOVLW     0x1            			MOVLW	1					;Turn the port ON                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000468   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000469   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00046a   204c     CALL      0x4c           			CALL	WRITE_PORT_STATE	;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00046b   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00046c   2383     CALL      0x383          			CALL	SELECT_TEMPO_TIME	;start the necessary timers                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00046d   30fe     MOVLW     0xfe           _TEMPO_END	MOVLW	0xFE				;indicate actions already performed                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00046e   0008     RETURN                   			RETURN						;END                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;TAPPARELLA changes the state of 2 ports depending of their current state. Shutoff  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;		  	timers are started or stopped when necessary                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;WARNING: it is assumed that the TAPPARELLA port are next to each other, the lower C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;         of the pair is the even number, the higher the odd.                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;                                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NBR_PORT, PORTSTATE<0,1> = requested and current states                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	W=ON/OFF action                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           PROC_TAPPARELLA							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00046f   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;figure out who is OWN and OTHER                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000470   00d3     MOVWF     0x53           			MOVWF	OWN_PORT_TAP		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000471   3001     MOVLW     0x1            			MOVLW	1					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000472   055a     ANDWF     0x5a,0x0       			ANDWF	NBR_PORT,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000473   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000474   2c78     GOTO      0x478          			GOTO	_ODD				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000475   0a5a     INCF      0x5a,0x0       			INCF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000476   00d4     MOVWF     0x54           			MOVWF	OTHRPORT_TAP		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000477   2c7a     GOTO      0x47a          			GOTO	_TAP_CONT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000478   035a     DECF      0x5a,0x0       _ODD		DECF	NBR_PORT,W			;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000479   00d4     MOVWF     0x54           			MOVWF	OTHRPORT_TAP		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00047a   0857     MOVF      0x57,0x0       _TAP_CONT	MOVF	PORTSTATE,W			;SAVE STATES OF OWN PORT (CURR,REQUESTED)           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00047b   00d5     MOVWF     0x55           			MOVWF	OWNSTATE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00047c   0854     MOVF      0x54,0x0       			MOVF	OTHRPORT_TAP,W		;OWNSTATE has current and requested states of own port   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00047d   201d     CALL      0x1d           			CALL	READ_PORT_STATE		;PORTSTATE has state of other side                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00047e   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;save state of other port                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00047f   00d6     MOVWF     0x56           			MOVWF	OTHRSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000480   3002     MOVLW     0x2            			MOVLW	b'00000010'			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000481   0555     ANDWF     0x55,0x0       			ANDWF	OWNSTATE,W			;IF REQUESTED STATE = ON                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000482   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000483   2ca5     GOTO      0x4a5          			GOTO	_TAP_IGNORE			;then                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000484   3001     MOVLW     0x1            			MOVLW	b'00000001'			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000485   0555     ANDWF     0x55,0x0       			ANDWF	OWNSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000486   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;  if OWNstate = OFF (ignore if OWNstate is already ON)      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000487   2ca5     GOTO      0x4a5          			GOTO	_TAP_IGNORE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000488   3001     MOVLW     0x1            			MOVLW	b'00000001'			;	  and                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000489   0556     ANDWF     0x56,0x0       			ANDWF	OTHRSTATE,W			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00048a   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;     OTHstate = OFF                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00048b   2c93     GOTO      0x493          			GOTO	_TAP_OTHR_SIDE		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00048c   3001     MOVLW     0x1            			MOVLW	ON					;     then OWNstate = ON                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00048d   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00048e   0853     MOVF      0x53,0x0       			MOVF	OWN_PORT_TAP,W		;			and                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00048f   204c     CALL      0x4c           			CALL	WRITE_PORT_STATE	;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;           start the shutoff timer                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000490   0853     MOVF      0x53,0x0       			MOVF	OWN_PORT_TAP,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000491   2383     CALL      0x383          			CALL	SELECT_TEMPO_TIME	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000492   2ca5     GOTO      0x4a5          			GOTO	_TAP_IGNORE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _TAP_OTHR_SIDE							;  else                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000493   3000     MOVLW     0x0            			MOVLW	OFF					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000494   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000495   0854     MOVF      0x54,0x0       			MOVF	OTHRPORT_TAP,W		;    OTHRstate = OFF                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000496   204c     CALL      0x4c           			CALL	WRITE_PORT_STATE	;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000497   087b     MOVF      0x7b,0x0       			MOVF	MSG_DISC,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000498   00d3     MOVWF     0x53           			MOVWF	OWN_PORT_TAP		;  (re-use OWN_PORT_TAP to save MSG_DISC (destroyed by broadcast)) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000499   0854     MOVF      0x54,0x0       			MOVF	OTHRPORT_TAP,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00049a   236a     CALL      0x36a          			CALL	BROADCAST_STAT		;  end                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00049b   0853     MOVF      0x53,0x0       			MOVF	OWN_PORT_TAP,W		;restore MSG_DISC to send correct ACTION_REPLY           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00049c   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00049d   0854     MOVF      0x54,0x0       			MOVF	OTHRPORT_TAP,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00049e   3e42     ADDLW     0x42           			ADDLW	PORT_MINUTES		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00049f   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a0   0180     CLRF      0x0            			CLRF	INDF				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a1   0854     MOVF      0x54,0x0       			MOVF	OTHRPORT_TAP,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a2   3e4a     ADDLW     0x4a           			ADDLW	PORT_SECONDS		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a3   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a4   0180     CLRF      0x0            			CLRF	INDF				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a5   30fe     MOVLW     0xfe           _TAP_IGNORE	MOVLW	0xFE				;indicate port actions already taken                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a6   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a7   0008     RETURN                   			RETURN						;END                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;HANDLE A SIGLE KEY (NOT MULTIKEY) ACTION: Read the appropiate eeprom memory and  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;prepare a message for the destination.                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		KEY_COUNTER = key number                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			KEY_STATE(0) = state of the key                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	Entry in TX_QUE and/or RX_QUE if key is assigned to action in this processor C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           KEY_ACTION								;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a8   085f     MOVF      0x5f,0x0       			MOVF	KEY_COUNTER,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004a9   3e32     ADDLW     0x32           			ADDLW	EE_SCHEDA			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004aa   2647     CALL      0x647          			CALL	READ_EEPROM			;returns W=scheda da comandare                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ab   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ac   08fa     MOVF      0x7a,0x1       			MOVF	MSG_SERL,F			;not assigned or possible ZONE command                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ad   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ae   2ce5     GOTO      0x4e5          			GOTO	_ZONE_KEY			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _KEY_COMMAND							;PUT VARIABLE PARS IN THE MESSAGE                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004af   085f     MOVF      0x5f,0x0       			MOVF	KEY_COUNTER,W		;remember key that produced the command in KEY_TO_PORT    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b0   00fe     MOVWF     0x7e           			MOVWF	KEY_TO_PORT			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b1   3005     MOVLW     0x5            			MOVLW	MAX_SINGLE_RETRIES	;5                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b2   00f7     MOVWF     0x77           			MOVWF	MSG_EXPIRE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b3   3055     MOVLW     0x55           			MOVLW	TYPE_FUNZIONAMENTO	;85                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b4   00f8     MOVWF     0x78           			MOVWF	MSG_TYPE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b5   085f     MOVF      0x5f,0x0       			MOVF	KEY_COUNTER,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b6   3e72     ADDLW     0x72           			ADDLW	EE_SGL_KEY_TIPO		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b7   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b8   00a4     MOVWF     0x24           			MOVWF	TEMP_BYT0			;save msg type                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004b9   3a03     XORLW     0x3            			XORLW	C_ALLARME			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ba   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004bb   2cc6     GOTO      0x4c6          			GOTO	_NORMAL				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004bc   3080     MOVLW     0x80           _ALARM		MOVLW	SUBT_ALLARME_C		;Send Alarm (subtype=128)                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004bd   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004be   082a     MOVF      0x2a,0x0       			MOVF	OWN_SERIAL,W		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004bf   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c0   0861     MOVF      0x61,0x0       			MOVF	PREV_KEYS,W			;state of the keys when they were read                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c1   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c2   23ac     CALL      0x3ac          			CALL	READ_ALL_PORT_STATES;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c3   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c4   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c5   2cee     GOTO      0x4ee          			GOTO	_SEND_TX			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c6   085f     MOVF      0x5f,0x0       _NORMAL		MOVF	KEY_COUNTER,W		;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c7   3e3a     ADDLW     0x3a           			ADDLW	EE_USCITA_ZONA		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c8   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004c9   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;USCITA/E da comandare                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ca   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;default normal msg ON                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;;                                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004cb   0824     MOVF      0x24,0x0       			MOVF	TEMP_BYT0,W			;saved MESSAGE TYPE                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004cc   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;C_NORMALE                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004cd   2cd3     GOTO      0x4d3          			GOTO	_FORCED				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ce   3010     MOVLW     0x10           			MOVLW	SUBT_INVIO_MODULO	;DEFAULT: NORMALE(16)                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004cf   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d0   1c64     BTFSS     0x64,0x0       			BTFSS	KEY_STATE,0			;state of the key                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d1   01fc     CLRF      0x7c           			CLRF	MSG_ARGT			;normal msg OFF                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d2   2cdd     GOTO      0x4dd          			GOTO	_KEY_CONT1			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d3   3022     MOVLW     0x22           _FORCED		MOVLW	SUBT_INVIO_CPU		;this is a forced command                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d4   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;pretend to be CPU (subtype 34)to force outputs              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d5   0864     MOVF      0x64,0x0       			MOVF	KEY_STATE,W			;state of the key                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d6   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;0                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d7   2cf1     GOTO      0x4f1          			GOTO	_KEY_ACT_FIN		;send forced messages only when key is ON                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d8   0824     MOVF      0x24,0x0       			MOVF	TEMP_BYT0,W			;saved MESSAGE TYPE                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004d9   3a01     XORLW     0x1            			XORLW	C_SET				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004da   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004db   2cdd     GOTO      0x4dd          			GOTO	_KEY_CONT1			;MSG_ARGT already has the correct value                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004dc   01fc     CLRF      0x7c           _FORC_RESET	CLRF	MSG_ARGT			;forced msg OFF                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004dd   25c8     CALL      0x5c8          _KEY_CONT1	CALL	CHECK_SERIAL		;is this a command for my own scheda?              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004de   1f28     BTFSS     0x28,0x6       			BTFSS	F_SERIAL_MATCH		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004df   2cee     GOTO      0x4ee          			GOTO	_SEND_TX			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e0   25e0     CALL      0x5e0          _MYOWN		CALL	FIND_EMPTY_RX_Q		;                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e1   1fa8     BTFSS     0x28,0x7       			BTFSS	F_MSG_FOUND			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e2   2cf1     GOTO      0x4f1          			GOTO	_KEY_ACT_FIN		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e3   25f5     CALL      0x5f5          			CALL	COPY_TO_RX			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e4   2cf1     GOTO      0x4f1          			GOTO	_KEY_ACT_FIN		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e5   085f     MOVF      0x5f,0x0       _ZONE_KEY	MOVF	KEY_COUNTER,W		;                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e6   00fe     MOVWF     0x7e           			MOVWF	KEY_TO_PORT			;save the key sending the zone command                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e7   3e3a     ADDLW     0x3a           			ADDLW	EE_USCITA_ZONA		;get zone number                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e8   2647     CALL      0x647          			CALL	READ_EEPROM			;W has the zone                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004e9   00fa     MOVWF     0x7a           			MOVWF	MSG_SERL			;save ZONE da commandare (if present)                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ea   3aff     XORLW     0xff           			XORLW	0xFF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004eb   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ec   2cf1     GOTO      0x4f1          			GOTO	_KEY_ACT_FIN		;this key really not assigned (scheda 0, zona -1)			       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ed   24f2     CALL      0x4f2          			CALL	HANDLE_ZONE_TX		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ee   25ce     CALL      0x5ce          _SEND_TX	CALL	FIND_EMPTY_TX_Q		;put this message in the TX_QUE                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ef   1ba8     BTFSC     0x28,0x7       			BTFSC	F_MSG_FOUND			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f0   2606     CALL      0x606          			CALL	COPY_TO_TX			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _KEY_ACT_FIN							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f1   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Send ZONE command                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		KEY_TO_PORT=KEY NUMBER (note: multikey is number 8)                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			KEYSTATES=state of the key (including multikey)                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			MSG_SERL = ZONE NUMBER                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	message to zones                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           HANDLE_ZONE_TX							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f2   087e     MOVF      0x7e,0x0       			MOVF	KEY_TO_PORT,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f3   3a08     XORLW     0x8            			XORLW	8					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f4   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;If this is multikey-multizone conmmand, read                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f5   2cf9     GOTO      0x4f9          			GOTO	_SINGLE_KEY_ZONE	; the message type using the MULTICOM counter           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f6   0837     MOVF      0x37,0x0       			MOVF	MULTICOM,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f7   3e21     ADDLW     0x21           			ADDLW	EE_MULTK_KEY_TIPO	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f8   2cfb     GOTO      0x4fb          			GOTO	_EEPROMTIPO			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _SINGLE_KEY_ZONE						;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004f9   087e     MOVF      0x7e,0x0       			MOVF	KEY_TO_PORT,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004fa   3e72     ADDLW     0x72           			ADDLW	EE_SGL_KEY_TIPO		;check what type of message must be sent               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004fb   2647     CALL      0x647          _EEPROMTIPO	CALL	READ_EEPROM			;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004fc   00a4     MOVWF     0x24           			MOVWF	TEMP_BYT0			;save msg type                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004fd   08a4     MOVF      0x24,0x1       			MOVF	TEMP_BYT0,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004fe   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0004ff   2d07     GOTO      0x507          			GOTO	_ZONE_FORCE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000500   01fb     CLRF      0x7b           _ZON_NORMAL	CLRF	MSG_DISC			;send normal type message                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000501   01fc     CLRF      0x7c           			CLRF	MSG_ARGT			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000502   3001     MOVLW     0x1            			MOVLW	1					;send the KEY_STATE (ON,OFF)                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000503   0564     ANDWF     0x64,0x0       			ANDWF	KEY_STATE,W			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000504   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000505   0afc     INCF      0x7c,0x1       			INCF	MSG_ARGT,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000506   2d11     GOTO      0x511          			GOTO	_ZONE_CONT			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000507   0864     MOVF      0x64,0x0       _ZONE_FORCE	MOVF	KEY_STATE,W			;state of the key                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000508   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;0                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000509   2d1b     GOTO      0x51b          			GOTO	_ZONE_END_FALSE		;send forced messages only if the key is 'ON'           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00050a   30ff     MOVLW     0xff           			MOVLW	0xFF				;indicates forced ZONE message                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00050b   00fb     MOVWF     0x7b           			MOVWF	MSG_DISC			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00050c   01fc     CLRF      0x7c           			CLRF	MSG_ARGT			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00050d   3002     MOVLW     0x2            			MOVLW	C_RESET				;2                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00050e   0624     XORWF     0x24,0x0       			XORWF	TEMP_BYT0,W			;send ON or OFF depending on SET or RESET                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00050f   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000510   0afc     INCF      0x7c,0x1       			INCF	MSG_ARGT,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000511   3055     MOVLW     0x55           _ZONE_CONT	MOVLW	TYPE_FUNZIONAMENTO	;85                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000512   00f8     MOVWF     0x78           			MOVWF	MSG_TYPE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000513   3011     MOVLW     0x11           			MOVLW	SUBT_INVIO_ZONA		;17                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000514   00f9     MOVWF     0x79           			MOVWF	MSG_SUBT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000515   3001     MOVLW     0x1            			MOVLW	MAX_ZONE_RETRIES	;(1=expect no reply)                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000516   00f7     MOVWF     0x77           			MOVWF	MSG_EXPIRE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000517   25e0     CALL      0x5e0          			CALL	FIND_EMPTY_RX_Q		;ZONE messages are put in both RX and TX ques in case   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000518   1ba8     BTFSC     0x28,0x7       			BTFSC	F_MSG_FOUND			; this scheda has ports in that zone                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000519   25f5     CALL      0x5f5          			CALL	COPY_TO_RX			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _ZONE_END_TRUE							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00051a   3401     RETLW     0x1            			RETLW	TRUE				;the return procedure will put the message in TX                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _ZONE_END_FALSE							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00051b   3400     RETLW     0x0            			RETLW	FALSE				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;(85,[34|16],NS,[255|OUT],[SO|[OUT|0]])                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;WARNING: This messages can be generated also by procedure ZONE_NEXT_COMM        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Analyze the message received and perform requested action on a port depending on  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;the function or if its a forced state from CPU.                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		msg in SHARED datat                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00051c   01da     CLRF      0x5a           PORT_ACTION	CLRF	NBR_PORT			;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00051d   3022     MOVLW     0x22           			MOVLW	SUBT_INVIO_CPU		;34: forced states                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00051e   0679     XORWF     0x79,0x0       			XORWF	MSG_SUBT,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00051f   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000520   2d73     GOTO      0x573          			GOTO	_FORCED_OUTPUTS		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000521   01d9     CLRF      0x59           			CLRF	FRONTE				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000522   08fc     MOVF      0x7c,0x1       			MOVF	MSG_ARGT,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000523   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;If argument is 0, is a LOW (FRONTE DISCESA)                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000524   2d2c     GOTO      0x52c          			GOTO	_ACT_CONT			;fronte discesa                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _FRONTE_SALITA							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000525   0ad9     INCF      0x59,0x1       			INCF	FRONTE,F			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000526   087b     MOVF      0x7b,0x0       			MOVF	MSG_DISC,W			;If argument is equal to discriminator is a HIGH            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000527   067c     XORWF     0x7c,0x0       			XORWF	MSG_ARGT,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000528   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;If they are not equal its an error                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000529   2d2c     GOTO      0x52c          			GOTO	_ACT_CONT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00052a   2644     CALL      0x644          			CALL	ERROR_HANDLER		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00052b   2d89     GOTO      0x589          			GOTO	_PORT_ACTS_FIN		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00052c   087b     MOVF      0x7b,0x0       _ACT_CONT	MOVF	MSG_DISC,W			;has a 1 for the ports that must change              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00052d   00a6     MOVWF     0x26           			MOVWF	TEMP_BYT2			;look out for TEMP_BYT2!!!                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00052e   0ca6     RRF       0x26,0x1       _NXT_PORT	RRF		TEMP_BYT2,F			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00052f   1c03     BTFSS     0x3,0x0        			BTFSS	STATUS,C			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000530   2d6f     GOTO      0x56f          			GOTO	_NO_CHANGE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000531   01d7     CLRF      0x57           			CLRF	PORTSTATE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000532   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000533   201d     CALL      0x1d           			CALL	READ_PORT_STATE		;see PORTSTATE - returns PORTSTATE<0>= state of the port C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000534   1003     BCF       0x3,0x0        			CLRC						;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000535   0d59     RLF       0x59,0x0       			RLF		FRONTE,W			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000536   04d7     IORWF     0x57,0x1       			IORWF	PORTSTATE,F			;PORTSTATE<1>=resquested state && PORTSTATE<0>=current state  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			CALL	FIND_OUTPUT_ACTION	;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INCORPORATED STACK REDUCTION                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;According to PORT NUMBER, FUNZIONE, PORT STATE and REQUESTED STATE get the output action C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NBR_PORT, PORTSTATE<0,1> =  current and requested state                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	W=ON/OFF action                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           FIND_OUTPUT_ACTION						;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000537   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000538   3e2d     ADDLW     0x2d           			ADDLW	FUNZIONE			;W -> FUNZIONE for this port                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000539   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00053a   3003     MOVLW     0x3            			MOVLW	MONOSTABILE			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00053b   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00053c   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00053d   2d41     GOTO      0x541          			GOTO	$+4					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00053e   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00053f   200e     CALL      0xe            			CALL	TABLE_MONOSTABILE	;W HAS THE ACTION (ON/OFF)                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000540   2d65     GOTO      0x565          			GOTO	_OUT_ACT_C			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000541   300c     MOVLW     0xc            			MOVLW	INVERTITORE			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000542   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000543   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000544   2d48     GOTO      0x548          			GOTO	$+4					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000545   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000546   2013     CALL      0x13           			CALL	TABLE_INVERTITORE	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000547   2d65     GOTO      0x565          			GOTO	_OUT_ACT_C			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000548   3030     MOVLW     0x30           			MOVLW	PASSOPASSO			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000549   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00054a   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00054b   2d4f     GOTO      0x54f          			GOTO	$+4					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00054c   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00054d   2018     CALL      0x18            			CALL	TABLE_PASSOPASSO	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00054e   2d65     GOTO      0x565          			GOTO	_OUT_ACT_C			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00054f   3033     MOVLW     0x33           			MOVLW	TAPPARELLA			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000550   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000551   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000552   2d56     GOTO      0x556          			GOTO	$+4					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000553   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000554   246f     CALL      0x46f           			CALL	PROC_TAPPARELLA		;this is a procedure, not a table                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000555   2d65     GOTO      0x565          			GOTO	_OUT_ACT_C			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000556   30cc     MOVLW     0xcc           			MOVLW	TEMPORIZZATA		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000557   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000558   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000559   2d5d     GOTO      0x55d          			GOTO	$+4					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00055a   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00055b   2463     CALL      0x463          			CALL	PROC_TEMPORIZZATA	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00055c   2d65     GOTO      0x565          			GOTO	_OUT_ACT_C			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00055d   30f0     MOVLW     0xf0           			MOVLW	VISUALIZZAZIONE		;VISUALIZZAZIONE cannot be commanded                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00055e   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00055f   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000560   2d63     GOTO      0x563          			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000561   30fe     MOVLW     0xfe           			MOVLW	0xFE				;no error but do nothing                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000562   2d65     GOTO      0x565          			GOTO	_OUT_ACT_C			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000563   2644     CALL      0x644          			CALL	ERROR_HANDLER		;THIS PORT HAS NOT BEEN ASSIGNED                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000564   30ff     MOVLW     0xff           			MOVLW	0xFF				;RETURN ERROR	                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _OUT_ACT_C	;RETURN						;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000565   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000566   3afe     XORLW     0xfe           			XORLW	0xFE				;TAPPARELLA, TEMPORIZZATTA - port actions already done          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000567   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000568   2d6f     GOTO      0x56f          			GOTO	_NO_CHANGE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000569   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00056a   3aff     XORLW     0xff           			XORLW	0xFF				;ERROR: function unknown (error was reported by FIND_OUTPUT_ACTION) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00056b   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00056c   2d89     GOTO      0x589          			GOTO	_PORT_ACTS_FIN		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00056d   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00056e   204c     CALL      0x4c           			CALL	WRITE_PORT_STATE	;returns W with intended port state required for NBR_PORT C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00056f   0ada     INCF      0x5a,0x1       _NO_CHANGE	INCF	NBR_PORT,F			;                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000570   1d5a     BTFSS     0x5a,0x2       			BTFSS	NBR_PORT,C_MAXBIT	;all ports checked?                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000571   2d2e     GOTO      0x52e          			GOTO	_NXT_PORT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000572   2d89     GOTO      0x589          			GOTO	_PORT_ACTS_FIN		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _FORCED_OUTPUTS							;command from CPU to force outputs to a state              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000573   087b     MOVF      0x7b,0x0       			MOVF	MSG_DISC,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000574   00a6     MOVWF     0x26           			MOVWF	TEMP_BYT2			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000575   1003     BCF       0x3,0x0        _NXT_FORCED	CLRC						;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000576   0ca6     RRF       0x26,0x1       			RRF		TEMP_BYT2,F			;all outputs (MSG_DISC=FF) or only some (MSG_DISC=SO,MSG_ARGT=SO) C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000577   1c03     BTFSS     0x3,0x0        			BTFSS	STATUS,C			; in either case the same reasoning applies.                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000578   2d85     GOTO      0x585          			GOTO	_INC_PORT			;this port to change?                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000579   3001     MOVLW     0x1            			MOVLW	1					;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00057a   057c     ANDWF     0x7c,0x0       			ANDWF	MSG_ARGT,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00057b   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;PORTSTATE<0> has the intended port state required for NBR_PORT C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00057c   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00057d   204c     CALL      0x4c           			CALL	WRITE_PORT_STATE	;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00057e   3042     MOVLW     0x42           			MOVLW	PORT_MINUTES		;turn LONG TIMER OFF                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00057f   075a     ADDWF     0x5a,0x0       			ADDWF	NBR_PORT,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000580   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000581   0180     CLRF      0x0            			CLRF	INDF				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000582   3e08     ADDLW     0x8            			ADDLW	8					;move FSR to PORT_SECONDS                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000583   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000584   0180     CLRF      0x0            			CLRF	INDF				;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000585   0cfc     RRF       0x7c,0x1       _INC_PORT	RRF		MSG_ARGT,F			;rotate to next port's state                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000586   0ada     INCF      0x5a,0x1       			INCF	NBR_PORT,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000587   1d5a     BTFSS     0x5a,0x2       			BTFSS	NBR_PORT,C_MAXBIT	;4 OR 8                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000588   2d75     GOTO      0x575          			GOTO	_NXT_FORCED			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _PORT_ACTS_FIN							;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000589   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Put an action reply message in the message in the TX_QUEU                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		Parameters already filled in MSG_... shared data                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	entry in TX_QUEU is filled                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SEND_ACTION_REPLY						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00058a   23ac     CALL      0x3ac          			CALL	READ_ALL_PORT_STATES;                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00058b   0857     MOVF      0x57,0x0       			MOVF	PORTSTATE,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00058c   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00058d   3001     MOVLW     0x1            			MOVLW	1					;send only once                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00058e   00f7     MOVWF     0x77           			MOVWF	MSG_EXPIRE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00058f   25ce     CALL      0x5ce          			CALL	FIND_EMPTY_TX_Q		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000590   1ba8     BTFSC     0x28,0x7       			BTFSC	F_MSG_FOUND			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000591   2d94     GOTO      0x594          			GOTO	$+3					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000592   2644     CALL      0x644          			CALL	ERROR_HANDLER		;ERROR: NO TX ENTRY AVAILABLE FOR REPLY                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000593   2d95     GOTO      0x595          			GOTO	_SND_A_FIN			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000594   2606     CALL      0x606          			CALL	COPY_TO_TX			;RX msg will be discarded on return                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000595   0008     RETURN                   _SND_A_FIN	RETURN						;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Given a port, check if it is of type VISUALIZZAZIONE, if it is, change the state C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;of the port according to the corresponding bit in MSG_ARGT                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		W=port number                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE, changes the port state if necessary                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           PROC_VISUALIZZAZIONE					;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000596   00da     MOVWF     0x5a           			MOVWF	NBR_PORT			;save                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000597   19da     BTFSC     0x5a,0x3       			BTFSC	NBR_PORT,3			;If this msg was sent by multikey(8), ignore port visualization C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000598   2dbb     GOTO      0x5bb          			GOTO	_END_VISUAL			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000599   1e29     BTFSS     0x29,0x4       			BTFSS	F_HAVE_VISUAL		;do we have any visualizzazione ports?                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00059a   2dbb     GOTO      0x5bb          			GOTO	_END_VISUAL			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00059b   3e2d     ADDLW     0x2d           			ADDLW	FUNZIONE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00059c   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00059d   0800     MOVF      0x0,0x0        			MOVF	INDF,W				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00059e   3af0     XORLW     0xf0           			XORLW	VISUALIZZAZIONE		;see if this port is of function VISUALIZZ.            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00059f   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a0   2dbb     GOTO      0x5bb          			GOTO	_END_VISUAL			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a1   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a2   3e32     ADDLW     0x32           			ADDLW	EE_SCHEDA			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a3   2647     CALL      0x647          			CALL	READ_EEPROM			;see if this port commands the scheda that sent the reply  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a4   067a     XORWF     0x7a,0x0       			XORWF	MSG_SERL,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a5   1d03     BTFSS     0x3,0x2        			BTFSS	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a6   2dbb     GOTO      0x5bb          			GOTO	_END_VISUAL			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a7   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a8   3e3a     ADDLW     0x3a           			ADDLW	EE_USCITA_ZONA		;                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005a9   2647     CALL      0x647          			CALL	READ_EEPROM			;see if this port commands the port of scheda that sent the reply C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005aa   00a4     MOVWF     0x24           			MOVWF	TEMP_BYT0			;save                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ab   057b     ANDWF     0x7b,0x0       			ANDWF	MSG_DISC,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ac   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ad   2dbb     GOTO      0x5bb          			GOTO	_END_VISUAL			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ae   087c     MOVF      0x7c,0x0       			MOVF	MSG_ARGT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005af   00a6     MOVWF     0x26           			MOVWF	TEMP_BYT2			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b0   0ca4     RRF       0x24,0x1       _NXT_ROTATE	RRF		TEMP_BYT0,F			;rotate the state that the remote scheda reported C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b1   1c03     BTFSS     0x3,0x0        			BTFSS	STATUS,C			;  until our port's state is in TEMP_BYT2<0>                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b2   2db4     GOTO      0x5b4          			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b3   2db7     GOTO      0x5b7          			GOTO	$+4					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b4   0ca6     RRF       0x26,0x1       			RRF		TEMP_BYT2,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b5   1003     BCF       0x3,0x0        			CLRC						;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b6   2db0     GOTO      0x5b0          			GOTO	_NXT_ROTATE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b7   0826     MOVF      0x26,0x0       _PORT_CHANG	MOVF	TEMP_BYT2,W			;TEMP_BYT2<0>=port state                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b8   00d7     MOVWF     0x57           			MOVWF	PORTSTATE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005b9   085a     MOVF      0x5a,0x0       			MOVF	NBR_PORT,W			;send port number                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ba   204c     CALL      0x4c           			CALL	WRITE_PORT_STATE	;now change the state of the own port                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005bb   0008     RETURN                   _END_VISUAL	RETURN						;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Read EEPROM and reply                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		Received message in SHARED data                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	Message in the TX_BUFFER ready to be sent                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           SEND_PROG_REPLY							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005bc   25ce     CALL      0x5ce          			CALL	FIND_EMPTY_TX_Q		;Prepare reply                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005bd   1fa8     BTFSS     0x28,0x7       			BTFSS	F_MSG_FOUND			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005be   2dc7     GOTO      0x5c7          			GOTO	_RISP_FIN			;No reply is possible, msg will be repeated so ignore        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005bf   087b     MOVF      0x7b,0x0       			MOVF	MSG_DISC,W			;read the EEPROM location in DISCRMINATOR                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c0   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c1   00fc     MOVWF     0x7c           			MOVWF	MSG_ARGT			;fill ARGUMENT in TX msg                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c2   3033     MOVLW     0x33           			MOVLW	TYPE_RISPOSTA		;modify the COMMAND_TYPE                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c3   00f8     MOVWF     0x78           			MOVWF	MSG_TYPE			;	                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c4   3001     MOVLW     0x1            			MOVLW	1					;send only once                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c5   00f7     MOVWF     0x77           			MOVWF	MSG_EXPIRE			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c6   2606     CALL      0x606          			CALL	COPY_TO_TX			;RX msg will be discarded on return                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c7   0008     RETURN                   _RISP_FIN	RETURN						;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Checks the serial number in a msg of the RX_QUE                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		RX_MSG_START                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	match/no match                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           CHECK_SERIAL							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c8   1328     BCF       0x28,0x6       			BCF		F_SERIAL_MATCH		;initialize as no match                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005c9   087a     MOVF      0x7a,0x0       			MOVF	MSG_SERL,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ca   062a     XORWF     0x2a,0x0       			XORWF	OWN_SERIAL,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005cb   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005cc   1728     BSF       0x28,0x6       			BSF		F_SERIAL_MATCH		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005cd   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Scan the TX_QUE for an empty msg slot                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	F_MSG_FOUND(T/F), FSR -> free msg                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           FIND_EMPTY_TX_Q							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ce   13a8     BCF       0x28,0x7       			BCF		F_MSG_FOUND			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005cf   30a0     MOVLW     0xa0           			MOVLW	TX_QUEU				;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d0   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d1   3006     MOVLW     0x6            			MOVLW	C_NBR_ENTRIES_TX	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d2   00f4     MOVWF     0x74           			MOVWF	NBR_BYTES			;shared bank                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d3   0800     MOVF      0x0,0x0        _FIND_E_TX	MOVF	INDF,W				;Skip empty entry (0 = entry not used)                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d4   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d5   2ddc     GOTO      0x5dc          			GOTO	_SLOT_FOUND			;Empty message found                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d6   0bf4     DECFSZ    0x74,0x1       			DECFSZ	NBR_BYTES,F			;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d7   2dd9     GOTO      0x5d9          			GOTO	$+2					;                                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d8   2ddf     GOTO      0x5df          			GOTO	_NOFREESLOT			;Give up, no free messages left                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005d9   3008     MOVLW     0x8            			MOVLW	C_SIZE_TX_Q_ENTRY	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005da   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005db   2dd3     GOTO      0x5d3          			GOTO	_FIND_E_TX			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005dc   17a8     BSF       0x28,0x7       _SLOT_FOUND	BSF		F_MSG_FOUND			;                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005dd   0804     MOVF      0x4,0x0        			MOVF	FSR,W				;FSR -> start of free TX msg                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005de   00f5     MOVWF     0x75           			MOVWF	TX_MSG_START		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005df   0008     RETURN                   _NOFREESLOT RETURN						;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;This procedure is used mostly by KEY actions assigned to an own port.           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Scan the RX_QUE for an empty msg slot.                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	F_MSG_FOUND(T/F), FSR -> free msg                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;WARNING: 	Runs with INTERRUPTS DISABLED to avoid conflict with ISR              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           FIND_EMPTY_RX_Q							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e0   13a8     BCF       0x28,0x7       			BCF		F_MSG_FOUND			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e1   3006     MOVLW     0x6            			MOVLW	C_NBR_ENTRIES_RX	;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e2   00a6     MOVWF     0x26           			MOVWF	TEMP_BYT2			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e3   30d0     MOVLW     0xd0           			MOVLW	RX_QUEU				;Find an empty slot in the RX_QUEU                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e4   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e5   138b     BCF       0xb,0x7        			BCF		INTCON,GIE			;disable interrupts                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e6   30ff     MOVLW     0xff           _FND_QRX	MOVLW	0xFF				;0xFF indicates empty                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e7   0600     XORWF     0x0,0x0        			XORWF	INDF,W				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e8   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005e9   2def     GOTO      0x5ef          			GOTO	_RX_Q_FOUND			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ea   3005     MOVLW     0x5            			MOVLW	C_SIZE_RX_Q_ENTRY	;                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005eb   0784     ADDWF     0x4,0x1        			ADDWF	FSR,F				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ec   0ba6     DECFSZ    0x26,0x1       			DECFSZ	TEMP_BYT2,F			;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ed   2de6     GOTO      0x5e6          			GOTO	_FND_QRX			;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ee   2df3     GOTO      0x5f3          			GOTO	_RX_Q_NOT_FOUND		;no space in RX Q                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ef   0180     CLRF      0x0            _RX_Q_FOUND	CLRF	INDF				;take this message que entry inmediately                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f0   17a8     BSF       0x28,0x7       			BSF		F_MSG_FOUND			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f1   0804     MOVF      0x4,0x0        			MOVF	FSR,W				;FSR -> start of free RX msg                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f2   00f6     MOVWF     0x76           			MOVWF	RX_MSG_START		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _RX_Q_NOT_FOUND							;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f3   178b     BSF       0xb,0x7        			BSF		INTCON,GIE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f4   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Moves the message found in the SHARED bank (MSG_TYPE...MSG_ARGT) and puts it in  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;the RX_QUEU, typically used for commands assigned to my own scheda              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		RX_MSG_START (pointer to empty RX msg)                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           COPY_TO_RX								;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f5   0876     MOVF      0x76,0x0       			MOVF	RX_MSG_START,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f6   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f7   0878     MOVF      0x78,0x0       			MOVF	MSG_TYPE,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f8   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005f9   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005fa   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005fb   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005fc   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005fd   087a     MOVF      0x7a,0x0       			MOVF	MSG_SERL,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005fe   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
0005ff   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000600   087b     MOVF      0x7b,0x0       			MOVF	MSG_DISC,W			;			                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000601   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000602   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000603   087c     MOVF      0x7c,0x0       			MOVF	MSG_ARGT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000604   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000605   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Moves the bytes found in the SHARED bank (MSG_TYPE...MSG_ARGT) and puts them    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;in the TX_QUEU, calculates and writes the sumcheck.  Copies also the expiration data. C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		TX_MSG_START (pointer to empty TX msg), MSG_EXPIRE                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           COPY_TO_TX								;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000606   01fd     CLRF      0x7d           			CLRF	TEMP_SC				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000607   0875     MOVF      0x75,0x0       			MOVF	TX_MSG_START,W		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000608   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000609   0877     MOVF      0x77,0x0       			MOVF	MSG_EXPIRE,W		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00060a   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00060b   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00060c   0878     MOVF      0x78,0x0       			MOVF	MSG_TYPE,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00060d   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00060e   07fd     ADDWF     0x7d,0x1       			ADDWF	TEMP_SC,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00060f   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000610   0879     MOVF      0x79,0x0       			MOVF	MSG_SUBT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000611   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000612   07fd     ADDWF     0x7d,0x1       			ADDWF	TEMP_SC,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000613   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000614   087a     MOVF      0x7a,0x0       			MOVF	MSG_SERL,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000615   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000616   07fd     ADDWF     0x7d,0x1       			ADDWF	TEMP_SC,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000617   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000618   087b     MOVF      0x7b,0x0       			MOVF	MSG_DISC,W			;			                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000619   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00061a   07fd     ADDWF     0x7d,0x1       			ADDWF	TEMP_SC,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00061b   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00061c   087c     MOVF      0x7c,0x0       			MOVF	MSG_ARGT,W			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00061d   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00061e   07fd     ADDWF     0x7d,0x1       			ADDWF	TEMP_SC,F			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00061f   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000620   087d     MOVF      0x7d,0x0       			MOVF	TEMP_SC,W			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000621   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000622   0a84     INCF      0x4,0x1        			INCF	FSR,F				;GI: KEY_TO_PORT added                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000623   087e     MOVF      0x7e,0x0       			MOVF	KEY_TO_PORT,W		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000624   0080     MOVWF     0x0            			MOVWF	INDF				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000625   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Reads all operating parameters from EEPROM if the programmazione argument is <= 81 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;(last port FUNZIONE)                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           READ_STABLE_DATA						;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000626   3052     MOVLW     0x52           			MOVLW	82					;FUNZIONE for the last port                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000627   027b     SUBWF     0x7b,0x0       			SUBWF	MSG_DISC,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000628   1803     BTFSC     0x3,0x0        			BTFSC	STATUS,C			;C is set when negative                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000629   2e43     GOTO      0x643          			GOTO	_STABLE_DONE		;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00062a   3030     MOVLW     0x30           			MOVLW	EE_SERIAL_NBR		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00062b   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00062c   00aa     MOVWF     0x2a           			MOVWF	OWN_SERIAL			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00062d   3031     MOVLW     0x31           			MOVLW	EE_PROGRAM_TYPE		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00062e   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00062f   00ab     MOVWF     0x2b           			MOVWF	OWN_PROGRAM			;			                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000630   01f4     CLRF      0x74           			CLRF	NBR_BYTES			;READ eeprom to get port functions                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000631   302d     MOVLW     0x2d           			MOVLW	FUNZIONE			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000632   0084     MOVWF     0x4            			MOVWF	FSR					;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000633   1229     BCF       0x29,0x4       			BCF		F_HAVE_VISUAL		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _NXT_FUNZIONE							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000634   0874     MOVF      0x74,0x0       			MOVF	NBR_BYTES,W			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000635   3e4a     ADDLW     0x4a           			ADDLW	EE_FUNZIONE			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000636   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000637   0080     MOVWF     0x0            			MOVWF	INDF				;save port assignment                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000638   3af0     XORLW     0xf0           			XORLW	VISUALIZZAZIONE		;                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000639   1903     BTFSC     0x3,0x2        			BTFSC	STATUS,Z			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00063a   1629     BSF       0x29,0x4       			BSF		F_HAVE_VISUAL		;indicate we have at least one visualizzazione port       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00063b   0af4     INCF      0x74,0x1       			INCF	NBR_BYTES,F			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00063c   1974     BTFSC     0x74,0x2       			BTFSC	NBR_BYTES,C_MAXBIT	;4 or 8 ports                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00063d   2e40     GOTO      0x640          			GOTO	_READ_PLRTY			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00063e   0a84     INCF      0x4,0x1        			INCF	FSR,F				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00063f   2e34     GOTO      0x634          			GOTO	_NXT_FUNZIONE		;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           										;                                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000640   302f     MOVLW     0x2f           _READ_PLRTY	MOVLW	EE_POLARITA			;                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000641   2647     CALL      0x647          			CALL	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000642   00ac     MOVWF     0x2c           			MOVWF	POLARITA			;byte that describes the polarity of each port               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           _STABLE_DONE							;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000643   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Treat errors, only for deugging purposes                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;INPUT:		NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;OUTPUT:	NONE                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ERROR_HANDLER							;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000644   0000     NOP                      			NOP							;Good spot for breakpoint                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000645   0000     NOP                      			NOP							;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000646   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Read EEPROM memory.                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Input: 	W=address                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Output: 	W=value read                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           READ_EEPROM								;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000647   1683     BSF       0x3,0x5        			BANKSEL	EECON1				;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000648   1303     BCF       0x3,0x6                                                                                         
000649   189c     BTFSC     0x1c,0x1       			BTFSC	EECON1,WR			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00064a   2e47     GOTO      0x647          			GOTO	READ_EEPROM			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00064b   009b     MOVWF     0x1b           			MOVWF	EEADR				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00064c   141c     BSF       0x1c,0x0       			BSF		EECON1,RD			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00064d   081a     MOVF      0x1a,0x0       			MOVF	EEDATA,W			;W=eeprom data                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00064e   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;bank 0                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00064f   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Write to EEPROM                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Input:		MSG_DISC4, MSG_ARGT                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;Output:	None                                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           COPY_TO_EEPROM                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000650   1683     BSF       0x3,0x5        			BANKSEL	EECON1				;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000651   1303     BCF       0x3,0x6                                                                                         
000652   189c     BTFSC     0x1c,0x1       			BTFSC	EECON1,WR			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000653   2e50     GOTO      0x650          			GOTO	COPY_TO_EEPROM		;                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000654   1283     BCF       0x3,0x5        			BANKSEL	E2ADDRESS			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000655   1303     BCF       0x3,0x6                                                                                         
000656   086d     MOVF      0x6d,0x0       			MOVF	E2ADDRESS,W			;IN BANK 0                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000657   1683     BSF       0x3,0x5        			BSF		STATUS,RP0			;BANK1                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000658   009b     MOVWF     0x1b           			MOVWF	EEADR				;                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000659   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;BANK0                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00065a   086e     MOVF      0x6e,0x0       			MOVF	E2VALUE,W			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00065b   1683     BSF       0x3,0x5        			BSF		STATUS,RP0			;BANK1                                                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00065c   009a     MOVWF     0x1a           			MOVWF	EEDATA				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00065d   151c     BSF       0x1c,0x2       			BSF		EECON1,WREN			;                                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00065e   138b     BCF       0xb,0x7        			BCF		INTCON,GIE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00065f   3055     MOVLW     0x55           			MOVLW	0x55				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000660   009d     MOVWF     0x1d           			MOVWF	EECON2				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000661   30aa     MOVLW     0xaa           			MOVLW	0xAA				;                                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000662   009d     MOVWF     0x1d           			MOVWF	EECON2				;                                                             C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000663   149c     BSF       0x1c,0x1       			BSF		EECON1,WR			;                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000664   178b     BSF       0xb,0x7        			BSF		INTCON,GIE			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;			BCF		EECON1,WREN			;                                                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000665   0000     NOP                      			NOP							;                                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000666   1283     BCF       0x3,0x5        			BCF		STATUS,RP0			;                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
000667   0008     RETURN                   			RETURN						;                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           ;PREINITIALIZED EEPROM VALUES                                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100)                                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002100   0062     TRIS      0x2            			DE		"by Gino Isla for BIT Srl - Italia"                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002101   0079     ??? Illegal Opcode                                                                                        
002102   0020     NOP                                                                                                       
002103   0047     ??? Illegal Opcode                                                                                        
002104   0069     ??? Illegal Opcode                                                                                        
002105   006e     ??? Illegal Opcode                                                                                        
002106   006f     ??? Illegal Opcode                                                                                        
002107   0020     NOP                                                                                                       
002108   0049     ??? Illegal Opcode                                                                                        
002109   0073     ??? Illegal Opcode                                                                                        
00210a   006c     ??? Illegal Opcode                                                                                        
00210b   0061     TRIS      0x1                                                                                             
00210c   0020     NOP                                                                                                       
00210d   0066     TRIS      0x6                                                                                             
00210e   006f     ??? Illegal Opcode                                                                                        
00210f   0072     ??? Illegal Opcode                                                                                        
002110   0020     NOP                                                                                                       
002111   0042     ??? Illegal Opcode                                                                                        
002112   0049     ??? Illegal Opcode                                                                                        
002113   0054     ??? Illegal Opcode                                                                                        
002114   0020     NOP                                                                                                       
002115   0053     ??? Illegal Opcode                                                                                        
002116   0072     ??? Illegal Opcode                                                                                        
002117   006c     ??? Illegal Opcode                                                                                        
002118   0020     NOP                                                                                                       
002119   002d     ??? Illegal Opcode                                                                                        
00211a   0020     NOP                                                                                                       
00211b   0049     ??? Illegal Opcode                                                                                        
00211c   0074     ??? Illegal Opcode                                                                                        
00211d   0061     TRIS      0x1                                                                                             
00211e   006c     ??? Illegal Opcode                                                                                        
00211f   0069     ??? Illegal Opcode                                                                                        
002120   0061     TRIS      0x1                                                                                             
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0X2100+EE_MULTK_KEY_TIPO)                                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002121   0000     NOP                      			DE		0,0,0,0,0,0,0,0				;default type NORMAL for MULTIKEY commanding a ZONE    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002122   0000     NOP                                                                                                       
002123   0000     NOP                                                                                                       
002124   0000     NOP                                                                                                       
002125   0000     NOP                                                                                                       
002126   0000     NOP                                                                                                       
002127   0000     NOP                                                                                                       
002128   0000     NOP                                                                                                       
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_STATO_USCITE)                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002129   0000     NOP                      			DE		0							;default all ports OFF                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_TIPO_SCHEDA)		                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00212a   0000     NOP                      			DE		0							;tipo 0                                                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_SW_VERSION)		                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00212b   0002     ??? Illegal Opcode       			DE		2							;version 2                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_RIT_USCITA)		                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00212c   0001     ??? Illegal Opcode       			DE		1							;delay activation of ports in the same zone                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_RIT_SCHEDA)		                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00212d   0001     ??? Illegal Opcode       			DE		1							;delay activation of a scheda during zone command                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_RIT_MULTIC)		                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00212e   0005     ??? Illegal Opcode       			DE		5							;250ms delay in sending multiple commands                         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			                                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_POLARITA)		                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00212f   0000     NOP                      			DE		0							;default POSITIVE polarity of the ports                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_SERIAL_NBR)		                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002130   0002     ??? Illegal Opcode       			DE		2							;default SERIAL NUMBER                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_PROGRAM_TYPE)	                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002131   000f     ??? Illegal Opcode       			DE		15							;default TIPO PROGRAMMA                                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_SCHEDA)                                                       C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002132   0000     NOP                      			DE		0,0,0,0,0,0,0,0				;scheda NOT ASSIGNED - could be zone though...         C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002133   0000     NOP                                                                                                       
002134   0000     NOP                                                                                                       
002135   0000     NOP                                                                                                       
002136   0000     NOP                                                                                                       
002137   0000     NOP                                                                                                       
002138   0000     NOP                                                                                                       
002139   0000     NOP                                                                                                       
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_USCITA_ZONA)                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00213a   00ff     MOVWF     0x7f           			DE		-1,-1,-1,-1,-1,-1,-1,-1		;default, no assignment                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00213b   00ff     MOVWF     0x7f                                                                                            
00213c   00ff     MOVWF     0x7f                                                                                            
00213d   00ff     MOVWF     0x7f                                                                                            
00213e   00ff     MOVWF     0x7f                                                                                            
00213f   00ff     MOVWF     0x7f                                                                                            
002140   00ff     MOVWF     0x7f                                                                                            
002141   00ff     MOVWF     0x7f                                                                                            
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_USCITA_PORTA)                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002142   0000     NOP                      			DE		0,1,2,3,4,5,6,7				;Default INGRESSO to USCITA assignment (prog B)        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002143   0001     ??? Illegal Opcode                                                                                        
002144   0002     ??? Illegal Opcode                                                                                        
002145   0003     ??? Illegal Opcode                                                                                        
002146   0004     ??? Illegal Opcode                                                                                        
002147   0005     ??? Illegal Opcode                                                                                        
002148   0006     ??? Illegal Opcode                                                                                        
002149   0007     ??? Illegal Opcode                                                                                        
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_FUNZIONE)                                                     C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00214a   0000     NOP                      			DE		0,0,0,0,0,0,0,0				;FUNZIONE NON USATA                                    C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00214b   0000     NOP                                                                                                       
00214c   0000     NOP                                                                                                       
00214d   0000     NOP                                                                                                       
00214e   0000     NOP                                                                                                       
00214f   0000     NOP                                                                                                       
002150   0000     NOP                                                                                                       
002151   0000     NOP                                                                                                       
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_TEMPO)                                                        C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002152   0000     NOP                      			DE		0,0,0,0,0,0,0,0				;TEMPORIZAZZIONE NOT ASSIGNED                          C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002153   0000     NOP                                                                                                       
002154   0000     NOP                                                                                                       
002155   0000     NOP                                                                                                       
002156   0000     NOP                                                                                                       
002157   0000     NOP                                                                                                       
002158   0000     NOP                                                                                                       
002159   0000     NOP                                                                                                       
                                           			                                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_MULT_SCHEDA)                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00215a   0000     NOP                      			DE		0,0,0,0,0,0,0,0				;MULTI COMMAND NOT ASSIGNED                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00215b   0000     NOP                                                                                                       
00215c   0000     NOP                                                                                                       
00215d   0000     NOP                                                                                                       
00215e   0000     NOP                                                                                                       
00215f   0000     NOP                                                                                                       
002160   0000     NOP                                                                                                       
002161   0000     NOP                                                                                                       
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_MULT_USCITA)                                                  C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002162   00ff     MOVWF     0x7f           			DE		-1,-1,-1,-1,-1,-1,-1,-1		;MULTI COMMAND NOT ASSIGNED                      C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002163   00ff     MOVWF     0x7f                                                                                            
002164   00ff     MOVWF     0x7f                                                                                            
002165   00ff     MOVWF     0x7f                                                                                            
002166   00ff     MOVWF     0x7f                                                                                            
002167   00ff     MOVWF     0x7f                                                                                            
002168   00ff     MOVWF     0x7f                                                                                            
002169   00ff     MOVWF     0x7f                                                                                            
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_ZONA_APPARTZA)                                                C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00216a   00ff     MOVWF     0x7f           			DE		-1,-1,-1,-1,-1,-1,-1,-1		;ZONE NOT ASSIGNED                               C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
00216b   00ff     MOVWF     0x7f                                                                                            
00216c   00ff     MOVWF     0x7f                                                                                            
00216d   00ff     MOVWF     0x7f                                                                                            
00216e   00ff     MOVWF     0x7f                                                                                            
00216f   00ff     MOVWF     0x7f                                                                                            
002170   00ff     MOVWF     0x7f                                                                                            
002171   00ff     MOVWF     0x7f                                                                                            
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			ORG		(0x2100+EE_SGL_KEY_TIPO)                                                 C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002172   0000     NOP                      			DE		0,0,0,0,0,0,0,0				;TYPE NORMAL FOR SINGLE KEYS                           C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
002173   0000     NOP                                                                                                       
002174   0000     NOP                                                                                                       
002175   0000     NOP                                                                                                       
002176   0000     NOP                                                                                                       
002177   0000     NOP                                                                                                       
002178   0000     NOP                                                                                                       
002179   0000     NOP                                                                                                       
                                           ;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			END							;PROGRAM FINISHED                                                   C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                                                                                                            C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
                                           			                                                                              C:\Embedded\GMB\GMB Digital\GMB_dig_5_4.asm
