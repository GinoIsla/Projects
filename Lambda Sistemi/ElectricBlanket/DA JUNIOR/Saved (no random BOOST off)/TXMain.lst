MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;----------------------------------------------------------------
                      00002 ;Tranmitter / Remote control for an electric blanket.  
                      00003 ;Funtions: Write to the LCD, al1low setting of parameters,....
                      00004 ;
                      00005 ; Programmer:   Gino Isla for Lambda Sistemi, Milano
                      00006 ; Created:              21-10-2005      Version 1.0
                      00007 ; Clock:                4Mhz normal operation or 32KHz external during PWM period
                      00008 ; IDE:                  MPLAB v7.20
                      00009 ;----------------------------------------------------------------
                      00010 ;       list            p=16f914                ; list directive to define processor
                      00011 ;       #include        <p16f917.inc>   ; processor specific variable definitions
                      00012         #include        <p16f914.inc>   ; processor specific variable definitions
                      00001         LIST
                      00002 ; P16F914.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00842         LIST
                      00013         #include        <Macros.inc>
                      00001 ;General macro definitions
                      00002 
                      00003 M_CMP_JE        macro   value1,value2,jumpto    ;value1 = value2?
                      00004                 movf    value1,w
                      00005                 xorwf   value2,w
                      00006                 btfsc   STATUS,Z
                      00007                 goto    jumpto
                      00008                 endm
                      00009 M_CMPL_JE       macro   value1,literal,jumpto   ;value1 = k?
                      00010                 movf    value1,w
                      00011                 xorlw   literal
                      00012                 btfsc   STATUS,Z
                      00013                 goto    jumpto
                      00014                 endm
                      00015 M_CMP_JNE       macro   value1,value2,jumpto    ;value1 <> value2?
                      00016                 movf    value1,w
                      00017                 xorwf   value2,w
                      00018                 btfss   STATUS,Z
                      00019                 goto    jumpto
                      00020                 endm
                      00021 M_CMPL_JNE      macro   value1,literal,jumpto   ;value1 <> k? WARNING: destroys WREG!
                      00022                 movf    value1,w
                      00023                 xorlw   literal
                      00024                 btfss   STATUS,Z
                      00025                 goto    jumpto
                      00026                 endm
                      00027 
                      00028 
                      00029 M_CMPL_JGE      macro   value1,literal,jumpto   ;value1 >= k?
                      00030                 movlw   literal
                      00031                 subwf   value1,w                ;k-v1 >= 0
                      00032                 btfsc   STATUS,C
                      00033                 goto    jumpto
                      00034                 endm
                      00035 
                      00036 
                      00037 
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00038 M_CMP_JG        macro   value1,value2,jumpto    ;value1 > value2?
                      00039                 movf    value2,w
                      00040                 subwf   value1,w        ;v1-v2 > 0
                      00041                 btfss   STATUS,C
                      00042                 goto    $+4
                      00043                 btfsc   STATUS,Z
                      00044                 goto    $+2
                      00045                 goto    jumpto
                      00046                 endm
                      00047 
                      00048 M_CMP_JGE       macro   value1,value2,jumpto    ;value1 >= value2?
                      00049                 movf    value2,w
                      00050                 subwf   value1,w        ;v1-v2 >= 0
                      00051                 btfsc   STATUS,C
                      00052                 goto    jumpto
                      00053                 endm
                      00054 
                      00055 M_CMP_JL        macro   value1,value2,jumpto    ;value1 < value2?
                      00056                 movf    value2,w
                      00057                 subwf   value1,w        ;v1-v2 < 0
                      00058                 btfss   STATUS,C
                      00059                 goto    jumpto
                      00060                 endm
                      00061 
                      00062 M_CMP_JLE       macro   value1,value2,jumpto    ;value1 <= value2?
                      00063                 movf    value1,w
                      00064                 subwf   value2,w        ;v2-v1 > 0
                      00065                 btfsc   STATUS,C
                      00066                 goto    $+2
                      00067                 btfsc   STATUS,Z
                      00068                 goto    jumpto
                      00069                 endm
                      00070 
                      00071 
                      00072 M_CMPL_JL       macro   value1,literal,jumpto   ;value1 < literal?
                      00073                 movf    value1,w
                      00074                 sublw   literal ;k-v1 < 0
                      00075                 btfss   STATUS,C
                      00076                 goto    $+4
                      00077                 btfsc   STATUS,Z
                      00078                 goto    $+2
                      00079                 goto    jumpto
                      00080                 endm
                      00081 
                      00082 M_CMPL_JG       macro   value1,literal,jumpto   ;k-val1 < 0
                      00083                 movf    value1,w
                      00084                 sublw   literal
                      00085                 btfss   STATUS,C
                      00086                 goto    jumpto
                      00087                 endm
                      00088                 
                      00089 
                      00090 M_BANKSEL_0     macro
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00091                 BCF     STATUS,6
                      00092                 BCF     STATUS,5
                      00093                 endm
                      00094 M_BANKSEL_1     macro
                      00095                 BCF     STATUS,6
                      00096                 BSF     STATUS,5
                      00097                 endm
                      00098 M_BANKSEL_2     macro
                      00099                 BSF     STATUS,6
                      00100                 BCF     STATUS,5
                      00101                 endm
                      00102 M_BANKSEL_3     macro
                      00103                 BSF     STATUS,6
                      00104                 BSF     STATUS,5
                      00105                 endm
                      00014         #include        <UTENZA.INC>
                      00001 
                      00002 
  0000012C            00003 LED1_ON_PERIOD                  EQU     .300    ;100÷7968 milliseconds;
  00000BB8            00004 LED1_OFF_PERIOD                 EQU     .3000   ;100÷7968 milliseconds;
                      00005 
                      00006 
  000000C8            00007 DEBOUNCE_NORMAL                 EQU     .200    ;100÷7968 milliseconds; debounce for all keys if not in 
                            autolock 
  000007D0            00008 DEBOUNCE_AUTOLOCK               EQU     .2000   ;100÷7968 milliseconds; debounce for MODE keys only if i
                            n autolock
                      00009 
                      00010 
                      00011         IF      DEBOUNCE_NORMAL < .150
                      00012         ERROR:"DEBOUNCE_NORMAL OUT OF RANGE"
                      00013         ENDIF
                      00014 
                      00015 
  000001F4            00016 BLINK_TIME                      EQU     .500    ;100÷7968 milliseconds; blinks when adjusting the clock
                      00017 
                      00018 
  0000001E            00019 AUTOLOCK_OFF_TIME               EQU     .30     ;1÷255  seconds
                      00020 
                      00021 
  0000001E            00022 BACKLIGHT_PERIOD                EQU     .30     ;1÷255  seconds
                      00023 
                      00024 
  0000001E            00025 BOOST_PERIOD                    EQU     .30     ;1÷255  minutes
                      00026 
                      00027 
  0000012C            00028 HEAT_MSG_DELAY                  EQU     .300    ;100÷1000 milliseconds; delay before sending the last he
                            at message
                      00029 
                      00030 
  0000003C            00031 PERCENT_BATT_HIGH_THRESHLD      EQU     .60     ;1÷100  percent battery high threshold
  00000035            00032 PERCENT_BATT_LOW_THRESHLD       EQU     .53     ;1÷100  percent battery low threshold
                      00033 
                      00034 
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000002            00035 REXMIT_NORMAL                   EQU     .2      ;1÷255  number of times to resend the message of tempera
                            ture
  00000003            00036 REXMIT_EXTEND                   EQU     .3      ;1÷255  number of times to resend the message of learn a
                            nd refresh
                      00015         #include        <TXHeader.h>
                      00001 
                      00002 ;
                      00003 ;********* make changes to LCD prescale here  ONLY********************
  00000003            00004 LCD_PRESCALE    EQU             b'00000011'                             ;PRESCALE=4 (last 4 bits of LCDP
                            S)
                      00005 ;#DEFINE        WAVE_TYPE_A
                      00006 #DEFINE         WAVE_TYPE_B                                             ;
                      00007 ;*********************************************************************
  00000000            00008 WFT_A                           EQU     b'00000000'
  00000080            00009 WFT_B                           EQU     b'10000000'
  00000004            00010 MULTIPLEX                       EQU     .4                                      ;1/4 multiplex
                      00011 
  00000040            00012 LCD_FRAME_FREQ          EQU     .1024/(MULTIPLEX * (LCD_PRESCALE+1))    ;Hz
  000003E8            00013 MILLI                           EQU     .1000                                   ;
  00003D09            00014 LCD_FRAME_PERIOD        EQU     .1000*MILLI/LCD_FRAME_FREQ              ;in millisecs
                      00015 
                      00016 ;++++++++++++ This is the time base for this project (1/4 mpx) +++++++++++++++++++++++++++
  00007A12            00017 LCD_TICK                        EQU     LCD_FRAME_PERIOD*2                      ;
                      00018 ;++++++++++++ This is the time base for this project +++++++++++++++++++++++++++++++++++++
                      00019 
  00000009            00020 PW_ON_PERIOD            EQU     LED1_ON_PERIOD*MILLI/LCD_TICK           ;counts for a period of approx 3
                            00ms
  00000060            00021 PW_OFF_PERIOD           EQU     LED1_OFF_PERIOD*MILLI/LCD_TICK          ;counts for a period of approx 3
                             seconds
  00000006            00022 DEBOUNCE_PERIOD         EQU     DEBOUNCE_NORMAL*MILLI/LCD_TICK          ;debounce
                      00023 
                      00024         IF      DEBOUNCE_PERIOD < .150*MILLI/LCD_TICK
                      00025         ERROR:"DEBOUNCE_PERIOD OUT OF RANGE"
                      00026         ENDIF
                      00027 
  00000040            00028 AUTOLOCK_DEBOUNCE       EQU     DEBOUNCE_AUTOLOCK*MILLI/LCD_TICK        ;2seconds
  0000000C            00029 HEAT_ADJ_DEBOUNCE       EQU     .400*MILLI/LCD_TICK                                     ;slow down conti
                            nuous heat adjustments
                      00030 
  00000010            00031 BLINK_PERIOD            EQU     BLINK_TIME*MILLI/LCD_TICK                       ;1/2 second blinks when 
                            adjusting the clock
                      00032 
                      00033 ;AUTOLOCK_OFF_TIME      EQU     .30                                                                     
                            ;in seconds
  0000003C            00034 SIXTY_MINUTES           EQU     .60                                                                     
                            ;
                      00035 ;BACKLIGHT_PERIOD       EQU     .30                                                                     
                            ;seconds
                      00036 
  0000000A            00037 MAX_TEMP                        EQU     .10                                                             
                                    ;max setting
                      00038 
                      00039 ;BOOST_PERIOD           EQU     .30                                                                     
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ;minutes
  0000001E            00040 SEND_OFF_PERIOD         EQU     .30                                                                     
                            ;in minutes, repeat OFF msg
                      00041 
  000002D0            00042 SEND_ON_PERIOD          EQU     .720                                                            ;in seco
                            nds, (+ a random number) for repeat ON msg
  00000001            00043 MSG_PAUSE_PERIOD        EQU     .32*MILLI/LCD_TICK                                      ;30 ms betwwen r
                            epeats of the same message
                      00044 
  00000009            00045 HEAT_MSG_COUNTDWN       EQU     HEAT_MSG_DELAY*MILLI/LCD_TICK           ;delay before sending the last h
                            eat message
                      00046 
  00000099            00047 BATT_HIGH_THRESHLD      EQU     (PERCENT_BATT_HIGH_THRESHLD*.255)/.100  ;substitute the percent load (.6
                            5) by appropriate number
  00000087            00048 BATT_LOW_THRESHLD       EQU     (PERCENT_BATT_LOW_THRESHLD*.255)/.100   ;substitute the percent load (.4
                            0) by appropriate number
  0000000C            00049 IDLE_BATTERY_TEST       EQU     .12                                                                     
                                    ;number of HOURS in which to perform the battery test if no messages are sent
                      00050 
  00000020            00051 BLINK_2P_PERIOD         EQU     .1000*MILLI/LCD_TICK
                      00052 
  00000000            00053 CLKP_NOTHING            EQU     0
  00000001            00054 CLKP_1224                       EQU     1
  00000002            00055 CLKP_MIN_ADJ            EQU     2
  00000003            00056 CLKP_HOUR_ADJ           EQU     3
  00000024            00057 CLKP_HOUR_DISP24        EQU     0x24                                    ;in BCD for displaying during ad
                            justments
  00000012            00058 CLKP_HOUR_DISP12        EQU     0x12                                    ;in BCD for displaying during ad
                            justments
  00000018            00059 CLKP_HOUR_24            EQU     .24                                     ;
  0000000C            00060 CLKP_HOUR_12            EQU     .12                                     ;
                      00061 ;
  00000000            00062 AUTO_OFF_OFF            EQU     .0                                      ;
  00000001            00063 AUTO_OFF_1HR            EQU     .1                                      ;in hours
  00000003            00064 AUTO_OFF_3HR            EQU     .3                                      ;
  0000000C            00065 AUTO_OFF_12HR           EQU     .12                                     ;
                      00066 
  00000030            00067 MESSAGE_LENGTH          EQU     .48                                     ;packet length
                      00068 ;REXMIT_NORMAL          EQU     .2                                      ;number of times to resend the m
                            essage
                      00069 ;REXMIT_EXTEND          EQU     .3                                      ;learn and refresh
                      00070 
                      00071 #define TXENBL_TRIS     TRISA,0                                 ;switch the TX_ENABLE port when not in u
                            se
                      00072 
                      00073 ;Port assignment
                      00074 #define TX_ENABLE       PORTA,0
                      00075 #define LCD7            PORTA,1
                      00076 #define COM2            PORTA,2
                      00077 #define KB0                     PORTA,3
                      00078 #define LCD4            PORTA,4
                      00079 #define LCD5            PORTA,5
                      00080 #define                         PORTA6  "NOT USED"
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00081 #define                         PORTA7  "NOT USED"
                      00082 #define MASKTA          b'11000001'                                     ;TX_ENABLE in INPUT
                      00083 ;
                      00084 #define LCD0            PORTB,0
                      00085 #define LCD1            PORTB,1
                      00086 #define LCD2            PORTB,2
                      00087 #define LCD3            PORTB,3
                      00088 #define COM0            PORTB,4
                      00089 #define COM1            PORTB,5
                      00090 #define BACKLIGHT       PORTB,6
                      00091 #define LED1            PORTB,7
                      00092 #define MASKTB          b'00000000'
                      00093 ;
                      00094 #define                         PORTC0  "DONT KNOW"
                      00095 #define                         PORTC1  "DONT KNOW"
                      00096 #define                         PORTC2  "DONT KNOW"
                      00097 #define LCD6            PORTC,3
                      00098 #define LCD11           PORTC,4
                      00099 #define LCD10           PORTC,5
                      00100 #define LCD9            PORTC,6
                      00101 #define LCD8            PORTC,7
                      00102 #define MASKTC          b'00000111'
                      00103 ;
                      00104 #define COM3            PORTD,0
                      00105 #define KB1                     PORTD,1
                      00106 #define KB2                     PORTD,2
                      00107 #define KB3                     PORTD,3
                      00108 #define KB4                     PORTD,4
                      00109 #define KB5                     PORTD,5
                      00110 #define KB6                     PORTD,6
                      00111 #define PWM_HCS         PORTD,7
                      00112 #define MASKTD          b'00111110'
                      00113 ;
                      00114 #define DEBUG_OUT       PORTE,0
                      00115 #define KB7                     PORTE,0
                      00116 #define KB8                     PORTE,1
                      00117 #define VDIODE          PORTE,2
                      00118 #define MCLR            PORTE,3
                      00119 #define MASKTE          b'11111110'
                      00120 
                      00121 ;******* FLAGS ********* LOOK OUT FOR BANK CHANGES *********************
                      00122 #DEFINE MINUTES                 LCD_CHAR1,0                     ; LCD_CHAR1 IS THE COMMON BANK
                      00123 #DEFINE HOURS                   LCD_CHAR1,1                     ;
                      00124 #DEFINE ONEHR                   LCD_CHAR1,2                     ;characters to be displayed in the LCD 
                      00125 #DEFINE THREEHR                 LCD_CHAR1,3                     ;
                      00126 #DEFINE TWELVEHR                LCD_CHAR1,4                     ;
                      00127 #DEFINE TEMPETR                 LCD_CHAR1,5                     ;
                      00128 #DEFINE LOCKED                  LCD_CHAR1,6                     ;
                      00129 #DEFINE BATTLOW                 LCD_CHAR1,7                     ;
                      00130 
                      00131 #DEFINE DEVON                   LCD_CHAR2,0                     ; LCD_CHAR2 IS IN THE COMMON BANK
                      00132 #DEFINE DEVOFF                  LCD_CHAR2,1                     ;
                      00133 #DEFINE BOOST                   LCD_CHAR2,2                     ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00134 #DEFINE LCD_UPD                 LCD_CHAR2,3                     ;time to update the real time clock coun
                            ters
                      00135 #DEFINE LED1_STATE              LCD_CHAR2,4                     ;LED1 flashes for.3 secs/3secs
                      00136 #DEFINE PLUS_BUT                LCD_CHAR2,5                     ;
                      00137 #DEFINE MINUS_BUT               LCD_CHAR2,6                     ;
                      00138 #DEFINE ADJUST_RT               LCD_CHAR2,7                     ;
                      00139 
                      00140 #DEFINE DEBOUNCING              LCD_CHAR3,0                     ; LCD_CHAR3 IS IN BANK 0
                      00141 #DEFINE BTN_ACT_PDG             LCD_CHAR3,1                     ;button action in progress
                      00142 #DEFINE MODE_ACT                LCD_CHAR3,2                     ;on-going MODE change 
                      00143 #DEFINE CLCKSET_ACT             LCD_CHAR3,3                     ;now changing the clock
                      00144 #DEFINE UNLOCKING               LCD_CHAR3,4                     ;now in process of unlocking
                      00145 #DEFINE HEAT_ACT                LCD_CHAR3,5                     ;
                      00146 #DEFINE AUTOLOCK_ON     LCD_CHAR3,6                     ;
                      00147 #DEFINE RELOCK_ON               LCD_CHAR3,7                     ;
                      00148 
                      00149 #DEFINE SND_OFF_MSG             LCD_CHAR4,0                     ;LCD_CHAR4 IS IN BANK 0
                      00150 #DEFINE SND_ON_MSG              LCD_CHAR4,1                     ;messages to the base
                      00151 #DEFINE SND_BOOSTON_MSG LCD_CHAR4,2                     ;
                      00152 #DEFINE SND_BOO_OFF_MSG LCD_CHAR4,3                     ;
                      00153 #DEFINE SND_TEMP_MSG    LCD_CHAR4,4                     ;
                      00154 #DEFINE SND_LEARN_MSG   LCD_CHAR4,5                     ;
                      00155 #DEFINE SND_TEST_MSG    LCD_CHAR4,6                     ;
                      00156 #DEFINE SND_REFRESH_MSG LCD_CHAR4,7
                      00157 
                      00158 #DEFINE BEEPER                  LCD_CHAR5,0                     ;LCD_CHAR5 IS IN  THE COMMON BANK
                      00159 #DEFINE BATTERY_WARN    LCD_CHAR5,1                     ;warnings for the battery charge level
                      00160 #DEFINE BATTERY_LOW             LCD_CHAR5,2                     ;
                      00161 #DEFINE BOOST_ACT               LCD_CHAR5,3                     ;pre-heat
                      00162 #DEFINE F_BODY_GUARD    LCD_CHAR5,4                     ;DISABLE KB0 CONTROL
                      00163 #DEFINE COLON                   LCD_CHAR5,5                     ;late requirement, blink ":" every secon
                            d
                      00164 ;
                      00165 #DEFINE SPARE                   NEW_BUTTON_CONFIG,0             ;KB8
                      00166 #DEFINE PREHEAT                 NEW_BUTTON_CONFIG,1             ;KB1
                      00167 #DEFINE MODE                    NEW_BUTTON_CONFIG,2             ;KB2    
                      00168 #DEFINE MINUS                   NEW_BUTTON_CONFIG,3             ;KB3
                      00169 #DEFINE PLUS                    NEW_BUTTON_CONFIG,4             ;KB4
                      00170 #DEFINE CLOCK_SET               NEW_BUTTON_CONFIG,5             ;KB5
                      00171 #DEFINE S_KB6                   NEW_BUTTON_CONFIG,6
                      00172 #DEFINE S_KB7                   NEW_BUTTON_CONFIG,7
                      00173 
                      00174 
                      00175 
                      00176 
                      00016 
                      00017 ;********************** INCLUDE FOR TX HANDLING **************************
                      00018 ;        #include   <hcs_tx.inc> AT THE BOTTOM OF THIS CODE
                      00019 ;********************** INCLUDE FOR TX HANDLING **************************
                      00020 
                      00021         
2007   3CE4           00022         __CONFIG _FCMEN_ON & _IESO_ON & _CP_OFF & _WDT_OFF & _BOD_OFF & _MCLRE_ON & _PWRTE_ON & _INTRC_O
                            SC_NOCLKOUT
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

2000   0000 0001 0001 00023         __IDLOCS        0110    ;1.1.0
       0000 
                      00024         ERRORLEVEL -302
                      00025 
                      00026 
                      00027 ;******* INTERRUPT FLAGSS *************************************************
                      00028 #DEFINE TMR1_IF         PIR1,TMR1IF     ;(0) TMR1 INTERRUPT OCCURRED
                      00029 #DEFINE LCD_IF          PIR2,LCDIF      ;(4) LCD INTERRUPT OCCURRED
                      00030 ;******* ADCON0 *************************************************
                      00031 #DEFINE GO_DONE         ADCON0,1        ;(1)    1 = CONVERSION IN PROGRESS                              
                                                            
                      00032                                                                 ;               0 = CONVERSION DONE
                      00033 ;******* FOR INCLUDED CODE TX_HCS ******************************
                      00034 #DEFINE TMR_HCS_ON      _TMR1ON
                      00035 ;definitions for TX_HCS:
                      00036 #DEFINE BANK1   BSF     STATUS,RP0
                      00037 #DEFINE BANK0   BCF     STATUS,RP0
                      00038 #DEFINE RAM1    BSF     STATUS,RP0
                      00039 #DEFINE RAM0    BCF     STATUS,RP0
                      00040 #DEFINE RAM_1   BSF     STATUS,RP0
                      00041 #DEFINE RAM_0   BCF     STATUS,RP0
                      00042 #DEFINE SET     BSF
                      00043 #DEFINE CANC    BCF
                      00044 #DEFINE SC      BTFSC
                      00045 #DEFINE SS      BTFSS
                      00046 #DEFINE IFSET   BTFSC
                      00047 #DEFINE IFCANC  BTFSS
                      00048 #DEFINE SKPB    SKPNC
                      00049 #DEFINE SKPNB   SKPC
                      00050 #DEFINE FW      MOVFW
                      00051 #DEFINE WF      MOVWF
                      00052 #DEFINE LW      MOVLW
                      00053 ;*** INTCON ***
                      00054 #DEFINE _INTE   INTCON,INTE
                      00055 #DEFINE _INTF   INTCON,INTF
                      00056 #DEFINE _GIE    INTCON,GIE
                      00057 #DEFINE _T0IE   INTCON,T0IE
                      00058 #DEFINE _T0IF   INTCON,T0IF
                      00059 #DEFINE _PEIE   INTCON,PEIE
                      00060 
                      00061 #DEFINE TRASMISSIONE_HCS        FLAGS_HCS,0     ;
                      00062 #DEFINE ALTO1_BASSO0            FLAGS_HCS,1     ;FLAG DA INVERTIRE CHE DETERMINA TE2
                      00063 
                      00064 ;#DEFINE        PWM_HCS         PORTD,7 ;PIN DI TRASMISSIONE HCS  <== new in electric blanket
                      00065 
                      00066 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00067 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00068 ;+++++++++++++++++++++++ DATA +++++++++++++++++++++++++++++++++++++++++
                      00069 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00070 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00071 
                      00072 ;BANK 0 VARIABLES *****************************************************
                      00073                 CBLOCK  020H
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000020            00074 TEMP_BYT0_B0                                    ;general purpose for bank0
  00000021            00075 TEMP_BYT1_B0                                    ;general purpose for bank0
  00000022            00076 LED1_CLOCK                                      ;
  00000023            00077 RT_SECONDS                                      ;real time seconds counter
  00000024            00078 RT_MINUTES                                      ;       "               minutes   "
  00000025            00079 RT_HOURS                                        ;       "               hours     "
  00000026            00080 DEBOUNCE_CNT                                    ;debounce count
  00000027            00081 BACKLIGHT_CNT                                   ;
  00000028            00082 BLINK_COUNT                                     ;delay for blinking the display
  00000029            00083 NEW_BUTTON_CONFIG                               ;configuration of the buttons when they are read
  0000002A            00084 OLD_BUTTON_CONFIG                               ;OLD configuration of the buttons
  0000002B            00085 LCD_CHAR3                                       ;all purpose flags
  0000002C            00086 LCD_CHAR4                                       ;more flags
  0000002D            00087 ADJUST_CLK_PHASE                                ;
  0000002E            00088 MAX_HOURS                                       ;CLOCK turn over
  0000002F            00089 RE_LOCK_TIME                                    ;RE LOCK TIMER
  00000030            00090 AUTO_OFF_HOURS                                  ;1, 3 or 12 hr AUTO SHUT-OFF timer
  00000031            00091 AUTO_OFF_MINUTES                                ;AUTO SHUT-OFF minutes count down
  00000032            00092 BOOST_MINUTES                                   ;minutes, counter of PRE-HEAT minutes
  00000033            00093 SAVED_TEMPERATURE                               ;save the temp when AUTO-OFF timer is is turned off
  00000034            00094 PRE_MESSAGE_TIMER                               ;wait time before sending a HEAT message
  00000035            00095 REXMIT_COUNT                                    ;
  00000036            00096 RESEND_OFF_COUNT                                ;counter for resending the OFF msg (15')
  00000037            00097 RESEND_ON_COUNT_L                               ;counter for resending the ON msg (15' -> 900secs)
  00000038            00098 RESEND_ON_COUNT_H                               ;
  00000039            00099 PAUSE_COUNT                                     ;counter delays in
  0000003A            00100 BATTERY_BLINK_COUNT                             ;counter blinks the battery segment
  0000003B            00101 IDLE_BATT_COUNT                                 ;number of hours after which the test message is sent wh
                            en no other tranmissions
  0000003C            00102 BAT_OFF_MSG_COUNT                               ;this is a stop to endless sends of the OFF msg on low b
                            attery.
  0000003D            00103 TMR2_1SECOND                                    ;one second counter with TMR2
                      00104 ;=====================================================
                      00105 ; BUFFER DI TRASMISSIONE HCS
  0000003E            00106 HCS1                                            ;reserved(7:5), left/right side (4),serial number high (
                            3:0)
  0000003F            00107 HCS2                                            ;serial number(7:0)
  00000040            00108 HCS3                                            ;serial number(7:0)
  00000041            00109 HCS4                                            ;serial number(7:0) low
  00000042            00110 HCS5                                            ;level(7:3),beep(2),learn(1), padding(0)
  00000043            00111 HCS6                                            ;checksum
  00000044            00112 FLAGS_HCS
  00000045            00113 FASE_TX_HCS
  00000046            00114 CARICA_TIMER_HCS_HI
  00000047            00115 CARICA_TIMER_HCS_LO
  00000048            00116 PUNTA_HCS
  00000049            00117 COUNT_BIT
  0000004A            00118 TEMP_ROTATE
  0000004B            00119 COUNT_PREAMBOLO
  0000004C            00120 BI_STATUS
  0000004D            00121 BI_PCLATH
  0000004E            00122 BI_FSR
                      00123                 ENDC
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00124 
                      00125 ;COMMON DATA            **************************************************
                      00126                 CBLOCK  71H
  00000071            00127 LCD_CHAR1                                       ;flags to discriminate characters in the display
  00000072            00128 LCD_CHAR2                                       ;all purpose flags
  00000073            00129 LCD_CHAR5                                       ;more flags (MISC, NOT USED)
  00000074            00130 MIN_VALUE                                       ;minutes to write on the display [0:60]
  00000075            00131 HOUR_VALUE                                      ;hours to write on the display [0:24]
  00000076            00132 TMPTR_VALUE                                     ;temperature to write on the display [0:24]
  00000077            00133 BI_WREG                                         ;save wreg in ISR
                      00134                 ENDC
                      00135 
                      00136 ;BANK 2 VARIABLES       **************************************************
                      00137                 CBLOCK  0120H
  00000120            00138 WR_ERRORS                                       ;
  00000121            00139 WR_NOERRORS                                     ;
  00000122            00140 TOGGLE_LCD                                      ;
  00000123            00141 TEMP_BYT0_B2                                    ;general purpose for bank2
  00000124            00142 TEMP_BYT1_B2                                    ;general purpose for bank2
                      00143                 ENDC
                      00144 
                      00145 ;-- ALIAS HCS_TX -------------------------------------------------------------
                      00146 
                      00147 
  00000001            00148 TMR_HCS EQU     TMR0
  0000004B            00149 HEADER_COUNT    EQU     COUNT_PREAMBOLO
  0000004B            00150 COUNT_DATA      EQU     COUNT_PREAMBOLO
                      00151 
                      00152 
                      00153 
                      00154 ;Uncomment to work with ICD2 +++++++++
                      00155 ;#DEFINE DEBUG
                      00156                                                 ;
0000                  00157         ORG     0x000                           ; processor reset vector
0000   018A           00158         clrf    PCLATH                          ; ensure page bits are cleared
0001   281B           00159         goto    main                            ; go to beginning of program
                      00160                                                 ;
                      00161                                                 ;
0004                  00162         org     0x04                            ;
0004                  00163 PUSH:                                           ;
0004   00F7           00164         WF      BI_WREG                         ;COPIA DEL WREG
0005   0E03           00165         SWAPF   STATUS,W                        ;COPIA DELLO STATUS
                      00166         M_BANKSEL_0
0006   1303               M                 BCF     STATUS,6
0007   1283               M                 BCF     STATUS,5
0008   00CC           00167         MOVWF   BI_STATUS
0009   080A           00168         FW      PCLATH
000A   00CD           00169         WF      BI_PCLATH
000B   0804           00170         FW      FSR
000C   00CE           00171         WF      BI_FSR
000D   2B2B           00172         B       INTERRUPT
                      00173 
                      00174 
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00175 ;Begining of executable code    ;
                      00176 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00177 ;Jump table for drawing a character in the LCD
                      00178 ;bit sequence is:  -gfedcba
                      00179 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
000E                  00180 DIGIT_SELECT                                    ;
000E   0782           00181         ADDWF   PCL,F                           ;
000F   343F           00182         RETLW   b'00111111'                     ;"0"            
0010   3406           00183         RETLW   b'00000110'                     ;"1"
0011   345B           00184         RETLW   b'01011011'                     ;"2"            
0012   344F           00185         RETLW   b'01001111'                     ;"3"
0013   3466           00186         RETLW   b'01100110'                     ;"4"
0014   346D           00187         RETLW   b'01101101'                     ;"5"
0015   347D           00188         RETLW   b'01111101'                     ;"6"
0016   3407           00189         RETLW   b'00000111'                     ;"7"
0017   347F           00190         RETLW   b'01111111'                     ;"8"
0018   346F           00191         RETLW   b'01101111'                     ;"9"
0019   3438           00192         RETLW   b'00111000'                     ;"L" (value=10)
001A   3476           00193         RETLW   b'01110110'                     ;"H" (value=11)
                      00194 
                      00195 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00196 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00197 ;++++++++++++++   Start of the Program   ++++++++++++++++++++++++++++++
                      00198 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00199 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
001B                  00200 main                                            ;
                      00201         M_BANKSEL_0                             ;bank 0
001B   1303               M                 BCF     STATUS,6
001C   1283               M                 BCF     STATUS,5
001D   0064           00202         CLRWDT                                  ;
                      00203                                                 ;
001E   3000           00204         MOVLW   b'00000000'                     ;gie off, peripherals off,tmr0 off,RB0 and RB changes of
                            f,flags off
001F   008B           00205         MOVWF   INTCON                          ;
0020   0185           00206         CLRF    PORTA                           ;
0021   0186           00207         CLRF    PORTB                           ;
0022   0187           00208         CLRF    PORTC                           ;
0023   0188           00209         CLRF    PORTD                           ;
0024   0189           00210         CLRF    PORTE                           ;
0025   018C           00211         CLRF    PIR1                            ;clear all interrupt flags
0026   018D           00212         CLRF    PIR2                            ;clear all interrupt flags .......including LCDPS,WA
                      00213                                                 ;
0027   300F           00214         MOVLW   b'00001111'                     ;gate off, 1:1 PS, no sync extr clock,tmr1 on
0028   0090           00215         MOVWF   T1CON                           ;
                      00216                                                 ;
0029   2416           00217         CALL    CLEAR_RAM_0                     ;
002A   241F           00218         CALL    CLEAR_RAM_1                     ;
                      00219                                                 ;       
002B   300C           00220         MOVLW   CLKP_HOUR_12                    ;
002C   00AE           00221         MOVWF   MAX_HOURS                       ;
                      00222                                                 ;
                      00223 ;A/D CONVERTER                                  ;
002D   301C           00224         MOVLW   b'00011100'                     ;LEFT justified,vref,read AN7,A/D powered OFF
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

002E   009F           00225         MOVWF   ADCON0                          ;
                      00226                                                 ;
                      00227         M_BANKSEL_1                             ;
002F   1303               M                 BCF     STATUS,6
0030   1683               M                 BSF     STATUS,5
0031   3080           00228         MOVLW   b'10000000'                     ;Select AN7 (RE2) analogue input for low battery detecti
                            on
0032   0091           00229         MOVWF   ANSEL                           ;
                      00230                                                 ;
0033   3050           00231         MOVLW   b'01010000'                     ;fosc/16 for conversion
0034   009F           00232         MOVWF   ADCON1                          ;
                      00233                                                 ;
0035   3007           00234         MOVLW   .7                              ;
0036   009C           00235         MOVWF   CMCON0                          ;OFF
                      00236                                                 ;
0037   3061           00237         MOVLW   b'01100001'                     ;4MHz clock,dev is running from int clk,int osc for syst
                            em clock
0038   008F           00238         MOVWF   OSCCON                          ;
0039   3000           00239         MOVLW   b'00000000'                     ;TMR1 interrupts DISABLED, TMR1IF flag will be polled fo
                            r seconds roll-over
                      00240 ;interrupts and ports                           ;
003A   008C           00241         MOVWF   PIE1                            ;
003B   3000           00242         MOVLW   b'00000000'                     ;LCD interrupt disabled
003C   008D           00243         MOVWF   PIE2                            ;
003D   30C1           00244         MOVLW   MASKTA                          ;
003E   0085           00245         MOVWF   TRISA                           ;
003F   3000           00246         MOVLW   MASKTB                          ;
0040   0086           00247         MOVWF   TRISB                           ;
0041   3007           00248         MOVLW   MASKTC                          ;
0042   0087           00249         MOVWF   TRISC                           ;
0043   303E           00250         MOVLW   MASKTD                          ;
0044   0088           00251         MOVWF   TRISD                           ;
0045   30FE           00252         MOVLW   MASKTE                          ;
0046   0089           00253         MOVWF   TRISE                           ;
                      00254                                                 ;
0047   3080           00255         MOVLW   b'10000000'                     ;no pullups, tmr0 internal, prescale assigned to tmr0,<2
                            :0>=PS tmr0 = 1:2
0048   0081           00256         MOVWF   OPTION_REG                      ;PortA pullups disabled
                      00257                                                 ;
                      00258 ;LCD control registers                          ;
                      00259         M_BANKSEL_2                             ;
0049   1703               M                 BSF     STATUS,6
004A   1283               M                 BCF     STATUS,5
004B   01A0           00260         CLRF    WR_ERRORS                       ;
004C   01A1           00261         CLRF    WR_NOERRORS                     ;
004D   01A2           00262         CLRF    TOGGLE_LCD                      ;
004E   3017           00263         MOVLW   b'00010111'                     ;lcd off, on when sleep,no write error,VLCD enabled,TMR1
                             is source clk,1/4 common
004F   0087           00264         MOVWF   LCDCON                          ; 
                      00265                                                 ;
0050   3080           00266         MOVLW   b'10000000'                     ;waveform B(1),bias 1/3 for 1/4 mux,
0051   3803           00267         IORLW   LCD_PRESCALE                    ;add the prescaler (see TXHeader.h)
0052   0088           00268         MOVWF   LCDPS                           ;  --- with 1:2 PS
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00269                                                 ;
                      00270 #IFDEF  WAVE_TYPE_B                             ;
0053   3080           00271         MOVLW   WFT_B                           ;waveform B(1),bias 1/3 for 1/4 mux,
                      00272 #ELSE                                           ;
                      00273         MOVLW   WFT_A                           ;waveform A(0),bias 1/3 for 1/4 mux,
                      00274 #ENDIF                                          ;
0054   0488           00275         IORWF   LCDPS,F                         ;
                      00276                                                 ;
0055   30FF           00277         MOVLW   b'11111111'                     ;Sements (7:0) all LCD segments enabled
0056   009C           00278         MOVWF   LCDSE0                          ;
                      00279 #IFDEF DEBUG                                    ;
                      00280         MOVLW   b'11101111'                     ; DEBUG - RB5 and RB6 for ICD2, seg15 <bit5> problems
                      00281 #ELSE                                           ;
0057   300F           00282         MOVLW   b'00001111'                     ;Sements (15:8)  THIS ARE THE REAL FLAGS !!!!!!!!!!
                      00283 #ENDIF                                          ;
0058   009D           00284         MOVWF   LCDSE1                          ;
0059   019E           00285         CLRF    LCDSE2                          ;Sements (23:16) all IO pins ********* LCDSE2 doesn't ex
                            ist in 16F913 ***
                      00286                                                 ;
005A   3012           00287         MOVLW   b'00010010'                     ;WDT PS 1:16K, software enable off
005B   0085           00288         MOVWF   WDTCON                          ;
005C   0190           00289         CLRF    LCDDATA0                        ;all segments dark
005D   0191           00290         CLRF    LCDDATA1                        ;
005E   0193           00291         CLRF    LCDDATA3                        ;******** LCDDATA2,LCDDATA5, LCDDATA8 and LCDDATA11 don'
                            t exist in 6F913 ***
005F   0194           00292         CLRF    LCDDATA4                        ;
0060   0196           00293         CLRF    LCDDATA6                        ;
0061   0197           00294         CLRF    LCDDATA7                        ;
0062   0199           00295         CLRF    LCDDATA9                        ;
0063   019A           00296         CLRF    LCDDATA10                       ;
0064   1787           00297         BSF     LCDCON,LCDEN                    ;
                      00298                                                 ;
                      00299         M_BANKSEL_0                             ;
0065   1303               M                 BCF     STATUS,6
0066   1283               M                 BCF     STATUS,5
0067   3060           00300         MOVLW   PW_OFF_PERIOD                   ;LED1 initialized to OFF
0068   00A2           00301         MOVWF   LED1_CLOCK                      ;
0069   1585           00302         BSF     KB0                             ;buttons disabled
006A   3003           00303         MOVLW   b'00000011'                     ;display hours, minutes
006B   00F1           00304         MOVWF   LCD_CHAR1                       ;
006C   3002           00305         MOVLW   b'00000010'                     ;display device OFF
006D   00F2           00306         MOVWF   LCD_CHAR2                       ;Initialize some more local data
006E   16F3           00307         BSF     COLON                           ;display ":"
006F   15F2           00308         BSF     LCD_UPD                         ;
                      00309                                                 ;
0070   172C           00310         BSF     SND_TEST_MSG                    ;Test the batery by sending a test message
0071   300C           00311         MOVLW   IDLE_BATTERY_TEST               ; and reload the counter
0072   00BB           00312         MOVWF   IDLE_BATT_COUNT                 ;
0073   3001           00313         MOVLW   1                               ;
0074   00BC           00314         MOVWF   BAT_OFF_MSG_COUNT               ;
0075   3020           00315         MOVLW   BLINK_2P_PERIOD                 ;
0076   00BD           00316         MOVWF   TMR2_1SECOND                    ;
0077   3006           00317         MOVLW   b'00000110'                     ;start timer 2
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0078   0092           00318         MOVWF   T2CON                           ;1 second blink of the ":", POSTSCALE 1:1, POSTCALE 1:16
                            , TMR2 OFF
                      00319 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00320 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00321 ;+++++++++++++++++++++   Main Loop ++++++++++++++++++++++++++++++++++++
                      00322 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00323 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0079                  00324 _SNOOZE:                                        ;
                      00325         M_BANKSEL_0                             ;
0079   1303               M                 BCF     STATUS,6
007A   1283               M                 BCF     STATUS,5
                      00326 ;       BCF     DEBUG_OUT                       ;
007B   1844           00327         BTFSC   TRASMISSIONE_HCS                ;if TRASMISSIONE_HCS is set, we're still transmitting
007C   288C           00328         GOTO    _STAY_UP                        ;
007D   18AB           00329         BTFSC   BTN_ACT_PDG                     ;if there is an on-going button action, don't sleep
007E   288C           00330         GOTO    _STAY_UP                        ;
                      00331                                                 ;
007F   0000           00332         NOP                                     ;
0080   138B           00333         BCF     INTCON,GIE                      ;
0081   170B           00334         BSF     INTCON,PEIE                     ;
0082   1683           00335         BSF     STATUS,5                        ;BANK 1
0083   160D           00336         BSF     PIE2,LCDIE                      ;set LCD ints to wake up
0084   0000           00337         NOP                                     ;
0085   0000           00338         NOP                                     ;       
                      00339                                                 ;
                      00340         #IFNDEF DEBUG                           ;
0086   0063           00341         SLEEP                                   ;
                      00342         ELSE                                    ;
                      00343         NOP                                     ;
                      00344         #ENDIF                                  ;
0087   0000           00345         NOP                                     ;
0088   0000           00346         NOP                                     ;
0089   120D           00347         BCF     PIE2,LCDIE                      ;
008A   1283           00348         BCF     STATUS,5                        ;BANK 0
008B   130B           00349         BCF     INTCON,PEIE                     ;
008C                  00350 _STAY_UP                                        ;
008C   1E0D           00351         BTFSS   LCD_IF                          ;wait here for lcd interrupt flag
008D   288C           00352         GOTO    _STAY_UP                        ;
                      00353                                                 ;
008E   0000           00354         NOP                                     ;
                      00355 ;       bsf     DEBUG_OUT                       ;
008F   0000           00356         NOP                                     ;
0090   1C44           00357         BTFSS   TRASMISSIONE_HCS                ;if TRASMISSIONE_HCS is set, we're transmitting somethin
                            g, 
0091   20A2           00358         CALL    SEND_MESSAGES                   ; so do other jobs
                      00359                                                 ;
0092   22B5           00360         CALL    SECONDS_BLINK                   ;
0093   233F           00361         CALL    UPDATE_LCD                      ;finish any display that may be pending because of even/
                            odd frames
0094   22BF           00362         CALL    REAL_TIME_SERVICES              ;see if TMR1 expired in the meantime
                      00363                                                 ;
0095   303E           00364         MOVLW   b'00111110'                     ;handle ALL ACTIONS which are in progress
0096   052B           00365         ANDWF   LCD_CHAR3,W                     ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0097   1D03           00366         BTFSS   STATUS,Z                        ;
0098   2108           00367         CALL    HANDLE_BUTTONS                  ;
                      00368                                                 ;
0099   1973           00369         BTFSC   BATTERY_LOW                     ;block all actions when the batteries are low
009A   2879           00370         GOTO    _SNOOZE                         ;
009B   1CAB           00371         BTFSS   BTN_ACT_PDG                     ;accept new jobs only if no other job is pending
009C   2251           00372         CALL    TEST_BUTTONS                    ;
                      00373                                                 ;
009D   231C           00374         CALL    DISPLAY_REAL_TIME               ;Load Real Time variables for display in the LCD
009E   2294           00375         CALL    MANAGE_LED1                     ;
009F   22A3           00376         CALL    TREAT_BATTERY_DISPLAY           ;
00A0   233F           00377         CALL    UPDATE_LCD                      ;
00A1   2879           00378         GOTO    _SNOOZE                         ;
                      00379 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00380 ;Handles message sending to the BASE unit. 
                      00381 ;BEEPER bit must be in the correct state
                      00382 ;Message layout:
                      00383 ;HCS1   BIT 7÷5         0               RESERVED, FORCED TO ZERO
                      00384 ;HCS1   BIT 4           0÷1             LEFT/RIGHT SIDE
                      00385 ;HCS1   BIT 3÷0         0÷F             SERIAL NUMBER HIGH
                      00386 ;HCS2   BIT 7÷0         00÷FF           SERIAL NUMBER
                      00387 ;HCS3   BIT 7÷0         00÷FF           SERIAL NUMBER
                      00388 ;HCS4   BIT 7÷0         00÷FF           SERIAL NUMBER LOW
                      00389 ;HCS5   BIT 7÷3         00÷0A           LEVEL CODE
                      00390 ;HCS5   BIT 2           0÷1             BEEPER
                      00391 ;HCS5   BIT 1           0-1             LEARN MODE ON/OFF
                      00392 ;HCS5   BIT 0           0               PADDING
                      00393 ;HCS6   BIT 7÷0         00÷FF           CHECKSUM
                      00394 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
00A2                  00395 SEND_MESSAGES                                   ;
00A2   1844           00396         BTFSC   TRASMISSIONE_HCS                ;If we are not finished xmitting, leave
00A3   2907           00397         GOTO    _MSG_FIN                        ;don't start a new one
00A4   08B5           00398         MOVF    REXMIT_COUNT,F                  ;
00A5   1903           00399         BTFSC   STATUS,Z                        ;If we are in the procees of retranmitting
00A6   28AC           00400         GOTO    _NEW_MSG                        ; go re-send the last message (already in HCSx)
00A7   0BB9           00401         DECFSZ  PAUSE_COUNT,F                   ;
00A8   2907           00402         GOTO    _MSG_FIN                        ;
00A9   0BB5           00403         DECFSZ  REXMIT_COUNT,F                  ;
00AA   28FA           00404         GOTO    _RE_SEND                        ;
00AB   2907           00405         GOTO    _MSG_FIN                        ;
                      00406                                                 ;
00AC                  00407 _NEW_MSG                                        ; else
00AC   1C2C           00408         BTFSS   SND_OFF_MSG                     ;check if there are NEW messages to send
00AD   28B1           00409         GOTO    _ON_MSG                         ;
00AE   3000           00410         MOVLW   .0                              ;tempertature = 0
00AF   102C           00411         BCF     SND_OFF_MSG                     ;
00B0   28CC           00412         GOTO    _MSG_CONT1                      ;
00B1                  00413 _ON_MSG                                         ;
00B1   1CAC           00414         BTFSS   SND_ON_MSG                      ;
00B2   28B6           00415         GOTO    _REFRESH_MSG                    ;
00B3   0876           00416         MOVF    TMPTR_VALUE,W                   ;temperature = new temperature
00B4   10AC           00417         BCF     SND_ON_MSG                      ;
00B5   28CC           00418         GOTO    _MSG_CONT1                      ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00B6                  00419 _REFRESH_MSG                                    ;
00B6   1FAC           00420         BTFSS   SND_REFRESH_MSG                 ;
00B7   28BB           00421         GOTO    _BOOST_ON_MSG                   ;temperature = real temperature
00B8   0876           00422         MOVF    TMPTR_VALUE,W                   ;
00B9   13AC           00423         BCF     SND_REFRESH_MSG                 ;
00BA   28D0           00424         GOTO    _MSG_CONT2                      ;do 5 repetitions
00BB                  00425 _BOOST_ON_MSG                                   ;
00BB   1D2C           00426         BTFSS   SND_BOOSTON_MSG                 ;
00BC   28C0           00427         GOTO    _BOOST_OFF_MSG                  ;
00BD   300A           00428         MOVLW   .10                             ;temperature = max temperature
00BE   112C           00429         BCF     SND_BOOSTON_MSG                 ;
00BF   28CC           00430         GOTO    _MSG_CONT1                      ;
00C0                  00431 _BOOST_OFF_MSG                                  ;
00C0   1DAC           00432         BTFSS   SND_BOO_OFF_MSG                 ;
00C1   28C5           00433         GOTO    _SND_LEARN_MSG                  ;
00C2   0876           00434         MOVF    TMPTR_VALUE,W                   ;temperature = real temperature
00C3   11AC           00435         BCF     SND_BOO_OFF_MSG                 ;
00C4   28CC           00436         GOTO    _MSG_CONT1                      ;
00C5                  00437 _SND_LEARN_MSG                                  ;
00C5   1EAC           00438         BTFSS   SND_LEARN_MSG                   ;
00C6   28C9           00439         GOTO    _SND_TEST_MSG                   ;we need the SND_LEARN_MSG flag down below
00C7   3000           00440         MOVLW   .0                              ;temperature = 0 (don't care)
00C8   28D0           00441         GOTO    _MSG_CONT2                      ;5 repetitions
00C9                  00442 _SND_TEST_MSG                                   ;
00C9   1F2C           00443         BTFSS   SND_TEST_MSG                    ;if this is a test message, we will load all the
00CA   2907           00444         GOTO    _MSG_FIN                        ; message parameters but corrupt the checksum to make
00CB   3000           00445         MOVLW   .0                              ;
                      00446                                                 ; sure the test message is not used by the base
00CC                  00447 _MSG_CONT1                                      ;
00CC   00A0           00448         MOVWF   TEMP_BYT0_B0                    ;save temperature level whiche is in WREG in temp_byt
00CD   3002           00449         MOVLW   REXMIT_NORMAL                   ;new message is ready to send
00CE   00B5           00450         MOVWF   REXMIT_COUNT                    ;Load the repeat counter
00CF   28D3           00451         GOTO    _MSG_CONT3                      ;
                      00452                                                 ;
00D0                  00453 _MSG_CONT2                                      ;
00D0   00A0           00454         MOVWF   TEMP_BYT0_B0                    ;save temperature level whiche is in WREG in temp_byt
00D1   3003           00455         MOVLW   REXMIT_EXTEND                   ;new message is ready to send
00D2   00B5           00456         MOVWF   REXMIT_COUNT                    ;Load the repeat counter                                
                                                            ;
                      00457                                                 ;
00D3                  00458 _MSG_CONT3                                      ;
00D3   0DA0           00459         RLF     TEMP_BYT0_B0,F                  ;now pack the temperature
00D4   0DA0           00460         RLF     TEMP_BYT0_B0,F                  ;and
00D5   0DA0           00461         RLF     TEMP_BYT0_B0,F                  ;
00D6   30F8           00462         MOVLW   0xF8                            ;clear padding bit
00D7   0520           00463         ANDWF   TEMP_BYT0_B0,W                  ;
00D8   00C2           00464         MOVWF   HCS5                            ;and
00D9   1873           00465         BTFSC   BEEPER                          ;
00DA   1542           00466         BSF     HCS5,2                          ;load beeper
00DB   1AAC           00467         BTFSC   SND_LEARN_MSG                   ;and
00DC   14C2           00468         BSF     HCS5,1                          ;learn bits
                      00469                                                 ;
00DD   1073           00470         BCF     BEEPER                          ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00DE   12AC           00471         BCF     SND_LEARN_MSG                   ;flags can now be cleared
                      00472                                                 ;
00DF   27FF           00473         CALL    GET_SERIAL_0                    ;msb
00E0   00A0           00474         MOVWF   TEMP_BYT0_B0                    ;
00E1   300F           00475         MOVLW   0x0F                            ;msb is 1 nibble only
00E2   0520           00476         ANDWF   TEMP_BYT0_B0,W                  ;
00E3   04BE           00477         IORWF   HCS1,F                          ;
                      00478                                                 ;
00E4   27FE           00479         CALL    GET_SERIAL_1                    ;next msb
00E5   00BF           00480         MOVWF   HCS2                            ;
00E6   27FD           00481         CALL    GET_SERIAL_2                    ;next msb
00E7   00C0           00482         MOVWF   HCS3                            ;
00E8   27FC           00483         CALL    GET_SERIAL_3                    ;lsb
00E9   00C1           00484         MOVWF   HCS4                            ;
00EA   123E           00485         BCF     HCS1,4                          ;Future LEFT/RIGHT indication
                      00486                                                 ;
00EB   01C3           00487         CLRF    HCS6                            ;
00EC   303E           00488         MOVLW   HCS1                            ;calculate checksum
00ED   0084           00489         MOVWF   FSR                             ;
00EE   3005           00490         MOVLW   .5                              ;
00EF   00A0           00491         MOVWF   TEMP_BYT0_B0                    ;
00F0                  00492 _CHKSUM_LOOP                                    ;
00F0   0800           00493         MOVF    INDF,W                          ;
00F1   07C3           00494         ADDWF   HCS6,F                          ;
00F2   0A84           00495         INCF    FSR,F                           ;
00F3   0BA0           00496         DECFSZ  TEMP_BYT0_B0,F                  ;
00F4   28F0           00497         GOTO    _CHKSUM_LOOP                    ;
                      00498                                                 ;
00F5   1F2C           00499         BTFSS   SND_TEST_MSG                    ;
00F6   28FA           00500         GOTO    _RE_SEND                        ;
00F7   0AC3           00501         INCF    HCS6,F                          ;corrupt the checksum
00F8   132C           00502         BCF     SND_TEST_MSG                    ;
00F9   01B5           00503         CLRF    REXMIT_COUNT                    ;send test message only once
                      00504                                                 ;
00FA                  00505 _RE_SEND                                        ;
00FA   1005           00506         BCF     TX_ENABLE                       ;
00FB   1683           00507         BANK1                                   ;TX_ENABLE should only be output when transmitting
00FC   1005           00508         BCF     TXENBL_TRIS                     ;
00FD   1283           00509         BANK0                                   ;
00FE   1005           00510         BCF     TX_ENABLE                       ;
00FF   303C           00511         MOVLW   .60                             ;hard delay 120uS                                       
                                                    
0100   00A0           00512         MOVWF   TEMP_BYT0_B0                    ;
0101                  00513 _LOOP_DELAY                                     ;
0101   0BA0           00514         DECFSZ  TEMP_BYT0_B0,F                  ;
0102   2901           00515         GOTO    _LOOP_DELAY                     ;
0103   178B           00516         BSF     _GIE                            ;enable global ints
                      00517                                                 ;
0104   3001           00518         MOVLW   MSG_PAUSE_PERIOD                ;
0105   00B9           00519         MOVWF   PAUSE_COUNT                     ;
0106   2428           00520         CALL    INIZIO_TX_HCS                   ;
0107                  00521 _MSG_FIN                                        ;
0107   0008           00522         RETURN                                  ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00523 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00524 ;Decide which button procedure must handle this button
                      00525 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0108                  00526 HANDLE_BUTTONS                                  ;
0108   1F2B           00527         BTFSS   AUTOLOCK_ON                     ;
0109   2918           00528         GOTO    _NEXT_HANDLE                    ;if locked
                      00529                                                 ;  then
010A   3004           00530         MOVLW   b'00000100'                     ;
010B   0629           00531         XORWF   NEW_BUTTON_CONFIG,W             ;
010C   1D03           00532         BTFSS   STATUS,Z                        ;when in AUTOLOCK, the debounce timer is 2 seconds!
010D   2915           00533         GOTO    _AUTOLOCK_REJECT                ; so on first detection of the MODE key, we
010E   132B           00534         BCF     AUTOLOCK_ON                     ; can remove the LOCK
010F   17AB           00535         BSF     RELOCK_ON                       ; and 
0110   301E           00536         MOVLW   AUTOLOCK_OFF_TIME               ; prepare the count to re-lock
0111   00AF           00537         MOVWF   RE_LOCK_TIME                    ;
0112   10AB           00538         BCF     BTN_ACT_PDG                     ;
0113   1371           00539         BCF     LOCKED                          ;
0114   2A28           00540         GOTO    _DISPLAY_ADJUSTMENTS            ;
                      00541                                                 ;
0115                  00542 _AUTOLOCK_REJECT                                ;
0115   172B           00543         BSF     AUTOLOCK_ON                     ;
0116   10AB           00544         BCF     BTN_ACT_PDG                     ;
0117   2A2C           00545         GOTO    _RESET_RELOCK                   ;
                      00546                                                 ;
0118                  00547 _NEXT_HANDLE                                    ;HANDLE BUTTON ACTIONS.........
0118   19AB           00548         BTFSC   CLCKSET_ACT                     ;clock adjustments?
0119   297D           00549         GOTO    _HANDLE_CLK_SET                 ;
011A   1AAB           00550         BTFSC   HEAT_ACT                        ;check if an action has already been assigned
011B   29FF           00551         GOTO    _HEAT_MSG_ACTION                ;boost adjustments?
                      00552                                                 ;
011C                  00553 _NEW_ACTIONS                                    ;no task has been assigned yet, this may be a new action
                      00554 ;===================================== SEND LEARN MESSAGE ==========
011C   3006           00555         MOVLW   b'00000110'                     ;
011D   0629           00556         XORWF   NEW_BUTTON_CONFIG,W             ;
011E   1D03           00557         BTFSS   STATUS,Z                        ;
011F   2924           00558         GOTO    _PREHEAT                        ;
0120   1473           00559         BSF     BEEPER                          ;beep
0121   16AC           00560         BSF     SND_LEARN_MSG                   ;
0122   10AB           00561         BCF     BTN_ACT_PDG                     ;
0123   2A2C           00562         GOTO    _RESET_RELOCK                   ;
                      00563                                                 ;
0124                  00564 _PREHEAT                                        ;
0124   1CA9           00565         BTFSS   PREHEAT                         ;
0125   2938           00566         GOTO    _NEW_MODE                       ;
                      00567                                                 ;
                      00568 ;===================================== NEW BOOST ACTION ==============
0126   1C72           00569         BTFSS   DEVON                           ;accept boost only if the device is on
0127   2A2B           00570         GOTO    _NO_MORE_ACTION                 ;
0128   19F3           00571         BTFSC   BOOST_ACT                       ;If the device is already BOOSTing, don't start it again
0129   2A2B           00572         GOTO    _NO_MORE_ACTION                 ;
                      00573                                                 ;
012A   15F3           00574         BSF     BOOST_ACT                       ;
012B   152C           00575         BSF     SND_BOOSTON_MSG                 ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

012C   16F1           00576         BSF     TEMPETR                         ;turn on TEMP and BOOST icons
012D   1473           00577         BSF     BEEPER                          ;beep
012E   1572           00578         BSF     BOOST                           ;
012F   300A           00579         MOVLW   .10                             ;display "H"
0130   00F6           00580         MOVWF   TMPTR_VALUE                     ;
0131   301E           00581         MOVLW   BOOST_PERIOD                    ;
0132   00B2           00582         MOVWF   BOOST_MINUTES                   ;start BOOST timer
0133   15F2           00583         BSF     LCD_UPD                         ;
0134   233F           00584         CALL    UPDATE_LCD                      ;
0135   233F           00585         CALL    UPDATE_LCD                      ;
0136   10AB           00586         BCF     BTN_ACT_PDG                     ;
0137   2A2C           00587         GOTO    _RESET_RELOCK                   ;
                      00588                                                 ;
0138                  00589 _NEW_MODE                                       ;
0138   1D29           00590         BTFSS   MODE                            ;
0139   2970           00591         GOTO    _NEW_CLKSET                     ;
                      00592 ;======================================= NEW ACTION FOR AUTO-OFF TIMER =====
013A   18F2           00593         BTFSC   DEVOFF                          ;
013B   2943           00594         GOTO    _MODE1HR                        ;
013C   1971           00595         BTFSC   ONEHR                           ;
013D   2952           00596         GOTO    _MODE3HR                        ;
013E   19F1           00597         BTFSC   THREEHR                         ;
013F   295C           00598         GOTO    _MODE12HR                       ;
0140   1A71           00599         BTFSC   TWELVEHR                        ;
0141   2966           00600         GOTO    _MODE_OFF                       ;
0142   2A2B           00601         GOTO    _NO_MORE_ACTION                 ;
                      00602                                                 ;
0143                  00603 _MODE1HR                                        ;
0143   3001           00604         MOVLW   AUTO_OFF_1HR                    ;THIS IS HOW WE TURN ON THE DEVICE
0144   00B0           00605         MOVWF   AUTO_OFF_HOURS                  ;Step through the different settings
                      00606                                                 ;
0145   0833           00607         MOVF    SAVED_TEMPERATURE,W             ;
0146   00F6           00608         MOVWF   TMPTR_VALUE                     ;
0147   1472           00609         BSF     DEVON                           ;
0148   16F1           00610         BSF     TEMPETR                         ;
0149   10F2           00611         BCF     DEVOFF                          ;
014A   1571           00612         BSF     ONEHR                           ;
014B   11F1           00613         BCF     THREEHR                         ;
014C   1271           00614         BCF     TWELVEHR                        ;
014D   14AC           00615         BSF     SND_ON_MSG                      ;Inform the base
014E   1473           00616         BSF     BEEPER                          ;(beep, unit is turned on)
014F   222F           00617         CALL    FILL_RESEND_PERIOD              ;
0150   01B6           00618         CLRF    RESEND_OFF_COUNT                ;don't send off msg
0151   2969           00619         GOTO    _SAVE_MINUTES                   ;
0152                  00620 _MODE3HR                                        ;
0152   3003           00621         MOVLW   AUTO_OFF_3HR                    ;
0153   00B0           00622         MOVWF   AUTO_OFF_HOURS                  ;
0154   1472           00623         BSF     DEVON                           ;
0155   10F2           00624         BCF     DEVOFF                          ;Don't need to inform the base, we'll just keep sending 
                            the refresh msg longer
0156   1171           00625         BCF     ONEHR                           ;
0157   15F1           00626         BSF     THREEHR                         ;
0158   1271           00627         BCF     TWELVEHR                        ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0159   1473           00628         BSF     BEEPER                          ;
015A   17AC           00629         BSF     SND_REFRESH_MSG                 ;
015B   2969           00630         GOTO    _SAVE_MINUTES                   ;
015C                  00631 _MODE12HR                                       ;
015C   300C           00632         MOVLW   AUTO_OFF_12HR                   ;
015D   00B0           00633         MOVWF   AUTO_OFF_HOURS                  ;
015E   1472           00634         BSF     DEVON                           ;
015F   10F2           00635         BCF     DEVOFF                          ;
0160   1171           00636         BCF     ONEHR                           ;
0161   11F1           00637         BCF     THREEHR                         ;
0162   1671           00638         BSF     TWELVEHR                        ;(no beep)
0163   1473           00639         BSF     BEEPER                          ;
0164   17AC           00640         BSF     SND_REFRESH_MSG                 ;
0165   2969           00641         GOTO    _SAVE_MINUTES                   ;
0166                  00642 _MODE_OFF                                       ;
0166   2240           00643         CALL    DEVICE_OFF                      ;
0167   1473           00644         BSF     BEEPER                          ;(beep, change is manual)
0168   296B           00645         GOTO    _DISP_AUTO_OFF                  ;
                      00646                                                 ;
0169                  00647 _SAVE_MINUTES                                   ;
0169   303C           00648         MOVLW   SIXTY_MINUTES                   ;
016A   00B1           00649         MOVWF   AUTO_OFF_MINUTES                ;minutes count down (hours already loaded in AUTO_OFF_HO
                            URS)
016B                  00650 _DISP_AUTO_OFF                                  ;
016B   15F2           00651         BSF     LCD_UPD                         ;
016C   233F           00652         CALL    UPDATE_LCD                      ;
016D   233F           00653         CALL    UPDATE_LCD                      ;
016E   10AB           00654         BCF     BTN_ACT_PDG                     ;
016F   2A2C           00655         GOTO    _RESET_RELOCK                   ;
                      00656                                                 ;
0170                  00657 _NEW_CLKSET                                     ;
0170   1EA9           00658         BTFSS   CLOCK_SET                       ;
0171   29F1           00659         GOTO    _NEW_TEMP_VARS                  ;
                      00660 ;=================================== NEW CLOCK ADJUSTMENTS ACTION ============
0172                  00661 _NEW_CLK_ADJ                                    ;
0172   15AB           00662         BSF     CLCKSET_ACT                     ;start clock adjustment
0173   16F3           00663         BSF     COLON                           ;
0174   3002           00664         MOVLW   CLKP_MIN_ADJ                    ;
0175   00AD           00665         MOVWF   ADJUST_CLK_PHASE                ;1st phase of clock adjustment
0176   3010           00666         MOVLW   BLINK_PERIOD                    ;
0177   00A8           00667         MOVWF   BLINK_COUNT                     ;
0178   1471           00668         BSF     MINUTES                         ;
0179   15F2           00669         BSF     LCD_UPD                         ;
017A   233F           00670         CALL    UPDATE_LCD                      ;
017B   233F           00671         CALL    UPDATE_LCD                      ;
017C   2A2C           00672         GOTO    _RESET_RELOCK                   ;
                      00673 ;===================================================================
017D                  00674 _HANDLE_CLK_SET                                 ;continue setting the clock according to the phase
                      00675         M_CMPL_JE       ADJUST_CLK_PHASE,CLKP_MIN_ADJ,_MIN_ADJUST
017D   082D               M                 movf    ADJUST_CLK_PHASE,w
017E   3A02               M                 xorlw   CLKP_MIN_ADJ
017F   1903               M                 btfsc   STATUS,Z
0180   2986               M                 goto    _MIN_ADJUST
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00676         M_CMPL_JE       ADJUST_CLK_PHASE,CLKP_HOUR_ADJ,_HR_ADJUST
0181   082D               M                 movf    ADJUST_CLK_PHASE,w
0182   3A03               M                 xorlw   CLKP_HOUR_ADJ
0183   1903               M                 btfsc   STATUS,Z
0184   29B9               M                 goto    _HR_ADJUST
0185   2A2B           00677         GOTO    _NO_MORE_ACTION                 ;resets flags, resets relock count and goes out
                      00678                                                 ;
0186                  00679 _MIN_ADJUST                                     ;ADJUST MINUTES
0186   0BA8           00680         DECFSZ  BLINK_COUNT,F                   ;
0187   298E           00681         GOTO    _NO_BLKMIN                      ;
0188   3001           00682         MOVLW   b'00000001'                     ;toggle MINUTES
0189   06F1           00683         XORWF   LCD_CHAR1,F                     ;
018A   3010           00684         MOVLW   BLINK_PERIOD                    ;
018B   00A8           00685         MOVWF   BLINK_COUNT                     ;
018C   15F2           00686         BSF     LCD_UPD                         ;
018D   233F           00687         CALL    UPDATE_LCD                      ;blink the display
018E                  00688 _NO_BLKMIN                                      ;
018E   2251           00689         CALL    TEST_BUTTONS                    ;check for + - buttons
018F   14AB           00690         BSF     BTN_ACT_PDG                     ;make sure we stay in this loop until debouncing is fini
                            shed
0190   182B           00691         BTFSC   DEBOUNCING                      ;
0191   2A2C           00692         GOTO    _RESET_RELOCK                   ;
0192   01AA           00693         CLRF    OLD_BUTTON_CONFIG               ;
                      00694                                                 ;
0193                  00695 _SKIPMIN                                        ;button was pressed
0193   1A29           00696         BTFSC   PLUS                            ;+ button
0194   2998           00697         GOTO    _ADD_MINUTE                     ;
0195   19A9           00698         BTFSC   MINUS                           ;- button
0196   29A2           00699         GOTO    _SUB_MINUTE                     ;
0197   29AD           00700         GOTO    _MODE_MIN                       ;
0198                  00701 _ADD_MINUTE                                     ;
0198   0AA4           00702         INCF    RT_MINUTES,F                    ;
                      00703         M_CMPL_JL RT_MINUTES,.60,_GO1_MIN       ;
0199   0824               M                 movf    RT_MINUTES,w
019A   3C3C               M                 sublw   .60     ;k-v1 < 0
019B   1C03               M                 btfss   STATUS,C
019C   29A0               M                 goto    $+4
019D   1903               M                 btfsc   STATUS,Z
019E   29A0               M                 goto    $+2
019F   29A1               M                 goto    _GO1_MIN
01A0   01A4           00704         CLRF    RT_MINUTES                      ;
01A1                  00705 _GO1_MIN                                        ;
01A1   29A8           00706         GOTO    _NEW_MINUTES                    ;
01A2                  00707 _SUB_MINUTE                                     ;
01A2   08A4           00708         MOVF    RT_MINUTES,F                    ;
01A3   1D03           00709         BTFSS   STATUS,Z                        ;decrement if not zero
01A4   29A7           00710         GOTO    _DECMIN                         ;
01A5   303C           00711         MOVLW   .59+.1                          ;
01A6   00A4           00712         MOVWF   RT_MINUTES                      ;
01A7                  00713 _DECMIN                                         ;
01A7   03A4           00714         DECF    RT_MINUTES,F                    ;
01A8                  00715 _NEW_MINUTES                                    ;
01A8   15F2           00716         BSF     LCD_UPD                         ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01A9   0824           00717         MOVF    RT_MINUTES,W                    ;
01AA   23E1           00718         CALL    Convert_to_BCD                  ;
01AB   00F4           00719         MOVWF   MIN_VALUE                       ;
01AC   2A2C           00720         GOTO    _RESET_RELOCK                   ;
01AD                  00721 _MODE_MIN                                       ;
01AD   1D29           00722         BTFSS   MODE                            ;MODE button pressed?
01AE   2A2E           00723         GOTO    _HANDLE_FIN                     ;
01AF   1471           00724         BSF     MINUTES                         ;
01B0   3010           00725         MOVLW   BLINK_PERIOD                    ;stop blinking 12/24 hours
01B1   00A8           00726         MOVWF   BLINK_COUNT                     ;
01B2   3003           00727         MOVLW   CLKP_HOUR_ADJ                   ;go to phase 3, adjust hours
01B3   00AD           00728         MOVWF   ADJUST_CLK_PHASE                ;
01B4   15F2           00729         BSF     LCD_UPD                         ;
01B5   233F           00730         CALL    UPDATE_LCD                      ;
01B6   233F           00731         CALL    UPDATE_LCD                      ;
01B7   14F1           00732         BSF     HOURS                           ;
01B8   2A2C           00733         GOTO    _RESET_RELOCK                   ;
                      00734                                                 ;
01B9                  00735 _HR_ADJUST                                      ;ADJUST HOURS
01B9   0BA8           00736         DECFSZ  BLINK_COUNT,F                   ;
01BA   29C1           00737         GOTO    _NO_BLKHR                       ;
01BB   3002           00738         MOVLW   b'00000010'                     ;toggle HOURS bit for blinking
01BC   06F1           00739         XORWF   LCD_CHAR1,F                     ;
01BD   3010           00740         MOVLW   BLINK_PERIOD                    ;
01BE   00A8           00741         MOVWF   BLINK_COUNT                     ;
01BF   15F2           00742         BSF     LCD_UPD                         ;
01C0   233F           00743         CALL    UPDATE_LCD                      ;
01C1                  00744 _NO_BLKHR                                       ;
01C1   2251           00745         CALL    TEST_BUTTONS                    ;check for adjustments 
01C2   14AB           00746         BSF     BTN_ACT_PDG                     ;make sure we stay in this loop until debouncing is fini
                            shed
01C3   182B           00747         BTFSC   DEBOUNCING                      ; 
01C4   2A2C           00748         GOTO    _RESET_RELOCK                   ;
01C5   01AA           00749         CLRF    OLD_BUTTON_CONFIG               ;
                      00750                                                 ;
01C6                  00751 _SKIPHR                                         ;button pressed was:
01C6   1A29           00752         BTFSC   PLUS                            ;+ button
01C7   29CB           00753         GOTO    _ADD_HOUR                       ;
01C8   19A9           00754         BTFSC   MINUS                           ;- button
01C9   29D5           00755         GOTO    _SUB_HOUR                       ;
01CA   29E3           00756         GOTO    _MODE_HOUR                      ;
01CB                  00757 _ADD_HOUR                                       ;
01CB   0AA5           00758         INCF    RT_HOURS,F                      ;
                      00759         M_CMP_JLE RT_HOURS,MAX_HOURS,_GO1_HR    ;
01CC   0825               M                 movf    RT_HOURS,w
01CD   022E               M                 subwf   MAX_HOURS,w     ;v2-v1 > 0
01CE   1803               M                 btfsc   STATUS,C
01CF   29D1               M                 goto    $+2
01D0   1903               M                 btfsc   STATUS,Z
01D1   29D4               M                 goto    _GO1_HR
01D2   3001           00760         MOVLW   .1                              ;
01D3   00A5           00761         MOVWF   RT_HOURS                        ;
01D4                  00762 _GO1_HR                                         ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01D4   29DD           00763         GOTO    _NEW_HOURS                      ;
01D5                  00764 _SUB_HOUR                                       ;
                      00765         M_CMPL_JG RT_HOURS,1,_DECHR             ;
01D5   0825               M                 movf    RT_HOURS,w
01D6   3C01               M                 sublw   1
01D7   1C03               M                 btfss   STATUS,C
01D8   29DC               M                 goto    _DECHR
01D9   300C           00766         MOVLW   CLKP_HOUR_12                    ;...2,1,12,11...
01DA   00A5           00767         MOVWF   RT_HOURS                        ;
01DB   29DD           00768         GOTO    _NEW_HOURS                      ;
01DC                  00769 _DECHR                                          ;
01DC   03A5           00770         DECF    RT_HOURS,F                      ;
01DD                  00771 _NEW_HOURS                                      ;
01DD   14F1           00772         BSF     HOURS                           ;
01DE   15F2           00773         BSF     LCD_UPD                         ;
01DF   0825           00774         MOVF    RT_HOURS,W                      ;
01E0   23E1           00775         CALL    Convert_to_BCD                  ;
01E1   00F5           00776         MOVWF   HOUR_VALUE                      ;
01E2   2A2C           00777         GOTO    _RESET_RELOCK                   ;
01E3                  00778 _MODE_HOUR                                      ;
01E3   1D29           00779         BTFSS   MODE                            ;
01E4   2A2E           00780         GOTO    _HANDLE_FIN                     ;
01E5   1471           00781         BSF     MINUTES                         ;hour values is being confirmed
01E6   14F1           00782         BSF     HOURS                           ;
01E7   10AB           00783         BCF     BTN_ACT_PDG                     ;
01E8   11AB           00784         BCF     CLCKSET_ACT                     ;
01E9   01AD           00785         CLRF    ADJUST_CLK_PHASE                ;ADJUST_CLK_PHASE = CLKP_NOTHING
01EA   01A3           00786         CLRF    RT_SECONDS                      ;
01EB   3020           00787         MOVLW   BLINK_2P_PERIOD                 ;re-start toggle the COLON bit
01EC   00BD           00788         MOVWF   TMR2_1SECOND                    ;
01ED   15F2           00789         BSF     LCD_UPD                         ;
01EE   233F           00790         CALL    UPDATE_LCD                      ;
01EF   233F           00791         CALL    UPDATE_LCD                      ;
01F0   2A2C           00792         GOTO    _RESET_RELOCK                   ;
                      00793                                                 ;
                      00794 ;===================================== NEW TEMPERATURES CHANGES ======
01F1                  00795 _NEW_TEMP_VARS                                  ;
01F1   1C72           00796         BTFSS   DEVON                           ;accept heat changes only if the device is on 
01F2   2A2B           00797         GOTO    _NO_MORE_ACTION                 ;
                      00798                                                 ;
01F3   1B2B           00799         BTFSC   AUTOLOCK_ON                     ;
01F4   2A2B           00800         GOTO    _NO_MORE_ACTION                 ;Temperature variations accepted only if unlocked
                      00801                                                 ;
01F5   19F3           00802         BTFSC   BOOST_ACT                       ;If the device is BOOSTing, don't accept temperature cha
                            nges (new requirement)
01F6   2A2B           00803         GOTO    _NO_MORE_ACTION                 ;
                      00804                                                 ;
01F7   1A29           00805         BTFSC   PLUS                            ;
01F8   29FB           00806         GOTO    _ACCEPT_HEAT_CHANGE             ;
01F9   1DA9           00807         BTFSS   MINUS                           ;
01FA   2A2B           00808         GOTO    _NO_MORE_ACTION                 ;
01FB                  00809 _ACCEPT_HEAT_CHANGE                             ;
01FB   16AB           00810         BSF     HEAT_ACT                        ;make sure we come back to _HEAT_MSG_COUNTING below
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01FC   16F1           00811         BSF     TEMPETR                         ;
01FD   3009           00812         MOVLW   HEAT_MSG_COUNTDWN               ;start the count down
01FE   00B4           00813         MOVWF   PRE_MESSAGE_TIMER               ;
01FF                  00814 _HEAT_MSG_ACTION                                ;
01FF   182B           00815         BTFSC   DEBOUNCING                      ;make sure we're finished debouncing
0200   2A2B           00816         GOTO    _NO_MORE_ACTION                 ;
                      00817                                                 ;
0201   1A29           00818         BTFSC   PLUS                            ;
0202   2A06           00819         GOTO    _TEMP_INCR                      ;
0203   19A9           00820         BTFSC   MINUS                           ;
0204   2A0E           00821         GOTO    _TEMP_DECR                      ;
0205   2A1F           00822         GOTO    _HEAT_MSG_COUNTDOWN             ;countdown if now button pressed
                      00823                                                 ;
0206                  00824 _TEMP_INCR                                      ;
                      00825         M_CMPL_JG TMPTR_VALUE,MAX_TEMP-1,_WRAP_ZERO ;wrap around if we're at min
0206   0876               M                 movf    TMPTR_VALUE,w
0207   3C09               M                 sublw   MAX_TEMP-1
0208   1C03               M                 btfss   STATUS,C
0209   2A0C               M                 goto    _WRAP_ZERO
020A   0AF6           00826         INCF    TMPTR_VALUE,F                   ;
020B   2A16           00827         GOTO    _DELAY_MSG_SEND                 ;
020C                  00828 _WRAP_ZERO                                      ;
020C   01F6           00829         CLRF    TMPTR_VALUE                     ;
020D   2A16           00830         GOTO    _DELAY_MSG_SEND                 ;
                      00831                                                 ;
020E                  00832 _TEMP_DECR                                      ;"-" BUTTON?
                      00833         M_CMPL_JE       TMPTR_VALUE,0,_WRAP_HIGH ;wrap around if we're at max
020E   0876               M                 movf    TMPTR_VALUE,w
020F   3A00               M                 xorlw   0
0210   1903               M                 btfsc   STATUS,Z
0211   2A14               M                 goto    _WRAP_HIGH
0212   03F6           00834         DECF    TMPTR_VALUE,F                   ;
0213   2A16           00835         GOTO    _DELAY_MSG_SEND                 ;
0214                  00836 _WRAP_HIGH                                      ;
0214   300A           00837         MOVLW   MAX_TEMP                        ;
0215   00F6           00838         MOVWF   TMPTR_VALUE                     ;
                      00839                                                 ;
0216                  00840 _DELAY_MSG_SEND                                 ;
0216   0876           00841         MOVF    TMPTR_VALUE,W                   ;
0217   00B3           00842         MOVWF   SAVED_TEMPERATURE               ;
0218   3009           00843         MOVLW   HEAT_MSG_COUNTDWN               ;reload the count down
0219   00B4           00844         MOVWF   PRE_MESSAGE_TIMER               ;
021A   15F2           00845         BSF     LCD_UPD                         ;
021B   233F           00846         CALL    UPDATE_LCD                      ;call twice
021C   233F           00847         CALL    UPDATE_LCD                      ;
021D   01AA           00848         CLRF    OLD_BUTTON_CONFIG               ;junior: elimina questa riga
                      00849 ;       CLRF    NEW_BUTTON_CONFIG               ;
021E   2A2B           00850         GOTO    _NO_MORE_ACTION                 ;
                      00851                                                 ;
021F                  00852 _HEAT_MSG_COUNTDOWN                             ;
021F   0BB4           00853         DECFSZ  PRE_MESSAGE_TIMER,F             ;
0220   2A2E           00854         GOTO    _HANDLE_FIN                     ;
0221   14AC           00855         BSF     SND_ON_MSG                      ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0222   1473           00856         BSF     BEEPER                          ;(beep, on last increment)
0223   12AB           00857         BCF     HEAT_ACT                        ;
0224   10AB           00858         BCF     BTN_ACT_PDG                     ;
0225   222F           00859         CALL    FILL_RESEND_PERIOD              ;
0226   01AA           00860         CLRF    OLD_BUTTON_CONFIG               ;
0227   2A2C           00861         GOTO    _RESET_RELOCK                   ;
                      00862 ;===================================================================
0228                  00863 _DISPLAY_ADJUSTMENTS                            ;
0228   15F2           00864         BSF     LCD_UPD                         ;
0229   233F           00865         CALL    UPDATE_LCD                      ;
022A   2A2C           00866         GOTO    _RESET_RELOCK                   ;
                      00867                                                 ;
022B                  00868 _NO_MORE_ACTION                                 ;
022B   10AB           00869         BCF     BTN_ACT_PDG                     ;
                      00870                                                 ;
022C                  00871 _RESET_RELOCK                                   ;
022C   301E           00872         MOVLW   AUTOLOCK_OFF_TIME               ; RESET THE RE-LOCK counters (even if we're not in autol
                            ock)
022D   00AF           00873         MOVWF   RE_LOCK_TIME                    ;
022E                  00874 _HANDLE_FIN                                     ;
022E   0008           00875         RETURN                                  ;
                      00876 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00877 ;Fill the RESEND_ON_COUNT with a pseudo random number with a spread that 
                      00878 ;goes from 12' to 15'.
                      00879 ;OUTPUT: RESEND_ON_COUNT_L,RESEND_ON_COUNT_H
                      00880 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
022F                  00881 FILL_RESEND_PERIOD                              ;
022F   3002           00882         MOVLW   HIGH (SEND_ON_PERIOD)           ;
0230   00A1           00883         MOVWF   TEMP_BYT1_B0                    ;
0231   30BF           00884         MOVLW   0xBF                            ;xBF = mask to get a ramdom spread of 191secs (~3mins)
0232   0501           00885         ANDWF   TMR0,W                          ; randomize with value of TMR0
0233   00A0           00886         MOVWF   TEMP_BYT0_B0                    ;
0234   30D0           00887         MOVLW   LOW (SEND_ON_PERIOD)            ;
0235   07A0           00888         ADDWF   TEMP_BYT0_B0,F                  ;
0236   1803           00889         SKPNC                                   ;
0237   0AA1           00890         INCF    TEMP_BYT1_B0,F                  ;       
0238   1003           00891         BCF     STATUS,C                        ;devide by 2 because the seconds timer expires each 2sec
                            onds
0239   0CA1           00892         RRF     TEMP_BYT1_B0,F                  ;
023A   0CA0           00893         RRF     TEMP_BYT0_B0,F                  ;
023B   0820           00894         MOVF    TEMP_BYT0_B0,W                  ;
023C   00B7           00895         MOVWF   RESEND_ON_COUNT_L               ;
023D   0A21           00896         INCF    TEMP_BYT1_B0,W                  ;this INCF is to make the countdown algorithm work for t
                            he last FF period
023E   00B8           00897         MOVWF   RESEND_ON_COUNT_H               ;
023F   0008           00898         RETURN                                  ;
                      00899 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00900 ;Turn this device off (adjust the LCD accordingly and send an OFF message to 
                      00901 ;the base
                      00902 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0240                  00903 DEVICE_OFF                                      ;
0240   01B0           00904         CLRF    AUTO_OFF_HOURS                  ;
0241   1072           00905         BCF     DEVON                           ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0242   1272           00906         BCF     LED1_STATE                      ;
0243   1386           00907         BCF     LED1                            ;make sure LED1 is off when the device goes off
0244   3060           00908         MOVLW   PW_OFF_PERIOD                   ;
0245   00A2           00909         MOVWF   LED1_CLOCK                      ;
0246   12F1           00910         BCF     TEMPETR                         ;
0247   11F3           00911         BCF     BOOST_ACT                       ;
0248   1172           00912         BCF     BOOST                           ;
0249   14F2           00913         BSF     DEVOFF                          ;
024A   1171           00914         BCF     ONEHR                           ;
024B   11F1           00915         BCF     THREEHR                         ;
024C   1271           00916         BCF     TWELVEHR                        ;
024D   142C           00917         BSF     SND_OFF_MSG                     ;
024E   301E           00918         MOVLW   SEND_OFF_PERIOD                 ;
024F   00B6           00919         MOVWF   RESEND_OFF_COUNT                ;
0250   0008           00920         RETURN                                  ;
                      00921 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00922 ;Test and debounce push buttons
                      00923 ;NEW_BUTTON_CONFIG<0:7> are mapped as follows: KB7, KB1, KB2, KB3, KB4, KB5, KB6, KB8
                      00924 ;redefined as CLOCK_SET(5),........
                      00925 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0251                  00926 TEST_BUTTONS                                    ;
                      00927 #IFDEF DEBUG                                    ;
                      00928         M_BANKSEL_2                             ;
                      00929         BCF     LCDSE1,7                        ;SEG15 shared with KB0 (RA3)
                      00930         BCF     STATUS,6                        ;BANK 0
                      00931 #ENDIF                                          ;
0251   10AB           00932         BCF     BTN_ACT_PDG                     ;
0252   1185           00933         BCF     KB0                             ;
0253   3005           00934         MOVLW   5                               ;
0254   00A0           00935         MOVWF   TEMP_BYT0_B0                    ;
0255                  00936 _TB_WAIT                                        ;
0255   0BA0           00937         DECFSZ  TEMP_BYT0_B0,F                  ;forced delay 5us wait for push buttons
0256   2A55           00938         GOTO    _TB_WAIT                        ;
                      00939                                                 ;
0257   0808           00940         MOVF    PORTD,W                         ;read buttons
0258   00A9           00941         MOVWF   NEW_BUTTON_CONFIG               ;
0259   1729           00942         BSF     NEW_BUTTON_CONFIG,6             ;NOT_USED
025A   17A9           00943         BSF     NEW_BUTTON_CONFIG,7             ;NOT USED.......
025B   1429           00944         BSF     NEW_BUTTON_CONFIG,0             ;NOT USED.......
                      00945                                                 ;
025C   1A2B           00946         BTFSC   UNLOCKING                       ;if the unlock/relock process is running
025D   2A6D           00947         GOTO    _TB_CONT                        ;       don't test the lock button
025E   1BAB           00948         BTFSC   RELOCK_ON                       ;
025F   2A6D           00949         GOTO    _TB_CONT                        ;
                      00950                                                 ;
0260   1889           00951         BTFSC   KB8                             ;else
0261   2A68           00952         GOTO    _TB_UNLOCK                      ;set the lock/unlock 
0262                  00953 _TB_LOCK                                        ;       according the current position 
0262   1B2B           00954         BTFSC   AUTOLOCK_ON                     ;       display if it has changed
0263   2A6D           00955         GOTO    _TB_CONT                        ;
0264   172B           00956         BSF     AUTOLOCK_ON                     ;
0265   1771           00957         BSF     LOCKED                          ;
0266   15F2           00958         BSF     LCD_UPD                         ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0267   2A6D           00959         GOTO    _TB_CONT                        ;
0268                  00960 _TB_UNLOCK                                      ;
0268   1F2B           00961         BTFSS   AUTOLOCK_ON                     ;
0269   2A6D           00962         GOTO    _TB_CONT                        ;
026A   132B           00963         BCF     AUTOLOCK_ON                     ;
026B   1371           00964         BCF     LOCKED                          ;
026C   15F2           00965         BSF     LCD_UPD                         ;fi;
026D                  00966 _TB_CONT                                        ;
026D   1E73           00967         BTFSS   F_BODY_GUARD                    ;
026E   1585           00968         BSF     KB0                             ;finished reading buttons
                      00969                                                 ;
026F   30FF           00970         MOVLW   0xFF                            ;
0270   06A9           00971         XORWF   NEW_BUTTON_CONFIG,F             ;invert
                      00972                                                 ;
0271   1C2B           00973         BTFSS   DEBOUNCING                      ;are we debouncing?
0272   2A7E           00974         GOTO    _START_DEBOUNCING               ;no
                      00975                                                 ;
0273                  00976 _DEBOUNCING                                     ;yes, waiting for a zero count
                      00977         M_CMP_JNE NEW_BUTTON_CONFIG,OLD_BUTTON_CONFIG,_CLEAR_DEBOUNCE   ;we are debouncing, still the sa
                            me?
0273   0829               M                 movf    NEW_BUTTON_CONFIG,w
0274   062A               M                 xorwf   OLD_BUTTON_CONFIG,w
0275   1D03               M                 btfss   STATUS,Z
0276   2A92               M                 goto    _CLEAR_DEBOUNCE
0277   0BA6           00978         DECFSZ  DEBOUNCE_CNT,F                  ;
0278   2A93           00979         GOTO    _BUTTON_END                     ;
0279   1706           00980         BSF     BACKLIGHT                       ;turn backlight on
027A   301E           00981         MOVLW   BACKLIGHT_PERIOD                ;
027B   00A7           00982         MOVWF   BACKLIGHT_CNT                   ;
027C   14AB           00983         BSF     BTN_ACT_PDG                     ;
027D   2A92           00984         GOTO    _CLEAR_DEBOUNCE                 ;finished debouncing
                      00985                                                 ;
027E                  00986 _START_DEBOUNCING                               ;this would be a first change
                      00987         M_CMP_JE NEW_BUTTON_CONFIG,OLD_BUTTON_CONFIG,_CLEAR_DEBOUNCE ;not debouncing and no change
027E   0829               M                 movf    NEW_BUTTON_CONFIG,w
027F   062A               M                 xorwf   OLD_BUTTON_CONFIG,w
0280   1903               M                 btfsc   STATUS,Z
0281   2A92               M                 goto    _CLEAR_DEBOUNCE
0282   142B           00988         BSF     DEBOUNCING                      ;start debouncing
0283   0829           00989         MOVF    NEW_BUTTON_CONFIG,W             ;the button pressed or released is here
0284   00AA           00990         MOVWF   OLD_BUTTON_CONFIG               ;
                      00991                                                 ;
0285   1F2B           00992         BTFSS   AUTOLOCK_ON                     ;select debounce period
0286   2A8A           00993         GOTO    _HEAT_DEBOUNCE_PERIOD           ;
                      00994                                                 ;
0287                  00995 _AUTOLOCK_DEBOUNCE_PERIOD                       ;
0287   3040           00996         MOVLW   AUTOLOCK_DEBOUNCE               ;extended debounce when in autolock
0288   00A6           00997         MOVWF   DEBOUNCE_CNT                    ;
0289   2A93           00998         GOTO    _BUTTON_END                     ;
                      00999                                                 ;
028A                  01000 _HEAT_DEBOUNCE_PERIOD                           ;
028A   1EAB           01001         BTFSS   HEAT_ACT                        ;extended debounce to slow down continuous changes to he
                            at level
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

028B   2A8F           01002         GOTO    _NORMAL_DEBOUNCE_PERIOD         ;
028C   300C           01003         MOVLW   HEAT_ADJ_DEBOUNCE               ;
028D   00A6           01004         MOVWF   DEBOUNCE_CNT                    ;
028E   2A93           01005         GOTO    _BUTTON_END                     ;
                      01006                                                 ;
028F                  01007 _NORMAL_DEBOUNCE_PERIOD                         ;
028F   3006           01008         MOVLW   DEBOUNCE_PERIOD                 ;
0290   00A6           01009         MOVWF   DEBOUNCE_CNT                    ;
0291   2A93           01010         GOTO    _BUTTON_END                     ;
                      01011                                                 ;
0292                  01012 _CLEAR_DEBOUNCE                                 ;
0292   102B           01013         BCF     DEBOUNCING                      ;no more debounce
                      01014                                                 ;
0293                  01015 _BUTTON_END                                     ;
                      01016 #IFDEF DEBUG                                    ;
                      01017         BSF     STATUS,6                        ;BANK 2
                      01018         BSF     LCDSE1,7                        ;SEG15 shared with KB0 (RA3)
                      01019         BCF     STATUS,6                        ;BANK 0
                      01020 #ENDIF                                          ;
0293   0008           01021         RETURN                                  ;
                      01022 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01023 ;Drive the ON/OFF cycle of LED1
                      01024 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0294                  01025 MANAGE_LED1                                     ;
0294   1C72           01026         BTFSS   DEVON                           ;drive LED only when the device is on
0295   2AA2           01027         GOTO    _LED1_END                       ;
                      01028                                                 ;
0296   0BA2           01029         DECFSZ  LED1_CLOCK,F                    ;
0297   2AA2           01030         GOTO    _LED1_END                       ;
                      01031                                                 ;
0298   1A72           01032         BTFSC   LED1_STATE                      ;
0299   2A9E           01033         GOTO    _TURN_LED1_OFF                  ;
                      01034                                                 ;
029A                  01035 _TURN_LED1_ON                                   ;
029A   1672           01036         BSF     LED1_STATE                      ;
029B   1786           01037         BSF     LED1                            ;don't go to sleep while LED1 is ON
029C   3009           01038         MOVLW   PW_ON_PERIOD                    ;
029D   2AA1           01039         GOTO    _LED1_SET                       ;
                      01040                                                 ;
029E                  01041 _TURN_LED1_OFF                                  ;
029E   1272           01042         BCF     LED1_STATE                      ;
029F   1386           01043         BCF     LED1                            ;don't go to sleep while LED1 is ON
02A0   3060           01044         MOVLW   PW_OFF_PERIOD                   ;
                      01045                                                 ;
02A1                  01046 _LED1_SET                                       ;
02A1   00A2           01047         MOVWF   LED1_CLOCK                      ;
02A2                  01048 _LED1_END                                       ;
02A2   0008           01049         RETURN                                  ;
                      01050 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01051 ;Treat the battery LCD segment according to its state
                      01052 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
02A3                  01053 TREAT_BATTERY_DISPLAY                           ;
02A3   1CF3           01054         BTFSS   BATTERY_WARN                    ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02A4   2AAE           01055         GOTO    _BATT_LOW                       ;
02A5   0BBA           01056         DECFSZ  BATTERY_BLINK_COUNT,F           ;battery warning
02A6   2AB4           01057         GOTO    _BATT_FIN                       ; decrement the blink counter
02A7   3010           01058         MOVLW   BLINK_PERIOD                    ; when the count reches 0, toggle the bit
02A8   00BA           01059         MOVWF   BATTERY_BLINK_COUNT             ; and display in the LCD
02A9   3080           01060         MOVLW   b'10000000'                     ;
02AA   06F1           01061         XORWF   LCD_CHAR1,F                     ;
02AB   15F2           01062         BSF     LCD_UPD                         ;
02AC   233F           01063         CALL    UPDATE_LCD                      ;
02AD   2AB4           01064         GOTO    _BATT_FIN                       ;
                      01065                                                 ;               
02AE                  01066 _BATT_LOW                                       ;
02AE   1D73           01067         BTFSS   BATTERY_LOW                     ;
02AF   2AB3           01068         GOTO    _BATT_GOOD                      ;
02B0   17F1           01069         BSF     BATTLOW                         ;battery low
02B1   15F2           01070         BSF     LCD_UPD                         ;
02B2   2AB4           01071         GOTO    _BATT_FIN                       ;
                      01072                                                 ;
02B3                  01073 _BATT_GOOD                                      ;
02B3   13F1           01074         BCF     BATTLOW                         ;
02B4                  01075 _BATT_FIN                                       ;
02B4   0008           01076         RETURN                                  ;
                      01077 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01078 ;blink the colon (:) every sec (based on the LCD period
                      01079 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
02B5                  01080 SECONDS_BLINK                                   ;
02B5   0BBD           01081         DECFSZ  TMR2_1SECOND,F                  ;
02B6   2ABE           01082         GOTO    _BLINK_END                      ;
                      01083                                                 ;
02B7   19AB           01084         BTFSC   CLCKSET_ACT                     ;blink : if we're NOT adjusting the clock
02B8   2ABE           01085         GOTO    _BLINK_END                      ;
                      01086                                                 ;
02B9   3020           01087         MOVLW   BLINK_2P_PERIOD                 ;toggle the COLON bit
02BA   00BD           01088         MOVWF   TMR2_1SECOND                    ;
02BB   3020           01089         MOVLW   b'00100000'                     ;
02BC   06F3           01090         XORWF   LCD_CHAR5,F                     ;
02BD   15F2           01091         BSF     LCD_UPD                         ;
02BE                  01092 _BLINK_END                                      ;
02BE   0008           01093         RETURN                                  ;
                      01094 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01095 ;Updates the real time clock and the LCD display when necessary
                      01096 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
02BF                  01097 REAL_TIME_SERVICES                              ;
02BF   1C0C           01098         BTFSS   TMR1_IF                         ;if TMR1 rolled over
02C0   2B1B           01099         GOTO    _RT_DONE                        ;
                      01100                                                 ;
                      01101 ;============================= SECONDS COUNTERS ===============================
02C1   100C           01102         BCF     TMR1_IF                         ;
02C2                  01103 _RT_SECONDS                                     ;
02C2   0AA3           01104         INCF    RT_SECONDS,F                    ;ticks every 2 seconds at 32K
02C3   0AA3           01105         INCF    RT_SECONDS,F                    ;
                      01106 ;...............................................;
                      01107 ;HANDLE ANY OTHER REAL TIME SECONDS COUNTERS
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01108 ;...............................................;
02C4   08A7           01109         MOVF    BACKLIGHT_CNT,F                 ;BACKLIGHT OFF
02C5   1903           01110         BTFSC   STATUS,Z                        ;
02C6   2ACD           01111         GOTO    _RESEND_ON_MSG                  ;
02C7   0BA7           01112         DECFSZ  BACKLIGHT_CNT,F                 ;
02C8   2ACA           01113         GOTO    _BL1                            ;BACKLIGHT OFF time should always be an even number
02C9   2ACC           01114         GOTO    _TURN_OFF_BL                    ; <-- this GOTO in case it was odd
02CA   0BA7           01115 _BL1    DECFSZ  BACKLIGHT_CNT,F                 ;
02CB   2ACD           01116         GOTO    _RESEND_ON_MSG                  ;
02CC                  01117 _TURN_OFF_BL                                    ;
02CC   1306           01118         BCF     BACKLIGHT                       ;
                      01119 ;...............................................;
02CD                  01120 _RESEND_ON_MSG                                  ;periodic ON message
02CD   1C72           01121         BTFSS   DEVON                           ;
02CE   2AD6           01122         GOTO    _RELOCK_SECS                    ;
02CF   0BB7           01123         DECFSZ  RESEND_ON_COUNT_L,F             ;
02D0   2AD6           01124         GOTO    _RELOCK_SECS                    ;
02D1   0BB8           01125         DECFSZ  RESEND_ON_COUNT_H,F             ;
02D2   2AD6           01126         GOTO    _RELOCK_SECS                    ;
                      01127                                                 ;
02D3                  01128 _RELOAD_ON_MSG                                  ;
02D3   222F           01129         CALL    FILL_RESEND_PERIOD              ;
02D4   1073           01130         BCF     BEEPER                          ;
02D5   17AC           01131         BSF     SND_REFRESH_MSG                 ;
                      01132 ;...............................................;
02D6                  01133 _RELOCK_SECS                                    ;
02D6   1FAB           01134         BTFSS   RELOCK_ON                       ;RE-LOCK
02D7   2AE1           01135         GOTO    _RT_MINUTES                     ;relock time should always be an even number
02D8   0BAF           01136         DECFSZ  RE_LOCK_TIME,F                  ;
02D9   2ADB           01137         GOTO    $+2                             ;
02DA   2ADD           01138         GOTO    _RELOCK_REACHED                 ;
02DB   0BAF           01139         DECFSZ  RE_LOCK_TIME,F                  ;
02DC   2AE1           01140         GOTO    _RT_MINUTES                     ;
02DD                  01141 _RELOCK_REACHED                                 ;
02DD   1771           01142         BSF     LOCKED                          ;
02DE   15F2           01143         BSF     LCD_UPD                         ;
02DF   172B           01144         BSF     AUTOLOCK_ON                     ;LOCK again
02E0   13AB           01145         BCF     RELOCK_ON                       ;prepare the count till un-lock
                      01146                                                 ;
                      01147 ;============================= MINUTES COUNTERS ===============================
02E1                  01148 _RT_MINUTES                                     ;
                      01149         M_CMPL_JG RT_SECONDS,.59,_INCMIN        ;
02E1   0823               M                 movf    RT_SECONDS,w
02E2   3C3B               M                 sublw   .59
02E3   1C03               M                 btfss   STATUS,C
02E4   2AE6               M                 goto    _INCMIN
02E5   2B1B           01150         GOTO    _RT_DONE                        ;
                      01151                                                 ;
02E6                  01152 _INCMIN                                         ;
02E6   01A3           01153         CLRF    RT_SECONDS                      ;REAL TIME MINUTES
02E7   0AA4           01154         INCF    RT_MINUTES,F                    ;
02E8   15F2           01155         BSF     LCD_UPD                         ;minutes have been updated so LCD must be updated also
                      01156 ;...............................................;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02E9                  01157 _RESEND_OFF_MSG                                 ;
02E9   08B6           01158         MOVF    RESEND_OFF_COUNT,F              ;see if OFF msg has to be resent
02EA   1903           01159         BTFSC   STATUS,Z                        ;
02EB   2AF0           01160         GOTO    _AUTOSHUTOFF                    ;
02EC   0BB6           01161         DECFSZ  RESEND_OFF_COUNT,F              ;
02ED   2AF0           01162         GOTO    _AUTOSHUTOFF                    ;
02EE   1073           01163         BCF     BEEPER                          ;
02EF   142C           01164         BSF     SND_OFF_MSG                     ;
                      01165 ;...............................................;
02F0                  01166 _AUTOSHUTOFF                                    ;
02F0   1C72           01167         BTFSS   DEVON                           ;
02F1   2AFD           01168         GOTO    PREHEAT_COUNTDOWN               ;
02F2   0BB1           01169         DECFSZ  AUTO_OFF_MINUTES,F              ;AUTO SHUT-OFF minutes count down
02F3   2AFD           01170         GOTO    PREHEAT_COUNTDOWN               ;
02F4   0BB0           01171         DECFSZ  AUTO_OFF_HOURS,F                ;hours count down
02F5   2AF7           01172         GOTO    _RELOAD_AO_MINUTES              ;
02F6   2AFA           01173         GOTO    _AO_DONE                        ;
02F7                  01174 _RELOAD_AO_MINUTES                              ;
02F7   303C           01175         MOVLW   SIXTY_MINUTES                   ;
02F8   00B1           01176         MOVWF   AUTO_OFF_MINUTES                ;
02F9   2AFD           01177         GOTO    PREHEAT_COUNTDOWN               ;
02FA                  01178 _AO_DONE                                        ;
02FA   2240           01179         CALL    DEVICE_OFF                      ;
02FB   0876           01180         MOVF    TMPTR_VALUE,W                   ;
02FC   00B3           01181         MOVWF   SAVED_TEMPERATURE               ;Save the temperature before going off
                      01182 ;...............................................;
02FD                  01183 PREHEAT_COUNTDOWN                               ;
02FD   1D72           01184         BTFSS   BOOST                           ;
02FE   2B07           01185         GOTO    _RT_HOURS                       ;
                      01186                                                 ;
02FF   0BB2           01187         DECFSZ  BOOST_MINUTES,F                 ;PRE-HEAT period minutes count down
0300   2B07           01188         GOTO    _RT_HOURS                       ;
0301   1172           01189         BCF     BOOST                           ;
0302   11F3           01190         BCF     BOOST_ACT                       ;
0303   0833           01191         MOVF    SAVED_TEMPERATURE,W             ;
0304   00F6           01192         MOVWF   TMPTR_VALUE                     ;
0305   1073           01193         BCF     BEEPER                          ;
0306   15AC           01194         BSF     SND_BOO_OFF_MSG                 ;turn pre heat off in the base
                      01195                                                 ;
                      01196 ;============================= HOURS COUNTERS ===============================
0307                  01197 _RT_HOURS                                       ;
                      01198         M_CMPL_JG RT_MINUTES,.59,_INCHR         ;
0307   0824               M                 movf    RT_MINUTES,w
0308   3C3B               M                 sublw   .59
0309   1C03               M                 btfss   STATUS,C
030A   2B0C               M                 goto    _INCHR
030B   2B1B           01199         GOTO    _RT_DONE                        ;
030C                  01200 _INCHR                                          ;
030C   01A4           01201         CLRF    RT_MINUTES                      ;0 minutes
030D   0AA5           01202         INCF    RT_HOURS,F                      ;next hour
                      01203         M_CMP_JLE RT_HOURS,MAX_HOURS,_BATTERY_COUNTER
030E   0825               M                 movf    RT_HOURS,w
030F   022E               M                 subwf   MAX_HOURS,w     ;v2-v1 > 0
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0310   1803               M                 btfsc   STATUS,C
0311   2B13               M                 goto    $+2
0312   1903               M                 btfsc   STATUS,Z
0313   2B16               M                 goto    _BATTERY_COUNTER
0314   3001           01204         MOVLW   .1                              ;
0315   00A5           01205         MOVWF   RT_HOURS                        ;roll the clock over
                      01206                                                 ;
                      01207 ;...............................................;
0316                  01208 _BATTERY_COUNTER                                ;
0316   0BBB           01209         DECFSZ  IDLE_BATT_COUNT,F               ;
0317   2B1B           01210         GOTO    _RT_DONE                        ;
                      01211                                                 ;
0318   172C           01212         BSF     SND_TEST_MSG                    ;If the counter is exceeded, send a test message
0319   300C           01213         MOVLW   IDLE_BATTERY_TEST               ; and reload the counter
031A   00BB           01214         MOVWF   IDLE_BATT_COUNT                 ;
                      01215                                                 ;
031B                  01216 _RT_DONE                                        ;
031B   0008           01217         RETURN                                  ;
                      01218 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01219 ;If there are no jobs pending and the display must be cupdated, 
                      01220 ;display move the REal Time info into the variables for the LCD
                      01221 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
031C                  01222 DISPLAY_REAL_TIME                               ;Display the real time in the clock
031C   301F           01223         MOVLW   b'00011111'                     ;unless some action is in progress
031D   052B           01224         ANDWF   LCD_CHAR3,W                     ;
031E   1D03           01225         BTFSS   STATUS,Z                        ;
031F   2B2A           01226         GOTO    _TM1ENDEND                      ;(but don't reset LCD_UPDATE)
                      01227                                                 ;
0320   1DF2           01228         BTFSS   LCD_UPD                         ;
0321   2B2A           01229         GOTO    _TM1ENDEND                      ;
                      01230                                                 ;
0322   1471           01231         BSF     MINUTES                         ;
0323   0824           01232         MOVF    RT_MINUTES,W                    ;
0324   23E1           01233         CALL    Convert_to_BCD                  ;convert both hours and minutes to BCD
0325   00F4           01234         MOVWF   MIN_VALUE                       ;
                      01235                                                 ;
0326   0825           01236         MOVF    RT_HOURS,W                      ;
0327   23E1           01237         CALL    Convert_to_BCD                  ;convert to BCD
0328   00F5           01238         MOVWF   HOUR_VALUE                      ;
0329   14F1           01239         BSF     HOURS                           ;
032A                  01240 _TM1ENDEND                                      ;
032A   0008           01241         RETURN                                  ;
                      01242 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
032B                  01243 INTERRUPT
                      01244 ;Servo l'interrupt
032B   190B           01245 ISR     BTFSC   _T0IF
032C   1E8B           01246         BTFSS   _T0IE
032D   2B34           01247         B       ISR_X
                      01248 
                      01249 ;=======================================
                      01250 ;*** BASE TEMPI OGNI 204,8 µS [(256 (CICLI) * 4 (PRESCALE) / 5 (QUARZO 20 MHZ)]
032E   110B           01251         BCF     _T0IF
                      01252 
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

032F   1C44           01253         SS      TRASMISSIONE_HCS
0330   2B34           01254         B       ISR_X
                      01255 
0331   30C8           01256         LW      .200
0332   0281           01257         SUBWF   TMR_HCS,F
                      01258 
0333   2476           01259         CALL    GESTIONE_TMR_HCS
                      01260 
                      01261 ;=======================================
0334                  01262 ISR_X
                      01263 POP     M_BANKSEL_0
0334   1303               M                 BCF     STATUS,6
0335   1283               M                 BCF     STATUS,5
0336   084E           01264         FW      BI_FSR
0337   0084           01265         WF      FSR
0338   084D           01266         FW      BI_PCLATH
0339   008A           01267         WF      PCLATH
033A   0E4C           01268         SWAPF   BI_STATUS,W     ;RIPRISTINO DELLO STATUS
033B   0083           01269         MOVWF   STATUS
033C   0EF7           01270         SWAPF   BI_WREG,F       ;RIPRISTINO DEL WREG
033D   0E77           01271         SWAPF   BI_WREG,W
033E   0009           01272         RETFIE
                      01273 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01274 ;LCD driver
                      01275 ;PARAMETERS: LCD DIGIT,VALUE (when displaying minutes, hours and temp)
                      01276 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
033F                  01277 UPDATE_LCD                                      ;
                      01278         M_BANKSEL_2                             ;
033F   1703               M                 BSF     STATUS,6
0340   1283               M                 BCF     STATUS,5
0341   1387           01279         BCF     LCDCON,LCDEN                    ;this is needed to be able to clear the LCDIF flag
0342   1303           01280         BCF     STATUS,6                        ;bank 0
0343   120D           01281         BCF     LCD_IF                          ;
0344   1703           01282         BSF     STATUS,6                        ;bank 2
0345   1787           01283         BSF     LCDCON,LCDEN                    ;
                      01284                                                 ;
0346   1DF2           01285         BTFSS   LCD_UPD                         ;write only if there is a request
0347   2BDE           01286         GOTO    _LCD_DONE                       ;
                      01287                                                 ;
                      01288 #IFDEF  WAVE_TYPE_B                             ;
0348   3001           01289         MOVLW   1                               ;
0349   06A2           01290         XORWF   TOGGLE_LCD,F                    ;Write only every other frame with WaveType "B"
034A   1903           01291         BTFSC   STATUS,Z                        ;
034B   2BDE           01292         GOTO    _LCD_DONE                       ;
                      01293 #ENDIF                                          ;
                      01294                                                 ;
034C   1E87           01295         BTFSS   LCDCON,WERR                     ;write only if no errors writing to the LCD
034D   2B51           01296         GOTO    _LCDCONT                        ;
034E   1287           01297         BCF     LCDCON,WERR                     ;
                      01298                                                 ;
034F   1E08           01299         BTFSS   LCDPS,WA                        ;write only if WA (write allowed) flag is set
0350   2BDE           01300         GOTO    _LCD_DONE                       ;
                      01301                                                 ;manage here the character flags an blinking
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0351                  01302 _LCDCONT                                        ;
0351   11F2           01303         BCF     LCD_UPD                         ;
0352   0AA1           01304         INCF    WR_NOERRORS,F                   ;FOR DEBUG - bANK 2
0353   0190           01305         CLRF    LCDDATA0                        ;first clear the display
0354   0191           01306         CLRF    LCDDATA1                        ;
0355   0193           01307         CLRF    LCDDATA3                        ;
0356   0194           01308         CLRF    LCDDATA4                        ;
0357   0196           01309         CLRF    LCDDATA6                        ;
0358   0197           01310         CLRF    LCDDATA7                        ;
0359   0199           01311         CLRF    LCDDATA9                        ;
035A   019A           01312         CLRF    LCDDATA10                       ;
                      01313                                                 ;
035B   1C71           01314         BTFSS   MINUTES                         ;
035C   2B85           01315         GOTO    _COLON                          ;
035D   3000           01316         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
035E   008A           01317         MOVWF   PCLATH                          ;
035F   0874           01318         MOVF    MIN_VALUE,W                     ;
0360   390F           01319         ANDLW   0x0F                            ;
0361   200E           01320         CALL    DIGIT_SELECT                    ;
0362   00A3           01321         MOVWF   TEMP_BYT0_B2                    ;Display units of minutes
0363   1823           01322         BTFSC   TEMP_BYT0_B2,0                  ;
0364   1410           01323         BSF     LCDDATA0,0                      ;4A
0365   18A3           01324         BTFSC   TEMP_BYT0_B2,1                  ;
0366   1413           01325         BSF     LCDDATA3,0                      ;4B
0367   1923           01326         BTFSC   TEMP_BYT0_B2,2                  ;
0368   1416           01327         BSF     LCDDATA6,0                      ;4C
0369   19A3           01328         BTFSC   TEMP_BYT0_B2,3                  ;
036A   1419           01329         BSF     LCDDATA9,0                      ;4D
036B   1A23           01330         BTFSC   TEMP_BYT0_B2,4                  ;
036C   1496           01331         BSF     LCDDATA6,1                      ;4E
036D   1AA3           01332         BTFSC   TEMP_BYT0_B2,5                  ;
036E   1490           01333         BSF     LCDDATA0,1                      ;4F
036F   1B23           01334         BTFSC   TEMP_BYT0_B2,6                  ;
0370   1493           01335         BSF     LCDDATA3,1                      ;4G
                      01336                                                 ;
0371   3000           01337         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
0372   008A           01338         MOVWF   PCLATH                          ;
0373   0E74           01339         SWAPF   MIN_VALUE,W                     ;
0374   390F           01340         ANDLW   0x0F                            ;
0375   200E           01341         CALL    DIGIT_SELECT                    ;Display tens of minute
0376   00A3           01342         MOVWF   TEMP_BYT0_B2                    ;
0377   1823           01343         BTFSC   TEMP_BYT0_B2,0                  ;
0378   1510           01344         BSF     LCDDATA0,2                      ;3A
0379   18A3           01345         BTFSC   TEMP_BYT0_B2,1                  ;
037A   1513           01346         BSF     LCDDATA3,2                      ;3B
037B   1923           01347         BTFSC   TEMP_BYT0_B2,2                  ;
037C   1516           01348         BSF     LCDDATA6,2                      ;3C
037D   19A3           01349         BTFSC   TEMP_BYT0_B2,3                  ;
037E   1519           01350         BSF     LCDDATA9,2                      ;3D
037F   1A23           01351         BTFSC   TEMP_BYT0_B2,4                  ;
0380   1596           01352         BSF     LCDDATA6,3                      ;3E
0381   1AA3           01353         BTFSC   TEMP_BYT0_B2,5                  ;
0382   1590           01354         BSF     LCDDATA0,3                      ;3F
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0383   1B23           01355         BTFSC   TEMP_BYT0_B2,6                  ;
0384   1593           01356         BSF     LCDDATA3,3                      ;3G
0385                  01357 _COLON                                          ;
0385   1AF3           01358         BTFSC   COLON                           ;
0386   1619           01359         BSF     LCDDATA9,4                      ;":"
0387                  01360 _HOURS:                                         ;
0387   1CF1           01361         BTFSS   HOURS                           ;
0388   2BB1           01362         GOTO    _1HR                            ;
0389   3000           01363         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
038A   008A           01364         MOVWF   PCLATH                          ;
038B   0875           01365         MOVF    HOUR_VALUE,W                    ;
038C   390F           01366         ANDLW   0x0F                            ;
038D   200E           01367         CALL    DIGIT_SELECT                    ;
038E   00A3           01368         MOVWF   TEMP_BYT0_B2                    ;Display units of hours
038F   1823           01369         BTFSC   TEMP_BYT0_B2,0                  ;
0390   1610           01370         BSF     LCDDATA0,4                      ;2A
0391   18A3           01371         BTFSC   TEMP_BYT0_B2,1                  ;
0392   1613           01372         BSF     LCDDATA3,4                      ;2B
0393   1923           01373         BTFSC   TEMP_BYT0_B2,2                  ;
0394   1616           01374         BSF     LCDDATA6,4                      ;2C
0395   19A3           01375         BTFSC   TEMP_BYT0_B2,3                  ;
0396   1699           01376         BSF     LCDDATA9,5                      ;2D
0397   1A23           01377         BTFSC   TEMP_BYT0_B2,4                  ;
0398   1696           01378         BSF     LCDDATA6,5                      ;2E
0399   1AA3           01379         BTFSC   TEMP_BYT0_B2,5                  ;
039A   1690           01380         BSF     LCDDATA0,5                      ;2F
039B   1B23           01381         BTFSC   TEMP_BYT0_B2,6                  ;
039C   1693           01382         BSF     LCDDATA3,5                      ;2G
                      01383                                                 ;
039D   3000           01384         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
039E   008A           01385         MOVWF   PCLATH                          ;
039F   0E75           01386         SWAPF   HOUR_VALUE,W                    ;
03A0   390F           01387         ANDLW   0x0F                            ;
03A1   200E           01388         CALL    DIGIT_SELECT                    ;Display tens of hours
03A2   00A3           01389         MOVWF   TEMP_BYT0_B2                    ;
03A3   1823           01390         BTFSC   TEMP_BYT0_B2,0                  ;
03A4   1790           01391         BSF     LCDDATA0,7                      ;1A
03A5   18A3           01392         BTFSC   TEMP_BYT0_B2,1                  ;
03A6   1793           01393         BSF     LCDDATA3,7                      ;1B
03A7   1923           01394         BTFSC   TEMP_BYT0_B2,2                  ;
03A8   1796           01395         BSF     LCDDATA6,7                      ;1C
03A9   19A3           01396         BTFSC   TEMP_BYT0_B2,3                  ;
03AA   1719           01397         BSF     LCDDATA9,6                      ;1D
03AB   1A23           01398         BTFSC   TEMP_BYT0_B2,4                  ;
03AC   1716           01399         BSF     LCDDATA6,6                      ;1E
03AD   1AA3           01400         BTFSC   TEMP_BYT0_B2,5                  ;
03AE   1710           01401         BSF     LCDDATA0,6                      ;1F
03AF   1B23           01402         BTFSC   TEMP_BYT0_B2,6                  ;
03B0   1713           01403         BSF     LCDDATA3,6                      ;1G
03B1                  01404 _1HR:                                           ;
03B1   1971           01405         BTFSC   ONEHR                           ;
03B2   1799           01406         BSF     LCDDATA9,7                      ;1G
03B3                  01407 _3HR                                            ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03B3   19F1           01408         BTFSC   THREEHR                         ;
03B4   141A           01409         BSF     LCDDATA10,0                     ;1G
03B5                  01410 _12HR                                           ;
03B5   1A71           01411         BTFSC   TWELVEHR                        ;
03B6   1499           01412         BSF     LCDDATA9,1                      ;1G
03B7                  01413 _TEMPERATURE                                    ;
03B7   1EF1           01414         BTFSS   TEMPETR                         ;
03B8   2BD4           01415         GOTO    _LOCKED                         ;
                      01416                                                 ;
03B9   0876           01417         MOVF    TMPTR_VALUE,W                   ;
03BA   00A4           01418         MOVWF   TEMP_BYT1_B2                    ;
03BB                  01419 _TEMPHIGH                                       ;
                      01420         M_CMPL_JNE TMPTR_VALUE,.10,_TEMP_CONT   ;
03BB   0876               M                 movf    TMPTR_VALUE,w
03BC   3A0A               M                 xorlw   .10
03BD   1D03               M                 btfss   STATUS,Z
03BE   2BC1               M                 goto    _TEMP_CONT
03BF   300B           01421         MOVLW   .11                             ;If 10 display 'H'
03C0   00A4           01422         MOVWF   TEMP_BYT1_B2                    ;
03C1                  01423 _TEMP_CONT                                      ;else normal temp 
03C1   3000           01424         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
03C2   008A           01425         MOVWF   PCLATH                          ;
03C3   0824           01426         MOVF    TEMP_BYT1_B2,W                  ;
03C4   200E           01427         CALL    DIGIT_SELECT                    ;
03C5   00A3           01428         MOVWF   TEMP_BYT0_B2                    ;
03C6   1823           01429         BTFSC   TEMP_BYT0_B2,0                  ;
03C7   149A           01430         BSF     LCDDATA10,1                     ;5A
03C8   18A3           01431         BTFSC   TEMP_BYT0_B2,1                  ;
03C9   1497           01432         BSF     LCDDATA7,1                      ;5B
03CA   1923           01433         BTFSC   TEMP_BYT0_B2,2                  ;
03CB   1494           01434         BSF     LCDDATA4,1                      ;5C
03CC   19A3           01435         BTFSC   TEMP_BYT0_B2,3                  ;
03CD   1491           01436         BSF     LCDDATA1,1                      ;5D
03CE   1A23           01437         BTFSC   TEMP_BYT0_B2,4                  ;
03CF   1514           01438         BSF     LCDDATA4,2                      ;5E
03D0   1AA3           01439         BTFSC   TEMP_BYT0_B2,5                  ;
03D1   151A           01440         BSF     LCDDATA10,2                     ;5F
03D2   1B23           01441         BTFSC   TEMP_BYT0_B2,6                  ;
03D3   1517           01442         BSF     LCDDATA7,2                      ;5G
03D4                  01443 _LOCKED                                         ;
03D4   1B71           01444         BTFSC   LOCKED                          ;
03D5   1411           01445         BSF     LCDDATA1,0                      ;
03D6                  01446 _BATTERY                                        ;
03D6   1BF1           01447         BTFSC   BATTLOW                         ;
03D7   1511           01448         BSF     LCDDATA1,2                      ;
03D8                  01449 _ON                                             ;
03D8   1872           01450         BTFSC   DEVON                           ;
03D9   1414           01451         BSF     LCDDATA4,0                      ;
03DA                  01452 _OFF                                            ;
03DA   18F2           01453         BTFSC   DEVOFF                          ;
03DB   1594           01454         BSF     LCDDATA4,3                      ;
03DC                  01455 _BOOST                                          ;
03DC   1972           01456         BTFSC   BOOST                           ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03DD   1417           01457         BSF     LCDDATA7,0                      ;
03DE                  01458 _LCD_DONE:                                      ;
                      01459         M_BANKSEL_0                             ;
03DE   1303               M                 BCF     STATUS,6
03DF   1283               M                 BCF     STATUS,5
03E0   0008           01460         RETURN                                  ;
                      01461 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01462 ;INPUT:         W in binary
                      01463 ;OUTPUT:        W in BCD
                      01464 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
03E1                  01465 Convert_to_BCD                                  ;
03E1   01A0           01466         CLRF    TEMP_BYT0_B0                    ;bank 0
03E2                  01467 LOOP_BCD:                                       ;
03E2   3EF6           01468         ADDLW   -.10                            ;
03E3   1C03           01469         BTFSS   STATUS,C                        ;
03E4   2BE7           01470         GOTO    SWAPBCD                         ;
03E5   0AA0           01471         INCF    TEMP_BYT0_B0,F                  ;
03E6   2BE2           01472         GOTO    LOOP_BCD                        ;
03E7                  01473 SWAPBCD:                                        ;
03E7   3E0A           01474         ADDLW   .10                             ;
03E8   0EA0           01475         SWAPF   TEMP_BYT0_B0,F                  ;
03E9   0420           01476         IORWF   TEMP_BYT0_B0,W                  ;
03EA   0008           01477         RETURN                                  ;
                      01478 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01479 ;Called from hcs_tx.inc at the end of every message sent.
                      01480 ;Do and A/D conversion to test the battery voltage and decide its
                      01481 ;charge state
                      01482 ;**********************************************************
03EB                  01483 TEST_BATTERY                                    ;
03EB   149F           01484         BSF     GO_DONE                         ;start conversion
03EC                  01485 _ADCON_GO                                       ;
03EC   189F           01486         BTFSC   GO_DONE                         ;
03ED   2BEC           01487         GOTO    _ADCON_GO                       ;
                      01488                                                 ;
03EE   0000           01489         NOP                                     ;
03EF   1585           01490         BSF     KB0                             ;
03F0   1273           01491         BCF     F_BODY_GUARD                    ;
03F1   0000           01492         NOP                                     ;
                      01493         M_CMPL_JG ADRESH,BATT_HIGH_THRESHLD,_BATTERY_OK;
03F2   081E               M                 movf    ADRESH,w
03F3   3C99               M                 sublw   BATT_HIGH_THRESHLD
03F4   1C03               M                 btfss   STATUS,C
03F5   2C0B               M                 goto    _BATTERY_OK
                      01494         M_CMPL_JG ADRESH,BATT_LOW_THRESHLD,_BATTERY_WARNING;
03F6   081E               M                 movf    ADRESH,w
03F7   3C87               M                 sublw   BATT_LOW_THRESHLD
03F8   1C03               M                 btfss   STATUS,C
03F9   2C06               M                 goto    _BATTERY_WARNING
                      01495                                                 ;
03FA                  01496 _BATTERY_LOW                                    ;
03FA   08BC           01497         MOVF    BAT_OFF_MSG_COUNT,F             ;initialized to one at restart, send this messag from
03FB   1903           01498         BTFSC   STATUS,Z                        ;  here only once, than the machine is shutoff anyways
03FC   2C0F           01499         GOTO    _TESTBATT_DONE                  ;
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03FD   2240           01500         CALL    DEVICE_OFF                      ;
03FE   17F1           01501         BSF     BATTLOW                         ;turn on the LOWBATT symbol, no blink
03FF   1071           01502         BCF     MINUTES                         ;turn off hours and minutes also
0400   10F1           01503         BCF     HOURS                           ;
0401   1573           01504         BSF     BATTERY_LOW                     ;
0402   10F3           01505         BCF     BATTERY_WARN                    ;
0403   15F2           01506         BSF     LCD_UPD                         ;
0404   03BC           01507         DECF    BAT_OFF_MSG_COUNT,F             ;
0405   2C0F           01508         GOTO    _TESTBATT_DONE                  ;
0406                  01509 _BATTERY_WARNING                                ;
0406   14F3           01510         BSF     BATTERY_WARN                    ;
0407   1173           01511         BCF     BATTERY_LOW                     ;
0408   3010           01512         MOVLW   BLINK_PERIOD                    ;
0409   00BA           01513         MOVWF   BATTERY_BLINK_COUNT             ;
040A   2C0F           01514         GOTO    _TESTBATT_DONE                  ;
                      01515                                                 ;
040B                  01516 _BATTERY_OK                                     ;
040B   13F1           01517         BCF     BATTLOW                         ;
040C   10F3           01518         BCF     BATTERY_WARN                    ;
040D   1173           01519         BCF     BATTERY_LOW                     ;
040E   15F2           01520         BSF     LCD_UPD                         ;
                      01521                                                 ;
040F                  01522 _TESTBATT_DONE                                  ;
040F   300C           01523         MOVLW   IDLE_BATTERY_TEST               ;in all cases reload the idle counter
0410   00BB           01524         MOVWF   IDLE_BATT_COUNT                 ;
0411   0008           01525         RETURN                                  ;
                      01526 ;**********************************************************
                      01527 ;Called during interrupts, message is being sent, start the converter
                      01528 ;**********************************************************
0412                  01529 AD_START                                        ;
0412   1673           01530         SET     F_BODY_GUARD                    ;
0413   1185           01531         BCF     KB0                             ;
0414   141F           01532         BSF     ADCON0,0                        ;START ADCONVERTER
0415   0008           01533         RETURN                                  ;
                      01534 ;**********************************************************
0416                  01535 CLEAR_RAM_0
0416   301F           01536         MOVLW   01FH            ;INIZIO RAM -1
0417   0084           01537         MOVWF   FSR
                      01538 
0418   0A84           01539 PR      INCF    FSR,F
0419   0180           01540         CLRF    INDF
041A   307F           01541         MOVLW   07FH            ;FINE RAM
041B   0604           01542         XORWF   FSR,W
041C   1D03           01543         SKPZ
041D   2C18           01544         B       PR
                      01545 
041E   0008           01546         RETURN
                      01547 ;******** PULIZIA RAM BANK1 *****************************************
041F                  01548 CLEAR_RAM_1
041F   309F           01549         MOVLW   09FH            ;INIZIO RAM -1
0420   0084           01550         MOVWF   FSR
                      01551 
0421   0A84           01552 PURA1   INCF    FSR,F
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0422   0180           01553         CLRF    INDF
0423   30EF           01554         MOVLW   0EFH            ;FINE RAM
0424   0604           01555         XORWF   FSR,W
0425   1D03           01556         SKPZ
0426   2C21           01557         B       PURA1
                      01558 
0427   0008           01559         RETURN
                      01560 ;**********************************************************
0428                  01561 ORG_INCLUDES:
                      01562         #include        <hcs_tx.inc>
                      00001 
                      00002 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00003 ;TRASMISSIONE HCS
                      00004 ;#DEFINE        TMR_HCS_ON      _TMR1ON
                      00005 
                      00006 ;*** MOVED TO TXMain.asm  *************************************************************
                      00007 ;       CBLOCK  
                      00008 ;
                      00009 ;FLAGS_HCS
                      00010 ;
                      00011 ; BUFFER DI TRASMISSIONE HCS
                      00012 ;HCS1                   ;ROLLING CODE
                      00013 ;HCS2                   ;ROLLING CODE
                      00014 ;HCS3                   ;DISCRIMINANTE (LSB)
                      00015 ;HCS4                   ;7:4 CHANNELS, 3:2 OVERFLOW BITS (UNUSED), DISCRIMINANTE (LSB)
                      00016 ;HCS5                   ;SERIAL NUMBER (LSB)
                      00017 ;HCS6                   ;SERIAL NUMBER
                      00018 ;HCS7                   ;SERIAL NUMBER (MSB)
                      00019 ;HCS8                   ;7:4 CHANNELS CODE (S2, S1, S0, S3)
                      00020 ;HCS9                   ;1 REPEAT, 0 LOW BATT
                      00021 ;
                      00022 ;FASE_TX_HCS
                      00023 ;
                      00024 ;CARICA_TIMER_HCS_HI
                      00025 ;CARICA_TIMER_HCS_LO
                      00026 ;
                      00027 ;PUNTA_HCS
                      00028 ;
                      00029 ;COUNT_BIT
                      00030 ;
                      00031 ;TEMP_ROTATE
                      00032 ;
                      00033 ;COUNT_PREAMBOLO
                      00034 ;       ENDC
                      00035 ;-- ALIAS -------------------------------------------------------------
                      00036 ;TMR_HCS        EQU     TMR0
                      00037 ;HEADER_COUNT   EQU     COUNT_PREAMBOLO
                      00038 ;COUNT_DATA     EQU     COUNT_PREAMBOLO
                      00039 ;----------------------------------------------------------------
                      00040 ;
                      00041 ; CODE COMPOSITION INTO TRASMISSION BUFFER
                      00042 ;
                      00043 ;HCS1   BIT 7÷5         0       RESERVED, FORCED TO ZERO
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00044 ;HCS1   BIT 4           0÷1     LEFT/RIGHT SIDE
                      00045 ;HCS1   BIT 3÷0         0÷F     SERIAL NUMBER HIGH
                      00046 
                      00047 ;HCS2   BIT 7÷0         00÷FF   SERIAL NUMBER
                      00048 
                      00049 ;HCS3   BIT 7÷0         00÷FF   SERIAL NUMBER
                      00050 
                      00051 ;HCS4   BIT 7÷0         00÷FF   SERIAL NUMBER LOW
                      00052 
                      00053 ;HCS5   BIT 7÷3         00÷0A   LEVEL CODE
                      00054 ;HCS5   BIT 2           0÷1     BEEPER
                      00055 ;HCS5   BIT 1           0-1     LEARN MODE ON/OFF
                      00056 ;HCS5   BIT 0           0       PADDING
                      00057 ;HCS6   BIT 7÷0         00÷FF   CHECKSUM
                      00058 ;MESSGE FOR LEARNING: BIT LEARN =1, SERIAL MUST BE VALID, LEFT/RIGHT, BEEPER ON, THE REST = DON'T CARE
                      00059 ;
                      00060 ; DURATA DI UN TE (TEMPO TIPICO)        400 MICROSECONDI
                      00061 ; DURATA DEL PREAMBOLO                   23 TE ALTERNATI HIGH-LOW-HIGH
                      00062 ; DURATA DEL HEADER                      10 TE LOW (4 MILLISECONDI DI PAUSA)
                      00063 ; DURATA DEL SINGOLO BIT                  3 TE: IL 1° HIGH, IL 3° LOW, IL 2° INVERTITO
                      00064 ;                                               DETERMINA IL DATO
                      00065 ;****** RE-DEFINE PORTD *****************************************
                      00066 ;#DEFINE        PWM_HCS         PORTD,7 ;PIN DI TRASMISSIONE HCS  <== new in electric blanket
                      00067 
                      00068 ;****** FLAGS_HCS *****************************************
                      00069 ;#DEFINE        TRASMISSIONE_HCS        FLAGS_HCS,0     ;
                      00070 ;#DEFINE        ALTO1_BASSO0            FLAGS_HCS,1     ;FLAG DA INVERTIRE CHE DETERMINA TE2
                      00071 
                      00072         IFDEF   NO_COMMENT
                      00073 #DEFINE                 FLAGS_HCS,2     ;
                      00074 #DEFINE                 FLAGS_HCS,3     ;
                      00075 #DEFINE                 FLAGS_HCS,4     ;
                      00076 #DEFINE                 FLAGS_HCS,5     ;
                      00077 #DEFINE         FLAGS_HCS,6     ;
                      00078 #DEFINE         FLAGS_HCS,7     ;
                      00079 
                      00080 ;****** FLAGS_HCS2 *************************************
                      00081 ;#DEFINE                FLAGS_HCS2,0    ;
                      00082 #DEFINE         FLAGS_HCS2,1    ;
                      00083         ENDIF
                      00084 
                      00085 ;*******************************************************
                      00086 
                      00087 
                      00088 ;*******************************************************
                      00089 ;       ORG             ORG_INCLUDES
0428                  00090 INIZIO_TX_HCS
                      00091 ;*** CARICARE BUFFER HCS
                      00092 ;       RAM1
                      00093 
                      00094 
0428   01C5           00095         CLRF    FASE_TX_HCS
0429   3017           00096         MOVLW   .23
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

042A   00CB           00097         MOVWF   COUNT_PREAMBOLO
                      00098 
042B   303E           00099         LW      HCS1
042C   00C8           00100         WF      PUNTA_HCS
                      00101 
042D   083E           00102         FW      HCS1
042E   00CA           00103         WF      TEMP_ROTATE
                      00104 
042F   3008           00105         LW      .8
0430   00C9           00106         WF      COUNT_BIT
                      00107 
                      00108         ;LW     0BH             ;COMPARE MODE, TRIGGER SPECIAL EVENT (CCP1 RESETS TMR1)
                      00109         ;WF     CCP1CON
                      00110 
0431   246A           00111         CALL    SET_TMR_TX
0432   1444           00112         SET     TRASMISSIONE_HCS
                      00113 
0433   0008           00114 ITH_X   RETURN
                      00115 ;*******************************************************
                      00116 
                      00117 
                      00118 ;*******************************************************
0434                  00119 FASE_PREAMBOLO
0434   3080           00120         MOVLW   0X80            ;1      ;TRASMISSIONE PREAMBOLO
0435   0688           00121         XORWF   PORTD,F         ;2              <-- gi:(WAS MOVLW 08H , XORWF PORTA,3?)
                      00122 
0436   0BCB           00123         DECFSZ  COUNT_PREAMBOLO,F
0437   2C3B           00124         B       FP_X
                      00125 
0438   300A           00126         MOVLW   .10
0439   00CB           00127         MOVWF   HEADER_COUNT
043A   0AC5           00128         INCF    FASE_TX_HCS,F
                      00129 
043B   2C7F           00130 FP_X    B       GTH_X
                      00131 ;*******************************************************
                      00132 
                      00133 
                      00134 ;*******************************************************
043C                  00135 FASE_HEADER
043C   0000           00136         NOP                     ;1
043D   1388           00137         CANC    PWM_HCS         ;2      ;TRASMISSIONE HEADER
                      00138 
043E   0BCB           00139         DECFSZ  HEADER_COUNT,F
043F   2C43           00140         B       FH_X
                      00141 
0440   3030           00142         MOVLW   MESSAGE_LENGTH          ;48 BITS...
0441   00CB           00143         MOVWF   COUNT_DATA
0442   0AC5           00144         INCF    FASE_TX_HCS,F
                      00145 
0443   2C7F           00146 FH_X    B       GTH_X
                      00147 ;*******************************************************
                      00148 
                      00149 
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00150 ;*******************************************************
0444                  00151 FASE_PWM_HI
0444   0000           00152         NOP                     ;1
0445   1788           00153         SET     PWM_HCS         ;2
                      00154 
0446   245C           00155         CALL    CALCOLA_PIN
0447   0AC5           00156         INCF    FASE_TX_HCS,F   ;1
                      00157 
0448   034B           00158         DECF    COUNT_DATA,W
0449   1903           00159         SKPNZ
044A   2412           00160         CALL    AD_START                ;(FIRST PUT KB0 TO GROUND,
                      00161 
                      00162 
044B   2C7F           00163 FPH_X   B       GTH_X
                      00164 ;*******************************************************
                      00165 ;TURN ON ANALOGICO...
                      00166 ;
                      00167 
                      00168 
                      00169 
                      00170 ;*******************************************************
044C                  00171 FASE_PWM_DATA                   ;IL PIN ARRIVA ALTO...
044C   18C4           00172         IFSET   ALTO1_BASSO0    ;1      ;...SE DEVO TRASMETTERE 1... 
044D   1388           00173         CANC    PWM_HCS         ;2      ;...LO INVERTO,...
                      00174                                 ;...SE DEVO TRASMETTERE 0 LO LASCIO ALTO
044E   0AC5           00175         INCF    FASE_TX_HCS,F
                      00176 
044F   034B           00177         DECF    COUNT_DATA,W
0450   1903           00178         SKPNZ
0451   23EB           00179         CALL    TEST_BATTERY                    ;..REMEMBER TO SHUT OFF)
                      00180 
                      00181 
0452   2C7F           00182         B       GTH_X
                      00183 ;*******************************************************
                      00184 
                      00185 
                      00186 ;*******************************************************
0453                  00187 FASE_PWM_LO
0453   0000           00188         NOP                     ;1
0454   1388           00189         CANC    PWM_HCS         ;2
                      00190 
0455   03C5           00191         DECF    FASE_TX_HCS,F
0456   03C5           00192         DECF    FASE_TX_HCS,F
                      00193 
0457   0BCB           00194         DECFSZ  COUNT_DATA,F
0458   2C5B           00195         B       FPL_X
                      00196 
                      00197 
0459   1044           00198         CANC    TRASMISSIONE_HCS
                      00199 
045A   246F           00200         CALL    CANC_TMR_TX
                      00201 
045B   2C7F           00202 FPL_X   B       GTH_X
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00203 ;*******************************************************
                      00204 
                      00205 
                      00206 ;*******************************************************
045C                  00207 CALCOLA_PIN
045C   10C4           00208         CANC    ALTO1_BASSO0
045D   0CCA           00209         RRF     TEMP_ROTATE,F
045E   1803           00210         SKPNC
045F   14C4           00211         SET     ALTO1_BASSO0
                      00212         
0460   0BC9           00213         DECFSZ  COUNT_BIT,F
0461   2C69           00214         B       CP_X
                      00215 
0462   0AC8           00216         INCF    PUNTA_HCS,F
0463   0848           00217         FW      PUNTA_HCS
0464   0084           00218         WF      FSR
0465   0800           00219         FW      INDF
0466   00CA           00220         WF      TEMP_ROTATE
                      00221 
0467   3008           00222         MOVLW   .8
0468   00C9           00223         MOVWF   COUNT_BIT
                      00224 
0469   0008           00225 CP_X    RETURN
                      00226 ;*******************************************************
                      00227 
                      00228 
                      00229 ;*******************************************************
046A                  00230 SET_TMR_TX
046A   3038           00231         LW      -.200  ;<----- CAMBIA PRESCALE PER 400uS
046B   0081           00232         WF      TMR_HCS
                      00233 
046C   110B           00234         CANC    _T0IF
046D   168B           00235         SET     _T0IE
                      00236 
046E   0008           00237         RETURN
                      00238 ;*******************************************************
                      00239 
                      00240 
                      00241 ;*******************************************************
046F                  00242 CANC_TMR_TX
                      00243 
046F   128B           00244         CANC    _T0IE
0470   1044           00245         CANC    TRASMISSIONE_HCS
                      00246         
0471   1405           00247         SET     TX_ENABLE
0472   1683           00248         BANK1
0473   1405           00249         BSF     TXENBL_TRIS
0474   1283           00250         BANK0
                      00251 
0475   0008           00252         RETURN
                      00253 ;*******************************************************
                      00254 
                      00255 
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00256 ;*******************************************************
0476                  00257 GESTIONE_TMR_HCS
0476   3004           00258         LW      HIGH    TAB_FASE_HCS
0477   008A           00259         WF      PCLATH
                      00260         ;ORG
                      00261 
0478   0845           00262         FW      FASE_TX_HCS
0479   0782           00263         ADDWF   PCL,F
                      00264 
047A                  00265 TAB_FASE_HCS
047A   2C34           00266         B       FASE_PREAMBOLO  ;0
047B   2C3C           00267         B       FASE_HEADER     ;1
047C   2C44           00268         B       FASE_PWM_HI     ;2
047D   2C4C           00269         B       FASE_PWM_DATA   ;3
047E                  00270 END_TAB_FASE_HCS
047E   2C53           00271         B       FASE_PWM_LO     ;4
                      00272 
                      00273         IF HIGH(TAB_FASE_HCS) != HIGH(END_TAB_FASE_HCS)
                      00274         ERROR "TAB_COMANDO: OVERFLOW del PCL"
                      00275         ENDIF
                      00276 
047F   0008           00277 GTH_X   RETURN                  ;A INTERRUPT
                      00278 ;*******************************************************
                      00279 
                      00280         IFDEF   NO_COMMENT
                      00281         NOP
                      00282         NOP
                      00283         NOP
                      00284         NOP
                      00285         NOP
                      00286         NOP
                      00287         NOP
                      00288         NOP
                      00289         NOP
                      00290         NOP
                      00291         NOP
                      00292         NOP
                      00293         NOP
                      00294         NOP
                      00295         NOP
                      00296         NOP
                      00297         NOP
                      00298         NOP
                      00299         NOP
                      00300         NOP
                      00301         NOP
                      00302         NOP
                      00303         NOP
                      00304         NOP
                      00305         NOP
                      00306         NOP
                      00307         NOP
                      00308         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00309         NOP
                      00310         NOP
                      00311         NOP
                      00312         NOP
                      00313         NOP
                      00314         NOP
                      00315         NOP
                      00316         NOP
                      00317         NOP
                      00318         NOP
                      00319         NOP
                      00320         NOP
                      00321         NOP
                      00322         NOP
                      00323         NOP
                      00324         NOP
                      00325         NOP
                      00326         NOP
                      00327         NOP
                      00328         NOP
                      00329         NOP
                      00330         NOP
                      00331         NOP
                      00332         NOP
                      00333         NOP
                      00334         NOP
                      00335         NOP
                      00336         NOP
                      00337         NOP
                      00338         NOP
                      00339         NOP
                      00340         NOP
                      00341         NOP
                      00342         NOP
                      00343         NOP
                      00344         NOP
                      00345         NOP
                      00346         NOP
                      00347         NOP
                      00348         NOP
                      00349         NOP
                      00350         NOP
                      00351         NOP
                      00352         NOP
                      00353         NOP
                      00354         NOP
                      00355         NOP
                      00356         NOP
                      00357         NOP
                      00358         NOP
                      00359         NOP
                      00360         NOP
                      00361         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00362         NOP
                      00363         NOP
                      00364         NOP
                      00365         NOP
                      00366         NOP
                      00367         NOP
                      00368         NOP
                      00369         NOP
                      00370         NOP
                      00371         NOP
                      00372         NOP
                      00373         NOP
                      00374         NOP
                      00375         NOP
                      00376         NOP
                      00377         NOP
                      00378         NOP
                      00379         NOP
                      00380         NOP
                      00381         NOP
                      00382         NOP
                      00383         NOP
                      00384         NOP
                      00385         NOP
                      00386         NOP
                      00387         NOP
                      00388         NOP
                      00389         NOP
                      00390         NOP
                      00391         NOP
                      00392         NOP
                      00393         NOP
                      00394         NOP
                      00395         NOP
                      00396         NOP
                      00397         NOP
                      00398         NOP
                      00399         NOP
                      00400         NOP
                      00401         NOP
                      00402         NOP
                      00403         NOP
                      00404         NOP
                      00405         NOP
                      00406         NOP
                      00407         NOP
                      00408         NOP
                      00409         NOP
                      00410         NOP
                      00411         NOP
                      00412         NOP
                      00413         NOP
                      00414         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00415         NOP
                      00416         NOP
                      00417         NOP
                      00418         NOP
                      00419         NOP
                      00420         NOP
                      00421         NOP
                      00422         NOP
                      00423         NOP
                      00424         NOP
                      00425         RETURN
                      00426         NOP
                      00427         NOP
                      00428         NOP
                      00429         NOP
                      00430         NOP
                      00431         NOP
                      00432         NOP
                      00433         NOP
                      00434         NOP
                      00435         NOP
                      00436         NOP
                      00437         NOP
                      00438         NOP
                      00439         NOP
                      00440         NOP
                      00441         NOP
                      00442         NOP
                      00443         NOP
                      00444         NOP
                      00445         NOP
                      00446         NOP
                      00447         NOP
                      00448         NOP
                      00449         NOP
                      00450         NOP
                      00451         NOP
                      00452         NOP
                      00453         NOP
                      00454         NOP
                      00455         NOP
                      00456         NOP
                      00457         NOP
                      00458         NOP
                      00459         NOP
                      00460         NOP
                      00461         NOP
                      00462         NOP
                      00463         NOP
                      00464         NOP
                      00465         NOP
                      00466         NOP
                      00467         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00468         NOP
                      00469         NOP
                      00470         NOP
                      00471         NOP
                      00472         NOP
                      00473         NOP
                      00474         NOP
                      00475         NOP
                      00476         NOP
                      00477         NOP
                      00478         NOP
                      00479         NOP
                      00480         NOP
                      00481         NOP
                      00482         NOP
                      00483         NOP
                      00484         NOP
                      00485         NOP
                      00486         NOP
                      00487         NOP
                      00488         NOP
                      00489         NOP
                      00490         NOP
                      00491         NOP
                      00492         NOP
                      00493         NOP
                      00494         NOP
                      00495         NOP
                      00496         NOP
                      00497         NOP
                      00498         NOP
                      00499         NOP
                      00500         NOP
                      00501         NOP
                      00502         NOP
                      00503         NOP
                      00504         NOP
                      00505         NOP
                      00506         NOP
                      00507         NOP
                      00508         NOP
                      00509         NOP
                      00510         NOP
                      00511         NOP
                      00512         NOP
                      00513         NOP
                      00514         NOP
                      00515         NOP
                      00516         NOP
                      00517         NOP
                      00518         NOP
                      00519         NOP
                      00520         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00521         NOP
                      00522         NOP
                      00523         NOP
                      00524         NOP
                      00525         NOP
                      00526         NOP
                      00527         NOP
                      00528         NOP
                      00529         NOP
                      00530         NOP
                      00531         NOP
                      00532         NOP
                      00533         NOP
                      00534         NOP
                      00535         NOP
                      00536         NOP
                      00537         NOP
                      00538         NOP
                      00539         NOP
                      00540         NOP
                      00541         NOP
                      00542         NOP
                      00543         NOP
                      00544         NOP
                      00545         NOP
                      00546         NOP
                      00547         NOP
                      00548         NOP
                      00549         NOP
                      00550         NOP
                      00551         NOP
                      00552         NOP
                      00553         NOP
                      00554         NOP
                      00555         NOP
                      00556         NOP
                      00557         NOP
                      00558         NOP
                      00559         NOP
                      00560         NOP
                      00561         NOP
                      00562         NOP
                      00563         NOP
                      00564         NOP
                      00565         NOP
                      00566         NOP
                      00567         NOP
                      00568         NOP
                      00569         NOP
                      00570         NOP
                      00571         NOP
                      00572         NOP
                      00573         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00574         NOP
                      00575         NOP
                      00576         NOP
                      00577         NOP
                      00578         NOP
                      00579         NOP
                      00580         NOP
                      00581         NOP
                      00582         NOP
                      00583         NOP
                      00584         NOP
                      00585         NOP
                      00586         NOP
                      00587         NOP
                      00588         NOP
                      00589         NOP
                      00590         NOP
                      00591         NOP
                      00592         NOP
                      00593         NOP
                      00594         NOP
                      00595         NOP
                      00596         NOP
                      00597         NOP
                      00598         NOP
                      00599         NOP
                      00600         NOP
                      00601         NOP
                      00602         NOP
                      00603         NOP
                      00604         NOP
                      00605         NOP
                      00606         NOP
                      00607         NOP
                      00608         NOP
                      00609         NOP
                      00610         NOP
                      00611         NOP
                      00612         NOP
                      00613         NOP
                      00614         NOP
                      00615         NOP
                      00616         NOP
                      00617         NOP
                      00618         NOP
                      00619         NOP
                      00620         NOP
                      00621         NOP
                      00622         NOP
                      00623         NOP
                      00624         NOP
                      00625         NOP
                      00626         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00627         NOP
                      00628         NOP
                      00629         NOP
                      00630         NOP
                      00631         NOP
                      00632         NOP
                      00633         NOP
                      00634         NOP
                      00635         NOP
                      00636         NOP
                      00637         NOP
                      00638         NOP
                      00639         NOP
                      00640         NOP
                      00641         NOP
                      00642         NOP
                      00643         NOP
                      00644         NOP
                      00645         NOP
                      00646         NOP
                      00647         NOP
                      00648         NOP
                      00649         NOP
                      00650         NOP
                      00651         NOP
                      00652         NOP
                      00653         NOP
                      00654         NOP
                      00655         NOP
                      00656         NOP
                      00657         NOP
                      00658         NOP
                      00659         NOP
                      00660         NOP
                      00661         NOP
                      00662         NOP
                      00663         NOP
                      00664         NOP
                      00665         NOP
                      00666         NOP
                      00667         NOP
                      00668         NOP
                      00669         NOP
                      00670         NOP
                      00671         NOP
                      00672         NOP
                      00673         NOP
                      00674         NOP
                      00675         NOP
                      00676         NOP
                      00677         NOP
                      00678         NOP
                      00679         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00680         NOP
                      00681         NOP
                      00682         NOP
                      00683         NOP
                      00684         NOP
                      00685         NOP
                      00686         NOP
                      00687         NOP
                      00688         NOP
                      00689         NOP
                      00690         NOP
                      00691         NOP
                      00692         NOP
                      00693         NOP
                      00694         NOP
                      00695         NOP
                      00696         NOP
                      00697         NOP
                      00698         NOP
                      00699         NOP
                      00700         NOP
                      00701         NOP
                      00702         NOP
                      00703         NOP
                      00704         NOP
                      00705         NOP
                      00706         NOP
                      00707         NOP
                      00708         NOP
                      00709         NOP
                      00710         NOP
                      00711         NOP
                      00712         NOP
                      00713         NOP
                      00714         NOP
                      00715         NOP
                      00716         NOP
                      00717         NOP
                      00718         NOP
                      00719         NOP
                      00720         NOP
                      00721         NOP
                      00722         NOP
                      00723         NOP
                      00724         NOP
                      00725         NOP
                      00726         NOP
                      00727         NOP
                      00728         NOP
                      00729         NOP
                      00730         NOP
                      00731         NOP
                      00732         NOP
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00733         NOP
                      00734         NOP
                      00735         NOP
                      00736         NOP
                      00737         NOP
                      00738         NOP
                      00739         NOP
                      00740         NOP
                      00741         NOP
                      00742         NOP
                      00743         NOP
                      00744         NOP
                      00745 
                      00746         ENDIF
                      01563 
                      01564 
                      01565 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01566 ;Jump table selection of Serial Number digits (28sb)
                      01567 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01568         ;ATTENTION: END OF PAGE 1
                      01569 
07FC                  01570         org     0x7FC           ;lookout this OFFSET is fixed!!!!!!!!
07FC   34A8           01571 GET_SERIAL_3    RETLW   0xA8    ;serial number (lsb)
07FD   34CB           01572 GET_SERIAL_2    RETLW   0xCB    ;serial number
07FE   34ED           01573 GET_SERIAL_1    RETLW   0xED    ;serial number
07FF   340F           01574 GET_SERIAL_0    RETLW   0x0F    ;low nibble only: msb serial number
                      01575 
                      01576 
0800                  01577         org     0x800
0800   0000           01578         NOP
                      01579         
                      01580         END                       ; directive 'end of program'
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 54


SYMBOL TABLE
  LABEL                             VALUE 

ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000004
ADCS1                             00000005
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADJUST_CLK_PHASE                  0000002D
ADJUST_RT                         LCD_CHAR2,7
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AD_START                          00000412
ALTO1_BASSO0                      FLAGS_HCS,1
AN0                               00000000
AN1                               00000001
AN2                               00000002
AN3                               00000003
AN4                               00000004
AN5                               00000005
AN6                               00000006
AN7                               00000007
ANSEL                             00000091
AUTOLOCK_DEBOUNCE                 00000040
AUTOLOCK_OFF_TIME                 0000001E
AUTOLOCK_ON                       LCD_CHAR3,6
AUTO_OFF_12HR                     0000000C
AUTO_OFF_1HR                      00000001
AUTO_OFF_3HR                      00000003
AUTO_OFF_HOURS                    00000030
AUTO_OFF_MINUTES                  00000031
AUTO_OFF_OFF                      00000000
BACKLIGHT                         PORTB,6
BACKLIGHT_CNT                     00000027
BACKLIGHT_PERIOD                  0000001E
BANK0                             BCF     STATUS,RP0
BANK1                             BSF     STATUS,RP0
BATTERY_BLINK_COUNT               0000003A
BATTERY_LOW                       LCD_CHAR5,2
BATTERY_WARN                      LCD_CHAR5,1
BATTLOW                           LCD_CHAR1,7
BATT_HIGH_THRESHLD                00000099
BATT_LOW_THRESHLD                 00000087
BAT_OFF_MSG_COUNT                 0000003C
BEEPER                            LCD_CHAR5,0
BF                                00000000
BIASMD                            00000006
BI_FSR                            0000004E
BI_PCLATH                         0000004D
BI_STATUS                         0000004C
BI_WREG                           00000077
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 55


SYMBOL TABLE
  LABEL                             VALUE 

BLINK_2P_PERIOD                   00000020
BLINK_COUNT                       00000028
BLINK_PERIOD                      00000010
BLINK_TIME                        000001F4
BOOST                             LCD_CHAR2,2
BOOST_ACT                         LCD_CHAR5,3
BOOST_MINUTES                     00000032
BOOST_PERIOD                      0000001E
BRGH                              00000002
BTN_ACT_PDG                       LCD_CHAR3,1
C                                 00000000
C1IE                              00000005
C1IF                              00000005
C1INV                             00000004
C1OUT                             00000006
C2IE                              00000006
C2IF                              00000006
C2INV                             00000005
C2OUT                             00000007
C2SYNC                            00000000
CALCOLA_PIN                       0000045C
CANC                              BCF
CANC_TMR_TX                       0000046F
CARICA_TIMER_HCS_HI               00000046
CARICA_TIMER_HCS_LO               00000047
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CIS                               00000003
CKE                               00000006
CKP                               00000004
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 56


SYMBOL TABLE
  LABEL                             VALUE 

CLCKSET_ACT                       LCD_CHAR3,3
CLEAR_RAM_0                       00000416
CLEAR_RAM_1                       0000041F
CLKP_1224                         00000001
CLKP_HOUR_12                      0000000C
CLKP_HOUR_24                      00000018
CLKP_HOUR_ADJ                     00000003
CLKP_HOUR_DISP12                  00000012
CLKP_HOUR_DISP24                  00000024
CLKP_MIN_ADJ                      00000002
CLKP_NOTHING                      00000000
CLOCK_SET                         NEW_BUTTON_CONFIG,5
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON0                            0000009C
CMCON1                            00000097
COLON                             LCD_CHAR5,5
COM0                              PORTB,4
COM1                              PORTB,5
COM2                              PORTA,2
COM3                              PORTD,0
COUNT_BIT                         00000049
COUNT_DATA                        0000004B
COUNT_PREAMBOLO                   0000004B
CP_X                              00000469
CREN                              00000004
CS0                               00000002
CS1                               00000003
CSRC                              00000007
Convert_to_BCD                    000003E1
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DEBOUNCE_AUTOLOCK                 000007D0
DEBOUNCE_CNT                      00000026
DEBOUNCE_NORMAL                   000000C8
DEBOUNCE_PERIOD                   00000006
DEBOUNCING                        LCD_CHAR3,0
DEBUG_OUT                         PORTE,0
DEVICE_OFF                        00000240
DEVOFF                            LCD_CHAR2,1
DEVON                             LCD_CHAR2,0
DIGIT_SELECT                      0000000E
DISPLAY_REAL_TIME                 0000031C
D_A                               00000005
EEADRH                            0000010F
EEADRL                            0000010D
EECON1                            0000018C
EECON2                            0000018D
EEDATH                            0000010E
EEDATL                            0000010C
EEIE                              00000007
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 57


SYMBOL TABLE
  LABEL                             VALUE 

EEIF                              00000007
EEPGD                             00000007
EERD                              00000000
EEWR                              00000001
END_TAB_FASE_HCS                  0000047E
F                                 00000001
FASE_HEADER                       0000043C
FASE_PREAMBOLO                    00000434
FASE_PWM_DATA                     0000044C
FASE_PWM_HI                       00000444
FASE_PWM_LO                       00000453
FASE_TX_HCS                       00000045
FERR                              00000002
FH_X                              00000443
FILL_RESEND_PERIOD                0000022F
FLAGS_HCS                         00000044
FPH_X                             0000044B
FPL_X                             0000045B
FP_X                              0000043B
FSR                               00000004
FW                                MOVFW
F_BODY_GUARD                      LCD_CHAR5,4
GESTIONE_TMR_HCS                  00000476
GET_SERIAL_0                      000007FF
GET_SERIAL_1                      000007FE
GET_SERIAL_2                      000007FD
GET_SERIAL_3                      000007FC
GIE                               00000007
GO_DONE                           ADCON0,1
GTH_X                             0000047F
HANDLE_BUTTONS                    00000108
HCS1                              0000003E
HCS2                              0000003F
HCS3                              00000040
HCS4                              00000041
HCS5                              00000042
HCS6                              00000043
HEADER_COUNT                      0000004B
HEAT_ACT                          LCD_CHAR3,5
HEAT_ADJ_DEBOUNCE                 0000000C
HEAT_MSG_COUNTDWN                 00000009
HEAT_MSG_DELAY                    0000012C
HOURS                             LCD_CHAR1,1
HOUR_VALUE                        00000075
HTS                               00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IDLE_BATTERY_TEST                 0000000C
IDLE_BATT_COUNT                   0000003B
IFCANC                            BTFSS
IFSET                             BTFSC
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 58


SYMBOL TABLE
  LABEL                             VALUE 

INDF                              00000000
INIZIO_TX_HCS                     00000428
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTERRUPT                         0000032B
INTF                              00000001
IOC                               00000096
IOC4                              00000004
IOC5                              00000005
IOC6                              00000006
IOC7                              00000007
IOCB                              00000096
IOCB4                             00000004
IOCB5                             00000005
IOCB6                             00000006
IOCB7                             00000007
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
IRVST                             00000005
ISR                               0000032B
ISR_X                             00000334
ITH_X                             00000433
KB0                               PORTA,3
KB1                               PORTD,1
KB2                               PORTD,2
KB3                               PORTD,3
KB4                               PORTD,4
KB5                               PORTD,5
KB6                               PORTD,6
KB7                               PORTE,0
KB8                               PORTE,1
LCD0                              PORTB,0
LCD1                              PORTB,1
LCD10                             PORTC,5
LCD11                             PORTC,4
LCD2                              PORTB,2
LCD3                              PORTB,3
LCD4                              PORTA,4
LCD5                              PORTA,5
LCD6                              PORTC,3
LCD7                              PORTA,1
LCD8                              PORTC,7
LCD9                              PORTC,6
LCDA                              00000005
LCDCON                            00000107
LCDDATA0                          00000110
LCDDATA1                          00000111
LCDDATA10                         0000011A
LCDDATA11                         0000011B
LCDDATA2                          00000112
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 59


SYMBOL TABLE
  LABEL                             VALUE 

LCDDATA3                          00000113
LCDDATA4                          00000114
LCDDATA5                          00000115
LCDDATA6                          00000116
LCDDATA7                          00000117
LCDDATA8                          00000118
LCDDATA9                          00000119
LCDEN                             00000007
LCDIE                             00000004
LCDIF                             00000004
LCDPS                             00000108
LCDSE0                            0000011C
LCDSE1                            0000011D
LCDSE2                            0000011E
LCD_CHAR1                         00000071
LCD_CHAR2                         00000072
LCD_CHAR3                         0000002B
LCD_CHAR4                         0000002C
LCD_CHAR5                         00000073
LCD_FRAME_FREQ                    00000040
LCD_FRAME_PERIOD                  00003D09
LCD_IF                            PIR2,LCDIF
LCD_PRESCALE                      00000003
LCD_TICK                          00007A12
LCD_UPD                           LCD_CHAR2,3
LED1                              PORTB,7
LED1_CLOCK                        00000022
LED1_OFF_PERIOD                   00000BB8
LED1_ON_PERIOD                    0000012C
LED1_STATE                        LCD_CHAR2,4
LMUX0                             00000000
LMUX1                             00000001
LOCKED                            LCD_CHAR1,6
LOOP_BCD                          000003E2
LP0                               00000000
LP1                               00000001
LP2                               00000002
LP3                               00000003
LTS                               00000001
LVDCON                            00000109
LVDEN                             00000004
LVDIE                             00000002
LVDIF                             00000002
LVDL0                             00000000
LVDL1                             00000001
LVDL2                             00000002
LW                                MOVLW
MANAGE_LED1                       00000294
MASKTA                            b'11000001'
MASKTB                            b'00000000'
MASKTC                            b'00000111'
MASKTD                            b'00111110'
MASKTE                            b'11111110'
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 60


SYMBOL TABLE
  LABEL                             VALUE 

MAX_HOURS                         0000002E
MAX_TEMP                          0000000A
MCLR                              PORTE,3
MESSAGE_LENGTH                    00000030
MILLI                             000003E8
MINUS                             NEW_BUTTON_CONFIG,3
MINUS_BUT                         LCD_CHAR2,6
MINUTES                           LCD_CHAR1,0
MIN_VALUE                         00000074
MODE                              NEW_BUTTON_CONFIG,2
MODE_ACT                          LCD_CHAR3,2
MSG_PAUSE_PERIOD                  00000001
MULTIPLEX                         00000004
M_BANKSEL_0                       
M_BANKSEL_1                       
M_BANKSEL_2                       
M_BANKSEL_3                       
M_CMPL_JE                         
M_CMPL_JG                         
M_CMPL_JGE                        
M_CMPL_JL                         
M_CMPL_JNE                        
M_CMP_JE                          
M_CMP_JG                          
M_CMP_JGE                         
M_CMP_JL                          
M_CMP_JLE                         
M_CMP_JNE                         
NEW_BUTTON_CONFIG                 00000029
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OERR                              00000001
OLD_BUTTON_CONFIG                 0000002A
ONEHR                             LCD_CHAR1,2
OPTION_REG                        00000081
ORG_INCLUDES                      00000428
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000003
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 61


SYMBOL TABLE
  LABEL                             VALUE 

P                                 00000004
PAUSE_COUNT                       00000039
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PERCENT_BATT_HIGH_THRESHLD        0000003C
PERCENT_BATT_LOW_THRESHLD         00000035
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PLUS                              NEW_BUTTON_CONFIG,4
PLUS_BUT                          LCD_CHAR2,5
POP                               00000334
PORTA                             00000005
PORTA6                            "NOT USED"
PORTA7                            "NOT USED"
PORTB                             00000006
PORTC                             00000007
PORTC0                            "DONT KNOW"
PORTC1                            "DONT KNOW"
PORTC2                            "DONT KNOW"
PORTD                             00000008
PORTE                             00000009
PR                                00000418
PR2                               00000092
PREHEAT                           NEW_BUTTON_CONFIG,1
PREHEAT_COUNTDOWN                 000002FD
PRE_MESSAGE_TIMER                 00000034
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PUNTA_HCS                         00000048
PURA1                             00000421
PUSH                              00000004
PWM_HCS                           PORTD,7
PW_OFF_PERIOD                     00000060
PW_ON_PERIOD                      00000009
R                                 00000002
RAM0                              BCF     STATUS,RP0
RAM1                              BSF     STATUS,RP0
RAM_0                             BCF     STATUS,RP0
RAM_1                             BSF     STATUS,RP0
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 62


SYMBOL TABLE
  LABEL                             VALUE 

RCSTA                             00000018
RD                                00000000
READ_WRITE                        00000002
REAL_TIME_SERVICES                000002BF
RELOCK_ON                         LCD_CHAR3,7
RESEND_OFF_COUNT                  00000036
RESEND_ON_COUNT_H                 00000038
RESEND_ON_COUNT_L                 00000037
REXMIT_COUNT                      00000035
REXMIT_EXTEND                     00000003
REXMIT_NORMAL                     00000002
RE_LOCK_TIME                      0000002F
RP0                               00000005
RP1                               00000006
RT_HOURS                          00000025
RT_MINUTES                        00000024
RT_SECONDS                        00000023
RX9                               00000006
RX9D                              00000000
R_W                               00000002
S                                 00000003
S0C0                              00000000
S0C1                              00000000
S0C2                              00000000
S0C3                              00000000
S10C0                             00000002
S10C1                             00000002
S10C2                             00000002
S10C3                             00000002
S11C0                             00000003
S11C1                             00000003
S11C2                             00000003
S11C3                             00000003
S12C0                             00000004
S12C1                             00000004
S12C2                             00000004
S12C3                             00000004
S13C0                             00000005
S13C1                             00000005
S13C2                             00000005
S13C3                             00000005
S14C0                             00000006
S14C1                             00000006
S14C2                             00000006
S14C3                             00000006
S15C0                             00000007
S15C1                             00000007
S15C2                             00000007
S15C3                             00000007
S16C0                             00000000
S16C1                             00000000
S16C2                             00000000
S16C3                             00000000
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 63


SYMBOL TABLE
  LABEL                             VALUE 

S17C0                             00000001
S17C1                             00000001
S17C2                             00000001
S17C3                             00000001
S18C0                             00000002
S18C1                             00000002
S18C2                             00000002
S18C3                             00000002
S19C0                             00000003
S19C1                             00000003
S19C2                             00000003
S19C3                             00000003
S1C0                              00000001
S1C1                              00000001
S1C2                              00000001
S1C3                              00000001
S20C0                             00000004
S20C1                             00000004
S20C2                             00000004
S20C3                             00000004
S21C0                             00000005
S21C1                             00000005
S21C2                             00000005
S21C3                             00000005
S22C0                             00000006
S22C1                             00000006
S22C2                             00000006
S22C3                             00000006
S23C0                             00000007
S23C1                             00000007
S23C2                             00000007
S23C3                             00000007
S2C0                              00000002
S2C1                              00000002
S2C2                              00000002
S2C3                              00000002
S3C0                              00000003
S3C1                              00000003
S3C2                              00000003
S3C3                              00000003
S4C0                              00000004
S4C1                              00000004
S4C2                              00000004
S4C3                              00000004
S5C0                              00000005
S5C1                              00000005
S5C2                              00000005
S5C3                              00000005
S6C0                              00000006
S6C1                              00000006
S6C2                              00000006
S6C3                              00000006
S7C0                              00000007
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 64


SYMBOL TABLE
  LABEL                             VALUE 

S7C1                              00000007
S7C2                              00000007
S7C3                              00000007
S8C0                              00000000
S8C1                              00000000
S8C2                              00000000
S8C3                              00000000
S9C0                              00000001
S9C1                              00000001
S9C2                              00000001
S9C3                              00000001
SAVED_TEMPERATURE                 00000033
SBOREN                            00000004
SC                                BTFSC
SCS                               00000000
SE0                               00000000
SE1                               00000001
SE10                              00000002
SE11                              00000003
SE12                              00000004
SE13                              00000005
SE14                              00000006
SE15                              00000007
SE16                              00000000
SE17                              00000001
SE18                              00000002
SE19                              00000003
SE2                               00000002
SE20                              00000004
SE21                              00000005
SE22                              00000006
SE23                              00000007
SE3                               00000003
SE4                               00000004
SE5                               00000005
SE6                               00000006
SE7                               00000007
SE8                               00000000
SE9                               00000001
SECONDS_BLINK                     000002B5
SEG0COM0                          00000000
SEG0COM1                          00000000
SEG0COM2                          00000000
SEG0COM3                          00000000
SEG10COM0                         00000002
SEG10COM1                         00000002
SEG10COM2                         00000002
SEG10COM3                         00000002
SEG11COM0                         00000003
SEG11COM1                         00000003
SEG11COM2                         00000003
SEG11COM3                         00000003
SEG12COM0                         00000004
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 65


SYMBOL TABLE
  LABEL                             VALUE 

SEG12COM1                         00000004
SEG12COM2                         00000004
SEG12COM3                         00000004
SEG13COM0                         00000005
SEG13COM1                         00000005
SEG13COM2                         00000005
SEG13COM3                         00000005
SEG14COM0                         00000006
SEG14COM1                         00000006
SEG14COM2                         00000006
SEG14COM3                         00000006
SEG15COM0                         00000007
SEG15COM1                         00000007
SEG15COM2                         00000007
SEG15COM3                         00000007
SEG16COM0                         00000000
SEG16COM1                         00000000
SEG16COM2                         00000000
SEG16COM3                         00000000
SEG17COM0                         00000001
SEG17COM1                         00000001
SEG17COM2                         00000001
SEG17COM3                         00000001
SEG18COM0                         00000002
SEG18COM1                         00000002
SEG18COM2                         00000002
SEG18COM3                         00000002
SEG19COM0                         00000003
SEG19COM1                         00000003
SEG19COM2                         00000003
SEG19COM3                         00000003
SEG1COM0                          00000001
SEG1COM1                          00000001
SEG1COM2                          00000001
SEG1COM3                          00000001
SEG20COM0                         00000004
SEG20COM1                         00000004
SEG20COM2                         00000004
SEG20COM3                         00000004
SEG21COM0                         00000005
SEG21COM1                         00000005
SEG21COM2                         00000005
SEG21COM3                         00000005
SEG22COM0                         00000006
SEG22COM1                         00000006
SEG22COM2                         00000006
SEG22COM3                         00000006
SEG23COM0                         00000007
SEG23COM1                         00000007
SEG23COM2                         00000007
SEG23COM3                         00000007
SEG2COM0                          00000002
SEG2COM1                          00000002
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 66


SYMBOL TABLE
  LABEL                             VALUE 

SEG2COM2                          00000002
SEG2COM3                          00000002
SEG3COM0                          00000003
SEG3COM1                          00000003
SEG3COM2                          00000003
SEG3COM3                          00000003
SEG4COM0                          00000004
SEG4COM1                          00000004
SEG4COM2                          00000004
SEG4COM3                          00000004
SEG5COM0                          00000005
SEG5COM1                          00000005
SEG5COM2                          00000005
SEG5COM3                          00000005
SEG6COM0                          00000006
SEG6COM1                          00000006
SEG6COM2                          00000006
SEG6COM3                          00000006
SEG7COM0                          00000007
SEG7COM1                          00000007
SEG7COM2                          00000007
SEG7COM3                          00000007
SEG8COM0                          00000000
SEG8COM1                          00000000
SEG8COM2                          00000000
SEG8COM3                          00000000
SEG9COM0                          00000001
SEG9COM1                          00000001
SEG9COM2                          00000001
SEG9COM3                          00000001
SEGEN0                            00000000
SEGEN1                            00000001
SEGEN10                           00000002
SEGEN11                           00000003
SEGEN12                           00000004
SEGEN13                           00000005
SEGEN14                           00000006
SEGEN15                           00000007
SEGEN16                           00000000
SEGEN17                           00000001
SEGEN18                           00000002
SEGEN19                           00000003
SEGEN2                            00000002
SEGEN20                           00000004
SEGEN21                           00000005
SEGEN22                           00000006
SEGEN23                           00000007
SEGEN3                            00000003
SEGEN4                            00000004
SEGEN5                            00000005
SEGEN6                            00000006
SEGEN7                            00000007
SEGEN8                            00000000
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 67


SYMBOL TABLE
  LABEL                             VALUE 

SEGEN9                            00000001
SEND_MESSAGES                     000000A2
SEND_OFF_PERIOD                   0000001E
SEND_ON_PERIOD                    000002D0
SET                               BSF
SET_TMR_TX                        0000046A
SIXTY_MINUTES                     0000003C
SKPB                              SKPNC
SKPNB                             SKPC
SLPEN                             00000006
SMP                               00000007
SND_BOOSTON_MSG                   LCD_CHAR4,2
SND_BOO_OFF_MSG                   LCD_CHAR4,3
SND_LEARN_MSG                     LCD_CHAR4,5
SND_OFF_MSG                       LCD_CHAR4,0
SND_ON_MSG                        LCD_CHAR4,1
SND_REFRESH_MSG                   LCD_CHAR4,7
SND_TEMP_MSG                      LCD_CHAR4,4
SND_TEST_MSG                      LCD_CHAR4,6
SPARE                             NEW_BUTTON_CONFIG,0
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SS                                BTFSS
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
SWAPBCD                           000003E7
SWDTE                             00000000
SWDTEN                            00000000
SYNC                              00000004
S_KB6                             NEW_BUTTON_CONFIG,6
S_KB7                             NEW_BUTTON_CONFIG,7
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GE                              00000006
T1GINV                            00000007
T1GSS                             00000001
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 68


SYMBOL TABLE
  LABEL                             VALUE 

T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TAB_FASE_HCS                      0000047A
TEMPETR                           LCD_CHAR1,5
TEMP_BYT0_B0                      00000020
TEMP_BYT0_B2                      00000123
TEMP_BYT1_B0                      00000021
TEMP_BYT1_B2                      00000124
TEMP_ROTATE                       0000004A
TEST_BATTERY                      000003EB
TEST_BUTTONS                      00000251
THREEHR                           LCD_CHAR1,3
TMPTR_VALUE                       00000076
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR1_IF                           PIR1,TMR1IF
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TMR2_1SECOND                      0000003D
TMR_HCS                           00000001
TMR_HCS_ON                        _TMR1ON
TOGGLE_LCD                        00000122
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRASMISSIONE_HCS                  FLAGS_HCS,0
TREAT_BATTERY_DISPLAY             000002A3
TRISA                             00000085
TRISB                             00000086
TRISC                             00000087
TRISD                             00000088
TRISE                             00000089
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TWELVEHR                          LCD_CHAR1,4
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 69


SYMBOL TABLE
  LABEL                             VALUE 

TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXENBL_TRIS                       TRISA,0
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
TX_ENABLE                         PORTA,0
UA                                00000001
UNLOCKING                         LCD_CHAR3,4
UPDATE_LCD                        0000033F
VCFG0                             00000005
VCFG1                             00000006
VDIODE                            PORTE,2
VLCDEN                            00000004
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             0000009D
VREN                              00000007
VRR                               00000005
W                                 00000000
WA                                00000004
WAVE_TYPE_B                       
WCOL                              00000007
WDTCON                            00000105
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WERR                              00000005
WF                                MOVWF
WFT                               00000007
WFT_A                             00000000
WFT_B                             00000080
WPU                               00000095
WPU0                              00000000
WPU1                              00000001
WPU2                              00000002
WPU3                              00000003
WPU4                              00000004
WPU5                              00000005
WPU6                              00000006
WPU7                              00000007
WPUB                              00000095
WPUB0                             00000000
WPUB1                             00000001
WPUB2                             00000002
WPUB3                             00000003
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 70


SYMBOL TABLE
  LABEL                             VALUE 

WPUB4                             00000004
WPUB5                             00000005
WPUB6                             00000006
WPUB7                             00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WR_ERRORS                         00000120
WR_NOERRORS                       00000121
Z                                 00000002
_ACCEPT_HEAT_CHANGE               000001FB
_ADCON_GO                         000003EC
_ADD_HOUR                         000001CB
_ADD_MINUTE                       00000198
_AO_DONE                          000002FA
_AUTOLOCK_DEBOUNCE_PERIOD         00000287
_AUTOLOCK_REJECT                  00000115
_AUTOSHUTOFF                      000002F0
_BATTERY                          000003D6
_BATTERY_COUNTER                  00000316
_BATTERY_LOW                      000003FA
_BATTERY_OK                       0000040B
_BATTERY_WARNING                  00000406
_BATT_FIN                         000002B4
_BATT_GOOD                        000002B3
_BATT_LOW                         000002AE
_BL1                              000002CA
_BLINK_END                        000002BE
_BOD_NSLEEP                       00003EFF
_BOD_OFF                          00003CFF
_BOD_ON                           00003FFF
_BOD_SBODEN                       00003DFF
_BOOST                            000003DC
_BOOST_OFF_MSG                    000000C0
_BOOST_ON_MSG                     000000BB
_BUTTON_END                       00000293
_CHKSUM_LOOP                      000000F0
_CLEAR_DEBOUNCE                   00000292
_COLON                            00000385
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEBOUNCING                       00000273
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         00002FFF
_DECHR                            000001DC
_DECMIN                           000001A7
_DELAY_MSG_SEND                   00000216
_DISPLAY_ADJUSTMENTS              00000228
_DISP_AUTO_OFF                    0000016B
_EC_OSC                           00003FFB
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 71


SYMBOL TABLE
  LABEL                             VALUE 

_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_GIE                              INTCON,GIE
_GO1_HR                           000001D4
_GO1_MIN                          000001A1
_HANDLE_CLK_SET                   0000017D
_HANDLE_FIN                       0000022E
_HEAT_DEBOUNCE_PERIOD             0000028A
_HEAT_MSG_ACTION                  000001FF
_HEAT_MSG_COUNTDOWN               0000021F
_HOURS                            00000387
_HR_ADJUST                        000001B9
_HS_OSC                           00003FFA
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INCHR                            0000030C
_INCMIN                           000002E6
_INTE                             INTCON,INTE
_INTF                             INTCON,INTF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LCDCONT                          00000351
_LCD_DONE                         000003DE
_LED1_END                         000002A2
_LED1_SET                         000002A1
_LOCKED                           000003D4
_LOOP_DELAY                       00000101
_LP_OSC                           00003FF8
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_MIN_ADJUST                       00000186
_MODE12HR                         0000015C
_MODE1HR                          00000143
_MODE3HR                          00000152
_MODE_HOUR                        000001E3
_MODE_MIN                         000001AD
_MODE_OFF                         00000166
_MSG_CONT1                        000000CC
_MSG_CONT2                        000000D0
_MSG_CONT3                        000000D3
_MSG_FIN                          00000107
_NEW_ACTIONS                      0000011C
_NEW_CLKSET                       00000170
_NEW_CLK_ADJ                      00000172
_NEW_HOURS                        000001DD
_NEW_MINUTES                      000001A8
_NEW_MODE                         00000138
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 72


SYMBOL TABLE
  LABEL                             VALUE 

_NEW_MSG                          000000AC
_NEW_TEMP_VARS                    000001F1
_NEXT_HANDLE                      00000118
_NORMAL_DEBOUNCE_PERIOD           0000028F
_NO_BLKHR                         000001C1
_NO_BLKMIN                        0000018E
_NO_MORE_ACTION                   0000022B
_OFF                              000003DA
_ON                               000003D8
_ON_MSG                           000000B1
_PEIE                             INTCON,PEIE
_PREHEAT                          00000124
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_REFRESH_MSG                      000000B6
_RELOAD_AO_MINUTES                000002F7
_RELOAD_ON_MSG                    000002D3
_RELOCK_REACHED                   000002DD
_RELOCK_SECS                      000002D6
_RESEND_OFF_MSG                   000002E9
_RESEND_ON_MSG                    000002CD
_RESET_RELOCK                     0000022C
_RE_SEND                          000000FA
_RT_DONE                          0000031B
_RT_HOURS                         00000307
_RT_MINUTES                       000002E1
_RT_SECONDS                       000002C2
_SAVE_MINUTES                     00000169
_SKIPHR                           000001C6
_SKIPMIN                          00000193
_SND_LEARN_MSG                    000000C5
_SND_TEST_MSG                     000000C9
_SNOOZE                           00000079
_START_DEBOUNCING                 0000027E
_STAY_UP                          0000008C
_SUB_HOUR                         000001D5
_SUB_MINUTE                       000001A2
_T0IE                             INTCON,T0IE
_T0IF                             INTCON,T0IF
_TB_CONT                          0000026D
_TB_LOCK                          00000262
_TB_UNLOCK                        00000268
_TB_WAIT                          00000255
_TEMPERATURE                      000003B7
_TEMPHIGH                         000003BB
_TEMP_CONT                        000003C1
_TEMP_DECR                        0000020E
_TEMP_INCR                        00000206
_TESTBATT_DONE                    0000040F
_TM1ENDEND                        0000032A
_TURN_LED1_OFF                    0000029E
_TURN_LED1_ON                     0000029A
_TURN_OFF_BL                      000002CC
MPASM  4.02 Released                               TXMAIN.ASM   12-29-2005  13:05:30         PAGE 73


SYMBOL TABLE
  LABEL                             VALUE 

_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_WRAP_HIGH                        00000214
_WRAP_ZERO                        0000020C
_XT_OSC                           00003FF9
__16F914                          00000001
main                              0000001B


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XX--XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
02C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
03C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
07C0 : ---------------- ---------------- ---------------- ------------XXXX
0800 : X--------------- ---------------- ---------------- ----------------
2000 : XXXX---X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:  1155
Program Memory Words Free:  2941


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,   137 suppressed

