MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;----------------------------------------------------------------
                      00002 ;Tranmitter / Remote control for an electric blanket.  
                      00003 ;Funtions: Write to the LCD, al1low setting of parameters,....
                      00004 ;
                      00005 ; Programmer:   Gino Isla for Lambda Sistemi, Milano
                      00006 ; Created:              21-10-2005      Version 1.0
                      00007 ; Clock:                4Mhz normal operation or 32KHz external during PWM period
                      00008 ; IDE:                  MPLAB v7.20
                      00009 ;Updates:
                      00010 ;----------------------------------------------------------------
                      00011 ;GI                     22-12-05        Add ":" blinking every second (new requirement)
                      00012 ;                                       Add new debounce timer for temperature changes so only the last 
                            one beeps
                      00013 ;----------------------------------------------------------------
                      00014 ;GI                     04-01-06        Add random seconds resend of SND_BOO_OFF_MSG
                      00015 ;----------------------------------------------------------------
                      00016 ;GI                     10-01-06        Random seconds resends optional, added #DEFINES
                      00017 ;----------------------------------------------------------------
                      00018 ;JC                     20-01-06        reminder to remove initial zero on visualized clock to be quoted
                             and built for
                      00019 ;                                       the next release fo this software
                      00020 ;----------------------------------------------------------------
                      00021 
                      00022         #include        <p16f914.inc>   ; processor specific variable definitions
                      00001         LIST
                      00002 ; P16F914.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00842         LIST
                      00023         #include        <Macros.inc>
                      00001 ;General macro definitions
                      00002 
                      00003 M_CMP_JE        macro   value1,value2,jumpto    ;value1 = value2?
                      00004                 movf    value1,w
                      00005                 xorwf   value2,w
                      00006                 btfsc   STATUS,Z
                      00007                 goto    jumpto
                      00008                 endm
                      00009 M_CMPL_JE       macro   value1,literal,jumpto   ;value1 = k?
                      00010                 movf    value1,w
                      00011                 xorlw   literal
                      00012                 btfsc   STATUS,Z
                      00013                 goto    jumpto
                      00014                 endm
                      00015 M_CMP_JNE       macro   value1,value2,jumpto    ;value1 <> value2?
                      00016                 movf    value1,w
                      00017                 xorwf   value2,w
                      00018                 btfss   STATUS,Z
                      00019                 goto    jumpto
                      00020                 endm
                      00021 M_CMPL_JNE      macro   value1,literal,jumpto   ;value1 <> k? WARNING: destroys WREG!
                      00022                 movf    value1,w
                      00023                 xorlw   literal
                      00024                 btfss   STATUS,Z
                      00025                 goto    jumpto
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00026                 endm
                      00027 
                      00028 
                      00029 M_CMPL_JGE      macro   value1,literal,jumpto   ;value1 >= k?
                      00030                 movlw   literal
                      00031                 subwf   value1,w                ;k-v1 >= 0
                      00032                 btfsc   STATUS,C
                      00033                 goto    jumpto
                      00034                 endm
                      00035 
                      00036 
                      00037 
                      00038 M_CMP_JG        macro   value1,value2,jumpto    ;value1 > value2?
                      00039                 movf    value2,w
                      00040                 subwf   value1,w        ;v1-v2 > 0
                      00041                 btfss   STATUS,C
                      00042                 goto    $+4
                      00043                 btfsc   STATUS,Z
                      00044                 goto    $+2
                      00045                 goto    jumpto
                      00046                 endm
                      00047 
                      00048 M_CMP_JGE       macro   value1,value2,jumpto    ;value1 >= value2?
                      00049                 movf    value2,w
                      00050                 subwf   value1,w        ;v1-v2 >= 0
                      00051                 btfsc   STATUS,C
                      00052                 goto    jumpto
                      00053                 endm
                      00054 
                      00055 M_CMP_JL        macro   value1,value2,jumpto    ;value1 < value2?
                      00056                 movf    value2,w
                      00057                 subwf   value1,w        ;v1-v2 < 0
                      00058                 btfss   STATUS,C
                      00059                 goto    jumpto
                      00060                 endm
                      00061 
                      00062 M_CMP_JLE       macro   value1,value2,jumpto    ;value1 <= value2?
                      00063                 movf    value1,w
                      00064                 subwf   value2,w        ;v2-v1 > 0
                      00065                 btfsc   STATUS,C
                      00066                 goto    $+2
                      00067                 btfsc   STATUS,Z
                      00068                 goto    jumpto
                      00069                 endm
                      00070 
                      00071 
                      00072 M_CMPL_JL       macro   value1,literal,jumpto   ;value1 < literal?
                      00073                 movf    value1,w
                      00074                 sublw   literal ;k-v1 < 0
                      00075                 btfss   STATUS,C
                      00076                 goto    $+4
                      00077                 btfsc   STATUS,Z
                      00078                 goto    $+2
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00079                 goto    jumpto
                      00080                 endm
                      00081 
                      00082 M_CMPL_JG       macro   value1,literal,jumpto   ;k-val1 < 0
                      00083                 movf    value1,w
                      00084                 sublw   literal
                      00085                 btfss   STATUS,C
                      00086                 goto    jumpto
                      00087                 endm
                      00088                 
                      00089 
                      00090 M_BANKSEL_0     macro
                      00091                 BCF     STATUS,6
                      00092                 BCF     STATUS,5
                      00093                 endm
                      00094 M_BANKSEL_1     macro
                      00095                 BCF     STATUS,6
                      00096                 BSF     STATUS,5
                      00097                 endm
                      00098 M_BANKSEL_2     macro
                      00099                 BSF     STATUS,6
                      00100                 BCF     STATUS,5
                      00101                 endm
                      00102 M_BANKSEL_3     macro
                      00103                 BSF     STATUS,6
                      00104                 BSF     STATUS,5
                      00105                 endm
                      00024         #include        <UTENZA.INC>
                      00001 
                      00002 
  0000012C            00003 LED1_ON_PERIOD                  EQU     .300    ;100÷7968 milliseconds;
  00000BB8            00004 LED1_OFF_PERIOD                 EQU     .3000   ;100÷7968 milliseconds;
                      00005 
                      00006 
  000000C8            00007 DEBOUNCE_NORMAL                 EQU     .200    ;100÷7968 milliseconds; debounce for all keys if not in 
                            autolock 
  000007D0            00008 DEBOUNCE_AUTOLOCK               EQU     .2000   ;100÷7968 milliseconds; debounce for MODE keys only if i
                            n autolock
                      00009 
                      00010 
                      00011         IF      DEBOUNCE_NORMAL < .150
                      00012         ERROR:"DEBOUNCE_NORMAL OUT OF RANGE"
                      00013         ENDIF
                      00014 
                      00015 
  000001F4            00016 BLINK_TIME                      EQU     .500    ;100÷7968 milliseconds; blinks when adjusting the clock
                      00017 
                      00018 
  0000001E            00019 AUTOLOCK_OFF_TIME               EQU     .30     ;1÷255  seconds
                      00020 
                      00021 
  0000001E            00022 BACKLIGHT_PERIOD                EQU     .30     ;1÷255  seconds
                      00023 
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00024 
  0000001E            00025 BOOST_PERIOD                    EQU     .30     ;1÷255  minutes
                      00026 
                      00027 
  0000012C            00028 HEAT_MSG_DELAY                  EQU     .300    ;100÷1000 milliseconds; delay before sending the last he
                            at message
                      00029 
                      00030 
  0000003C            00031 PERCENT_BATT_HIGH_THRESHLD      EQU     .60     ;1÷100  percent battery high threshold
  00000035            00032 PERCENT_BATT_LOW_THRESHLD       EQU     .53     ;1÷100  percent battery low threshold
                      00033 
                      00034 
  00000002            00035 REXMIT_NORMAL                   EQU     .2      ;1÷255  number of times to resend the message of tempera
                            ture
  00000003            00036 REXMIT_EXTEND                   EQU     .3      ;1÷255  number of times to resend the message of learn a
                            nd refresh
                      00025         #include        <TXHeader.h>
                      00001 ;
                      00002 ;********* make changes to LCD prescale here  ONLY ********************
  00000003            00003 LCD_PRESCALE    EQU             b'00000011'                     ;PRESCALE=4 (last 4 bits of LCDPS)
                      00004 ;*********************************************************************
                      00005 ;#DEFINE        WAVE_TYPE_A                                             ;type of WAVE determines, among 
                            other things, the number of
                      00006 #DEFINE         WAVE_TYPE_B                                             ; cycles we have to use to write
                             to the LCD
                      00007 ;*********************************************************************
                      00008 ;#DEFINE RANDMOM_REFRESH                                        ;random restranmission of the REFRESH_MS
                            G or
                      00009 ;                                                                                       ; COMMENTED OUT 
                            = rxmit REFRESH every 15 minutes
                      00010 ;#DEFINE RANDMOM_BOOST_OFF                                      ;random restranmission of BOOST_OFF or
                      00011 ;                                                                                       ; COMMENT OUT = 
                            rxmit at exactly 15 seconds
                      00012 ;*********************************************************************
  00000000            00013 WFT_A                           EQU     b'00000000'
  00000080            00014 WFT_B                           EQU     b'10000000'
  00000004            00015 MULTIPLEX                       EQU     .4                                      ;1/4 multiplex
                      00016 
  00000040            00017 LCD_FRAME_FREQ          EQU     .1024/(MULTIPLEX * (LCD_PRESCALE+1))    ;Hz
  000003E8            00018 MILLI                           EQU     .1000                                   ;
  00003D09            00019 LCD_FRAME_PERIOD        EQU     .1000*MILLI/LCD_FRAME_FREQ              ;in millisecs
                      00020 
                      00021 ;++++++++++++ This is the time base for this project (1/4 mpx) +++++++++++++++++++++++++++
  00007A12            00022 LCD_TICK                        EQU     LCD_FRAME_PERIOD*2                      ;
                      00023 ;++++++++++++ This is the time base for this project +++++++++++++++++++++++++++++++++++++
                      00024 
  00000009            00025 PW_ON_PERIOD            EQU     LED1_ON_PERIOD*MILLI/LCD_TICK           ;counts for a period of approx 3
                            00ms
  00000060            00026 PW_OFF_PERIOD           EQU     LED1_OFF_PERIOD*MILLI/LCD_TICK          ;counts for a period of approx 3
                             seconds
  00000006            00027 DEBOUNCE_PERIOD         EQU     DEBOUNCE_NORMAL*MILLI/LCD_TICK          ;debounce
                      00028 
                      00029         IF      DEBOUNCE_PERIOD < .150*MILLI/LCD_TICK
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00030         ERROR:"DEBOUNCE_PERIOD OUT OF RANGE"
                      00031         ENDIF
                      00032 
  00000040            00033 AUTOLOCK_DEBOUNCE       EQU     DEBOUNCE_AUTOLOCK*MILLI/LCD_TICK        ;2seconds
  0000000C            00034 HEAT_ADJ_DEBOUNCE       EQU     .400*MILLI/LCD_TICK                                     ;slow down conti
                            nuous heat adjustments
                      00035 
  00000010            00036 BLINK_PERIOD            EQU     BLINK_TIME*MILLI/LCD_TICK                       ;1/2 second blinks when 
                            adjusting the clock
                      00037 
                      00038 ;AUTOLOCK_OFF_TIME      EQU     .30                                                                     
                            ;in seconds
  0000003C            00039 SIXTY_MINUTES           EQU     .60                                                                     
                            ;
                      00040 ;BACKLIGHT_PERIOD       EQU     .30                                                                     
                            ;seconds
                      00041 
  0000000A            00042 MAX_TEMP                        EQU     .10                                                             
                                    ;max setting
                      00043 
                      00044 ;BOOST_PERIOD           EQU     .30                                                                     
                            ;minutes
  0000001E            00045 SEND_OFF_PERIOD         EQU     .30                                                                     
                            ;in minutes, repeat OFF msg
                      00046 
                      00047 #IFDEF RANDMOM_REFRESH
                      00048 SEND_ON_PERIOD          EQU     .720                                                            ;12 minu
                            tes + a random number 0:191secs for random repeat ON msg
                      00049 #ELSE
  00000384            00050 SEND_ON_PERIOD          EQU     .900                                                            ;fixed 1
                            5 minutes
                      00051 #ENDIF
                      00052 
  0000000F            00053 RESEND_BOOST_PERIOD     EQU     .15                                                                     
                            ;retransmit BOOST_OFF unless RANDOM_BOOST_OFF, see SECONDS_TASKS() )
                      00054 
  00000001            00055 MSG_PAUSE_PERIOD        EQU     .32*MILLI/LCD_TICK                                      ;30 ms betwwen r
                            epeats of the same message
                      00056 
  00000009            00057 HEAT_MSG_COUNTDWN       EQU     HEAT_MSG_DELAY*MILLI/LCD_TICK           ;delay before sending the last h
                            eat message
                      00058 
  00000099            00059 BATT_HIGH_THRESHLD      EQU     (PERCENT_BATT_HIGH_THRESHLD*.255)/.100  ;substitute the percent load (.6
                            5) by appropriate number
  00000087            00060 BATT_LOW_THRESHLD       EQU     (PERCENT_BATT_LOW_THRESHLD*.255)/.100   ;substitute the percent load (.4
                            0) by appropriate number
  0000000C            00061 IDLE_BATTERY_TEST       EQU     .12                                                                     
                                    ;number of HOURS in which to perform the battery test if no messages are sent
                      00062 
  00000020            00063 BLINK_2P_PERIOD         EQU     .1000*MILLI/LCD_TICK
                      00064 
  00000000            00065 CLKP_NOTHING            EQU     0
  00000001            00066 CLKP_1224                       EQU     1
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000002            00067 CLKP_MIN_ADJ            EQU     2
  00000003            00068 CLKP_HOUR_ADJ           EQU     3
  00000024            00069 CLKP_HOUR_DISP24        EQU     0x24                                    ;in BCD for displaying during ad
                            justments
  00000012            00070 CLKP_HOUR_DISP12        EQU     0x12                                    ;in BCD for displaying during ad
                            justments
  00000018            00071 CLKP_HOUR_24            EQU     .24                                     ;
  0000000C            00072 CLKP_HOUR_12            EQU     .12                                     ;
                      00073 ;
  00000000            00074 AUTO_OFF_OFF            EQU     .0                                      ;
  00000001            00075 AUTO_OFF_1HR            EQU     .1                                      ;in hours
  00000003            00076 AUTO_OFF_3HR            EQU     .3                                      ;
  0000000C            00077 AUTO_OFF_12HR           EQU     .12                                     ;
                      00078 
  00000030            00079 MESSAGE_LENGTH          EQU     .48                                     ;packet length
                      00080 ;REXMIT_NORMAL          EQU     .2                                      ;number of times to resend the m
                            essage
                      00081 ;REXMIT_EXTEND          EQU     .3                                      ;learn and refresh
                      00082 
                      00083 #define TXENBL_TRIS     TRISA,0                                 ;switch the TX_ENABLE port when not in u
                            se
                      00084 
                      00085 ;Port assignment
                      00086 #define TX_ENABLE       PORTA,0
                      00087 #define LCD7            PORTA,1
                      00088 #define COM2            PORTA,2
                      00089 #define KB0                     PORTA,3
                      00090 #define LCD4            PORTA,4
                      00091 #define LCD5            PORTA,5
                      00092 #define                         PORTA6  "NOT USED"
                      00093 #define                         PORTA7  "NOT USED"
                      00094 #define MASKTA          b'11000001'                                     ;TX_ENABLE in INPUT
                      00095 ;
                      00096 #define LCD0            PORTB,0
                      00097 #define LCD1            PORTB,1
                      00098 #define LCD2            PORTB,2
                      00099 #define LCD3            PORTB,3
                      00100 #define COM0            PORTB,4
                      00101 #define COM1            PORTB,5
                      00102 #define BACKLIGHT       PORTB,6
                      00103 #define LED1            PORTB,7
                      00104 #define MASKTB          b'00000000'
                      00105 ;
                      00106 #define                         PORTC0  "DONT KNOW"
                      00107 #define                         PORTC1  "DONT KNOW"
                      00108 #define                         PORTC2  "DONT KNOW"
                      00109 #define LCD6            PORTC,3
                      00110 #define LCD11           PORTC,4
                      00111 #define LCD10           PORTC,5
                      00112 #define LCD9            PORTC,6
                      00113 #define LCD8            PORTC,7
                      00114 #define MASKTC          b'00000111'
                      00115 ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00116 #define COM3            PORTD,0
                      00117 #define KB1                     PORTD,1
                      00118 #define KB2                     PORTD,2
                      00119 #define KB3                     PORTD,3
                      00120 #define KB4                     PORTD,4
                      00121 #define KB5                     PORTD,5
                      00122 #define KB6                     PORTD,6
                      00123 #define PWM_HCS         PORTD,7
                      00124 #define MASKTD          b'00111110'
                      00125 ;
                      00126 #define DEBUG_OUT       PORTE,0
                      00127 #define KB7                     PORTE,0
                      00128 #define KB8                     PORTE,1
                      00129 #define VDIODE          PORTE,2
                      00130 #define MCLR            PORTE,3
                      00131 #define MASKTE          b'11111110'
                      00132 
                      00133 ;******* FLAGS ********* LOOK OUT FOR BANK CHANGES *********************
                      00134 #DEFINE MINUTES                 LCD_CHAR1,0                     ; LCD_CHAR1 IS THE COMMON BANK
                      00135 #DEFINE HOURS                   LCD_CHAR1,1                     ;
                      00136 #DEFINE ONEHR                   LCD_CHAR1,2                     ;characters to be displayed in the LCD 
                      00137 #DEFINE THREEHR                 LCD_CHAR1,3                     ;
                      00138 #DEFINE TWELVEHR                LCD_CHAR1,4                     ;
                      00139 #DEFINE TEMPETR                 LCD_CHAR1,5                     ;
                      00140 #DEFINE LOCKED                  LCD_CHAR1,6                     ;
                      00141 #DEFINE BATTLOW                 LCD_CHAR1,7                     ;
                      00142 
                      00143 #DEFINE DEVON                   LCD_CHAR2,0                     ; LCD_CHAR2 IS IN THE COMMON BANK
                      00144 #DEFINE DEVOFF                  LCD_CHAR2,1                     ;
                      00145 #DEFINE BOOST                   LCD_CHAR2,2                     ;
                      00146 #DEFINE LCD_UPD                 LCD_CHAR2,3                     ;time to update the real time clock coun
                            ters
                      00147 #DEFINE LED1_STATE              LCD_CHAR2,4                     ;LED1 flashes for.3 secs/3secs
                      00148 #DEFINE PLUS_BUT                LCD_CHAR2,5                     ;
                      00149 #DEFINE MINUS_BUT               LCD_CHAR2,6                     ;
                      00150 #DEFINE ADJUST_RT               LCD_CHAR2,7                     ;
                      00151 
                      00152 #DEFINE DEBOUNCING              LCD_CHAR3,0                     ; LCD_CHAR3 IS IN BANK 0
                      00153 #DEFINE BTN_ACT_PDG             LCD_CHAR3,1                     ;button action in progress
                      00154 #DEFINE MODE_ACT                LCD_CHAR3,2                     ;on-going MODE change 
                      00155 #DEFINE CLCKSET_ACT             LCD_CHAR3,3                     ;now changing the clock
                      00156 #DEFINE UNLOCKING               LCD_CHAR3,4                     ;now in process of unlocking
                      00157 #DEFINE HEAT_ACT                LCD_CHAR3,5                     ;
                      00158 #DEFINE AUTOLOCK_ON     LCD_CHAR3,6                     ;
                      00159 #DEFINE RELOCK_ON               LCD_CHAR3,7                     ;
                      00160 
                      00161 #DEFINE SND_OFF_MSG             LCD_CHAR4,0                     ;LCD_CHAR4 IS IN BANK 0
                      00162 #DEFINE SND_ON_MSG              LCD_CHAR4,1                     ;messages to the base
                      00163 #DEFINE SND_BOOSTON_MSG LCD_CHAR4,2                     ;
                      00164 #DEFINE SND_BOO_OFF_MSG LCD_CHAR4,3                     ;
                      00165 #DEFINE SND_TEMP_MSG    LCD_CHAR4,4                     ;
                      00166 #DEFINE SND_LEARN_MSG   LCD_CHAR4,5                     ;
                      00167 #DEFINE SND_TEST_MSG    LCD_CHAR4,6                     ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00168 #DEFINE SND_REFRESH_MSG LCD_CHAR4,7
                      00169 
                      00170 #DEFINE BEEPER                  LCD_CHAR5,0                     ;LCD_CHAR5 IS IN  THE COMMON BANK
                      00171 #DEFINE BATTERY_WARN    LCD_CHAR5,1                     ;warnings for the battery charge level
                      00172 #DEFINE BATTERY_LOW             LCD_CHAR5,2                     ;
                      00173 #DEFINE BOOST_ACT               LCD_CHAR5,3                     ;pre-heat
                      00174 #DEFINE F_BODY_GUARD    LCD_CHAR5,4                     ;DISABLE KB0 CONTROL
                      00175 #DEFINE COLON                   LCD_CHAR5,5                     ;late requirement, blink ":" every secon
                            d
                      00176 #DEFINE F_SEND_BOOFF    LCD_CHAR5,6                     ;counts seconds for send and re-send of PREHEAT-
                            OFF MSG
                      00177 #DEFINE F_RESEND_BOOFF  LCD_CHAR5,7                     ;
                      00178 
                      00179 ;
                      00180 #DEFINE SPARE                   NEW_BUTTON_CONFIG,0             ;KB8
                      00181 #DEFINE PREHEAT                 NEW_BUTTON_CONFIG,1             ;KB1
                      00182 #DEFINE MODE                    NEW_BUTTON_CONFIG,2             ;KB2    
                      00183 #DEFINE MINUS                   NEW_BUTTON_CONFIG,3             ;KB3
                      00184 #DEFINE PLUS                    NEW_BUTTON_CONFIG,4             ;KB4
                      00185 #DEFINE CLOCK_SET               NEW_BUTTON_CONFIG,5             ;KB5
                      00186 #DEFINE S_KB6                   NEW_BUTTON_CONFIG,6
                      00187 #DEFINE S_KB7                   NEW_BUTTON_CONFIG,7
                      00188 
                      00189 
                      00190 
                      00191 
                      00026 
                      00027 ;********************** INCLUDE FOR TX HANDLING **************************
                      00028 ;        #include   <hcs_tx.inc> AT THE BOTTOM OF THIS CODE
                      00029 ;********************** INCLUDE FOR TX HANDLING **************************
                      00030 
                      00031         
2007   3CE4           00032         __CONFIG _FCMEN_ON & _IESO_ON & _CP_OFF & _WDT_OFF & _BOD_OFF & _MCLRE_ON & _PWRTE_ON & _INTRC_O
                            SC_NOCLKOUT
2000   0000 0001 0001 00033         __IDLOCS        0110    ;1.1.0
       0000 
                      00034         ERRORLEVEL -302
                      00035 
                      00036 
                      00037 ;******* INTERRUPT FLAGSS *************************************************
                      00038 #DEFINE TMR1_IF         PIR1,TMR1IF     ;(0) TMR1 INTERRUPT OCCURRED
                      00039 #DEFINE LCD_IF          PIR2,LCDIF      ;(4) LCD INTERRUPT OCCURRED
                      00040 ;******* ADCON0 *************************************************
                      00041 #DEFINE GO_DONE         ADCON0,1        ;(1)    1 = CONVERSION IN PROGRESS                              
                                                            
                      00042                                                                 ;               0 = CONVERSION DONE
                      00043 ;******* FOR INCLUDED CODE TX_HCS ******************************
                      00044 #DEFINE TMR_HCS_ON      _TMR1ON
                      00045 ;definitions for TX_HCS:
                      00046 #DEFINE BANK1   BSF     STATUS,RP0
                      00047 #DEFINE BANK0   BCF     STATUS,RP0
                      00048 #DEFINE RAM1    BSF     STATUS,RP0
                      00049 #DEFINE RAM0    BCF     STATUS,RP0
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00050 #DEFINE RAM_1   BSF     STATUS,RP0
                      00051 #DEFINE RAM_0   BCF     STATUS,RP0
                      00052 #DEFINE SET     BSF
                      00053 #DEFINE CANC    BCF
                      00054 #DEFINE SC      BTFSC
                      00055 #DEFINE SS      BTFSS
                      00056 #DEFINE IFSET   BTFSC
                      00057 #DEFINE IFCANC  BTFSS
                      00058 #DEFINE SKPB    SKPNC
                      00059 #DEFINE SKPNB   SKPC
                      00060 #DEFINE FW      MOVFW
                      00061 #DEFINE WF      MOVWF
                      00062 #DEFINE LW      MOVLW
                      00063 ;*** INTCON ***
                      00064 #DEFINE _INTE   INTCON,INTE
                      00065 #DEFINE _INTF   INTCON,INTF
                      00066 #DEFINE _GIE    INTCON,GIE
                      00067 #DEFINE _T0IE   INTCON,T0IE
                      00068 #DEFINE _T0IF   INTCON,T0IF
                      00069 #DEFINE _PEIE   INTCON,PEIE
                      00070 
                      00071 #DEFINE TRASMISSIONE_HCS        FLAGS_HCS,0     ;
                      00072 #DEFINE ALTO1_BASSO0            FLAGS_HCS,1     ;FLAG DA INVERTIRE CHE DETERMINA TE2
                      00073 
                      00074 ;#DEFINE        PWM_HCS         PORTD,7 ;PIN DI TRASMISSIONE HCS  <== new in electric blanket
                      00075 
                      00076 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00077 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00078 ;+++++++++++++++++++++++ DATA +++++++++++++++++++++++++++++++++++++++++
                      00079 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00080 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00081 
                      00082 ;BANK 0 VARIABLES *****************************************************
                      00083                 CBLOCK  020H
  00000020            00084 TEMP_BYT0_B0                                    ;general purpose for bank0
  00000021            00085 TEMP_BYT1_B0                                    ;general purpose for bank0
  00000022            00086 LED1_CLOCK                                      ;
  00000023            00087 RT_SECONDS                                      ;real time seconds counter
  00000024            00088 RT_MINUTES                                      ;       "               minutes   "
  00000025            00089 RT_HOURS                                        ;       "               hours     "
  00000026            00090 DEBOUNCE_CNT                                    ;debounce count
  00000027            00091 BACKLIGHT_CNT                                   ;
  00000028            00092 BLINK_COUNT                                     ;delay for blinking the display
  00000029            00093 NEW_BUTTON_CONFIG                               ;configuration of the buttons when they are read
  0000002A            00094 OLD_BUTTON_CONFIG                               ;OLD configuration of the buttons
  0000002B            00095 LCD_CHAR3                                       ;all purpose flags
  0000002C            00096 LCD_CHAR4                                       ;more flags
  0000002D            00097 ADJUST_CLK_PHASE                                ;
  0000002E            00098 MAX_HOURS                                       ;CLOCK turn over
  0000002F            00099 RE_LOCK_TIME                                    ;RE LOCK TIMER
  00000030            00100 AUTO_OFF_HOURS                                  ;1, 3 or 12 hr AUTO SHUT-OFF timer
  00000031            00101 AUTO_OFF_MINUTES                                ;AUTO SHUT-OFF minutes count down
  00000032            00102 BOOST_MINUTES                                   ;minutes, counter of PRE-HEAT minutes
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000033            00103 BOOST_SECONDS                                   ;seconds counter PRE-HEAT seconds
  00000034            00104 SAVED_TEMPERATURE                               ;save the temp when AUTO-OFF timer is is turned off
  00000035            00105 PRE_MESSAGE_TIMER                               ;wait time before sending a HEAT message
  00000036            00106 REXMIT_COUNT                                    ;
  00000037            00107 RESEND_OFF_COUNT                                ;counter for resending the OFF msg (15')
  00000038            00108 RESEND_ON_COUNT_L                               ;counter for resending the ON msg (15' -> 900secs)
  00000039            00109 RESEND_ON_COUNT_H                               ;
  0000003A            00110 PAUSE_COUNT                                     ;counter delays in
  0000003B            00111 BATTERY_BLINK_COUNT                             ;counter blinks the battery segment
  0000003C            00112 IDLE_BATT_COUNT                                 ;number of hours after which the test message is sent wh
                            en no other tranmissions
  0000003D            00113 BAT_OFF_MSG_COUNT                               ;this is a stop to endless sends of the OFF msg on low b
                            attery.
  0000003E            00114 TMR_1SECOND                                     ;one second counter to be used TMR2
                      00115 ;=====================================================
                      00116 ; BUFFER DI TRASMISSIONE HCS
  0000003F            00117 HCS1                                            ;reserved(7:5), left/right side (4),serial number high (
                            3:0)
  00000040            00118 HCS2                                            ;serial number(7:0)
  00000041            00119 HCS3                                            ;serial number(7:0)
  00000042            00120 HCS4                                            ;serial number(7:0) low
  00000043            00121 HCS5                                            ;level(7:3),beep(2),learn(1), padding(0)
  00000044            00122 HCS6                                            ;checksum
  00000045            00123 FLAGS_HCS
  00000046            00124 FASE_TX_HCS
  00000047            00125 CARICA_TIMER_HCS_HI
  00000048            00126 CARICA_TIMER_HCS_LO
  00000049            00127 PUNTA_HCS
  0000004A            00128 COUNT_BIT
  0000004B            00129 TEMP_ROTATE
  0000004C            00130 COUNT_PREAMBOLO
  0000004D            00131 BI_STATUS
  0000004E            00132 BI_PCLATH
  0000004F            00133 BI_FSR
                      00134                 ENDC
                      00135 
                      00136 ;COMMON DATA            **************************************************
                      00137                 CBLOCK  71H
  00000071            00138 LCD_CHAR1                                       ;flags to discriminate characters in the display
  00000072            00139 LCD_CHAR2                                       ;all purpose flags
  00000073            00140 LCD_CHAR5                                       ;more flags (MISC, NOT USED)
  00000074            00141 MIN_VALUE                                       ;minutes to write on the display [0:60]
  00000075            00142 HOUR_VALUE                                      ;hours to write on the display [0:24]
  00000076            00143 TMPTR_VALUE                                     ;temperature to write on the display [0:24]
  00000077            00144 BI_WREG                                         ;save wreg in ISR
                      00145                 ENDC
                      00146 
                      00147 ;BANK 2 VARIABLES       **************************************************
                      00148                 CBLOCK  0120H
  00000120            00149 WR_ERRORS                                       ;
  00000121            00150 WR_NOERRORS                                     ;
  00000122            00151 TOGGLE_LCD                                      ;
  00000123            00152 TEMP_BYT0_B2                                    ;general purpose for bank2
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000124            00153 TEMP_BYT1_B2                                    ;general purpose for bank2
                      00154                 ENDC
                      00155 
                      00156 ;-- ALIAS HCS_TX -------------------------------------------------------------
                      00157 
                      00158 
  00000001            00159 TMR_HCS EQU     TMR0
  0000004C            00160 HEADER_COUNT    EQU     COUNT_PREAMBOLO
  0000004C            00161 COUNT_DATA      EQU     COUNT_PREAMBOLO
                      00162 
                      00163 ;Uncomment to work with ICD2 +++++++++
                      00164 ;#DEFINE DEBUG
                      00165                                                 ;
0000                  00166         ORG     0x000                           ; processor reset vector
0000   018A           00167         clrf    PCLATH                          ; ensure page bits are cleared
0001   281B           00168         goto    main                            ; go to beginning of program
                      00169 
                      00170 ;       ERROR   "MISSING MODIFY: INITAL ZERO ON CLOCK"
                      00171 
                      00172                                                 ;
                      00173                                                 ;
0004                  00174         org     0x04                            ;
0004                  00175 PUSH:                                           ;
0004   00F7           00176         WF      BI_WREG                         ;COPIA DEL WREG
0005   0E03           00177         SWAPF   STATUS,W                        ;COPIA DELLO STATUS
                      00178         M_BANKSEL_0
0006   1303               M                 BCF     STATUS,6
0007   1283               M                 BCF     STATUS,5
0008   00CD           00179         MOVWF   BI_STATUS
0009   080A           00180         FW      PCLATH
000A   00CE           00181         WF      BI_PCLATH
000B   0804           00182         FW      FSR
000C   00CF           00183         WF      BI_FSR
000D   2B33           00184         B       INTERRUPT
                      00185 
                      00186 
                      00187 ;Begining of executable code    ;
                      00188 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00189 ;Jump table for drawing a character in the LCD
                      00190 ;bit sequence is:  -gfedcba
                      00191 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
000E                  00192 DIGIT_SELECT                                    ;
000E   0782           00193         ADDWF   PCL,F                           ;
000F   343F           00194         RETLW   b'00111111'                     ;"0"            
0010   3406           00195         RETLW   b'00000110'                     ;"1"
0011   345B           00196         RETLW   b'01011011'                     ;"2"            
0012   344F           00197         RETLW   b'01001111'                     ;"3"
0013   3466           00198         RETLW   b'01100110'                     ;"4"
0014   346D           00199         RETLW   b'01101101'                     ;"5"
0015   347D           00200         RETLW   b'01111101'                     ;"6"
0016   3407           00201         RETLW   b'00000111'                     ;"7"
0017   347F           00202         RETLW   b'01111111'                     ;"8"
0018   346F           00203         RETLW   b'01101111'                     ;"9"
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0019   3438           00204         RETLW   b'00111000'                     ;"L" (value=10)
001A   3476           00205         RETLW   b'01110110'                     ;"H" (value=11)
                      00206 
                      00207 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00208 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00209 ;++++++++++++++   Start of the Program   ++++++++++++++++++++++++++++++
                      00210 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00211 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
001B                  00212 main                                            ;
                      00213         M_BANKSEL_0                             ;bank 0
001B   1303               M                 BCF     STATUS,6
001C   1283               M                 BCF     STATUS,5
001D   0064           00214         CLRWDT                                  ;
                      00215                                                 ;
001E   3000           00216         MOVLW   b'00000000'                     ;gie off, peripherals off,tmr0 off,RB0 and RB changes of
                            f,flags off
001F   008B           00217         MOVWF   INTCON                          ;
0020   0185           00218         CLRF    PORTA                           ;
0021   0186           00219         CLRF    PORTB                           ;
0022   0187           00220         CLRF    PORTC                           ;
0023   0188           00221         CLRF    PORTD                           ;
0024   0189           00222         CLRF    PORTE                           ;
0025   018C           00223         CLRF    PIR1                            ;clear all interrupt flags
0026   018D           00224         CLRF    PIR2                            ;clear all interrupt flags .......including LCDPS,WA
                      00225                                                 ;
0027   300F           00226         MOVLW   b'00001111'                     ;gate off, 1:1 PS, no sync extr clock,tmr1 on
0028   0090           00227         MOVWF   T1CON                           ;
                      00228                                                 ;
0029   241E           00229         CALL    CLEAR_RAM_0                     ;
002A   2427           00230         CALL    CLEAR_RAM_1                     ;
                      00231                                                 ;       
002B   300C           00232         MOVLW   CLKP_HOUR_12                    ;
002C   00AE           00233         MOVWF   MAX_HOURS                       ;
                      00234                                                 ;
                      00235 ;A/D CONVERTER                                  ;
002D   301C           00236         MOVLW   b'00011100'                     ;LEFT justified,vref,read AN7,A/D powered OFF
002E   009F           00237         MOVWF   ADCON0                          ;
                      00238                                                 ;
                      00239         M_BANKSEL_1                             ;
002F   1303               M                 BCF     STATUS,6
0030   1683               M                 BSF     STATUS,5
0031   3080           00240         MOVLW   b'10000000'                     ;Select AN7 (RE2) analogue input for low battery detecti
                            on
0032   0091           00241         MOVWF   ANSEL                           ;
                      00242                                                 ;
0033   3050           00243         MOVLW   b'01010000'                     ;fosc/16 for conversion
0034   009F           00244         MOVWF   ADCON1                          ;
                      00245                                                 ;
0035   3007           00246         MOVLW   .7                              ;
0036   009C           00247         MOVWF   CMCON0                          ;OFF
                      00248                                                 ;
0037   3061           00249         MOVLW   b'01100001'                     ;4MHz clock,dev is running from int clk,int osc for syst
                            em clock
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0038   008F           00250         MOVWF   OSCCON                          ;
0039   3000           00251         MOVLW   b'00000000'                     ;TMR1 interrupts DISABLED, TMR1IF flag will be polled fo
                            r seconds roll-over
                      00252 ;interrupts and ports                           ;
003A   008C           00253         MOVWF   PIE1                            ;
003B   3000           00254         MOVLW   b'00000000'                     ;LCD interrupt disabled
003C   008D           00255         MOVWF   PIE2                            ;
003D   30C1           00256         MOVLW   MASKTA                          ;
003E   0085           00257         MOVWF   TRISA                           ;
003F   3000           00258         MOVLW   MASKTB                          ;
0040   0086           00259         MOVWF   TRISB                           ;
0041   3007           00260         MOVLW   MASKTC                          ;
0042   0087           00261         MOVWF   TRISC                           ;
0043   303E           00262         MOVLW   MASKTD                          ;
0044   0088           00263         MOVWF   TRISD                           ;
0045   30FE           00264         MOVLW   MASKTE                          ;
0046   0089           00265         MOVWF   TRISE                           ;
                      00266                                                 ;
0047   3080           00267         MOVLW   b'10000000'                     ;no pullups, tmr0 internal, prescale assigned to tmr0,<2
                            :0>=PS tmr0 = 1:2
0048   0081           00268         MOVWF   OPTION_REG                      ;PortA pullups disabled
                      00269                                                 ;
                      00270 ;LCD control registers                          ;
                      00271         M_BANKSEL_2                             ;
0049   1703               M                 BSF     STATUS,6
004A   1283               M                 BCF     STATUS,5
004B   01A0           00272         CLRF    WR_ERRORS                       ;
004C   01A1           00273         CLRF    WR_NOERRORS                     ;
004D   01A2           00274         CLRF    TOGGLE_LCD                      ;
004E   3017           00275         MOVLW   b'00010111'                     ;lcd off, on when sleep,no write error,VLCD enabled,TMR1
                             is source clk,1/4 common
004F   0087           00276         MOVWF   LCDCON                          ; 
                      00277                                                 ;
0050   3080           00278         MOVLW   b'10000000'                     ;waveform B(1),bias 1/3 for 1/4 mux,
0051   3803           00279         IORLW   LCD_PRESCALE                    ;add the prescaler (see TXHeader.h)
0052   0088           00280         MOVWF   LCDPS                           ;  --- with 1:2 PS
                      00281                                                 ;
                      00282 #IFDEF  WAVE_TYPE_B                             ;
0053   3080           00283         MOVLW   WFT_B                           ;waveform B(1),bias 1/3 for 1/4 mux,
                      00284 #ELSE                                           ;
                      00285         MOVLW   WFT_A                           ;waveform A(0),bias 1/3 for 1/4 mux,
                      00286 #ENDIF                                          ;
0054   0488           00287         IORWF   LCDPS,F                         ;
                      00288                                                 ;
0055   30FF           00289         MOVLW   b'11111111'                     ;Sements (7:0) all LCD segments enabled
0056   009C           00290         MOVWF   LCDSE0                          ;
                      00291 #IFDEF DEBUG                                    ;
                      00292         MOVLW   b'11101111'                     ; DEBUG - RB5 and RB6 for ICD2, seg15 <bit5> problems
                      00293 #ELSE                                           ;
0057   300F           00294         MOVLW   b'00001111'                     ;Sements (15:8)  THIS ARE THE REAL FLAGS !!!!!!!!!!
                      00295 #ENDIF                                          ;
0058   009D           00296         MOVWF   LCDSE1                          ;
0059   019E           00297         CLRF    LCDSE2                          ;Sements (23:16) all IO pins ********* LCDSE2 doesn't ex
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ist in 16F913 ***
                      00298                                                 ;
005A   3012           00299         MOVLW   b'00010010'                     ;WDT PS 1:16K, software enable off
005B   0085           00300         MOVWF   WDTCON                          ;
005C   0190           00301         CLRF    LCDDATA0                        ;all segments dark
005D   0191           00302         CLRF    LCDDATA1                        ;
005E   0193           00303         CLRF    LCDDATA3                        ;******** LCDDATA2,LCDDATA5, LCDDATA8 and LCDDATA11 don'
                            t exist in 6F913 ***
005F   0194           00304         CLRF    LCDDATA4                        ;
0060   0196           00305         CLRF    LCDDATA6                        ;
0061   0197           00306         CLRF    LCDDATA7                        ;
0062   0199           00307         CLRF    LCDDATA9                        ;
0063   019A           00308         CLRF    LCDDATA10                       ;
0064   1787           00309         BSF     LCDCON,LCDEN                    ;
                      00310                                                 ;
                      00311         M_BANKSEL_0                             ;
0065   1303               M                 BCF     STATUS,6
0066   1283               M                 BCF     STATUS,5
0067   3060           00312         MOVLW   PW_OFF_PERIOD                   ;LED1 initialized to OFF
0068   00A2           00313         MOVWF   LED1_CLOCK                      ;
0069   1585           00314         BSF     KB0                             ;buttons disabled
006A   3003           00315         MOVLW   b'00000011'                     ;display hours, minutes
006B   00F1           00316         MOVWF   LCD_CHAR1                       ;
006C   3002           00317         MOVLW   b'00000010'                     ;display device OFF
006D   00F2           00318         MOVWF   LCD_CHAR2                       ;Initialize some more local data
006E   16F3           00319         BSF     COLON                           ;display ":"
006F   15F2           00320         BSF     LCD_UPD                         ;
                      00321                                                 ;
0070   172C           00322         BSF     SND_TEST_MSG                    ;Test the batery by sending a test message
0071   300C           00323         MOVLW   IDLE_BATTERY_TEST               ; and reload the counter
0072   00BC           00324         MOVWF   IDLE_BATT_COUNT                 ;
0073   3001           00325         MOVLW   1                               ;
0074   00BD           00326         MOVWF   BAT_OFF_MSG_COUNT               ;
0075   3020           00327         MOVLW   BLINK_2P_PERIOD                 ;
0076   00BE           00328         MOVWF   TMR_1SECOND                     ;
0077   3006           00329         MOVLW   b'00000110'                     ;start timer 2
0078   0092           00330         MOVWF   T2CON                           ;1 second blink of the ":", POSTSCALE 1:1, POSTCALE 1:16
                            , TMR2 OFF
                      00331 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00332 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00333 ;+++++++++++++++++++++   Main Loop ++++++++++++++++++++++++++++++++++++
                      00334 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00335 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0079                  00336 _SNOOZE:                                        ;
                      00337         M_BANKSEL_0                             ;
0079   1303               M                 BCF     STATUS,6
007A   1283               M                 BCF     STATUS,5
                      00338 ;       BCF     DEBUG_OUT                       ;
007B   1845           00339         BTFSC   TRASMISSIONE_HCS                ;if TRASMISSIONE_HCS is set, we're still transmitting
007C   288C           00340         GOTO    _STAY_UP                        ;
007D   18AB           00341         BTFSC   BTN_ACT_PDG                     ;if there is an on-going button action, don't sleep
007E   288C           00342         GOTO    _STAY_UP                        ;
                      00343                                                 ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

007F   0000           00344         NOP                                     ;
0080   138B           00345         BCF     INTCON,GIE                      ;
0081   170B           00346         BSF     INTCON,PEIE                     ;
0082   1683           00347         BSF     STATUS,5                        ;BANK 1
0083   160D           00348         BSF     PIE2,LCDIE                      ;set LCD ints to wake up
0084   0000           00349         NOP                                     ;
0085   0000           00350         NOP                                     ;       
                      00351                                                 ;
                      00352         #IFNDEF DEBUG                           ;
0086   0063           00353         SLEEP                                   ;
                      00354         ELSE                                    ;
                      00355         NOP                                     ;
                      00356         #ENDIF                                  ;
0087   0000           00357         NOP                                     ;
0088   0000           00358         NOP                                     ;
0089   120D           00359         BCF     PIE2,LCDIE                      ;
008A   1283           00360         BCF     STATUS,5                        ;BANK 0
008B   130B           00361         BCF     INTCON,PEIE                     ;
008C                  00362 _STAY_UP                                        ;
008C   1E0D           00363         BTFSS   LCD_IF                          ;wait here for lcd interrupt flag
008D   288C           00364         GOTO    _STAY_UP                        ;
                      00365                                                 ;
008E   0000           00366         NOP                                     ;
                      00367 ;       bsf     DEBUG_OUT                       ;
008F   0000           00368         NOP                                     ;
0090   1C45           00369         BTFSS   TRASMISSIONE_HCS                ;if TRASMISSIONE_HCS is set, we're transmitting somethin
                            g, 
0091   20A2           00370         CALL    SEND_MESSAGES                   ; so do other jobs
                      00371                                                 ;
0092   22AD           00372         CALL    SECONDS_TASKS                   ;
0093   2347           00373         CALL    UPDATE_LCD                      ;finish any display that may be pending because of even/
                            odd frames
0094   22D5           00374         CALL    REAL_TIME_SERVICES              ;see if TMR1 expired in the meantime
                      00375                                                 ;
0095   303E           00376         MOVLW   b'00111110'                     ;handle ALL ACTIONS which are in progress
0096   052B           00377         ANDWF   LCD_CHAR3,W                     ;
0097   1D03           00378         BTFSS   STATUS,Z                        ;
0098   2108           00379         CALL    HANDLE_BUTTONS                  ;
                      00380                                                 ;
0099   1973           00381         BTFSC   BATTERY_LOW                     ;block all actions when the batteries are low
009A   2879           00382         GOTO    _SNOOZE                         ;
009B   1CAB           00383         BTFSS   BTN_ACT_PDG                     ;accept new jobs only if no other job is pending
009C   2249           00384         CALL    TEST_BUTTONS                    ;
                      00385                                                 ;
009D   2324           00386         CALL    DISPLAY_REAL_TIME               ;Load Real Time variables for display in the LCD
009E   228C           00387         CALL    MANAGE_LED1                     ;
009F   229B           00388         CALL    TREAT_BATTERY_DISPLAY           ;
00A0   2347           00389         CALL    UPDATE_LCD                      ;
00A1   2879           00390         GOTO    _SNOOZE                         ;
                      00391 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00392 ;Handles message sending to the BASE unit. 
                      00393 ;BEEPER bit must be in the correct state
                      00394 ;Message layout:
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00395 ;HCS1   BIT 7÷5         0               RESERVED, FORCED TO ZERO
                      00396 ;HCS1   BIT 4           0÷1             LEFT/RIGHT SIDE
                      00397 ;HCS1   BIT 3÷0         0÷F             SERIAL NUMBER HIGH
                      00398 ;HCS2   BIT 7÷0         00÷FF           SERIAL NUMBER
                      00399 ;HCS3   BIT 7÷0         00÷FF           SERIAL NUMBER
                      00400 ;HCS4   BIT 7÷0         00÷FF           SERIAL NUMBER LOW
                      00401 ;HCS5   BIT 7÷3         00÷0A           LEVEL CODE
                      00402 ;HCS5   BIT 2           0÷1             BEEPER
                      00403 ;HCS5   BIT 1           0-1             LEARN MODE ON/OFF
                      00404 ;HCS5   BIT 0           0               PADDING
                      00405 ;HCS6   BIT 7÷0         00÷FF           CHECKSUM
                      00406 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
00A2                  00407 SEND_MESSAGES                                   ;
00A2   1845           00408         BTFSC   TRASMISSIONE_HCS                ;If we are not finished xmitting, leave
00A3   2907           00409         GOTO    _MSG_FIN                        ;don't start a new one
00A4   08B6           00410         MOVF    REXMIT_COUNT,F                  ;
00A5   1903           00411         BTFSC   STATUS,Z                        ;If we are in the procees of retranmitting
00A6   28AC           00412         GOTO    _NEW_MSG                        ; go re-send the last message (already in HCSx)
00A7   0BBA           00413         DECFSZ  PAUSE_COUNT,F                   ;
00A8   2907           00414         GOTO    _MSG_FIN                        ;
00A9   0BB6           00415         DECFSZ  REXMIT_COUNT,F                  ;
00AA   28FA           00416         GOTO    _RE_SEND                        ;
00AB   2907           00417         GOTO    _MSG_FIN                        ;
                      00418                                                 ;
00AC                  00419 _NEW_MSG                                        ; else
00AC   1C2C           00420         BTFSS   SND_OFF_MSG                     ;check if there are NEW messages to send
00AD   28B1           00421         GOTO    _ON_MSG                         ;
00AE   3000           00422         MOVLW   .0                              ;tempertature = 0
00AF   102C           00423         BCF     SND_OFF_MSG                     ;
00B0   28CC           00424         GOTO    _MSG_CONT1                      ;
00B1                  00425 _ON_MSG                                         ;
00B1   1CAC           00426         BTFSS   SND_ON_MSG                      ;
00B2   28B6           00427         GOTO    _REFRESH_MSG                    ;
00B3   0876           00428         MOVF    TMPTR_VALUE,W                   ;temperature = new temperature
00B4   10AC           00429         BCF     SND_ON_MSG                      ;
00B5   28CC           00430         GOTO    _MSG_CONT1                      ;
00B6                  00431 _REFRESH_MSG                                    ;
00B6   1FAC           00432         BTFSS   SND_REFRESH_MSG                 ;
00B7   28BB           00433         GOTO    _BOOST_ON_MSG                   ;temperature = real temperature
00B8   0876           00434         MOVF    TMPTR_VALUE,W                   ;
00B9   13AC           00435         BCF     SND_REFRESH_MSG                 ;
00BA   28D0           00436         GOTO    _MSG_CONT2                      ;do 5 repetitions
00BB                  00437 _BOOST_ON_MSG                                   ;
00BB   1D2C           00438         BTFSS   SND_BOOSTON_MSG                 ;
00BC   28C0           00439         GOTO    _BOOST_OFF_MSG                  ;
00BD   300A           00440         MOVLW   .10                             ;temperature = max temperature
00BE   112C           00441         BCF     SND_BOOSTON_MSG                 ;
00BF   28CC           00442         GOTO    _MSG_CONT1                      ;
00C0                  00443 _BOOST_OFF_MSG                                  ;
00C0   1DAC           00444         BTFSS   SND_BOO_OFF_MSG                 ;
00C1   28C5           00445         GOTO    _SND_LEARN_MSG                  ;
00C2   0876           00446         MOVF    TMPTR_VALUE,W                   ;temperature = real temperature
00C3   11AC           00447         BCF     SND_BOO_OFF_MSG                 ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00C4   28CC           00448         GOTO    _MSG_CONT1                      ;
00C5                  00449 _SND_LEARN_MSG                                  ;
00C5   1EAC           00450         BTFSS   SND_LEARN_MSG                   ;
00C6   28C9           00451         GOTO    _SND_TEST_MSG                   ;we need the SND_LEARN_MSG flag down below
00C7   3000           00452         MOVLW   .0                              ;temperature = 0 (don't care)
00C8   28D0           00453         GOTO    _MSG_CONT2                      ;5 repetitions
00C9                  00454 _SND_TEST_MSG                                   ;
00C9   1F2C           00455         BTFSS   SND_TEST_MSG                    ;if this is a test message, we will load all the
00CA   2907           00456         GOTO    _MSG_FIN                        ; message parameters but corrupt the checksum to make
00CB   3000           00457         MOVLW   .0                              ;
                      00458                                                 ; sure the test message is not used by the base
00CC                  00459 _MSG_CONT1                                      ;
00CC   00A0           00460         MOVWF   TEMP_BYT0_B0                    ;save temperature level whiche is in WREG in temp_byt
00CD   3002           00461         MOVLW   REXMIT_NORMAL                   ;new message is ready to send
00CE   00B6           00462         MOVWF   REXMIT_COUNT                    ;Load the repeat counter
00CF   28D3           00463         GOTO    _MSG_CONT3                      ;
                      00464                                                 ;
00D0                  00465 _MSG_CONT2                                      ;
00D0   00A0           00466         MOVWF   TEMP_BYT0_B0                    ;save temperature level whiche is in WREG in temp_byt
00D1   3003           00467         MOVLW   REXMIT_EXTEND                   ;new message is ready to send
00D2   00B6           00468         MOVWF   REXMIT_COUNT                    ;Load the repeat counter                                
                                                            ;
                      00469                                                 ;
00D3                  00470 _MSG_CONT3                                      ;
00D3   0DA0           00471         RLF     TEMP_BYT0_B0,F                  ;now pack the temperature
00D4   0DA0           00472         RLF     TEMP_BYT0_B0,F                  ;and
00D5   0DA0           00473         RLF     TEMP_BYT0_B0,F                  ;
00D6   30F8           00474         MOVLW   0xF8                            ;clear padding bit
00D7   0520           00475         ANDWF   TEMP_BYT0_B0,W                  ;
00D8   00C3           00476         MOVWF   HCS5                            ;and
00D9   1873           00477         BTFSC   BEEPER                          ;
00DA   1543           00478         BSF     HCS5,2                          ;load beeper
00DB   1AAC           00479         BTFSC   SND_LEARN_MSG                   ;and
00DC   14C3           00480         BSF     HCS5,1                          ;learn bits
                      00481                                                 ;
00DD   1073           00482         BCF     BEEPER                          ;
00DE   12AC           00483         BCF     SND_LEARN_MSG                   ;flags can now be cleared
                      00484                                                 ;
00DF   27FF           00485         CALL    GET_SERIAL_0                    ;msb
00E0   00A0           00486         MOVWF   TEMP_BYT0_B0                    ;
00E1   300F           00487         MOVLW   0x0F                            ;msb is 1 nibble only
00E2   0520           00488         ANDWF   TEMP_BYT0_B0,W                  ;
00E3   04BF           00489         IORWF   HCS1,F                          ;
                      00490                                                 ;
00E4   27FE           00491         CALL    GET_SERIAL_1                    ;next msb
00E5   00C0           00492         MOVWF   HCS2                            ;
00E6   27FD           00493         CALL    GET_SERIAL_2                    ;next msb
00E7   00C1           00494         MOVWF   HCS3                            ;
00E8   27FC           00495         CALL    GET_SERIAL_3                    ;lsb
00E9   00C2           00496         MOVWF   HCS4                            ;
00EA   123F           00497         BCF     HCS1,4                          ;Future LEFT/RIGHT indication
                      00498                                                 ;
00EB   01C4           00499         CLRF    HCS6                            ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00EC   303F           00500         MOVLW   HCS1                            ;calculate checksum
00ED   0084           00501         MOVWF   FSR                             ;
00EE   3005           00502         MOVLW   .5                              ;
00EF   00A0           00503         MOVWF   TEMP_BYT0_B0                    ;
00F0                  00504 _CHKSUM_LOOP                                    ;
00F0   0800           00505         MOVF    INDF,W                          ;
00F1   07C4           00506         ADDWF   HCS6,F                          ;
00F2   0A84           00507         INCF    FSR,F                           ;
00F3   0BA0           00508         DECFSZ  TEMP_BYT0_B0,F                  ;
00F4   28F0           00509         GOTO    _CHKSUM_LOOP                    ;
                      00510                                                 ;
00F5   1F2C           00511         BTFSS   SND_TEST_MSG                    ;
00F6   28FA           00512         GOTO    _RE_SEND                        ;
00F7   0AC4           00513         INCF    HCS6,F                          ;corrupt the checksum
00F8   132C           00514         BCF     SND_TEST_MSG                    ;
00F9   01B6           00515         CLRF    REXMIT_COUNT                    ;send test message only once
                      00516                                                 ;
00FA                  00517 _RE_SEND                                        ;
00FA   1005           00518         BCF     TX_ENABLE                       ;
00FB   1683           00519         BANK1                                   ;TX_ENABLE should only be output when transmitting
00FC   1005           00520         BCF     TXENBL_TRIS                     ;
00FD   1283           00521         BANK0                                   ;
00FE   1005           00522         BCF     TX_ENABLE                       ;
00FF   303C           00523         MOVLW   .60                             ;hard delay 120uS                                       
                                                    
0100   00A0           00524         MOVWF   TEMP_BYT0_B0                    ;
0101                  00525 _LOOP_DELAY                                     ;
0101   0BA0           00526         DECFSZ  TEMP_BYT0_B0,F                  ;
0102   2901           00527         GOTO    _LOOP_DELAY                     ;
0103   178B           00528         BSF     _GIE                            ;enable global ints
                      00529                                                 ;
0104   3001           00530         MOVLW   MSG_PAUSE_PERIOD                ;
0105   00BA           00531         MOVWF   PAUSE_COUNT                     ;
0106   2430           00532         CALL    INIZIO_TX_HCS                   ;
0107                  00533 _MSG_FIN                                        ;
0107   0008           00534         RETURN                                  ;
                      00535 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00536 ;Decide which button procedure must handle this button
                      00537 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0108                  00538 HANDLE_BUTTONS                                  ;
0108   1F2B           00539         BTFSS   AUTOLOCK_ON                     ;
0109   2918           00540         GOTO    _NEXT_HANDLE                    ;if locked
                      00541                                                 ;  then
010A   3004           00542         MOVLW   b'00000100'                     ;
010B   0629           00543         XORWF   NEW_BUTTON_CONFIG,W             ;
010C   1D03           00544         BTFSS   STATUS,Z                        ;when in AUTOLOCK, the debounce timer is 2 seconds!
010D   2915           00545         GOTO    _AUTOLOCK_REJECT                ; so on first detection of the MODE key, we
010E   132B           00546         BCF     AUTOLOCK_ON                     ; can remove the LOCK
010F   17AB           00547         BSF     RELOCK_ON                       ; and 
0110   301E           00548         MOVLW   AUTOLOCK_OFF_TIME               ; prepare the count to re-lock
0111   00AF           00549         MOVWF   RE_LOCK_TIME                    ;
0112   10AB           00550         BCF     BTN_ACT_PDG                     ;
0113   1371           00551         BCF     LOCKED                          ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0114   2A2C           00552         GOTO    _DISPLAY_ADJUSTMENTS            ;
                      00553                                                 ;
0115                  00554 _AUTOLOCK_REJECT                                ;
0115   172B           00555         BSF     AUTOLOCK_ON                     ;
0116   10AB           00556         BCF     BTN_ACT_PDG                     ;
0117   2A30           00557         GOTO    _RESET_RELOCK                   ;
                      00558                                                 ;
0118                  00559 _NEXT_HANDLE                                    ;HANDLE BUTTON ACTIONS.........
0118   19AB           00560         BTFSC   CLCKSET_ACT                     ;clock adjustments?
0119   2981           00561         GOTO    _HANDLE_CLK_SET                 ;
011A   1AAB           00562         BTFSC   HEAT_ACT                        ;check if an action has already been assigned
011B   2A03           00563         GOTO    _HEAT_MSG_ACTION                ;boost adjustments?
                      00564                                                 ;
011C                  00565 _NEW_ACTIONS                                    ;no task has been assigned yet, this may be a new action
                      00566 ;===================================== SEND LEARN MESSAGE ==========
011C   3006           00567         MOVLW   b'00000110'                     ;
011D   0629           00568         XORWF   NEW_BUTTON_CONFIG,W             ;
011E   1D03           00569         BTFSS   STATUS,Z                        ;
011F   2924           00570         GOTO    _PREHEAT                        ;
0120   1473           00571         BSF     BEEPER                          ;beep
0121   16AC           00572         BSF     SND_LEARN_MSG                   ;
0122   10AB           00573         BCF     BTN_ACT_PDG                     ;
0123   2A30           00574         GOTO    _RESET_RELOCK                   ;
                      00575                                                 ;
0124                  00576 _PREHEAT                                        ;
0124   1CA9           00577         BTFSS   PREHEAT                         ;
0125   293C           00578         GOTO    _NEW_MODE                       ;
                      00579                                                 ;
                      00580 ;===================================== NEW BOOST ACTION ==============
0126   1C72           00581         BTFSS   DEVON                           ;accept boost only if the device is on
0127   2A2F           00582         GOTO    _NO_MORE_ACTION                 ;
0128   19F3           00583         BTFSC   BOOST_ACT                       ;If the device is already BOOSTing, don't start it again
0129   2A2F           00584         GOTO    _NO_MORE_ACTION                 ;
                      00585                                                 ;
012A   15F3           00586         BSF     BOOST_ACT                       ;
012B   152C           00587         BSF     SND_BOOSTON_MSG                 ;
012C   16F1           00588         BSF     TEMPETR                         ;turn on TEMP and BOOST icons
012D   1473           00589         BSF     BEEPER                          ;beep
012E   1572           00590         BSF     BOOST                           ;
012F   300A           00591         MOVLW   .10                             ;display "H"
0130   00F6           00592         MOVWF   TMPTR_VALUE                     ;
0131   301E           00593         MOVLW   BOOST_PERIOD                    ;
0132   00B2           00594         MOVWF   BOOST_MINUTES                   ;start BOOST timers
0133   0823           00595         MOVF    RT_SECONDS,W                    ;
0134   00B3           00596         MOVWF   BOOST_SECONDS                   ;
0135   1373           00597         BCF     F_SEND_BOOFF                    ;
0136   13F3           00598         BCF     F_RESEND_BOOFF                  ;
0137   15F2           00599         BSF     LCD_UPD                         ;
0138   2347           00600         CALL    UPDATE_LCD                      ;
0139   2347           00601         CALL    UPDATE_LCD                      ;
013A   10AB           00602         BCF     BTN_ACT_PDG                     ;
013B   2A30           00603         GOTO    _RESET_RELOCK                   ;
                      00604                                                 ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

013C                  00605 _NEW_MODE                                       ;
013C   1D29           00606         BTFSS   MODE                            ;
013D   2974           00607         GOTO    _NEW_CLKSET                     ;
                      00608 ;======================================= NEW ACTION FOR AUTO-OFF TIMER =====
013E   18F2           00609         BTFSC   DEVOFF                          ;
013F   2947           00610         GOTO    _MODE1HR                        ;
0140   1971           00611         BTFSC   ONEHR                           ;
0141   2956           00612         GOTO    _MODE3HR                        ;
0142   19F1           00613         BTFSC   THREEHR                         ;
0143   2960           00614         GOTO    _MODE12HR                       ;
0144   1A71           00615         BTFSC   TWELVEHR                        ;
0145   296A           00616         GOTO    _MODE_OFF                       ;
0146   2A2F           00617         GOTO    _NO_MORE_ACTION                 ;
                      00618                                                 ;
0147                  00619 _MODE1HR                                        ;
0147   3001           00620         MOVLW   AUTO_OFF_1HR                    ;THIS IS HOW WE TURN ON THE DEVICE
0148   00B0           00621         MOVWF   AUTO_OFF_HOURS                  ;Step through the different settings
                      00622                                                 ;
0149   0834           00623         MOVF    SAVED_TEMPERATURE,W             ;
014A   00F6           00624         MOVWF   TMPTR_VALUE                     ;
014B   1472           00625         BSF     DEVON                           ;
014C   16F1           00626         BSF     TEMPETR                         ;
014D   10F2           00627         BCF     DEVOFF                          ;
014E   1571           00628         BSF     ONEHR                           ;
014F   11F1           00629         BCF     THREEHR                         ;
0150   1271           00630         BCF     TWELVEHR                        ;
0151   14AC           00631         BSF     SND_ON_MSG                      ;Inform the base
0152   1473           00632         BSF     BEEPER                          ;(beep, unit is turned on)
0153   2233           00633         CALL    FILL_RESEND_PERIOD              ;
0154   01B7           00634         CLRF    RESEND_OFF_COUNT                ;don't send off msg
0155   296D           00635         GOTO    _SAVE_MINUTES                   ;
0156                  00636 _MODE3HR                                        ;
0156   3003           00637         MOVLW   AUTO_OFF_3HR                    ;
0157   00B0           00638         MOVWF   AUTO_OFF_HOURS                  ;
0158   1472           00639         BSF     DEVON                           ;
0159   10F2           00640         BCF     DEVOFF                          ;Don't need to inform the base, we'll just keep sending 
                            the refresh msg longer
015A   1171           00641         BCF     ONEHR                           ;
015B   15F1           00642         BSF     THREEHR                         ;
015C   1271           00643         BCF     TWELVEHR                        ;
015D   1473           00644         BSF     BEEPER                          ;
015E   17AC           00645         BSF     SND_REFRESH_MSG                 ;
015F   296D           00646         GOTO    _SAVE_MINUTES                   ;
0160                  00647 _MODE12HR                                       ;
0160   300C           00648         MOVLW   AUTO_OFF_12HR                   ;
0161   00B0           00649         MOVWF   AUTO_OFF_HOURS                  ;
0162   1472           00650         BSF     DEVON                           ;
0163   10F2           00651         BCF     DEVOFF                          ;
0164   1171           00652         BCF     ONEHR                           ;
0165   11F1           00653         BCF     THREEHR                         ;
0166   1671           00654         BSF     TWELVEHR                        ;(no beep)
0167   1473           00655         BSF     BEEPER                          ;
0168   17AC           00656         BSF     SND_REFRESH_MSG                 ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0169   296D           00657         GOTO    _SAVE_MINUTES                   ;
016A                  00658 _MODE_OFF                                       ;
016A   2238           00659         CALL    DEVICE_OFF                      ;
016B   1473           00660         BSF     BEEPER                          ;(beep, change is manual)
016C   296F           00661         GOTO    _DISP_AUTO_OFF                  ;
                      00662                                                 ;
016D                  00663 _SAVE_MINUTES                                   ;
016D   303C           00664         MOVLW   SIXTY_MINUTES                   ;
016E   00B1           00665         MOVWF   AUTO_OFF_MINUTES                ;minutes count down (hours already loaded in AUTO_OFF_HO
                            URS)
016F                  00666 _DISP_AUTO_OFF                                  ;
016F   15F2           00667         BSF     LCD_UPD                         ;
0170   2347           00668         CALL    UPDATE_LCD                      ;
0171   2347           00669         CALL    UPDATE_LCD                      ;
0172   10AB           00670         BCF     BTN_ACT_PDG                     ;
0173   2A30           00671         GOTO    _RESET_RELOCK                   ;
                      00672                                                 ;
0174                  00673 _NEW_CLKSET                                     ;
0174   1EA9           00674         BTFSS   CLOCK_SET                       ;
0175   29F5           00675         GOTO    _NEW_TEMP_VARS                  ;
                      00676 ;=================================== NEW CLOCK ADJUSTMENTS ACTION ============
0176                  00677 _NEW_CLK_ADJ                                    ;
0176   15AB           00678         BSF     CLCKSET_ACT                     ;start clock adjustment
0177   16F3           00679         BSF     COLON                           ;
0178   3002           00680         MOVLW   CLKP_MIN_ADJ                    ;
0179   00AD           00681         MOVWF   ADJUST_CLK_PHASE                ;1st phase of clock adjustment
017A   3010           00682         MOVLW   BLINK_PERIOD                    ;
017B   00A8           00683         MOVWF   BLINK_COUNT                     ;
017C   1471           00684         BSF     MINUTES                         ;
017D   15F2           00685         BSF     LCD_UPD                         ;
017E   2347           00686         CALL    UPDATE_LCD                      ;
017F   2347           00687         CALL    UPDATE_LCD                      ;
0180   2A30           00688         GOTO    _RESET_RELOCK                   ;
                      00689 ;===================================================================
0181                  00690 _HANDLE_CLK_SET                                 ;continue setting the clock according to the phase
                      00691         M_CMPL_JE       ADJUST_CLK_PHASE,CLKP_MIN_ADJ,_MIN_ADJUST
0181   082D               M                 movf    ADJUST_CLK_PHASE,w
0182   3A02               M                 xorlw   CLKP_MIN_ADJ
0183   1903               M                 btfsc   STATUS,Z
0184   298A               M                 goto    _MIN_ADJUST
                      00692         M_CMPL_JE       ADJUST_CLK_PHASE,CLKP_HOUR_ADJ,_HR_ADJUST
0185   082D               M                 movf    ADJUST_CLK_PHASE,w
0186   3A03               M                 xorlw   CLKP_HOUR_ADJ
0187   1903               M                 btfsc   STATUS,Z
0188   29BD               M                 goto    _HR_ADJUST
0189   2A2F           00693         GOTO    _NO_MORE_ACTION                 ;resets flags, resets relock count and goes out
                      00694                                                 ;
018A                  00695 _MIN_ADJUST                                     ;ADJUST MINUTES
018A   0BA8           00696         DECFSZ  BLINK_COUNT,F                   ;
018B   2992           00697         GOTO    _NO_BLKMIN                      ;
018C   3001           00698         MOVLW   b'00000001'                     ;toggle MINUTES
018D   06F1           00699         XORWF   LCD_CHAR1,F                     ;
018E   3010           00700         MOVLW   BLINK_PERIOD                    ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

018F   00A8           00701         MOVWF   BLINK_COUNT                     ;
0190   15F2           00702         BSF     LCD_UPD                         ;
0191   2347           00703         CALL    UPDATE_LCD                      ;blink the display
0192                  00704 _NO_BLKMIN                                      ;
0192   2249           00705         CALL    TEST_BUTTONS                    ;check for + - buttons
0193   14AB           00706         BSF     BTN_ACT_PDG                     ;make sure we stay in this loop until debouncing is fini
                            shed
0194   182B           00707         BTFSC   DEBOUNCING                      ;
0195   2A30           00708         GOTO    _RESET_RELOCK                   ;
0196   01AA           00709         CLRF    OLD_BUTTON_CONFIG               ;
                      00710                                                 ;
0197                  00711 _SKIPMIN                                        ;button was pressed
0197   1A29           00712         BTFSC   PLUS                            ;+ button
0198   299C           00713         GOTO    _ADD_MINUTE                     ;
0199   19A9           00714         BTFSC   MINUS                           ;- button
019A   29A6           00715         GOTO    _SUB_MINUTE                     ;
019B   29B1           00716         GOTO    _MODE_MIN                       ;
019C                  00717 _ADD_MINUTE                                     ;
019C   0AA4           00718         INCF    RT_MINUTES,F                    ;
                      00719         M_CMPL_JL RT_MINUTES,.60,_GO1_MIN       ;
019D   0824               M                 movf    RT_MINUTES,w
019E   3C3C               M                 sublw   .60     ;k-v1 < 0
019F   1C03               M                 btfss   STATUS,C
01A0   29A4               M                 goto    $+4
01A1   1903               M                 btfsc   STATUS,Z
01A2   29A4               M                 goto    $+2
01A3   29A5               M                 goto    _GO1_MIN
01A4   01A4           00720         CLRF    RT_MINUTES                      ;
01A5                  00721 _GO1_MIN                                        ;
01A5   29AC           00722         GOTO    _NEW_MINUTES                    ;
01A6                  00723 _SUB_MINUTE                                     ;
01A6   08A4           00724         MOVF    RT_MINUTES,F                    ;
01A7   1D03           00725         BTFSS   STATUS,Z                        ;decrement if not zero
01A8   29AB           00726         GOTO    _DECMIN                         ;
01A9   303C           00727         MOVLW   .59+.1                          ;
01AA   00A4           00728         MOVWF   RT_MINUTES                      ;
01AB                  00729 _DECMIN                                         ;
01AB   03A4           00730         DECF    RT_MINUTES,F                    ;
01AC                  00731 _NEW_MINUTES                                    ;
01AC   15F2           00732         BSF     LCD_UPD                         ;
01AD   0824           00733         MOVF    RT_MINUTES,W                    ;
01AE   23E9           00734         CALL    Convert_to_BCD                  ;
01AF   00F4           00735         MOVWF   MIN_VALUE                       ;
01B0   2A30           00736         GOTO    _RESET_RELOCK                   ;
01B1                  00737 _MODE_MIN                                       ;
01B1   1D29           00738         BTFSS   MODE                            ;MODE button pressed?
01B2   2A32           00739         GOTO    _HANDLE_FIN                     ;
01B3   1471           00740         BSF     MINUTES                         ;
01B4   3010           00741         MOVLW   BLINK_PERIOD                    ;stop blinking 12/24 hours
01B5   00A8           00742         MOVWF   BLINK_COUNT                     ;
01B6   3003           00743         MOVLW   CLKP_HOUR_ADJ                   ;go to phase 3, adjust hours
01B7   00AD           00744         MOVWF   ADJUST_CLK_PHASE                ;
01B8   15F2           00745         BSF     LCD_UPD                         ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01B9   2347           00746         CALL    UPDATE_LCD                      ;
01BA   2347           00747         CALL    UPDATE_LCD                      ;
01BB   14F1           00748         BSF     HOURS                           ;
01BC   2A30           00749         GOTO    _RESET_RELOCK                   ;
                      00750                                                 ;
01BD                  00751 _HR_ADJUST                                      ;ADJUST HOURS
01BD   0BA8           00752         DECFSZ  BLINK_COUNT,F                   ;
01BE   29C5           00753         GOTO    _NO_BLKHR                       ;
01BF   3002           00754         MOVLW   b'00000010'                     ;toggle HOURS bit for blinking
01C0   06F1           00755         XORWF   LCD_CHAR1,F                     ;
01C1   3010           00756         MOVLW   BLINK_PERIOD                    ;
01C2   00A8           00757         MOVWF   BLINK_COUNT                     ;
01C3   15F2           00758         BSF     LCD_UPD                         ;
01C4   2347           00759         CALL    UPDATE_LCD                      ;
01C5                  00760 _NO_BLKHR                                       ;
01C5   2249           00761         CALL    TEST_BUTTONS                    ;check for adjustments 
01C6   14AB           00762         BSF     BTN_ACT_PDG                     ;make sure we stay in this loop until debouncing is fini
                            shed
01C7   182B           00763         BTFSC   DEBOUNCING                      ; 
01C8   2A30           00764         GOTO    _RESET_RELOCK                   ;
01C9   01AA           00765         CLRF    OLD_BUTTON_CONFIG               ;
                      00766                                                 ;
01CA                  00767 _SKIPHR                                         ;button pressed was:
01CA   1A29           00768         BTFSC   PLUS                            ;+ button
01CB   29CF           00769         GOTO    _ADD_HOUR                       ;
01CC   19A9           00770         BTFSC   MINUS                           ;- button
01CD   29D9           00771         GOTO    _SUB_HOUR                       ;
01CE   29E7           00772         GOTO    _MODE_HOUR                      ;
01CF                  00773 _ADD_HOUR                                       ;
01CF   0AA5           00774         INCF    RT_HOURS,F                      ;
                      00775         M_CMP_JLE RT_HOURS,MAX_HOURS,_GO1_HR    ;
01D0   0825               M                 movf    RT_HOURS,w
01D1   022E               M                 subwf   MAX_HOURS,w     ;v2-v1 > 0
01D2   1803               M                 btfsc   STATUS,C
01D3   29D5               M                 goto    $+2
01D4   1903               M                 btfsc   STATUS,Z
01D5   29D8               M                 goto    _GO1_HR
01D6   3001           00776         MOVLW   .1                              ;
01D7   00A5           00777         MOVWF   RT_HOURS                        ;
01D8                  00778 _GO1_HR                                         ;
01D8   29E1           00779         GOTO    _NEW_HOURS                      ;
01D9                  00780 _SUB_HOUR                                       ;
                      00781         M_CMPL_JG RT_HOURS,1,_DECHR             ;
01D9   0825               M                 movf    RT_HOURS,w
01DA   3C01               M                 sublw   1
01DB   1C03               M                 btfss   STATUS,C
01DC   29E0               M                 goto    _DECHR
01DD   300C           00782         MOVLW   CLKP_HOUR_12                    ;...2,1,12,11...
01DE   00A5           00783         MOVWF   RT_HOURS                        ;
01DF   29E1           00784         GOTO    _NEW_HOURS                      ;
01E0                  00785 _DECHR                                          ;
01E0   03A5           00786         DECF    RT_HOURS,F                      ;
01E1                  00787 _NEW_HOURS                                      ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01E1   14F1           00788         BSF     HOURS                           ;
01E2   15F2           00789         BSF     LCD_UPD                         ;
01E3   0825           00790         MOVF    RT_HOURS,W                      ;
01E4   23E9           00791         CALL    Convert_to_BCD                  ;
01E5   00F5           00792         MOVWF   HOUR_VALUE                      ;
01E6   2A30           00793         GOTO    _RESET_RELOCK                   ;
01E7                  00794 _MODE_HOUR                                      ;
01E7   1D29           00795         BTFSS   MODE                            ;
01E8   2A32           00796         GOTO    _HANDLE_FIN                     ;
01E9   1471           00797         BSF     MINUTES                         ;hour values is being confirmed
01EA   14F1           00798         BSF     HOURS                           ;
01EB   10AB           00799         BCF     BTN_ACT_PDG                     ;
01EC   11AB           00800         BCF     CLCKSET_ACT                     ;
01ED   01AD           00801         CLRF    ADJUST_CLK_PHASE                ;ADJUST_CLK_PHASE = CLKP_NOTHING
01EE   01A3           00802         CLRF    RT_SECONDS                      ;
01EF   3020           00803         MOVLW   BLINK_2P_PERIOD                 ;re-start toggle the COLON bit
01F0   00BE           00804         MOVWF   TMR_1SECOND                     ;
01F1   15F2           00805         BSF     LCD_UPD                         ;
01F2   2347           00806         CALL    UPDATE_LCD                      ;
01F3   2347           00807         CALL    UPDATE_LCD                      ;
01F4   2A30           00808         GOTO    _RESET_RELOCK                   ;
                      00809                                                 ;
                      00810 ;===================================== NEW TEMPERATURES CHANGES ======
01F5                  00811 _NEW_TEMP_VARS                                  ;
01F5   1C72           00812         BTFSS   DEVON                           ;accept heat changes only if the device is on 
01F6   2A2F           00813         GOTO    _NO_MORE_ACTION                 ;
                      00814                                                 ;
01F7   1B2B           00815         BTFSC   AUTOLOCK_ON                     ;
01F8   2A2F           00816         GOTO    _NO_MORE_ACTION                 ;Temperature variations accepted only if unlocked
                      00817                                                 ;
01F9   19F3           00818         BTFSC   BOOST_ACT                       ;If the device is BOOSTing, don't accept temperature cha
                            nges (new requirement)
01FA   2A2F           00819         GOTO    _NO_MORE_ACTION                 ;
                      00820                                                 ;
01FB   1A29           00821         BTFSC   PLUS                            ;
01FC   29FF           00822         GOTO    _ACCEPT_HEAT_CHANGE             ;
01FD   1DA9           00823         BTFSS   MINUS                           ;
01FE   2A2F           00824         GOTO    _NO_MORE_ACTION                 ;
01FF                  00825 _ACCEPT_HEAT_CHANGE                             ;
01FF   16AB           00826         BSF     HEAT_ACT                        ;make sure we come back to _HEAT_MSG_COUNTING below
0200   16F1           00827         BSF     TEMPETR                         ;
0201   3009           00828         MOVLW   HEAT_MSG_COUNTDWN               ;start the count down
0202   00B5           00829         MOVWF   PRE_MESSAGE_TIMER               ;
0203                  00830 _HEAT_MSG_ACTION                                ;
0203   182B           00831         BTFSC   DEBOUNCING                      ;make sure we're finished debouncing
0204   2A2F           00832         GOTO    _NO_MORE_ACTION                 ;
                      00833                                                 ;
0205   1A29           00834         BTFSC   PLUS                            ;
0206   2A0A           00835         GOTO    _TEMP_INCR                      ;
0207   19A9           00836         BTFSC   MINUS                           ;
0208   2A12           00837         GOTO    _TEMP_DECR                      ;
0209   2A23           00838         GOTO    _HEAT_MSG_COUNTDOWN             ;countdown if now button pressed
                      00839                                                 ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

020A                  00840 _TEMP_INCR                                      ;
                      00841         M_CMPL_JG TMPTR_VALUE,MAX_TEMP-1,_WRAP_ZERO ;wrap around if we're at min
020A   0876               M                 movf    TMPTR_VALUE,w
020B   3C09               M                 sublw   MAX_TEMP-1
020C   1C03               M                 btfss   STATUS,C
020D   2A10               M                 goto    _WRAP_ZERO
020E   0AF6           00842         INCF    TMPTR_VALUE,F                   ;
020F   2A1A           00843         GOTO    _DELAY_MSG_SEND                 ;
0210                  00844 _WRAP_ZERO                                      ;
0210   01F6           00845         CLRF    TMPTR_VALUE                     ;
0211   2A1A           00846         GOTO    _DELAY_MSG_SEND                 ;
                      00847                                                 ;
0212                  00848 _TEMP_DECR                                      ;"-" BUTTON?
                      00849         M_CMPL_JE       TMPTR_VALUE,0,_WRAP_HIGH ;wrap around if we're at max
0212   0876               M                 movf    TMPTR_VALUE,w
0213   3A00               M                 xorlw   0
0214   1903               M                 btfsc   STATUS,Z
0215   2A18               M                 goto    _WRAP_HIGH
0216   03F6           00850         DECF    TMPTR_VALUE,F                   ;
0217   2A1A           00851         GOTO    _DELAY_MSG_SEND                 ;
0218                  00852 _WRAP_HIGH                                      ;
0218   300A           00853         MOVLW   MAX_TEMP                        ;
0219   00F6           00854         MOVWF   TMPTR_VALUE                     ;
                      00855                                                 ;
021A                  00856 _DELAY_MSG_SEND                                 ;
021A   0876           00857         MOVF    TMPTR_VALUE,W                   ;
021B   00B4           00858         MOVWF   SAVED_TEMPERATURE               ;
021C   3009           00859         MOVLW   HEAT_MSG_COUNTDWN               ;reload the count down
021D   00B5           00860         MOVWF   PRE_MESSAGE_TIMER               ;
021E   15F2           00861         BSF     LCD_UPD                         ;
021F   2347           00862         CALL    UPDATE_LCD                      ;call twice
0220   2347           00863         CALL    UPDATE_LCD                      ;
0221   01AA           00864         CLRF    OLD_BUTTON_CONFIG               ;junior: elimina questa riga
                      00865 ;       CLRF    NEW_BUTTON_CONFIG               ;
0222   2A2F           00866         GOTO    _NO_MORE_ACTION                 ;
                      00867                                                 ;
0223                  00868 _HEAT_MSG_COUNTDOWN                             ;
0223   0BB5           00869         DECFSZ  PRE_MESSAGE_TIMER,F             ;
0224   2A32           00870         GOTO    _HANDLE_FIN                     ;
0225   14AC           00871         BSF     SND_ON_MSG                      ;
0226   1473           00872         BSF     BEEPER                          ;(beep, on last increment)
0227   12AB           00873         BCF     HEAT_ACT                        ;
0228   10AB           00874         BCF     BTN_ACT_PDG                     ;
0229   2233           00875         CALL    FILL_RESEND_PERIOD              ;
022A   01AA           00876         CLRF    OLD_BUTTON_CONFIG               ;
022B   2A30           00877         GOTO    _RESET_RELOCK                   ;
                      00878 ;===================================================================
022C                  00879 _DISPLAY_ADJUSTMENTS                            ;
022C   15F2           00880         BSF     LCD_UPD                         ;
022D   2347           00881         CALL    UPDATE_LCD                      ;
022E   2A30           00882         GOTO    _RESET_RELOCK                   ;
                      00883                                                 ;
022F                  00884 _NO_MORE_ACTION                                 ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

022F   10AB           00885         BCF     BTN_ACT_PDG                     ;
                      00886                                                 ;
0230                  00887 _RESET_RELOCK                                   ;
0230   301E           00888         MOVLW   AUTOLOCK_OFF_TIME               ; RESET THE RE-LOCK counters (even if we're not in autol
                            ock)
0231   00AF           00889         MOVWF   RE_LOCK_TIME                    ;
0232                  00890 _HANDLE_FIN                                     ;
0232   0008           00891         RETURN                                  ;
                      00892 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00893 ;Fill the RESEND_ON_COUNT with either a pseudo random number with a spread that 
                      00894 ;goes from 12' to 15' or a fixed counter
                      00895 ;OUTPUT: RESEND_ON_COUNT_L,RESEND_ON_COUNT_H
                      00896 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0233                  00897 FILL_RESEND_PERIOD                              ;
                      00898 #IFDEF RANDMOM_REFRESH                          ;
                      00899         MOVLW   HIGH (SEND_ON_PERIOD)           ;
                      00900         MOVWF   TEMP_BYT1_B0                    ;
                      00901         MOVLW   0xBF                            ;xBF = mask to get a ramdom spread of 191secs (~3mins)
                      00902         ANDWF   TMR0,W                          ; randomize with value of TMR0
                      00903         MOVWF   TEMP_BYT0_B0                    ;
                      00904         MOVLW   LOW (SEND_ON_PERIOD)            ;
                      00905         ADDWF   TEMP_BYT0_B0,F                  ;
                      00906         SKPNC                                   ;
                      00907         INCF    TEMP_BYT1_B0,F                  ;
                      00908         MOVF    TEMP_BYT0_B0,W                  ;
                      00909         MOVWF   RESEND_ON_COUNT_L               ;
                      00910         INCF    TEMP_BYT1_B0,W                  ;this INCF is to make the countdown algorithm work for t
                            he last FF period
                      00911         MOVWF   RESEND_ON_COUNT_H               ;
                      00912 #ELSE                                           ;
0233   3004           00913         MOVLW   HIGH (SEND_ON_PERIOD)+1         ;make the countdown algorithm work for the last FF perio
                            d
0234   00B9           00914         MOVWF   RESEND_ON_COUNT_H               ;
0235   3084           00915         MOVLW   LOW (SEND_ON_PERIOD)            ;
0236   00B8           00916         MOVWF   RESEND_ON_COUNT_L               ;
                      00917 #ENDIF                                          ;
0237   0008           00918         RETURN                                  ;
                      00919 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00920 ;Turn this device off (adjust the LCD accordingly and send an OFF message to 
                      00921 ;the base
                      00922 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0238                  00923 DEVICE_OFF                                      ;
0238   01B0           00924         CLRF    AUTO_OFF_HOURS                  ;
0239   1072           00925         BCF     DEVON                           ;
023A   1272           00926         BCF     LED1_STATE                      ;
023B   1386           00927         BCF     LED1                            ;make sure LED1 is off when the device goes off
023C   3060           00928         MOVLW   PW_OFF_PERIOD                   ;
023D   00A2           00929         MOVWF   LED1_CLOCK                      ;
023E   12F1           00930         BCF     TEMPETR                         ;
023F   11F3           00931         BCF     BOOST_ACT                       ;
0240   1172           00932         BCF     BOOST                           ;
0241   14F2           00933         BSF     DEVOFF                          ;
0242   1171           00934         BCF     ONEHR                           ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0243   11F1           00935         BCF     THREEHR                         ;
0244   1271           00936         BCF     TWELVEHR                        ;
0245   142C           00937         BSF     SND_OFF_MSG                     ;
0246   301E           00938         MOVLW   SEND_OFF_PERIOD                 ;
0247   00B7           00939         MOVWF   RESEND_OFF_COUNT                ;
0248   0008           00940         RETURN                                  ;
                      00941 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00942 ;Test and debounce push buttons
                      00943 ;NEW_BUTTON_CONFIG<0:7> are mapped as follows: KB7, KB1, KB2, KB3, KB4, KB5, KB6, KB8
                      00944 ;redefined as CLOCK_SET(5),........
                      00945 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0249                  00946 TEST_BUTTONS                                    ;
                      00947 #IFDEF DEBUG                                    ;
                      00948         M_BANKSEL_2                             ;
                      00949         BCF     LCDSE1,7                        ;SEG15 shared with KB0 (RA3)
                      00950         BCF     STATUS,6                        ;BANK 0
                      00951 #ENDIF                                          ;
0249   10AB           00952         BCF     BTN_ACT_PDG                     ;
024A   1185           00953         BCF     KB0                             ;
024B   3005           00954         MOVLW   5                               ;
024C   00A0           00955         MOVWF   TEMP_BYT0_B0                    ;
024D                  00956 _TB_WAIT                                        ;
024D   0BA0           00957         DECFSZ  TEMP_BYT0_B0,F                  ;forced delay 5us wait for push buttons
024E   2A4D           00958         GOTO    _TB_WAIT                        ;
                      00959                                                 ;
024F   0808           00960         MOVF    PORTD,W                         ;read buttons
0250   00A9           00961         MOVWF   NEW_BUTTON_CONFIG               ;
0251   1729           00962         BSF     NEW_BUTTON_CONFIG,6             ;NOT_USED
0252   17A9           00963         BSF     NEW_BUTTON_CONFIG,7             ;NOT USED.......
0253   1429           00964         BSF     NEW_BUTTON_CONFIG,0             ;NOT USED.......
                      00965                                                 ;
0254   1A2B           00966         BTFSC   UNLOCKING                       ;if the unlock/relock process is running
0255   2A65           00967         GOTO    _TB_CONT                        ;       don't test the lock button
0256   1BAB           00968         BTFSC   RELOCK_ON                       ;
0257   2A65           00969         GOTO    _TB_CONT                        ;
                      00970                                                 ;
0258   1889           00971         BTFSC   KB8                             ;else
0259   2A60           00972         GOTO    _TB_UNLOCK                      ;set the lock/unlock 
025A                  00973 _TB_LOCK                                        ;       according the current position 
025A   1B2B           00974         BTFSC   AUTOLOCK_ON                     ;       display if it has changed
025B   2A65           00975         GOTO    _TB_CONT                        ;
025C   172B           00976         BSF     AUTOLOCK_ON                     ;
025D   1771           00977         BSF     LOCKED                          ;
025E   15F2           00978         BSF     LCD_UPD                         ;
025F   2A65           00979         GOTO    _TB_CONT                        ;
0260                  00980 _TB_UNLOCK                                      ;
0260   1F2B           00981         BTFSS   AUTOLOCK_ON                     ;
0261   2A65           00982         GOTO    _TB_CONT                        ;
0262   132B           00983         BCF     AUTOLOCK_ON                     ;
0263   1371           00984         BCF     LOCKED                          ;
0264   15F2           00985         BSF     LCD_UPD                         ;fi;
0265                  00986 _TB_CONT                                        ;
0265   1E73           00987         BTFSS   F_BODY_GUARD                    ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0266   1585           00988         BSF     KB0                             ;finished reading buttons
                      00989                                                 ;
0267   30FF           00990         MOVLW   0xFF                            ;
0268   06A9           00991         XORWF   NEW_BUTTON_CONFIG,F             ;invert
                      00992                                                 ;
0269   1C2B           00993         BTFSS   DEBOUNCING                      ;are we debouncing?
026A   2A76           00994         GOTO    _START_DEBOUNCING               ;no
                      00995                                                 ;
026B                  00996 _DEBOUNCING                                     ;yes, waiting for a zero count
                      00997         M_CMP_JNE NEW_BUTTON_CONFIG,OLD_BUTTON_CONFIG,_CLEAR_DEBOUNCE   ;we are debouncing, still the sa
                            me?
026B   0829               M                 movf    NEW_BUTTON_CONFIG,w
026C   062A               M                 xorwf   OLD_BUTTON_CONFIG,w
026D   1D03               M                 btfss   STATUS,Z
026E   2A8A               M                 goto    _CLEAR_DEBOUNCE
026F   0BA6           00998         DECFSZ  DEBOUNCE_CNT,F                  ;
0270   2A8B           00999         GOTO    _BUTTON_END                     ;
0271   1706           01000         BSF     BACKLIGHT                       ;turn backlight on
0272   301E           01001         MOVLW   BACKLIGHT_PERIOD                ;
0273   00A7           01002         MOVWF   BACKLIGHT_CNT                   ;
0274   14AB           01003         BSF     BTN_ACT_PDG                     ;
0275   2A8A           01004         GOTO    _CLEAR_DEBOUNCE                 ;finished debouncing
                      01005                                                 ;
0276                  01006 _START_DEBOUNCING                               ;this would be a first change
                      01007         M_CMP_JE NEW_BUTTON_CONFIG,OLD_BUTTON_CONFIG,_CLEAR_DEBOUNCE ;not debouncing and no change
0276   0829               M                 movf    NEW_BUTTON_CONFIG,w
0277   062A               M                 xorwf   OLD_BUTTON_CONFIG,w
0278   1903               M                 btfsc   STATUS,Z
0279   2A8A               M                 goto    _CLEAR_DEBOUNCE
027A   142B           01008         BSF     DEBOUNCING                      ;start debouncing
027B   0829           01009         MOVF    NEW_BUTTON_CONFIG,W             ;the button pressed or released is here
027C   00AA           01010         MOVWF   OLD_BUTTON_CONFIG               ;
                      01011                                                 ;
027D   1F2B           01012         BTFSS   AUTOLOCK_ON                     ;select debounce period
027E   2A82           01013         GOTO    _HEAT_DEBOUNCE_PERIOD           ;
                      01014                                                 ;
027F                  01015 _AUTOLOCK_DEBOUNCE_PERIOD                       ;
027F   3040           01016         MOVLW   AUTOLOCK_DEBOUNCE               ;extended debounce when in autolock
0280   00A6           01017         MOVWF   DEBOUNCE_CNT                    ;
0281   2A8B           01018         GOTO    _BUTTON_END                     ;
                      01019                                                 ;
0282                  01020 _HEAT_DEBOUNCE_PERIOD                           ;
0282   1EAB           01021         BTFSS   HEAT_ACT                        ;extended debounce to slow down continuous changes to he
                            at level
0283   2A87           01022         GOTO    _NORMAL_DEBOUNCE_PERIOD         ;
0284   300C           01023         MOVLW   HEAT_ADJ_DEBOUNCE               ;
0285   00A6           01024         MOVWF   DEBOUNCE_CNT                    ;
0286   2A8B           01025         GOTO    _BUTTON_END                     ;
                      01026                                                 ;
0287                  01027 _NORMAL_DEBOUNCE_PERIOD                         ;
0287   3006           01028         MOVLW   DEBOUNCE_PERIOD                 ;
0288   00A6           01029         MOVWF   DEBOUNCE_CNT                    ;
0289   2A8B           01030         GOTO    _BUTTON_END                     ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01031                                                 ;
028A                  01032 _CLEAR_DEBOUNCE                                 ;
028A   102B           01033         BCF     DEBOUNCING                      ;no more debounce
                      01034                                                 ;
028B                  01035 _BUTTON_END                                     ;
                      01036 #IFDEF DEBUG                                    ;
                      01037         BSF     STATUS,6                        ;BANK 2
                      01038         BSF     LCDSE1,7                        ;SEG15 shared with KB0 (RA3)
                      01039         BCF     STATUS,6                        ;BANK 0
                      01040 #ENDIF                                          ;
028B   0008           01041         RETURN                                  ;
                      01042 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01043 ;Drive the ON/OFF cycle of LED1
                      01044 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
028C                  01045 MANAGE_LED1                                     ;
028C   1C72           01046         BTFSS   DEVON                           ;drive LED only when the device is on
028D   2A9A           01047         GOTO    _LED1_END                       ;
                      01048                                                 ;
028E   0BA2           01049         DECFSZ  LED1_CLOCK,F                    ;
028F   2A9A           01050         GOTO    _LED1_END                       ;
                      01051                                                 ;
0290   1A72           01052         BTFSC   LED1_STATE                      ;
0291   2A96           01053         GOTO    _TURN_LED1_OFF                  ;
                      01054                                                 ;
0292                  01055 _TURN_LED1_ON                                   ;
0292   1672           01056         BSF     LED1_STATE                      ;
0293   1786           01057         BSF     LED1                            ;don't go to sleep while LED1 is ON
0294   3009           01058         MOVLW   PW_ON_PERIOD                    ;
0295   2A99           01059         GOTO    _LED1_SET                       ;
                      01060                                                 ;
0296                  01061 _TURN_LED1_OFF                                  ;
0296   1272           01062         BCF     LED1_STATE                      ;
0297   1386           01063         BCF     LED1                            ;don't go to sleep while LED1 is ON
0298   3060           01064         MOVLW   PW_OFF_PERIOD                   ;
                      01065                                                 ;
0299                  01066 _LED1_SET                                       ;
0299   00A2           01067         MOVWF   LED1_CLOCK                      ;
029A                  01068 _LED1_END                                       ;
029A   0008           01069         RETURN                                  ;
                      01070 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01071 ;Treat the battery LCD segment according to its state
                      01072 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
029B                  01073 TREAT_BATTERY_DISPLAY                           ;
029B   1CF3           01074         BTFSS   BATTERY_WARN                    ;
029C   2AA6           01075         GOTO    _BATT_LOW                       ;
029D   0BBB           01076         DECFSZ  BATTERY_BLINK_COUNT,F           ;battery warning
029E   2AAC           01077         GOTO    _BATT_FIN                       ; decrement the blink counter
029F   3010           01078         MOVLW   BLINK_PERIOD                    ; when the count reches 0, toggle the bit
02A0   00BB           01079         MOVWF   BATTERY_BLINK_COUNT             ; and display in the LCD
02A1   3080           01080         MOVLW   b'10000000'                     ;
02A2   06F1           01081         XORWF   LCD_CHAR1,F                     ;
02A3   15F2           01082         BSF     LCD_UPD                         ;
02A4   2347           01083         CALL    UPDATE_LCD                      ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02A5   2AAC           01084         GOTO    _BATT_FIN                       ;
                      01085                                                 ;               
02A6                  01086 _BATT_LOW                                       ;
02A6   1D73           01087         BTFSS   BATTERY_LOW                     ;
02A7   2AAB           01088         GOTO    _BATT_GOOD                      ;
02A8   17F1           01089         BSF     BATTLOW                         ;battery low
02A9   15F2           01090         BSF     LCD_UPD                         ;
02AA   2AAC           01091         GOTO    _BATT_FIN                       ;
                      01092                                                 ;
02AB                  01093 _BATT_GOOD                                      ;
02AB   13F1           01094         BCF     BATTLOW                         ;
02AC                  01095 _BATT_FIN                                       ;
02AC   0008           01096         RETURN                                  ;
                      01097 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01098 ;seconds actions, time base LCD period
                      01099 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
02AD                  01100 SECONDS_TASKS                                   ;
02AD   0BBE           01101         DECFSZ  TMR_1SECOND,F                   ;
02AE   2AD4           01102         GOTO    _SECONDS_END                    ;
                      01103                                                 ;
02AF   19AB           01104         BTFSC   CLCKSET_ACT                     ;blink : if we're NOT adjusting the clock
02B0   2AB6           01105         GOTO    _BOOST_OFF_SECS                 ;
                      01106                                                 ;
02B1   3020           01107         MOVLW   BLINK_2P_PERIOD                 ;toggle the COLON bit
02B2   00BE           01108         MOVWF   TMR_1SECOND                     ;
02B3   3020           01109         MOVLW   b'00100000'                     ;
02B4   06F3           01110         XORWF   LCD_CHAR5,F                     ;
02B5   15F2           01111         BSF     LCD_UPD                         ;
                      01112 ;...............................................;
02B6                  01113 _BOOST_OFF_SECS                                 ;
02B6   30C0           01114         MOVLW   b'11000000'                     ;are we treating the BOOST_OFF_MSG seconds counter?
02B7   0573           01115         ANDWF   LCD_CHAR5,W                     ;
02B8   1903           01116         BTFSC   STATUS,Z                        ;
02B9   2ACB           01117         GOTO    _RESEND_ON_MSG                  ;
                      01118                                                 ;
02BA   0BB3           01119         DECFSZ  BOOST_SECONDS,F                 ;
02BB   2AD4           01120         GOTO    _SECONDS_END                    ;this jump avoids a useless refresh during this minute
                      01121                                                 ;
02BC   1172           01122         BCF     BOOST                           ;now send BOOST-OFF and setupf the counter to 
02BD   11F3           01123         BCF     BOOST_ACT                       ; resend 
02BE   0834           01124         MOVF    SAVED_TEMPERATURE,W             ;
02BF   00F6           01125         MOVWF   TMPTR_VALUE                     ;
02C0   1073           01126         BCF     BEEPER                          ;
02C1   15AC           01127         BSF     SND_BOO_OFF_MSG                 ;turn pre heat off in the base
                      01128                                                 ;
02C2   1F73           01129         BTFSS   F_SEND_BOOFF                    ;first send?
02C3   2AC9           01130         GOTO    _BOOST_CYCLE_END                ;
                      01131                                                 ;
                      01132 #IFDEF RANDMOM_BOOST_OFF                        ;
                      01133         MOVLW   0x1F                            ;prepare resend of boost
                      01134         ANDWF   TMR0,W                          ;random wait of 1 to 32 seconds
                      01135         MOVWF   BOOST_SECONDS                   ;
                      01136         INCF    BOOST_SECONDS,F                 ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01137 #ELSE                                           ;
02C4   300F           01138         MOVLW   RESEND_BOOST_PERIOD             ;fixed restransmit
02C5   00B3           01139         MOVWF   BOOST_SECONDS                   ;
                      01140 #ENDIF                                          ;
02C6   1373           01141         BCF     F_SEND_BOOFF                    ;
02C7   17F3           01142         BSF     F_RESEND_BOOFF                  ;
02C8   2AD4           01143         GOTO    _SECONDS_END                    ;avoids a useless refresh
02C9                  01144 _BOOST_CYCLE_END                                ;
02C9   13F3           01145         BCF     F_RESEND_BOOFF                  ;
02CA   2AD4           01146         GOTO    _SECONDS_END                    ;avoids a useless refresh
                      01147 ;...............................................;
02CB                  01148 _RESEND_ON_MSG                                  ;this is the REFRESH message
02CB   1C72           01149         BTFSS   DEVON                           ;
02CC   2AD4           01150         GOTO    _SECONDS_END                    ;
02CD   0BB8           01151         DECFSZ  RESEND_ON_COUNT_L,F             ;
02CE   2AD4           01152         GOTO    _SECONDS_END                    ;
02CF   0BB9           01153         DECFSZ  RESEND_ON_COUNT_H,F             ;
02D0   2AD4           01154         GOTO    _SECONDS_END                    ;
                      01155                                                 ;
02D1                  01156 _RELOAD_ON_MSG                                  ;
02D1   2233           01157         CALL    FILL_RESEND_PERIOD              ;
02D2   1073           01158         BCF     BEEPER                          ;
02D3   17AC           01159         BSF     SND_REFRESH_MSG                 ;
                      01160 ;...............................................;
02D4                  01161 _SECONDS_END                                    ;
02D4   0008           01162         RETURN                                  ;
                      01163 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01164 ;Updates the real time clock and the LCD display when necessary
                      01165 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
02D5                  01166 REAL_TIME_SERVICES                              ;
02D5   1C0C           01167         BTFSS   TMR1_IF                         ;if TMR1 rolled over
02D6   2B23           01168         GOTO    _RT_DONE                        ;
                      01169                                                 ;
                      01170 ;============================= SECONDS COUNTERS ===============================
02D7   100C           01171         BCF     TMR1_IF                         ;
02D8                  01172 _RT_SECONDS                                     ;
02D8   0AA3           01173         INCF    RT_SECONDS,F                    ;ticks every 2 seconds at 32K
02D9   0AA3           01174         INCF    RT_SECONDS,F                    ;
                      01175 ;...............................................;
                      01176 ;HANDLE OTHER REAL TIME SECONDS COUNTERS
                      01177 ;...............................................;
02DA   08A7           01178         MOVF    BACKLIGHT_CNT,F                 ;BACKLIGHT OFF
02DB   1903           01179         BTFSC   STATUS,Z                        ;
02DC   2AE3           01180         GOTO    _RELOCK_SECS                    ;
02DD   0BA7           01181         DECFSZ  BACKLIGHT_CNT,F                 ;
02DE   2AE0           01182         GOTO    _BL1                            ;BACKLIGHT OFF time should always be an even number
02DF   2AE2           01183         GOTO    _TURN_OFF_BL                    ; <-- this GOTO in case it was odd
02E0   0BA7           01184 _BL1    DECFSZ  BACKLIGHT_CNT,F                 ;
02E1   2AE3           01185         GOTO    _RELOCK_SECS                    ;
02E2                  01186 _TURN_OFF_BL                                    ;
02E2   1306           01187         BCF     BACKLIGHT                       ;
                      01188 ;...............................................;
02E3                  01189 _RELOCK_SECS                                    ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02E3   1FAB           01190         BTFSS   RELOCK_ON                       ;RE-LOCK
02E4   2AEE           01191         GOTO    _RT_MINUTES                     ;relock time should always be an even number
02E5   0BAF           01192         DECFSZ  RE_LOCK_TIME,F                  ;
02E6   2AE8           01193         GOTO    $+2                             ;
02E7   2AEA           01194         GOTO    _RELOCK_REACHED                 ;
02E8   0BAF           01195         DECFSZ  RE_LOCK_TIME,F                  ;
02E9   2AEE           01196         GOTO    _RT_MINUTES                     ;
02EA                  01197 _RELOCK_REACHED                                 ;
02EA   1771           01198         BSF     LOCKED                          ;
02EB   15F2           01199         BSF     LCD_UPD                         ;
02EC   172B           01200         BSF     AUTOLOCK_ON                     ;LOCK again
02ED   13AB           01201         BCF     RELOCK_ON                       ;prepare the count till un-lock
                      01202                                                 ;
                      01203 ;============================= MINUTES COUNTERS ===============================
02EE                  01204 _RT_MINUTES                                     ;
                      01205         M_CMPL_JG RT_SECONDS,.59,_INCMIN        ;
02EE   0823               M                 movf    RT_SECONDS,w
02EF   3C3B               M                 sublw   .59
02F0   1C03               M                 btfss   STATUS,C
02F1   2AF3               M                 goto    _INCMIN
02F2   2B23           01206         GOTO    _RT_DONE                        ;
                      01207                                                 ;
02F3                  01208 _INCMIN                                         ;
02F3   01A3           01209         CLRF    RT_SECONDS                      ;REAL TIME MINUTES
02F4   0AA4           01210         INCF    RT_MINUTES,F                    ;
02F5   15F2           01211         BSF     LCD_UPD                         ;minutes have been updated so LCD must be updated also
                      01212 ;...............................................;
02F6                  01213 _RESEND_OFF_MSG                                 ;
02F6   08B7           01214         MOVF    RESEND_OFF_COUNT,F              ;see if OFF msg has to be resent
02F7   1903           01215         BTFSC   STATUS,Z                        ;
02F8   2AFD           01216         GOTO    _AUTOSHUTOFF                    ;
02F9   0BB7           01217         DECFSZ  RESEND_OFF_COUNT,F              ;
02FA   2AFD           01218         GOTO    _AUTOSHUTOFF                    ;
02FB   1073           01219         BCF     BEEPER                          ;
02FC   142C           01220         BSF     SND_OFF_MSG                     ;
                      01221 ;...............................................;
02FD                  01222 _AUTOSHUTOFF                                    ;
02FD   1C72           01223         BTFSS   DEVON                           ;
02FE   2B0A           01224         GOTO    PREHEAT_COUNTDOWN               ;
02FF   0BB1           01225         DECFSZ  AUTO_OFF_MINUTES,F              ;AUTO SHUT-OFF minutes count down
0300   2B0A           01226         GOTO    PREHEAT_COUNTDOWN               ;
0301   0BB0           01227         DECFSZ  AUTO_OFF_HOURS,F                ;hours count down
0302   2B04           01228         GOTO    _RELOAD_AO_MINUTES              ;
0303   2B07           01229         GOTO    _AO_DONE                        ;
0304                  01230 _RELOAD_AO_MINUTES                              ;
0304   303C           01231         MOVLW   SIXTY_MINUTES                   ;
0305   00B1           01232         MOVWF   AUTO_OFF_MINUTES                ;
0306   2B0A           01233         GOTO    PREHEAT_COUNTDOWN               ;
0307                  01234 _AO_DONE                                        ;
0307   2238           01235         CALL    DEVICE_OFF                      ;
0308   0876           01236         MOVF    TMPTR_VALUE,W                   ;
0309   00B4           01237         MOVWF   SAVED_TEMPERATURE               ;Save the temperature before going off
                      01238 ;...............................................;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

030A                  01239 PREHEAT_COUNTDOWN                               ;
030A   1D72           01240         BTFSS   BOOST                           ;
030B   2B0F           01241         GOTO    _RT_HOURS                       ;
                      01242                                                 ;
030C   0BB2           01243         DECFSZ  BOOST_MINUTES,F                 ;PRE-HEAT period minutes count down
030D   2B0F           01244         GOTO    _RT_HOURS                       ;
030E   1773           01245         BSF     F_SEND_BOOFF                    ;modification: instead of sending the 
                      01246                                                 ;BOO_OFF_MSG, set the flag for the seconds countdown
                      01247                                                 ;
                      01248 ;============================= HOURS COUNTERS ===============================
030F                  01249 _RT_HOURS                                       ;
                      01250         M_CMPL_JG RT_MINUTES,.59,_INCHR         ;
030F   0824               M                 movf    RT_MINUTES,w
0310   3C3B               M                 sublw   .59
0311   1C03               M                 btfss   STATUS,C
0312   2B14               M                 goto    _INCHR
0313   2B23           01251         GOTO    _RT_DONE                        ;
0314                  01252 _INCHR                                          ;
0314   01A4           01253         CLRF    RT_MINUTES                      ;0 minutes
0315   0AA5           01254         INCF    RT_HOURS,F                      ;next hour
                      01255         M_CMP_JLE RT_HOURS,MAX_HOURS,_BATTERY_COUNTER
0316   0825               M                 movf    RT_HOURS,w
0317   022E               M                 subwf   MAX_HOURS,w     ;v2-v1 > 0
0318   1803               M                 btfsc   STATUS,C
0319   2B1B               M                 goto    $+2
031A   1903               M                 btfsc   STATUS,Z
031B   2B1E               M                 goto    _BATTERY_COUNTER
031C   3001           01256         MOVLW   .1                              ;
031D   00A5           01257         MOVWF   RT_HOURS                        ;roll the clock over
                      01258                                                 ;
                      01259 ;...............................................;
031E                  01260 _BATTERY_COUNTER                                ;
031E   0BBC           01261         DECFSZ  IDLE_BATT_COUNT,F               ;
031F   2B23           01262         GOTO    _RT_DONE                        ;
                      01263                                                 ;
0320   172C           01264         BSF     SND_TEST_MSG                    ;If the counter is exceeded, send a test message
0321   300C           01265         MOVLW   IDLE_BATTERY_TEST               ; and reload the counter
0322   00BC           01266         MOVWF   IDLE_BATT_COUNT                 ;
                      01267                                                 ;
0323                  01268 _RT_DONE                                        ;
0323   0008           01269         RETURN                                  ;
                      01270 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01271 ;If there are no jobs pending and the display must be cupdated, 
                      01272 ;display move the REal Time info into the variables for the LCD
                      01273 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0324                  01274 DISPLAY_REAL_TIME                               ;Display the real time in the clock
0324   301F           01275         MOVLW   b'00011111'                     ;unless some action is in progress
0325   052B           01276         ANDWF   LCD_CHAR3,W                     ;
0326   1D03           01277         BTFSS   STATUS,Z                        ;
0327   2B32           01278         GOTO    _TM1ENDEND                      ;(but don't reset LCD_UPDATE)
                      01279                                                 ;
0328   1DF2           01280         BTFSS   LCD_UPD                         ;
0329   2B32           01281         GOTO    _TM1ENDEND                      ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01282                                                 ;
032A   1471           01283         BSF     MINUTES                         ;
032B   0824           01284         MOVF    RT_MINUTES,W                    ;
032C   23E9           01285         CALL    Convert_to_BCD                  ;convert both hours and minutes to BCD
032D   00F4           01286         MOVWF   MIN_VALUE                       ;
                      01287                                                 ;
032E   0825           01288         MOVF    RT_HOURS,W                      ;
032F   23E9           01289         CALL    Convert_to_BCD                  ;convert to BCD
0330   00F5           01290         MOVWF   HOUR_VALUE                      ;
0331   14F1           01291         BSF     HOURS                           ;
0332                  01292 _TM1ENDEND                                      ;
0332   0008           01293         RETURN                                  ;
                      01294 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0333                  01295 INTERRUPT
                      01296 ;Servo l'interrupt
0333   190B           01297 ISR     BTFSC   _T0IF
0334   1E8B           01298         BTFSS   _T0IE
0335   2B3C           01299         B       ISR_X
                      01300 
                      01301 ;=======================================
                      01302 ;*** BASE TEMPI OGNI 204,8 µS [(256 (CICLI) * 4 (PRESCALE) / 5 (QUARZO 20 MHZ)]
0336   110B           01303         BCF     _T0IF
                      01304 
0337   1C45           01305         SS      TRASMISSIONE_HCS
0338   2B3C           01306         B       ISR_X
                      01307 
0339   30C8           01308         LW      .200
033A   0281           01309         SUBWF   TMR_HCS,F
                      01310 
033B   247E           01311         CALL    GESTIONE_TMR_HCS
                      01312 
                      01313 ;=======================================
033C                  01314 ISR_X
                      01315 POP     M_BANKSEL_0
033C   1303               M                 BCF     STATUS,6
033D   1283               M                 BCF     STATUS,5
033E   084F           01316         FW      BI_FSR
033F   0084           01317         WF      FSR
0340   084E           01318         FW      BI_PCLATH
0341   008A           01319         WF      PCLATH
0342   0E4D           01320         SWAPF   BI_STATUS,W     ;RIPRISTINO DELLO STATUS
0343   0083           01321         MOVWF   STATUS
0344   0EF7           01322         SWAPF   BI_WREG,F       ;RIPRISTINO DEL WREG
0345   0E77           01323         SWAPF   BI_WREG,W
0346   0009           01324         RETFIE
                      01325 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01326 ;LCD driver
                      01327 ;PARAMETERS: LCD DIGIT,VALUE (when displaying minutes, hours and temp)
                      01328 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
0347                  01329 UPDATE_LCD                                      ;
                      01330         M_BANKSEL_2                             ;
0347   1703               M                 BSF     STATUS,6
0348   1283               M                 BCF     STATUS,5
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0349   1387           01331         BCF     LCDCON,LCDEN                    ;this is needed to be able to clear the LCDIF flag
034A   1303           01332         BCF     STATUS,6                        ;bank 0
034B   120D           01333         BCF     LCD_IF                          ;
034C   1703           01334         BSF     STATUS,6                        ;bank 2
034D   1787           01335         BSF     LCDCON,LCDEN                    ;
                      01336                                                 ;
034E   1DF2           01337         BTFSS   LCD_UPD                         ;write only if there is a request
034F   2BE6           01338         GOTO    _LCD_DONE                       ;
                      01339                                                 ;
                      01340 #IFDEF  WAVE_TYPE_B                             ;
0350   3001           01341         MOVLW   1                               ;
0351   06A2           01342         XORWF   TOGGLE_LCD,F                    ;Write only every other frame with WaveType "B"
0352   1903           01343         BTFSC   STATUS,Z                        ;
0353   2BE6           01344         GOTO    _LCD_DONE                       ;
                      01345 #ENDIF                                          ;
                      01346                                                 ;
0354   1E87           01347         BTFSS   LCDCON,WERR                     ;write only if no errors writing to the LCD
0355   2B59           01348         GOTO    _LCDCONT                        ;
0356   1287           01349         BCF     LCDCON,WERR                     ;
                      01350                                                 ;
0357   1E08           01351         BTFSS   LCDPS,WA                        ;write only if WA (write allowed) flag is set
0358   2BE6           01352         GOTO    _LCD_DONE                       ;
                      01353                                                 ;manage here the character flags an blinking
0359                  01354 _LCDCONT                                        ;
0359   11F2           01355         BCF     LCD_UPD                         ;
035A   0AA1           01356         INCF    WR_NOERRORS,F                   ;FOR DEBUG - bANK 2
035B   0190           01357         CLRF    LCDDATA0                        ;first clear the display
035C   0191           01358         CLRF    LCDDATA1                        ;
035D   0193           01359         CLRF    LCDDATA3                        ;
035E   0194           01360         CLRF    LCDDATA4                        ;
035F   0196           01361         CLRF    LCDDATA6                        ;
0360   0197           01362         CLRF    LCDDATA7                        ;
0361   0199           01363         CLRF    LCDDATA9                        ;
0362   019A           01364         CLRF    LCDDATA10                       ;
                      01365                                                 ;
0363   1C71           01366         BTFSS   MINUTES                         ;
0364   2B8D           01367         GOTO    _COLON                          ;
0365   3000           01368         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
0366   008A           01369         MOVWF   PCLATH                          ;
0367   0874           01370         MOVF    MIN_VALUE,W                     ;
0368   390F           01371         ANDLW   0x0F                            ;
0369   200E           01372         CALL    DIGIT_SELECT                    ;
036A   00A3           01373         MOVWF   TEMP_BYT0_B2                    ;Display units of minutes
036B   1823           01374         BTFSC   TEMP_BYT0_B2,0                  ;
036C   1410           01375         BSF     LCDDATA0,0                      ;4A
036D   18A3           01376         BTFSC   TEMP_BYT0_B2,1                  ;
036E   1413           01377         BSF     LCDDATA3,0                      ;4B
036F   1923           01378         BTFSC   TEMP_BYT0_B2,2                  ;
0370   1416           01379         BSF     LCDDATA6,0                      ;4C
0371   19A3           01380         BTFSC   TEMP_BYT0_B2,3                  ;
0372   1419           01381         BSF     LCDDATA9,0                      ;4D
0373   1A23           01382         BTFSC   TEMP_BYT0_B2,4                  ;
0374   1496           01383         BSF     LCDDATA6,1                      ;4E
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0375   1AA3           01384         BTFSC   TEMP_BYT0_B2,5                  ;
0376   1490           01385         BSF     LCDDATA0,1                      ;4F
0377   1B23           01386         BTFSC   TEMP_BYT0_B2,6                  ;
0378   1493           01387         BSF     LCDDATA3,1                      ;4G
                      01388                                                 ;
0379   3000           01389         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
037A   008A           01390         MOVWF   PCLATH                          ;
037B   0E74           01391         SWAPF   MIN_VALUE,W                     ;
037C   390F           01392         ANDLW   0x0F                            ;
037D   200E           01393         CALL    DIGIT_SELECT                    ;Display tens of minute
037E   00A3           01394         MOVWF   TEMP_BYT0_B2                    ;
037F   1823           01395         BTFSC   TEMP_BYT0_B2,0                  ;
0380   1510           01396         BSF     LCDDATA0,2                      ;3A
0381   18A3           01397         BTFSC   TEMP_BYT0_B2,1                  ;
0382   1513           01398         BSF     LCDDATA3,2                      ;3B
0383   1923           01399         BTFSC   TEMP_BYT0_B2,2                  ;
0384   1516           01400         BSF     LCDDATA6,2                      ;3C
0385   19A3           01401         BTFSC   TEMP_BYT0_B2,3                  ;
0386   1519           01402         BSF     LCDDATA9,2                      ;3D
0387   1A23           01403         BTFSC   TEMP_BYT0_B2,4                  ;
0388   1596           01404         BSF     LCDDATA6,3                      ;3E
0389   1AA3           01405         BTFSC   TEMP_BYT0_B2,5                  ;
038A   1590           01406         BSF     LCDDATA0,3                      ;3F
038B   1B23           01407         BTFSC   TEMP_BYT0_B2,6                  ;
038C   1593           01408         BSF     LCDDATA3,3                      ;3G
038D                  01409 _COLON                                          ;
038D   1AF3           01410         BTFSC   COLON                           ;
038E   1619           01411         BSF     LCDDATA9,4                      ;":"
038F                  01412 _HOURS:                                         ;
038F   1CF1           01413         BTFSS   HOURS                           ;
0390   2BB9           01414         GOTO    _1HR                            ;
0391   3000           01415         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
0392   008A           01416         MOVWF   PCLATH                          ;
0393   0875           01417         MOVF    HOUR_VALUE,W                    ;
0394   390F           01418         ANDLW   0x0F                            ;
0395   200E           01419         CALL    DIGIT_SELECT                    ;
0396   00A3           01420         MOVWF   TEMP_BYT0_B2                    ;Display units of hours
0397   1823           01421         BTFSC   TEMP_BYT0_B2,0                  ;
0398   1610           01422         BSF     LCDDATA0,4                      ;2A
0399   18A3           01423         BTFSC   TEMP_BYT0_B2,1                  ;
039A   1613           01424         BSF     LCDDATA3,4                      ;2B
039B   1923           01425         BTFSC   TEMP_BYT0_B2,2                  ;
039C   1616           01426         BSF     LCDDATA6,4                      ;2C
039D   19A3           01427         BTFSC   TEMP_BYT0_B2,3                  ;
039E   1699           01428         BSF     LCDDATA9,5                      ;2D
039F   1A23           01429         BTFSC   TEMP_BYT0_B2,4                  ;
03A0   1696           01430         BSF     LCDDATA6,5                      ;2E
03A1   1AA3           01431         BTFSC   TEMP_BYT0_B2,5                  ;
03A2   1690           01432         BSF     LCDDATA0,5                      ;2F
03A3   1B23           01433         BTFSC   TEMP_BYT0_B2,6                  ;
03A4   1693           01434         BSF     LCDDATA3,5                      ;2G
                      01435                                                 ;
03A5   3000           01436         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03A6   008A           01437         MOVWF   PCLATH                          ;
03A7   0E75           01438         SWAPF   HOUR_VALUE,W                    ;
03A8   390F           01439         ANDLW   0x0F                            ;
03A9   200E           01440         CALL    DIGIT_SELECT                    ;Display tens of hours
03AA   00A3           01441         MOVWF   TEMP_BYT0_B2                    ;
03AB   1823           01442         BTFSC   TEMP_BYT0_B2,0                  ;
03AC   1790           01443         BSF     LCDDATA0,7                      ;1A
03AD   18A3           01444         BTFSC   TEMP_BYT0_B2,1                  ;
03AE   1793           01445         BSF     LCDDATA3,7                      ;1B
03AF   1923           01446         BTFSC   TEMP_BYT0_B2,2                  ;
03B0   1796           01447         BSF     LCDDATA6,7                      ;1C
03B1   19A3           01448         BTFSC   TEMP_BYT0_B2,3                  ;
03B2   1719           01449         BSF     LCDDATA9,6                      ;1D
03B3   1A23           01450         BTFSC   TEMP_BYT0_B2,4                  ;
03B4   1716           01451         BSF     LCDDATA6,6                      ;1E
03B5   1AA3           01452         BTFSC   TEMP_BYT0_B2,5                  ;
03B6   1710           01453         BSF     LCDDATA0,6                      ;1F
03B7   1B23           01454         BTFSC   TEMP_BYT0_B2,6                  ;
03B8   1713           01455         BSF     LCDDATA3,6                      ;1G
03B9                  01456 _1HR:                                           ;
03B9   1971           01457         BTFSC   ONEHR                           ;
03BA   1799           01458         BSF     LCDDATA9,7                      ;1G
03BB                  01459 _3HR                                            ;
03BB   19F1           01460         BTFSC   THREEHR                         ;
03BC   141A           01461         BSF     LCDDATA10,0                     ;1G
03BD                  01462 _12HR                                           ;
03BD   1A71           01463         BTFSC   TWELVEHR                        ;
03BE   1499           01464         BSF     LCDDATA9,1                      ;1G
03BF                  01465 _TEMPERATURE                                    ;
03BF   1EF1           01466         BTFSS   TEMPETR                         ;
03C0   2BDC           01467         GOTO    _LOCKED                         ;
                      01468                                                 ;
03C1   0876           01469         MOVF    TMPTR_VALUE,W                   ;
03C2   00A4           01470         MOVWF   TEMP_BYT1_B2                    ;
03C3                  01471 _TEMPHIGH                                       ;
                      01472         M_CMPL_JNE TMPTR_VALUE,.10,_TEMP_CONT   ;
03C3   0876               M                 movf    TMPTR_VALUE,w
03C4   3A0A               M                 xorlw   .10
03C5   1D03               M                 btfss   STATUS,Z
03C6   2BC9               M                 goto    _TEMP_CONT
03C7   300B           01473         MOVLW   .11                             ;If 10 display 'H'
03C8   00A4           01474         MOVWF   TEMP_BYT1_B2                    ;
03C9                  01475 _TEMP_CONT                                      ;else normal temp 
03C9   3000           01476         MOVLW   HIGH (DIGIT_SELECT)             ;take care of paging and jump tables
03CA   008A           01477         MOVWF   PCLATH                          ;
03CB   0824           01478         MOVF    TEMP_BYT1_B2,W                  ;
03CC   200E           01479         CALL    DIGIT_SELECT                    ;
03CD   00A3           01480         MOVWF   TEMP_BYT0_B2                    ;
03CE   1823           01481         BTFSC   TEMP_BYT0_B2,0                  ;
03CF   149A           01482         BSF     LCDDATA10,1                     ;5A
03D0   18A3           01483         BTFSC   TEMP_BYT0_B2,1                  ;
03D1   1497           01484         BSF     LCDDATA7,1                      ;5B
03D2   1923           01485         BTFSC   TEMP_BYT0_B2,2                  ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03D3   1494           01486         BSF     LCDDATA4,1                      ;5C
03D4   19A3           01487         BTFSC   TEMP_BYT0_B2,3                  ;
03D5   1491           01488         BSF     LCDDATA1,1                      ;5D
03D6   1A23           01489         BTFSC   TEMP_BYT0_B2,4                  ;
03D7   1514           01490         BSF     LCDDATA4,2                      ;5E
03D8   1AA3           01491         BTFSC   TEMP_BYT0_B2,5                  ;
03D9   151A           01492         BSF     LCDDATA10,2                     ;5F
03DA   1B23           01493         BTFSC   TEMP_BYT0_B2,6                  ;
03DB   1517           01494         BSF     LCDDATA7,2                      ;5G
03DC                  01495 _LOCKED                                         ;
03DC   1B71           01496         BTFSC   LOCKED                          ;
03DD   1411           01497         BSF     LCDDATA1,0                      ;
03DE                  01498 _BATTERY                                        ;
03DE   1BF1           01499         BTFSC   BATTLOW                         ;
03DF   1511           01500         BSF     LCDDATA1,2                      ;
03E0                  01501 _ON                                             ;
03E0   1872           01502         BTFSC   DEVON                           ;
03E1   1414           01503         BSF     LCDDATA4,0                      ;
03E2                  01504 _OFF                                            ;
03E2   18F2           01505         BTFSC   DEVOFF                          ;
03E3   1594           01506         BSF     LCDDATA4,3                      ;
03E4                  01507 _BOOST                                          ;
03E4   1972           01508         BTFSC   BOOST                           ;
03E5   1417           01509         BSF     LCDDATA7,0                      ;
03E6                  01510 _LCD_DONE:                                      ;
                      01511         M_BANKSEL_0                             ;
03E6   1303               M                 BCF     STATUS,6
03E7   1283               M                 BCF     STATUS,5
03E8   0008           01512         RETURN                                  ;
                      01513 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01514 ;INPUT:         W in binary
                      01515 ;OUTPUT:        W in BCD
                      01516 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
03E9                  01517 Convert_to_BCD                                  ;
03E9   01A0           01518         CLRF    TEMP_BYT0_B0                    ;bank 0
03EA                  01519 LOOP_BCD:                                       ;
03EA   3EF6           01520         ADDLW   -.10                            ;
03EB   1C03           01521         BTFSS   STATUS,C                        ;
03EC   2BEF           01522         GOTO    SWAPBCD                         ;
03ED   0AA0           01523         INCF    TEMP_BYT0_B0,F                  ;
03EE   2BEA           01524         GOTO    LOOP_BCD                        ;
03EF                  01525 SWAPBCD:                                        ;
03EF   3E0A           01526         ADDLW   .10                             ;
03F0   0EA0           01527         SWAPF   TEMP_BYT0_B0,F                  ;
03F1   0420           01528         IORWF   TEMP_BYT0_B0,W                  ;
03F2   0008           01529         RETURN                                  ;
                      01530 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01531 ;Called from hcs_tx.inc at the end of every message sent.
                      01532 ;Do and A/D conversion to test the battery voltage and decide its
                      01533 ;charge state
                      01534 ;**********************************************************
03F3                  01535 TEST_BATTERY                                    ;
03F3   149F           01536         BSF     GO_DONE                         ;start conversion
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03F4                  01537 _ADCON_GO                                       ;
03F4   189F           01538         BTFSC   GO_DONE                         ;
03F5   2BF4           01539         GOTO    _ADCON_GO                       ;
                      01540                                                 ;
03F6   0000           01541         NOP                                     ;
03F7   1585           01542         BSF     KB0                             ;
03F8   1273           01543         BCF     F_BODY_GUARD                    ;
03F9   0000           01544         NOP                                     ;
                      01545         M_CMPL_JG ADRESH,BATT_HIGH_THRESHLD,_BATTERY_OK;
03FA   081E               M                 movf    ADRESH,w
03FB   3C99               M                 sublw   BATT_HIGH_THRESHLD
03FC   1C03               M                 btfss   STATUS,C
03FD   2C13               M                 goto    _BATTERY_OK
                      01546         M_CMPL_JG ADRESH,BATT_LOW_THRESHLD,_BATTERY_WARNING;
03FE   081E               M                 movf    ADRESH,w
03FF   3C87               M                 sublw   BATT_LOW_THRESHLD
0400   1C03               M                 btfss   STATUS,C
0401   2C0E               M                 goto    _BATTERY_WARNING
                      01547                                                 ;
0402                  01548 _BATTERY_LOW                                    ;
0402   08BD           01549         MOVF    BAT_OFF_MSG_COUNT,F             ;initialized to one at restart, send this messag from
0403   1903           01550         BTFSC   STATUS,Z                        ;  here only once, than the machine is shutoff anyways
0404   2C17           01551         GOTO    _TESTBATT_DONE                  ;
0405   2238           01552         CALL    DEVICE_OFF                      ;
0406   17F1           01553         BSF     BATTLOW                         ;turn on the LOWBATT symbol, no blink
0407   1071           01554         BCF     MINUTES                         ;turn off hours and minutes also
0408   10F1           01555         BCF     HOURS                           ;
0409   1573           01556         BSF     BATTERY_LOW                     ;
040A   10F3           01557         BCF     BATTERY_WARN                    ;
040B   15F2           01558         BSF     LCD_UPD                         ;
040C   03BD           01559         DECF    BAT_OFF_MSG_COUNT,F             ;
040D   2C17           01560         GOTO    _TESTBATT_DONE                  ;
040E                  01561 _BATTERY_WARNING                                ;
040E   14F3           01562         BSF     BATTERY_WARN                    ;
040F   1173           01563         BCF     BATTERY_LOW                     ;
0410   3010           01564         MOVLW   BLINK_PERIOD                    ;
0411   00BB           01565         MOVWF   BATTERY_BLINK_COUNT             ;
0412   2C17           01566         GOTO    _TESTBATT_DONE                  ;
                      01567                                                 ;
0413                  01568 _BATTERY_OK                                     ;
0413   13F1           01569         BCF     BATTLOW                         ;
0414   10F3           01570         BCF     BATTERY_WARN                    ;
0415   1173           01571         BCF     BATTERY_LOW                     ;
0416   15F2           01572         BSF     LCD_UPD                         ;
                      01573                                                 ;
0417                  01574 _TESTBATT_DONE                                  ;
0417   300C           01575         MOVLW   IDLE_BATTERY_TEST               ;in all cases reload the idle counter
0418   00BC           01576         MOVWF   IDLE_BATT_COUNT                 ;
0419   0008           01577         RETURN                                  ;
                      01578 ;**********************************************************
                      01579 ;Called during interrupts, message is being sent, start the converter
                      01580 ;**********************************************************
041A                  01581 AD_START                                        ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

041A   1673           01582         SET     F_BODY_GUARD                    ;
041B   1185           01583         BCF     KB0                             ;
041C   141F           01584         BSF     ADCON0,0                        ;START ADCONVERTER
041D   0008           01585         RETURN                                  ;
                      01586 ;**********************************************************
041E                  01587 CLEAR_RAM_0
041E   301F           01588         MOVLW   01FH            ;INIZIO RAM -1
041F   0084           01589         MOVWF   FSR
                      01590 
0420   0A84           01591 PR      INCF    FSR,F
0421   0180           01592         CLRF    INDF
0422   307F           01593         MOVLW   07FH            ;FINE RAM
0423   0604           01594         XORWF   FSR,W
0424   1D03           01595         SKPZ
0425   2C20           01596         B       PR
                      01597 
0426   0008           01598         RETURN
                      01599 ;******** PULIZIA RAM BANK1 *****************************************
0427                  01600 CLEAR_RAM_1
0427   309F           01601         MOVLW   09FH            ;INIZIO RAM -1
0428   0084           01602         MOVWF   FSR
                      01603 
0429   0A84           01604 PURA1   INCF    FSR,F
042A   0180           01605         CLRF    INDF
042B   30EF           01606         MOVLW   0EFH            ;FINE RAM
042C   0604           01607         XORWF   FSR,W
042D   1D03           01608         SKPZ
042E   2C29           01609         B       PURA1
                      01610 
042F   0008           01611         RETURN
                      01612 ;**********************************************************
0430                  01613 ORG_INCLUDES:
                      01614         #include        <hcs_tx.inc>
                      00001 
                      00002 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      00003 ;TRASMISSIONE HCS
                      00004 ;#DEFINE        TMR_HCS_ON      _TMR1ON
                      00005 
                      00006 ;*** MOVED TO TXMain.asm  *************************************************************
                      00007 ;       CBLOCK  
                      00008 ;
                      00009 ;FLAGS_HCS
                      00010 ;
                      00011 ; BUFFER DI TRASMISSIONE HCS
                      00012 ;HCS1                   ;ROLLING CODE
                      00013 ;HCS2                   ;ROLLING CODE
                      00014 ;HCS3                   ;DISCRIMINANTE (LSB)
                      00015 ;HCS4                   ;7:4 CHANNELS, 3:2 OVERFLOW BITS (UNUSED), DISCRIMINANTE (LSB)
                      00016 ;HCS5                   ;SERIAL NUMBER (LSB)
                      00017 ;HCS6                   ;SERIAL NUMBER
                      00018 ;HCS7                   ;SERIAL NUMBER (MSB)
                      00019 ;HCS8                   ;7:4 CHANNELS CODE (S2, S1, S0, S3)
                      00020 ;HCS9                   ;1 REPEAT, 0 LOW BATT
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00021 ;
                      00022 ;FASE_TX_HCS
                      00023 ;
                      00024 ;CARICA_TIMER_HCS_HI
                      00025 ;CARICA_TIMER_HCS_LO
                      00026 ;
                      00027 ;PUNTA_HCS
                      00028 ;
                      00029 ;COUNT_BIT
                      00030 ;
                      00031 ;TEMP_ROTATE
                      00032 ;
                      00033 ;COUNT_PREAMBOLO
                      00034 ;       ENDC
                      00035 ;-- ALIAS -------------------------------------------------------------
                      00036 ;TMR_HCS        EQU     TMR0
                      00037 ;HEADER_COUNT   EQU     COUNT_PREAMBOLO
                      00038 ;COUNT_DATA     EQU     COUNT_PREAMBOLO
                      00039 ;----------------------------------------------------------------
                      00040 ;
                      00041 ; CODE COMPOSITION INTO TRASMISSION BUFFER
                      00042 ;
                      00043 ;HCS1   BIT 7÷5         0       RESERVED, FORCED TO ZERO
                      00044 ;HCS1   BIT 4           0÷1     LEFT/RIGHT SIDE
                      00045 ;HCS1   BIT 3÷0         0÷F     SERIAL NUMBER HIGH
                      00046 
                      00047 ;HCS2   BIT 7÷0         00÷FF   SERIAL NUMBER
                      00048 
                      00049 ;HCS3   BIT 7÷0         00÷FF   SERIAL NUMBER
                      00050 
                      00051 ;HCS4   BIT 7÷0         00÷FF   SERIAL NUMBER LOW
                      00052 
                      00053 ;HCS5   BIT 7÷3         00÷0A   LEVEL CODE
                      00054 ;HCS5   BIT 2           0÷1     BEEPER
                      00055 ;HCS5   BIT 1           0-1     LEARN MODE ON/OFF
                      00056 ;HCS5   BIT 0           0       PADDING
                      00057 ;HCS6   BIT 7÷0         00÷FF   CHECKSUM
                      00058 ;MESSGE FOR LEARNING: BIT LEARN =1, SERIAL MUST BE VALID, LEFT/RIGHT, BEEPER ON, THE REST = DON'T CARE
                      00059 ;
                      00060 ; DURATA DI UN TE (TEMPO TIPICO)        400 MICROSECONDI
                      00061 ; DURATA DEL PREAMBOLO                   23 TE ALTERNATI HIGH-LOW-HIGH
                      00062 ; DURATA DEL HEADER                      10 TE LOW (4 MILLISECONDI DI PAUSA)
                      00063 ; DURATA DEL SINGOLO BIT                  3 TE: IL 1° HIGH, IL 3° LOW, IL 2° INVERTITO
                      00064 ;                                               DETERMINA IL DATO
                      00065 ;****** RE-DEFINE PORTD *****************************************
                      00066 ;#DEFINE        PWM_HCS         PORTD,7 ;PIN DI TRASMISSIONE HCS  <== new in electric blanket
                      00067 
                      00068 ;****** FLAGS_HCS *****************************************
                      00069 ;#DEFINE        TRASMISSIONE_HCS        FLAGS_HCS,0     ;
                      00070 ;#DEFINE        ALTO1_BASSO0            FLAGS_HCS,1     ;FLAG DA INVERTIRE CHE DETERMINA TE2
                      00071 
                      00072         IFDEF   NO_COMMENT
                      00073 #DEFINE                 FLAGS_HCS,2     ;
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00074 #DEFINE                 FLAGS_HCS,3     ;
                      00075 #DEFINE                 FLAGS_HCS,4     ;
                      00076 #DEFINE                 FLAGS_HCS,5     ;
                      00077 #DEFINE         FLAGS_HCS,6     ;
                      00078 #DEFINE         FLAGS_HCS,7     ;
                      00079 
                      00080 ;****** FLAGS_HCS2 *************************************
                      00081 ;#DEFINE                FLAGS_HCS2,0    ;
                      00082 #DEFINE         FLAGS_HCS2,1    ;
                      00083         ENDIF
                      00084 
                      00085 ;*******************************************************
                      00086 
                      00087 
                      00088 ;*******************************************************
                      00089 ;       ORG             ORG_INCLUDES
0430                  00090 INIZIO_TX_HCS
                      00091 ;*** CARICARE BUFFER HCS
                      00092 ;       RAM1
                      00093 
                      00094 
0430   01C6           00095         CLRF    FASE_TX_HCS
0431   3017           00096         MOVLW   .23
0432   00CC           00097         MOVWF   COUNT_PREAMBOLO
                      00098 
0433   303F           00099         LW      HCS1
0434   00C9           00100         WF      PUNTA_HCS
                      00101 
0435   083F           00102         FW      HCS1
0436   00CB           00103         WF      TEMP_ROTATE
                      00104 
0437   3008           00105         LW      .8
0438   00CA           00106         WF      COUNT_BIT
                      00107 
                      00108         ;LW     0BH             ;COMPARE MODE, TRIGGER SPECIAL EVENT (CCP1 RESETS TMR1)
                      00109         ;WF     CCP1CON
                      00110 
0439   2472           00111         CALL    SET_TMR_TX
043A   1445           00112         SET     TRASMISSIONE_HCS
                      00113 
043B   0008           00114 ITH_X   RETURN
                      00115 ;*******************************************************
                      00116 
                      00117 
                      00118 ;*******************************************************
043C                  00119 FASE_PREAMBOLO
043C   3080           00120         MOVLW   0X80            ;1      ;TRASMISSIONE PREAMBOLO
043D   0688           00121         XORWF   PORTD,F         ;2              <-- gi:(WAS MOVLW 08H , XORWF PORTA,3?)
                      00122 
043E   0BCC           00123         DECFSZ  COUNT_PREAMBOLO,F
043F   2C43           00124         B       FP_X
                      00125 
0440   300A           00126         MOVLW   .10
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0441   00CC           00127         MOVWF   HEADER_COUNT
0442   0AC6           00128         INCF    FASE_TX_HCS,F
                      00129 
0443   2C87           00130 FP_X    B       GTH_X
                      00131 ;*******************************************************
                      00132 
                      00133 
                      00134 ;*******************************************************
0444                  00135 FASE_HEADER
0444   0000           00136         NOP                     ;1
0445   1388           00137         CANC    PWM_HCS         ;2      ;TRASMISSIONE HEADER
                      00138 
0446   0BCC           00139         DECFSZ  HEADER_COUNT,F
0447   2C4B           00140         B       FH_X
                      00141 
0448   3030           00142         MOVLW   MESSAGE_LENGTH          ;48 BITS...
0449   00CC           00143         MOVWF   COUNT_DATA
044A   0AC6           00144         INCF    FASE_TX_HCS,F
                      00145 
044B   2C87           00146 FH_X    B       GTH_X
                      00147 ;*******************************************************
                      00148 
                      00149 
                      00150 ;*******************************************************
044C                  00151 FASE_PWM_HI
044C   0000           00152         NOP                     ;1
044D   1788           00153         SET     PWM_HCS         ;2
                      00154 
044E   2464           00155         CALL    CALCOLA_PIN
044F   0AC6           00156         INCF    FASE_TX_HCS,F   ;1
                      00157 
0450   034C           00158         DECF    COUNT_DATA,W
0451   1903           00159         SKPNZ
0452   241A           00160         CALL    AD_START                ;(FIRST PUT KB0 TO GROUND,
                      00161 
                      00162 
0453   2C87           00163 FPH_X   B       GTH_X
                      00164 ;*******************************************************
                      00165 ;TURN ON ANALOGICO...
                      00166 ;
                      00167 
                      00168 
                      00169 
                      00170 ;*******************************************************
0454                  00171 FASE_PWM_DATA                   ;IL PIN ARRIVA ALTO...
0454   18C5           00172         IFSET   ALTO1_BASSO0    ;1      ;...SE DEVO TRASMETTERE 1... 
0455   1388           00173         CANC    PWM_HCS         ;2      ;...LO INVERTO,...
                      00174                                 ;...SE DEVO TRASMETTERE 0 LO LASCIO ALTO
0456   0AC6           00175         INCF    FASE_TX_HCS,F
                      00176 
0457   034C           00177         DECF    COUNT_DATA,W
0458   1903           00178         SKPNZ
0459   23F3           00179         CALL    TEST_BATTERY                    ;..REMEMBER TO SHUT OFF)
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00180 
                      00181 
045A   2C87           00182         B       GTH_X
                      00183 ;*******************************************************
                      00184 
                      00185 
                      00186 ;*******************************************************
045B                  00187 FASE_PWM_LO
045B   0000           00188         NOP                     ;1
045C   1388           00189         CANC    PWM_HCS         ;2
                      00190 
045D   03C6           00191         DECF    FASE_TX_HCS,F
045E   03C6           00192         DECF    FASE_TX_HCS,F
                      00193 
045F   0BCC           00194         DECFSZ  COUNT_DATA,F
0460   2C63           00195         B       FPL_X
                      00196 
                      00197 
0461   1045           00198         CANC    TRASMISSIONE_HCS
                      00199 
0462   2477           00200         CALL    CANC_TMR_TX
                      00201 
0463   2C87           00202 FPL_X   B       GTH_X
                      00203 ;*******************************************************
                      00204 
                      00205 
                      00206 ;*******************************************************
0464                  00207 CALCOLA_PIN
0464   10C5           00208         CANC    ALTO1_BASSO0
0465   0CCB           00209         RRF     TEMP_ROTATE,F
0466   1803           00210         SKPNC
0467   14C5           00211         SET     ALTO1_BASSO0
                      00212         
0468   0BCA           00213         DECFSZ  COUNT_BIT,F
0469   2C71           00214         B       CP_X
                      00215 
046A   0AC9           00216         INCF    PUNTA_HCS,F
046B   0849           00217         FW      PUNTA_HCS
046C   0084           00218         WF      FSR
046D   0800           00219         FW      INDF
046E   00CB           00220         WF      TEMP_ROTATE
                      00221 
046F   3008           00222         MOVLW   .8
0470   00CA           00223         MOVWF   COUNT_BIT
                      00224 
0471   0008           00225 CP_X    RETURN
                      00226 ;*******************************************************
                      00227 
                      00228 
                      00229 ;*******************************************************
0472                  00230 SET_TMR_TX
0472   3038           00231         LW      -.200  ;<----- CAMBIA PRESCALE PER 400uS
0473   0081           00232         WF      TMR_HCS
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00233 
0474   110B           00234         CANC    _T0IF
0475   168B           00235         SET     _T0IE
                      00236 
0476   0008           00237         RETURN
                      00238 ;*******************************************************
                      00239 
                      00240 
                      00241 ;*******************************************************
0477                  00242 CANC_TMR_TX
                      00243 
0477   128B           00244         CANC    _T0IE
0478   1045           00245         CANC    TRASMISSIONE_HCS
                      00246         
0479   1405           00247         SET     TX_ENABLE
047A   1683           00248         BANK1
047B   1405           00249         BSF     TXENBL_TRIS
047C   1283           00250         BANK0
                      00251 
047D   0008           00252         RETURN
                      00253 ;*******************************************************
                      00254 
                      00255 
                      00256 ;*******************************************************
047E                  00257 GESTIONE_TMR_HCS
047E   3004           00258         LW      HIGH    TAB_FASE_HCS
047F   008A           00259         WF      PCLATH
                      00260         ;ORG
                      00261 
0480   0846           00262         FW      FASE_TX_HCS
0481   0782           00263         ADDWF   PCL,F
                      00264 
0482                  00265 TAB_FASE_HCS
0482   2C3C           00266         B       FASE_PREAMBOLO  ;0
0483   2C44           00267         B       FASE_HEADER     ;1
0484   2C4C           00268         B       FASE_PWM_HI     ;2
0485   2C54           00269         B       FASE_PWM_DATA   ;3
0486                  00270 END_TAB_FASE_HCS
0486   2C5B           00271         B       FASE_PWM_LO     ;4
                      00272 
                      00273         IF HIGH(TAB_FASE_HCS) != HIGH(END_TAB_FASE_HCS)
                      00274         ERROR "TAB_COMANDO: OVERFLOW del PCL"
                      00275         ENDIF
                      00276 
0487   0008           00277 GTH_X   RETURN                  ;A INTERRUPT
                      00278 ;*******************************************************
                      00279 
                      00280         IFDEF   NO_COMMENT
                      00281         NOP
                      00282         NOP
                      00283         NOP
                      00284         NOP
                      00285         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00286         NOP
                      00287         NOP
                      00288         NOP
                      00289         NOP
                      00290         NOP
                      00291         NOP
                      00292         NOP
                      00293         NOP
                      00294         NOP
                      00295         NOP
                      00296         NOP
                      00297         NOP
                      00298         NOP
                      00299         NOP
                      00300         NOP
                      00301         NOP
                      00302         NOP
                      00303         NOP
                      00304         NOP
                      00305         NOP
                      00306         NOP
                      00307         NOP
                      00308         NOP
                      00309         NOP
                      00310         NOP
                      00311         NOP
                      00312         NOP
                      00313         NOP
                      00314         NOP
                      00315         NOP
                      00316         NOP
                      00317         NOP
                      00318         NOP
                      00319         NOP
                      00320         NOP
                      00321         NOP
                      00322         NOP
                      00323         NOP
                      00324         NOP
                      00325         NOP
                      00326         NOP
                      00327         NOP
                      00328         NOP
                      00329         NOP
                      00330         NOP
                      00331         NOP
                      00332         NOP
                      00333         NOP
                      00334         NOP
                      00335         NOP
                      00336         NOP
                      00337         NOP
                      00338         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00339         NOP
                      00340         NOP
                      00341         NOP
                      00342         NOP
                      00343         NOP
                      00344         NOP
                      00345         NOP
                      00346         NOP
                      00347         NOP
                      00348         NOP
                      00349         NOP
                      00350         NOP
                      00351         NOP
                      00352         NOP
                      00353         NOP
                      00354         NOP
                      00355         NOP
                      00356         NOP
                      00357         NOP
                      00358         NOP
                      00359         NOP
                      00360         NOP
                      00361         NOP
                      00362         NOP
                      00363         NOP
                      00364         NOP
                      00365         NOP
                      00366         NOP
                      00367         NOP
                      00368         NOP
                      00369         NOP
                      00370         NOP
                      00371         NOP
                      00372         NOP
                      00373         NOP
                      00374         NOP
                      00375         NOP
                      00376         NOP
                      00377         NOP
                      00378         NOP
                      00379         NOP
                      00380         NOP
                      00381         NOP
                      00382         NOP
                      00383         NOP
                      00384         NOP
                      00385         NOP
                      00386         NOP
                      00387         NOP
                      00388         NOP
                      00389         NOP
                      00390         NOP
                      00391         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00392         NOP
                      00393         NOP
                      00394         NOP
                      00395         NOP
                      00396         NOP
                      00397         NOP
                      00398         NOP
                      00399         NOP
                      00400         NOP
                      00401         NOP
                      00402         NOP
                      00403         NOP
                      00404         NOP
                      00405         NOP
                      00406         NOP
                      00407         NOP
                      00408         NOP
                      00409         NOP
                      00410         NOP
                      00411         NOP
                      00412         NOP
                      00413         NOP
                      00414         NOP
                      00415         NOP
                      00416         NOP
                      00417         NOP
                      00418         NOP
                      00419         NOP
                      00420         NOP
                      00421         NOP
                      00422         NOP
                      00423         NOP
                      00424         NOP
                      00425         RETURN
                      00426         NOP
                      00427         NOP
                      00428         NOP
                      00429         NOP
                      00430         NOP
                      00431         NOP
                      00432         NOP
                      00433         NOP
                      00434         NOP
                      00435         NOP
                      00436         NOP
                      00437         NOP
                      00438         NOP
                      00439         NOP
                      00440         NOP
                      00441         NOP
                      00442         NOP
                      00443         NOP
                      00444         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00445         NOP
                      00446         NOP
                      00447         NOP
                      00448         NOP
                      00449         NOP
                      00450         NOP
                      00451         NOP
                      00452         NOP
                      00453         NOP
                      00454         NOP
                      00455         NOP
                      00456         NOP
                      00457         NOP
                      00458         NOP
                      00459         NOP
                      00460         NOP
                      00461         NOP
                      00462         NOP
                      00463         NOP
                      00464         NOP
                      00465         NOP
                      00466         NOP
                      00467         NOP
                      00468         NOP
                      00469         NOP
                      00470         NOP
                      00471         NOP
                      00472         NOP
                      00473         NOP
                      00474         NOP
                      00475         NOP
                      00476         NOP
                      00477         NOP
                      00478         NOP
                      00479         NOP
                      00480         NOP
                      00481         NOP
                      00482         NOP
                      00483         NOP
                      00484         NOP
                      00485         NOP
                      00486         NOP
                      00487         NOP
                      00488         NOP
                      00489         NOP
                      00490         NOP
                      00491         NOP
                      00492         NOP
                      00493         NOP
                      00494         NOP
                      00495         NOP
                      00496         NOP
                      00497         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00498         NOP
                      00499         NOP
                      00500         NOP
                      00501         NOP
                      00502         NOP
                      00503         NOP
                      00504         NOP
                      00505         NOP
                      00506         NOP
                      00507         NOP
                      00508         NOP
                      00509         NOP
                      00510         NOP
                      00511         NOP
                      00512         NOP
                      00513         NOP
                      00514         NOP
                      00515         NOP
                      00516         NOP
                      00517         NOP
                      00518         NOP
                      00519         NOP
                      00520         NOP
                      00521         NOP
                      00522         NOP
                      00523         NOP
                      00524         NOP
                      00525         NOP
                      00526         NOP
                      00527         NOP
                      00528         NOP
                      00529         NOP
                      00530         NOP
                      00531         NOP
                      00532         NOP
                      00533         NOP
                      00534         NOP
                      00535         NOP
                      00536         NOP
                      00537         NOP
                      00538         NOP
                      00539         NOP
                      00540         NOP
                      00541         NOP
                      00542         NOP
                      00543         NOP
                      00544         NOP
                      00545         NOP
                      00546         NOP
                      00547         NOP
                      00548         NOP
                      00549         NOP
                      00550         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00551         NOP
                      00552         NOP
                      00553         NOP
                      00554         NOP
                      00555         NOP
                      00556         NOP
                      00557         NOP
                      00558         NOP
                      00559         NOP
                      00560         NOP
                      00561         NOP
                      00562         NOP
                      00563         NOP
                      00564         NOP
                      00565         NOP
                      00566         NOP
                      00567         NOP
                      00568         NOP
                      00569         NOP
                      00570         NOP
                      00571         NOP
                      00572         NOP
                      00573         NOP
                      00574         NOP
                      00575         NOP
                      00576         NOP
                      00577         NOP
                      00578         NOP
                      00579         NOP
                      00580         NOP
                      00581         NOP
                      00582         NOP
                      00583         NOP
                      00584         NOP
                      00585         NOP
                      00586         NOP
                      00587         NOP
                      00588         NOP
                      00589         NOP
                      00590         NOP
                      00591         NOP
                      00592         NOP
                      00593         NOP
                      00594         NOP
                      00595         NOP
                      00596         NOP
                      00597         NOP
                      00598         NOP
                      00599         NOP
                      00600         NOP
                      00601         NOP
                      00602         NOP
                      00603         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00604         NOP
                      00605         NOP
                      00606         NOP
                      00607         NOP
                      00608         NOP
                      00609         NOP
                      00610         NOP
                      00611         NOP
                      00612         NOP
                      00613         NOP
                      00614         NOP
                      00615         NOP
                      00616         NOP
                      00617         NOP
                      00618         NOP
                      00619         NOP
                      00620         NOP
                      00621         NOP
                      00622         NOP
                      00623         NOP
                      00624         NOP
                      00625         NOP
                      00626         NOP
                      00627         NOP
                      00628         NOP
                      00629         NOP
                      00630         NOP
                      00631         NOP
                      00632         NOP
                      00633         NOP
                      00634         NOP
                      00635         NOP
                      00636         NOP
                      00637         NOP
                      00638         NOP
                      00639         NOP
                      00640         NOP
                      00641         NOP
                      00642         NOP
                      00643         NOP
                      00644         NOP
                      00645         NOP
                      00646         NOP
                      00647         NOP
                      00648         NOP
                      00649         NOP
                      00650         NOP
                      00651         NOP
                      00652         NOP
                      00653         NOP
                      00654         NOP
                      00655         NOP
                      00656         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00657         NOP
                      00658         NOP
                      00659         NOP
                      00660         NOP
                      00661         NOP
                      00662         NOP
                      00663         NOP
                      00664         NOP
                      00665         NOP
                      00666         NOP
                      00667         NOP
                      00668         NOP
                      00669         NOP
                      00670         NOP
                      00671         NOP
                      00672         NOP
                      00673         NOP
                      00674         NOP
                      00675         NOP
                      00676         NOP
                      00677         NOP
                      00678         NOP
                      00679         NOP
                      00680         NOP
                      00681         NOP
                      00682         NOP
                      00683         NOP
                      00684         NOP
                      00685         NOP
                      00686         NOP
                      00687         NOP
                      00688         NOP
                      00689         NOP
                      00690         NOP
                      00691         NOP
                      00692         NOP
                      00693         NOP
                      00694         NOP
                      00695         NOP
                      00696         NOP
                      00697         NOP
                      00698         NOP
                      00699         NOP
                      00700         NOP
                      00701         NOP
                      00702         NOP
                      00703         NOP
                      00704         NOP
                      00705         NOP
                      00706         NOP
                      00707         NOP
                      00708         NOP
                      00709         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00710         NOP
                      00711         NOP
                      00712         NOP
                      00713         NOP
                      00714         NOP
                      00715         NOP
                      00716         NOP
                      00717         NOP
                      00718         NOP
                      00719         NOP
                      00720         NOP
                      00721         NOP
                      00722         NOP
                      00723         NOP
                      00724         NOP
                      00725         NOP
                      00726         NOP
                      00727         NOP
                      00728         NOP
                      00729         NOP
                      00730         NOP
                      00731         NOP
                      00732         NOP
                      00733         NOP
                      00734         NOP
                      00735         NOP
                      00736         NOP
                      00737         NOP
                      00738         NOP
                      00739         NOP
                      00740         NOP
                      00741         NOP
                      00742         NOP
                      00743         NOP
                      00744         NOP
                      00745 
                      00746         ENDIF
                      01615 
                      01616 
                      01617 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01618 ;Jump table selection of Serial Number digits (28sb)
                      01619 ;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                      01620         ;ATTENTION: END OF PAGE 1
                      01621 
07FC                  01622         org     0x7FC           ;lookout this OFFSET is fixed!!!!!!!!
07FC   34A8           01623 GET_SERIAL_3    RETLW   0xA8    ;serial number (lsb)
07FD   34CB           01624 GET_SERIAL_2    RETLW   0xCB    ;serial number
07FE   34ED           01625 GET_SERIAL_1    RETLW   0xED    ;serial number
07FF   340F           01626 GET_SERIAL_0    RETLW   0x0F    ;low nibble only: msb serial number
                      01627 
                      01628 
0800                  01629         org     0x800
0800   0000           01630         NOP
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01631         
                      01632         END                       ; directive 'end of program'
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 56


SYMBOL TABLE
  LABEL                             VALUE 

ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000004
ADCS1                             00000005
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADJUST_CLK_PHASE                  0000002D
ADJUST_RT                         LCD_CHAR2,7
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AD_START                          0000041A
ALTO1_BASSO0                      FLAGS_HCS,1
AN0                               00000000
AN1                               00000001
AN2                               00000002
AN3                               00000003
AN4                               00000004
AN5                               00000005
AN6                               00000006
AN7                               00000007
ANSEL                             00000091
AUTOLOCK_DEBOUNCE                 00000040
AUTOLOCK_OFF_TIME                 0000001E
AUTOLOCK_ON                       LCD_CHAR3,6
AUTO_OFF_12HR                     0000000C
AUTO_OFF_1HR                      00000001
AUTO_OFF_3HR                      00000003
AUTO_OFF_HOURS                    00000030
AUTO_OFF_MINUTES                  00000031
AUTO_OFF_OFF                      00000000
BACKLIGHT                         PORTB,6
BACKLIGHT_CNT                     00000027
BACKLIGHT_PERIOD                  0000001E
BANK0                             BCF     STATUS,RP0
BANK1                             BSF     STATUS,RP0
BATTERY_BLINK_COUNT               0000003B
BATTERY_LOW                       LCD_CHAR5,2
BATTERY_WARN                      LCD_CHAR5,1
BATTLOW                           LCD_CHAR1,7
BATT_HIGH_THRESHLD                00000099
BATT_LOW_THRESHLD                 00000087
BAT_OFF_MSG_COUNT                 0000003D
BEEPER                            LCD_CHAR5,0
BF                                00000000
BIASMD                            00000006
BI_FSR                            0000004F
BI_PCLATH                         0000004E
BI_STATUS                         0000004D
BI_WREG                           00000077
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 57


SYMBOL TABLE
  LABEL                             VALUE 

BLINK_2P_PERIOD                   00000020
BLINK_COUNT                       00000028
BLINK_PERIOD                      00000010
BLINK_TIME                        000001F4
BOOST                             LCD_CHAR2,2
BOOST_ACT                         LCD_CHAR5,3
BOOST_MINUTES                     00000032
BOOST_PERIOD                      0000001E
BOOST_SECONDS                     00000033
BRGH                              00000002
BTN_ACT_PDG                       LCD_CHAR3,1
C                                 00000000
C1IE                              00000005
C1IF                              00000005
C1INV                             00000004
C1OUT                             00000006
C2IE                              00000006
C2IF                              00000006
C2INV                             00000005
C2OUT                             00000007
C2SYNC                            00000000
CALCOLA_PIN                       00000464
CANC                              BCF
CANC_TMR_TX                       00000477
CARICA_TIMER_HCS_HI               00000047
CARICA_TIMER_HCS_LO               00000048
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CIS                               00000003
CKE                               00000006
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 58


SYMBOL TABLE
  LABEL                             VALUE 

CKP                               00000004
CLCKSET_ACT                       LCD_CHAR3,3
CLEAR_RAM_0                       0000041E
CLEAR_RAM_1                       00000427
CLKP_1224                         00000001
CLKP_HOUR_12                      0000000C
CLKP_HOUR_24                      00000018
CLKP_HOUR_ADJ                     00000003
CLKP_HOUR_DISP12                  00000012
CLKP_HOUR_DISP24                  00000024
CLKP_MIN_ADJ                      00000002
CLKP_NOTHING                      00000000
CLOCK_SET                         NEW_BUTTON_CONFIG,5
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON0                            0000009C
CMCON1                            00000097
COLON                             LCD_CHAR5,5
COM0                              PORTB,4
COM1                              PORTB,5
COM2                              PORTA,2
COM3                              PORTD,0
COUNT_BIT                         0000004A
COUNT_DATA                        0000004C
COUNT_PREAMBOLO                   0000004C
CP_X                              00000471
CREN                              00000004
CS0                               00000002
CS1                               00000003
CSRC                              00000007
Convert_to_BCD                    000003E9
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DEBOUNCE_AUTOLOCK                 000007D0
DEBOUNCE_CNT                      00000026
DEBOUNCE_NORMAL                   000000C8
DEBOUNCE_PERIOD                   00000006
DEBOUNCING                        LCD_CHAR3,0
DEBUG_OUT                         PORTE,0
DEVICE_OFF                        00000238
DEVOFF                            LCD_CHAR2,1
DEVON                             LCD_CHAR2,0
DIGIT_SELECT                      0000000E
DISPLAY_REAL_TIME                 00000324
D_A                               00000005
EEADRH                            0000010F
EEADRL                            0000010D
EECON1                            0000018C
EECON2                            0000018D
EEDATH                            0000010E
EEDATL                            0000010C
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 59


SYMBOL TABLE
  LABEL                             VALUE 

EEIE                              00000007
EEIF                              00000007
EEPGD                             00000007
EERD                              00000000
EEWR                              00000001
END_TAB_FASE_HCS                  00000486
F                                 00000001
FASE_HEADER                       00000444
FASE_PREAMBOLO                    0000043C
FASE_PWM_DATA                     00000454
FASE_PWM_HI                       0000044C
FASE_PWM_LO                       0000045B
FASE_TX_HCS                       00000046
FERR                              00000002
FH_X                              0000044B
FILL_RESEND_PERIOD                00000233
FLAGS_HCS                         00000045
FPH_X                             00000453
FPL_X                             00000463
FP_X                              00000443
FSR                               00000004
FW                                MOVFW
F_BODY_GUARD                      LCD_CHAR5,4
F_RESEND_BOOFF                    LCD_CHAR5,7
F_SEND_BOOFF                      LCD_CHAR5,6
GESTIONE_TMR_HCS                  0000047E
GET_SERIAL_0                      000007FF
GET_SERIAL_1                      000007FE
GET_SERIAL_2                      000007FD
GET_SERIAL_3                      000007FC
GIE                               00000007
GO_DONE                           ADCON0,1
GTH_X                             00000487
HANDLE_BUTTONS                    00000108
HCS1                              0000003F
HCS2                              00000040
HCS3                              00000041
HCS4                              00000042
HCS5                              00000043
HCS6                              00000044
HEADER_COUNT                      0000004C
HEAT_ACT                          LCD_CHAR3,5
HEAT_ADJ_DEBOUNCE                 0000000C
HEAT_MSG_COUNTDWN                 00000009
HEAT_MSG_DELAY                    0000012C
HOURS                             LCD_CHAR1,1
HOUR_VALUE                        00000075
HTS                               00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IDLE_BATTERY_TEST                 0000000C
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 60


SYMBOL TABLE
  LABEL                             VALUE 

IDLE_BATT_COUNT                   0000003C
IFCANC                            BTFSS
IFSET                             BTFSC
INDF                              00000000
INIZIO_TX_HCS                     00000430
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTERRUPT                         00000333
INTF                              00000001
IOC                               00000096
IOC4                              00000004
IOC5                              00000005
IOC6                              00000006
IOC7                              00000007
IOCB                              00000096
IOCB4                             00000004
IOCB5                             00000005
IOCB6                             00000006
IOCB7                             00000007
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
IRVST                             00000005
ISR                               00000333
ISR_X                             0000033C
ITH_X                             0000043B
KB0                               PORTA,3
KB1                               PORTD,1
KB2                               PORTD,2
KB3                               PORTD,3
KB4                               PORTD,4
KB5                               PORTD,5
KB6                               PORTD,6
KB7                               PORTE,0
KB8                               PORTE,1
LCD0                              PORTB,0
LCD1                              PORTB,1
LCD10                             PORTC,5
LCD11                             PORTC,4
LCD2                              PORTB,2
LCD3                              PORTB,3
LCD4                              PORTA,4
LCD5                              PORTA,5
LCD6                              PORTC,3
LCD7                              PORTA,1
LCD8                              PORTC,7
LCD9                              PORTC,6
LCDA                              00000005
LCDCON                            00000107
LCDDATA0                          00000110
LCDDATA1                          00000111
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 61


SYMBOL TABLE
  LABEL                             VALUE 

LCDDATA10                         0000011A
LCDDATA11                         0000011B
LCDDATA2                          00000112
LCDDATA3                          00000113
LCDDATA4                          00000114
LCDDATA5                          00000115
LCDDATA6                          00000116
LCDDATA7                          00000117
LCDDATA8                          00000118
LCDDATA9                          00000119
LCDEN                             00000007
LCDIE                             00000004
LCDIF                             00000004
LCDPS                             00000108
LCDSE0                            0000011C
LCDSE1                            0000011D
LCDSE2                            0000011E
LCD_CHAR1                         00000071
LCD_CHAR2                         00000072
LCD_CHAR3                         0000002B
LCD_CHAR4                         0000002C
LCD_CHAR5                         00000073
LCD_FRAME_FREQ                    00000040
LCD_FRAME_PERIOD                  00003D09
LCD_IF                            PIR2,LCDIF
LCD_PRESCALE                      00000003
LCD_TICK                          00007A12
LCD_UPD                           LCD_CHAR2,3
LED1                              PORTB,7
LED1_CLOCK                        00000022
LED1_OFF_PERIOD                   00000BB8
LED1_ON_PERIOD                    0000012C
LED1_STATE                        LCD_CHAR2,4
LMUX0                             00000000
LMUX1                             00000001
LOCKED                            LCD_CHAR1,6
LOOP_BCD                          000003EA
LP0                               00000000
LP1                               00000001
LP2                               00000002
LP3                               00000003
LTS                               00000001
LVDCON                            00000109
LVDEN                             00000004
LVDIE                             00000002
LVDIF                             00000002
LVDL0                             00000000
LVDL1                             00000001
LVDL2                             00000002
LW                                MOVLW
MANAGE_LED1                       0000028C
MASKTA                            b'11000001'
MASKTB                            b'00000000'
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 62


SYMBOL TABLE
  LABEL                             VALUE 

MASKTC                            b'00000111'
MASKTD                            b'00111110'
MASKTE                            b'11111110'
MAX_HOURS                         0000002E
MAX_TEMP                          0000000A
MCLR                              PORTE,3
MESSAGE_LENGTH                    00000030
MILLI                             000003E8
MINUS                             NEW_BUTTON_CONFIG,3
MINUS_BUT                         LCD_CHAR2,6
MINUTES                           LCD_CHAR1,0
MIN_VALUE                         00000074
MODE                              NEW_BUTTON_CONFIG,2
MODE_ACT                          LCD_CHAR3,2
MSG_PAUSE_PERIOD                  00000001
MULTIPLEX                         00000004
M_BANKSEL_0                       
M_BANKSEL_1                       
M_BANKSEL_2                       
M_BANKSEL_3                       
M_CMPL_JE                         
M_CMPL_JG                         
M_CMPL_JGE                        
M_CMPL_JL                         
M_CMPL_JNE                        
M_CMP_JE                          
M_CMP_JG                          
M_CMP_JGE                         
M_CMP_JL                          
M_CMP_JLE                         
M_CMP_JNE                         
NEW_BUTTON_CONFIG                 00000029
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OERR                              00000001
OLD_BUTTON_CONFIG                 0000002A
ONEHR                             LCD_CHAR1,2
OPTION_REG                        00000081
ORG_INCLUDES                      00000430
OSCCON                            0000008F
OSCTUNE                           00000090
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 63


SYMBOL TABLE
  LABEL                             VALUE 

OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000003
P                                 00000004
PAUSE_COUNT                       0000003A
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PERCENT_BATT_HIGH_THRESHLD        0000003C
PERCENT_BATT_LOW_THRESHLD         00000035
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PLUS                              NEW_BUTTON_CONFIG,4
PLUS_BUT                          LCD_CHAR2,5
POP                               0000033C
PORTA                             00000005
PORTA6                            "NOT USED"
PORTA7                            "NOT USED"
PORTB                             00000006
PORTC                             00000007
PORTC0                            "DONT KNOW"
PORTC1                            "DONT KNOW"
PORTC2                            "DONT KNOW"
PORTD                             00000008
PORTE                             00000009
PR                                00000420
PR2                               00000092
PREHEAT                           NEW_BUTTON_CONFIG,1
PREHEAT_COUNTDOWN                 0000030A
PRE_MESSAGE_TIMER                 00000035
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PUNTA_HCS                         00000049
PURA1                             00000429
PUSH                              00000004
PWM_HCS                           PORTD,7
PW_OFF_PERIOD                     00000060
PW_ON_PERIOD                      00000009
R                                 00000002
RAM0                              BCF     STATUS,RP0
RAM1                              BSF     STATUS,RP0
RAM_0                             BCF     STATUS,RP0
RAM_1                             BSF     STATUS,RP0
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 64


SYMBOL TABLE
  LABEL                             VALUE 

RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_WRITE                        00000002
REAL_TIME_SERVICES                000002D5
RELOCK_ON                         LCD_CHAR3,7
RESEND_BOOST_PERIOD               0000000F
RESEND_OFF_COUNT                  00000037
RESEND_ON_COUNT_H                 00000039
RESEND_ON_COUNT_L                 00000038
REXMIT_COUNT                      00000036
REXMIT_EXTEND                     00000003
REXMIT_NORMAL                     00000002
RE_LOCK_TIME                      0000002F
RP0                               00000005
RP1                               00000006
RT_HOURS                          00000025
RT_MINUTES                        00000024
RT_SECONDS                        00000023
RX9                               00000006
RX9D                              00000000
R_W                               00000002
S                                 00000003
S0C0                              00000000
S0C1                              00000000
S0C2                              00000000
S0C3                              00000000
S10C0                             00000002
S10C1                             00000002
S10C2                             00000002
S10C3                             00000002
S11C0                             00000003
S11C1                             00000003
S11C2                             00000003
S11C3                             00000003
S12C0                             00000004
S12C1                             00000004
S12C2                             00000004
S12C3                             00000004
S13C0                             00000005
S13C1                             00000005
S13C2                             00000005
S13C3                             00000005
S14C0                             00000006
S14C1                             00000006
S14C2                             00000006
S14C3                             00000006
S15C0                             00000007
S15C1                             00000007
S15C2                             00000007
S15C3                             00000007
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 65


SYMBOL TABLE
  LABEL                             VALUE 

S16C0                             00000000
S16C1                             00000000
S16C2                             00000000
S16C3                             00000000
S17C0                             00000001
S17C1                             00000001
S17C2                             00000001
S17C3                             00000001
S18C0                             00000002
S18C1                             00000002
S18C2                             00000002
S18C3                             00000002
S19C0                             00000003
S19C1                             00000003
S19C2                             00000003
S19C3                             00000003
S1C0                              00000001
S1C1                              00000001
S1C2                              00000001
S1C3                              00000001
S20C0                             00000004
S20C1                             00000004
S20C2                             00000004
S20C3                             00000004
S21C0                             00000005
S21C1                             00000005
S21C2                             00000005
S21C3                             00000005
S22C0                             00000006
S22C1                             00000006
S22C2                             00000006
S22C3                             00000006
S23C0                             00000007
S23C1                             00000007
S23C2                             00000007
S23C3                             00000007
S2C0                              00000002
S2C1                              00000002
S2C2                              00000002
S2C3                              00000002
S3C0                              00000003
S3C1                              00000003
S3C2                              00000003
S3C3                              00000003
S4C0                              00000004
S4C1                              00000004
S4C2                              00000004
S4C3                              00000004
S5C0                              00000005
S5C1                              00000005
S5C2                              00000005
S5C3                              00000005
S6C0                              00000006
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 66


SYMBOL TABLE
  LABEL                             VALUE 

S6C1                              00000006
S6C2                              00000006
S6C3                              00000006
S7C0                              00000007
S7C1                              00000007
S7C2                              00000007
S7C3                              00000007
S8C0                              00000000
S8C1                              00000000
S8C2                              00000000
S8C3                              00000000
S9C0                              00000001
S9C1                              00000001
S9C2                              00000001
S9C3                              00000001
SAVED_TEMPERATURE                 00000034
SBOREN                            00000004
SC                                BTFSC
SCS                               00000000
SE0                               00000000
SE1                               00000001
SE10                              00000002
SE11                              00000003
SE12                              00000004
SE13                              00000005
SE14                              00000006
SE15                              00000007
SE16                              00000000
SE17                              00000001
SE18                              00000002
SE19                              00000003
SE2                               00000002
SE20                              00000004
SE21                              00000005
SE22                              00000006
SE23                              00000007
SE3                               00000003
SE4                               00000004
SE5                               00000005
SE6                               00000006
SE7                               00000007
SE8                               00000000
SE9                               00000001
SECONDS_TASKS                     000002AD
SEG0COM0                          00000000
SEG0COM1                          00000000
SEG0COM2                          00000000
SEG0COM3                          00000000
SEG10COM0                         00000002
SEG10COM1                         00000002
SEG10COM2                         00000002
SEG10COM3                         00000002
SEG11COM0                         00000003
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 67


SYMBOL TABLE
  LABEL                             VALUE 

SEG11COM1                         00000003
SEG11COM2                         00000003
SEG11COM3                         00000003
SEG12COM0                         00000004
SEG12COM1                         00000004
SEG12COM2                         00000004
SEG12COM3                         00000004
SEG13COM0                         00000005
SEG13COM1                         00000005
SEG13COM2                         00000005
SEG13COM3                         00000005
SEG14COM0                         00000006
SEG14COM1                         00000006
SEG14COM2                         00000006
SEG14COM3                         00000006
SEG15COM0                         00000007
SEG15COM1                         00000007
SEG15COM2                         00000007
SEG15COM3                         00000007
SEG16COM0                         00000000
SEG16COM1                         00000000
SEG16COM2                         00000000
SEG16COM3                         00000000
SEG17COM0                         00000001
SEG17COM1                         00000001
SEG17COM2                         00000001
SEG17COM3                         00000001
SEG18COM0                         00000002
SEG18COM1                         00000002
SEG18COM2                         00000002
SEG18COM3                         00000002
SEG19COM0                         00000003
SEG19COM1                         00000003
SEG19COM2                         00000003
SEG19COM3                         00000003
SEG1COM0                          00000001
SEG1COM1                          00000001
SEG1COM2                          00000001
SEG1COM3                          00000001
SEG20COM0                         00000004
SEG20COM1                         00000004
SEG20COM2                         00000004
SEG20COM3                         00000004
SEG21COM0                         00000005
SEG21COM1                         00000005
SEG21COM2                         00000005
SEG21COM3                         00000005
SEG22COM0                         00000006
SEG22COM1                         00000006
SEG22COM2                         00000006
SEG22COM3                         00000006
SEG23COM0                         00000007
SEG23COM1                         00000007
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 68


SYMBOL TABLE
  LABEL                             VALUE 

SEG23COM2                         00000007
SEG23COM3                         00000007
SEG2COM0                          00000002
SEG2COM1                          00000002
SEG2COM2                          00000002
SEG2COM3                          00000002
SEG3COM0                          00000003
SEG3COM1                          00000003
SEG3COM2                          00000003
SEG3COM3                          00000003
SEG4COM0                          00000004
SEG4COM1                          00000004
SEG4COM2                          00000004
SEG4COM3                          00000004
SEG5COM0                          00000005
SEG5COM1                          00000005
SEG5COM2                          00000005
SEG5COM3                          00000005
SEG6COM0                          00000006
SEG6COM1                          00000006
SEG6COM2                          00000006
SEG6COM3                          00000006
SEG7COM0                          00000007
SEG7COM1                          00000007
SEG7COM2                          00000007
SEG7COM3                          00000007
SEG8COM0                          00000000
SEG8COM1                          00000000
SEG8COM2                          00000000
SEG8COM3                          00000000
SEG9COM0                          00000001
SEG9COM1                          00000001
SEG9COM2                          00000001
SEG9COM3                          00000001
SEGEN0                            00000000
SEGEN1                            00000001
SEGEN10                           00000002
SEGEN11                           00000003
SEGEN12                           00000004
SEGEN13                           00000005
SEGEN14                           00000006
SEGEN15                           00000007
SEGEN16                           00000000
SEGEN17                           00000001
SEGEN18                           00000002
SEGEN19                           00000003
SEGEN2                            00000002
SEGEN20                           00000004
SEGEN21                           00000005
SEGEN22                           00000006
SEGEN23                           00000007
SEGEN3                            00000003
SEGEN4                            00000004
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 69


SYMBOL TABLE
  LABEL                             VALUE 

SEGEN5                            00000005
SEGEN6                            00000006
SEGEN7                            00000007
SEGEN8                            00000000
SEGEN9                            00000001
SEND_MESSAGES                     000000A2
SEND_OFF_PERIOD                   0000001E
SEND_ON_PERIOD                    00000384
SET                               BSF
SET_TMR_TX                        00000472
SIXTY_MINUTES                     0000003C
SKPB                              SKPNC
SKPNB                             SKPC
SLPEN                             00000006
SMP                               00000007
SND_BOOSTON_MSG                   LCD_CHAR4,2
SND_BOO_OFF_MSG                   LCD_CHAR4,3
SND_LEARN_MSG                     LCD_CHAR4,5
SND_OFF_MSG                       LCD_CHAR4,0
SND_ON_MSG                        LCD_CHAR4,1
SND_REFRESH_MSG                   LCD_CHAR4,7
SND_TEMP_MSG                      LCD_CHAR4,4
SND_TEST_MSG                      LCD_CHAR4,6
SPARE                             NEW_BUTTON_CONFIG,0
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SS                                BTFSS
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
SWAPBCD                           000003EF
SWDTE                             00000000
SWDTEN                            00000000
SYNC                              00000004
S_KB6                             NEW_BUTTON_CONFIG,6
S_KB7                             NEW_BUTTON_CONFIG,7
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 70


SYMBOL TABLE
  LABEL                             VALUE 

T1CON                             00000010
T1GE                              00000006
T1GINV                            00000007
T1GSS                             00000001
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TAB_FASE_HCS                      00000482
TEMPETR                           LCD_CHAR1,5
TEMP_BYT0_B0                      00000020
TEMP_BYT0_B2                      00000123
TEMP_BYT1_B0                      00000021
TEMP_BYT1_B2                      00000124
TEMP_ROTATE                       0000004B
TEST_BATTERY                      000003F3
TEST_BUTTONS                      00000249
THREEHR                           LCD_CHAR1,3
TMPTR_VALUE                       00000076
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR1_IF                           PIR1,TMR1IF
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TMR_1SECOND                       0000003E
TMR_HCS                           00000001
TMR_HCS_ON                        _TMR1ON
TOGGLE_LCD                        00000122
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRASMISSIONE_HCS                  FLAGS_HCS,0
TREAT_BATTERY_DISPLAY             0000029B
TRISA                             00000085
TRISB                             00000086
TRISC                             00000087
TRISD                             00000088
TRISE                             00000089
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 71


SYMBOL TABLE
  LABEL                             VALUE 

TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TWELVEHR                          LCD_CHAR1,4
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXENBL_TRIS                       TRISA,0
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
TX_ENABLE                         PORTA,0
UA                                00000001
UNLOCKING                         LCD_CHAR3,4
UPDATE_LCD                        00000347
VCFG0                             00000005
VCFG1                             00000006
VDIODE                            PORTE,2
VLCDEN                            00000004
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             0000009D
VREN                              00000007
VRR                               00000005
W                                 00000000
WA                                00000004
WAVE_TYPE_B                       
WCOL                              00000007
WDTCON                            00000105
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WERR                              00000005
WF                                MOVWF
WFT                               00000007
WFT_A                             00000000
WFT_B                             00000080
WPU                               00000095
WPU0                              00000000
WPU1                              00000001
WPU2                              00000002
WPU3                              00000003
WPU4                              00000004
WPU5                              00000005
WPU6                              00000006
WPU7                              00000007
WPUB                              00000095
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 72


SYMBOL TABLE
  LABEL                             VALUE 

WPUB0                             00000000
WPUB1                             00000001
WPUB2                             00000002
WPUB3                             00000003
WPUB4                             00000004
WPUB5                             00000005
WPUB6                             00000006
WPUB7                             00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WR_ERRORS                         00000120
WR_NOERRORS                       00000121
Z                                 00000002
_ACCEPT_HEAT_CHANGE               000001FF
_ADCON_GO                         000003F4
_ADD_HOUR                         000001CF
_ADD_MINUTE                       0000019C
_AO_DONE                          00000307
_AUTOLOCK_DEBOUNCE_PERIOD         0000027F
_AUTOLOCK_REJECT                  00000115
_AUTOSHUTOFF                      000002FD
_BATTERY                          000003DE
_BATTERY_COUNTER                  0000031E
_BATTERY_LOW                      00000402
_BATTERY_OK                       00000413
_BATTERY_WARNING                  0000040E
_BATT_FIN                         000002AC
_BATT_GOOD                        000002AB
_BATT_LOW                         000002A6
_BL1                              000002E0
_BOD_NSLEEP                       00003EFF
_BOD_OFF                          00003CFF
_BOD_ON                           00003FFF
_BOD_SBODEN                       00003DFF
_BOOST                            000003E4
_BOOST_CYCLE_END                  000002C9
_BOOST_OFF_MSG                    000000C0
_BOOST_OFF_SECS                   000002B6
_BOOST_ON_MSG                     000000BB
_BUTTON_END                       0000028B
_CHKSUM_LOOP                      000000F0
_CLEAR_DEBOUNCE                   0000028A
_COLON                            0000038D
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEBOUNCING                       0000026B
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         00002FFF
_DECHR                            000001E0
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 73


SYMBOL TABLE
  LABEL                             VALUE 

_DECMIN                           000001AB
_DELAY_MSG_SEND                   0000021A
_DISPLAY_ADJUSTMENTS              0000022C
_DISP_AUTO_OFF                    0000016F
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_GIE                              INTCON,GIE
_GO1_HR                           000001D8
_GO1_MIN                          000001A5
_HANDLE_CLK_SET                   00000181
_HANDLE_FIN                       00000232
_HEAT_DEBOUNCE_PERIOD             00000282
_HEAT_MSG_ACTION                  00000203
_HEAT_MSG_COUNTDOWN               00000223
_HOURS                            0000038F
_HR_ADJUST                        000001BD
_HS_OSC                           00003FFA
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INCHR                            00000314
_INCMIN                           000002F3
_INTE                             INTCON,INTE
_INTF                             INTCON,INTF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LCDCONT                          00000359
_LCD_DONE                         000003E6
_LED1_END                         0000029A
_LED1_SET                         00000299
_LOCKED                           000003DC
_LOOP_DELAY                       00000101
_LP_OSC                           00003FF8
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_MIN_ADJUST                       0000018A
_MODE12HR                         00000160
_MODE1HR                          00000147
_MODE3HR                          00000156
_MODE_HOUR                        000001E7
_MODE_MIN                         000001B1
_MODE_OFF                         0000016A
_MSG_CONT1                        000000CC
_MSG_CONT2                        000000D0
_MSG_CONT3                        000000D3
_MSG_FIN                          00000107
_NEW_ACTIONS                      0000011C
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 74


SYMBOL TABLE
  LABEL                             VALUE 

_NEW_CLKSET                       00000174
_NEW_CLK_ADJ                      00000176
_NEW_HOURS                        000001E1
_NEW_MINUTES                      000001AC
_NEW_MODE                         0000013C
_NEW_MSG                          000000AC
_NEW_TEMP_VARS                    000001F5
_NEXT_HANDLE                      00000118
_NORMAL_DEBOUNCE_PERIOD           00000287
_NO_BLKHR                         000001C5
_NO_BLKMIN                        00000192
_NO_MORE_ACTION                   0000022F
_OFF                              000003E2
_ON                               000003E0
_ON_MSG                           000000B1
_PEIE                             INTCON,PEIE
_PREHEAT                          00000124
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_REFRESH_MSG                      000000B6
_RELOAD_AO_MINUTES                00000304
_RELOAD_ON_MSG                    000002D1
_RELOCK_REACHED                   000002EA
_RELOCK_SECS                      000002E3
_RESEND_OFF_MSG                   000002F6
_RESEND_ON_MSG                    000002CB
_RESET_RELOCK                     00000230
_RE_SEND                          000000FA
_RT_DONE                          00000323
_RT_HOURS                         0000030F
_RT_MINUTES                       000002EE
_RT_SECONDS                       000002D8
_SAVE_MINUTES                     0000016D
_SECONDS_END                      000002D4
_SKIPHR                           000001CA
_SKIPMIN                          00000197
_SND_LEARN_MSG                    000000C5
_SND_TEST_MSG                     000000C9
_SNOOZE                           00000079
_START_DEBOUNCING                 00000276
_STAY_UP                          0000008C
_SUB_HOUR                         000001D9
_SUB_MINUTE                       000001A6
_T0IE                             INTCON,T0IE
_T0IF                             INTCON,T0IF
_TB_CONT                          00000265
_TB_LOCK                          0000025A
_TB_UNLOCK                        00000260
_TB_WAIT                          0000024D
_TEMPERATURE                      000003BF
_TEMPHIGH                         000003C3
_TEMP_CONT                        000003C9
_TEMP_DECR                        00000212
MPASM  4.02 Released                               TXMAIN.ASM   1-20-2006  12:16:03         PAGE 75


SYMBOL TABLE
  LABEL                             VALUE 

_TEMP_INCR                        0000020A
_TESTBATT_DONE                    00000417
_TM1ENDEND                        00000332
_TURN_LED1_OFF                    00000296
_TURN_LED1_ON                     00000292
_TURN_OFF_BL                      000002E2
_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_WRAP_HIGH                        00000218
_WRAP_ZERO                        00000210
_XT_OSC                           00003FF9
__16F914                          00000001
main                              0000001B


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XX--XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
02C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
03C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0480 : XXXXXXXX-------- ---------------- ---------------- ----------------
07C0 : ---------------- ---------------- ---------------- ------------XXXX
0800 : X--------------- ---------------- ---------------- ----------------
2000 : XXXX---X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:  1163
Program Memory Words Free:  2933


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,   137 suppressed

